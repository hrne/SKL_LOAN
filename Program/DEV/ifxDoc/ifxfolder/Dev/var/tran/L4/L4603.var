!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L4603)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,8)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,81)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,40)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)
</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L4603" layout="cols=1;screen.width=[150,850];printer.width=[20,80];order=1">
[
["[L4603]@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@火險通知作業"],
[#<->#,"#FdInsuEndMonth+火險到期年月",#InsuEndMonth],
]

#ReportC=X,1,S,ui:button;value: ;enable:1;tabbable:0

#FdInsuEndMonth=X,2,L
T(3,*)

#CHAIN=A,1,S
T(4,CHAIN$) 

#NEXT_MONTH=D,8,S
D(7,2,#SYSDATE,1,0)

#CheckDays=m,2,S
T(1,#SYSDATE,7,2)
T(2,@ReportC,V)

! 火險到期年月 15號前為當月，15號後為下個月
#InsuEndMonth=A,5,I
IF(#CheckDays<15,T(1,#SYSDATE,2,5),T(1,#NEXT_MONTH,2,5))
@A(YM,1,#InsuEndMonth)

#RPTFG=A,1,S

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>

#L461CPRT=A,1,S
C(4,#ReportC,E(0,0),$)
C(5,#TXFORM,L461C,E(0,1),E(0,0))
![資料表頭(HEADER)長度]
#L461CHD=n,3,S
C(4,#ReportC,S,$)E(0,6)ASGN(INQHD$)
![每筆明細(OCCURS)長度]
#L461CLN=n,3,S
C(4,#ReportC,S,$)E(0,202)ASGN(INQLEN$)
![每張印錄單列印的筆數]
#L461CQPRT=n,2,S
C(4,#ReportC,S,$)E(0,40)ASGN(INQPRT$)
![畫面顯示的明細間的高度]
#L461CLOOP=n,3,S
C(4,#ReportC,S,$)E(0,1)ASGN(LOOPHEIGHT$)

</sub>

!------------ TXFORM = L4603 -----------
<sub type="FORM" name="L4603">
! 媒體檔FileNo
!#PdfSnoM=X,8,S
!E(2,@SnoM,#PdfSnoM)
!#SnoM=A,8,S

! 媒體檔FileNo
!#PdfPrtM=A,1,S
!C(3,#SnoM,0,E(0,0),E(0,1))

#LOOP=X,1,S
E(0,1)ASGN(LOOP$)

#OOCustNo=A,7,O
#OOFacmNo=A,3,O

#OOCustNoX=X,11,O
T(2,#OOCustNo+-+#OOFacmNo)

#OOClCode1=A,1,O
#OOClCode2=A,2,O
#OOClNo=A,7,O

#OOClNoX=X,12,O
T(2,#OOClCode1+-+#OOClCode2+-+#OOClNo)

#OOCustName=c,40,O

#OOInsuNo=X,20,O

#OOLableA=A,1,O

#OOLableAX=X,10,O
C(2,#OOLableA,T(2,火險通知單),
T(2,書面通知),
T(2,簡訊通知),
T(2,電子郵件),
T(2,不通知))
E(0,@L461CPRT,0)

</sub>

<sub type="FORM" name="L461C" tota-mode="1">
#ErrorCCnt=m,6,O
! IF(#ErrorCCnt==0,E(0,@L461CPRT,0),$)
#L461C_LOOP=X,1,S
E(0,1)ASGN(LOOP$)
#ReportCClCode1=X,1,O
C(3,#ReportCClCode1,0,S,E(0,@ReportCClCode1T,#ReportCClCode1))
#ReportCClCode1T=A,1,O
C(3,#ReportCClCode1,0,S,$)
T(2,@ReportCClCode1,#ReportCClCode1T)

#ReportCClCode2=X,2,O
C(3,#ReportCClCode2,0,S,E(0,@ReportCClCode2T,#ReportCClCode2))
#ReportCClCode2T=A,2,O
C(3,#ReportCClCode2,0,S,$)
T(2,@ReportCClCode2,#ReportCClCode2T)

#ReportCClNo=X,7,O
C(3,#ReportCClNo,0,S,E(0,@ReportCClNoT,#ReportCClNo))
#ReportCClNoT=A,7,O
C(3,#ReportCClNo,0,S,$)
T(2,@ReportCClNo,#ReportCClNoT)

#ReportCPrevInsuNo=X,16,O

#ReportCCustNo=X,7,O
C(3,#ReportCCustNo,0,S,E(0,@ReportCCustNoT,#ReportCCustNo))
#ReportCCustNoT=A,7,O
C(3,#ReportCCustNo,0,S,$)
T(2,@ReportCCustNo,#ReportCCustNoT)

#ReportCFacmNo=X,3,O
C(3,#ReportCFacmNo,0,S,E(0,@ReportCFacmNoT,#ReportCFacmNo))
#ReportCFacmNoT=A,3,O
C(3,#ReportCFacmNo,0,S,$)
T(2,@ReportCFacmNo,#ReportCFacmNoT)

#ReportCCustName=c,20,O
#ReportCNewInsuStartDate=D,8,O
C(3,#ReportCNewInsuStartDate,0,S,$)
#ReportCNewInsuEndDate=D,8,O
C(3,#ReportCNewInsuEndDate,0,S,$)

#ReportCFireAmt=m,18,O
C(3,#ReportCFireAmt,0,S,$)

#ReportCFireAmtX=X,18,O
CALL2(#ADJUSTDOT,2,#ReportCFireAmt,#ReportCFireAmtX)
P(R,#ReportCFireAmtX)

#ReportCFireFee=m,18,O
C(3,#ReportCFireFee,0,S,$)

#ReportCFireFeeX=X,18,O
CALL2(#ADJUSTDOT,2,#ReportCFireFee,#ReportCFireFeeX)
P(R,#ReportCFireFeeX)

#ReportCEthqAmt=m,18,O
C(3,#ReportCEthqAmt,0,S,$)

#ReportCEthqAmtX=X,18,O
CALL2(#ADJUSTDOT,2,#ReportCEthqAmt,#ReportCEthqAmtX)
P(R,#ReportCEthqAmtX)

#ReportCEthqFee=m,18,O
C(3,#ReportCEthqFee,0,S,$)

#ReportCEthqFeeX=X,18,O
CALL2(#ADJUSTDOT,2,#ReportCEthqFee,#ReportCEthqFeeX)
P(R,#ReportCEthqFeeX)

#ReportCTotlFee=m,18,O
C(3,#ReportCTotlFee,0,S,$)

#ReportCTotlFeeX=X,18,O
CALL2(#ADJUSTDOT,2,#ReportCTotlFee,#ReportCTotlFeeX)
P(R,#ReportCTotlFeeX)

#ReportCErrMsg=c,40,O
E(0,@RPTFG,1)

</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#InsuEndMonth
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
TXFORM=L4603
#OOCustNo
#OOFacmNo
#OOClCode1
#OOClCode2
#OOClNo
#OOInsuNo
#OOCustName
#OOLableA
^
TXFORM=L461C
#ErrorCCnt
#ReportCClCode1
#ReportCClCode2
#ReportCClNo
#ReportCPrevInsuNo
#ReportCCustNo
#ReportCFacmNo
#ReportCCustName
#ReportCNewInsuStartDate
#ReportCNewInsuEndDate
#ReportCFireAmt
#ReportCFireFee
#ReportCEthqAmt
#ReportCEthqFee
#ReportCTotlFee
#ReportCErrMsg
^

</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
#RPTFG=0,QUERY.GRID
#any={detail:true, caption:'', rowNum:40, rowList:[20,40,60]}
#OOCustNoX=戶號
{width:120}

#OOClNoX=擔保品代號
{width:120}

#OOInsuNo=原保單號碼
{width:120}

#OOCustName=戶名
{width:120}

#OOLableAX=通知種類
{width:120}
^

#L461CPRT=1,L461C,NA,,D,15
%
#ReportCClCode1
#ReportCClCode2
#ReportCClNo
#ReportCPrevInsuNo
#ReportCCustNo
#ReportCFacmNo
#ReportCCustName
#ReportCNewInsuStartDate
#ReportCNewInsuEndDate
#ReportCFireAmtX
#ReportCFireFeeX
#ReportCEthqAmtX
#ReportCEthqFeeX
#ReportCTotlFeeX
#ReportCErrMsg
@
^
</sub>
