----- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

!#TXCD
!T(3,L4965)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,0)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,251)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,20)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

#button=x,1,S
K(MODIFYBUTTON,查詢)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)

!#FKEY
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L4965" layout="cols=1;screen.width=[130,1100];printer.width=[20,20];">
[
["[L4965]                                 保險單明細資料查詢"],
["#FdSearchFlag+查詢方法",#SearchFlag,#SearchFlagX],
["#FdClCode1+擔保品編號",#ClCode1,"-",#ClCode2,"-",#ClNo],
["#FdCustNo+戶號",#CustNo,"-",#FacmNo],
["#FdApplNo+核准號碼",#ApplNo],
["#FdNowInsuNo+保險單號碼",#NowInsuNo],
["#FdInsuCompany+保險公司",#InsuCompany,#InsuCompanyX],
["#FdInsuTypeCode+保險類別",#InsuTypeCode,#InsuTypeCodeX],
["#FdInsuEndDateFrom+保險到期日",#InsuEndDateFrom,"@-@",#InsuEndDateTo],
]

#FdSearchFlag=X,2,L
T(3,*)
#FdClCode1=X,2,L
T(3,*)
#FdCustNo=X,2,L
T(3,*)
#FdApplNo=X,2,L
T(3,*)
#FdNowInsuNo=X,2,L
#FdInsuCompany=X,2,L
T(3,*)
#FdInsuTypeCode=X,2,L
T(3,*)
#FdInsuEndDateFrom=X,2,L
T(3,*)


!---------- AP Button AREA ----------
![Buttom資料查詢]
#BUF1=X,42,S
!---------- AP TEXT AREA Variables ----------

!Help
<include src="HELPRIM.icf::HELPRIM.rtn"/>

![代號2]
#CDDEF01=x,26,S
T(3,CdCode.ClCode21)

#ClCode21Help=x,1024,S

![保險公司]
#CDDEF02=x,26,S
T(3,CdCode.InsuCompany)

#InsuCompanyHelp=x,1024,S

![保險類別]
#CDDEF03=x,26,S
T(3,CdCode.InsuTypeCode)

#InsuTypeCodeHelp=x,1024,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDDEF01,#CDDEF02,#CDDEF03)
R(1,XXR99)
CALL(#HelpProc)
T(2,@ClCode21Help,#HelpDesc1) 
T(2,@InsuCompanyHelp,#HelpDesc2)
T(2,@InsuTypeCodeHelp,#HelpDesc3)

#SearchFlagHelp=x,100,S
T(3,1:擔保品編號;2:戶號;3:核准號螞;4:保險單號碼;5:保險公司;6:保險類別)

#CHAIN=A,1,S
T(4,CHAIN$)
T(2,@RimTxCode,#TXCD)
E(0,@RimFKey,#FKEY)

#NTXBUF=X,13,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@SearchFlag,#NTXBUF,1,1)
T(1,@CustNo,#NTXBUF,2,7)
T(1,@FacmNo,#NTXBUF,9,3)

! 查詢選項
#SearchFlag=A,1,I
C(3,#CHAIN,1,s,$)
HELP(#SearchFlagHelp)
@V(H,#SearchFlagHelp)
!HELP(
!1:擔保品編號;
!2:戶號;
!3:核准號螞;
!4:保險單號碼;
!5:保險公司;
!6:保險類別
!)
!@V(1,1,2,3,4,5,6)
SWITCH(#SearchFlag
,1,
INVOKEJS(SHOW,L4965_2,1)
INVOKEJS(SHOW,L4965_3,0)
INVOKEJS(SHOW,L4965_4,0)
INVOKEJS(SHOW,L4965_5,0)
INVOKEJS(SHOW,L4965_6,0)
INVOKEJS(SHOW,L4965_7,0)
,2,
INVOKEJS(SHOW,L4965_2,0)
INVOKEJS(SHOW,L4965_3,1)
INVOKEJS(SHOW,L4965_4,0)
INVOKEJS(SHOW,L4965_5,0)
INVOKEJS(SHOW,L4965_6,0)
INVOKEJS(SHOW,L4965_7,0)
,3,
INVOKEJS(SHOW,L4965_2,0)
INVOKEJS(SHOW,L4965_3,0)
INVOKEJS(SHOW,L4965_4,1)
INVOKEJS(SHOW,L4965_5,0)
INVOKEJS(SHOW,L4965_6,0)
INVOKEJS(SHOW,L4965_7,0)
,4,
INVOKEJS(SHOW,L4965_2,0)
INVOKEJS(SHOW,L4965_3,0)
INVOKEJS(SHOW,L4965_4,0)
INVOKEJS(SHOW,L4965_5,1)
INVOKEJS(SHOW,L4965_6,0)
INVOKEJS(SHOW,L4965_7,0)
,5,
INVOKEJS(SHOW,L4965_2,0)
INVOKEJS(SHOW,L4965_3,0)
INVOKEJS(SHOW,L4965_4,0)
INVOKEJS(SHOW,L4965_5,0)
INVOKEJS(SHOW,L4965_6,1)
INVOKEJS(SHOW,L4965_7,0)
,6,
INVOKEJS(SHOW,L4965_2,0)
INVOKEJS(SHOW,L4965_3,0)
INVOKEJS(SHOW,L4965_4,0)
INVOKEJS(SHOW,L4965_5,0)
INVOKEJS(SHOW,L4965_6,0)
INVOKEJS(SHOW,L4965_7,1)
)

#PrtFlag=A,1,S
C(3,#SearchFlag,0,E(0,0),E(0,1))


#SearchFlagX=X,10,L        
T(3,)T(H,#SearchFlag,#SearchFlagHelp)
SWITCH(#SearchFlag,1,T(3,擔保品編號),
                   2,T(3,戶號),
                   3,T(3,核准號螞),
                   4,T(3,保險單號碼),
                   5,T(3,保險公司),
                   6,T(3,保險類別))


!代號1 可不輸入,若有輸入只可輸入1,9
#ClCode1=X,1,I
C(3,#SearchFlag,1,$,S)
@
T(2,1)

!代號2 可不輸入
#ClCode2=A,2,I
C(3,#SearchFlag,1,$,S)
C(2,#ClCode1,$,HELP(#ClCode21Help))
@C(2,#ClCode1,T(3,),V(H,#ClCode21Help))
!C(2,#ClCode1,$,
!             HELP(01: 房地-住宅;02: 房地-辦公;03: 房地-商場;04: 房地-廠房;05: 房地-停車位;99: 房地-其他)
! )
!@C(2,#ClCode1,T(3,),
!             V(1,1,2,3,4,5,99)
! )

!擔保品編號 可不輸入
#ClNo=A,7,I
C(3,#SearchFlag,1,$,S)
@V(2,0)

!戶號 可不輸入
#CustNo=A,7,I
C(3,#SearchFlag,2,$,S)
C(3,#CHAIN,1,s,$)
@V(2,0)

!額度編號 可不輸入
#FacmNo=A,3,I
C(3,#SearchFlag,2,$,S)
C(3,#CHAIN,1,s,$)



!核准號碼 可不輸入
#ApplNo=A,7,I
C(3,#SearchFlag,3,$,S)
@V(2,0)

!用核准號碼(ApplNo)調L2R05
#SendL2r05A=X,1,S
C(3,#ApplNo,0,S,$)
E(0,@RimFuncCode,5)
E(0,@RimCustNo,#CustNo)
E(0,@RimFacmNo,0)
E(0,@RimApplNo,#ApplNo)
E(0,@RimCaseNo,0)
RESET_RIM(#SendL2r05A,L2R05)
S(L2R05,1,#RimFuncCode,#RimTxCode,#RimFKey,#RimCustNo,#RimFacmNo,#RimApplNo,#RimCaseNo)
R(1,L2R05)

#TimCustNo=A,7,S
E(0,0)
C(3,#CustNo,0,$,E(0,#CustNo))
C(3,#ApplNo,0,$,E(0,#L2r05CustNo))

#MRKEY=_,_,S
C(3,#FacmNo,0,T(2,#TimCustNo),T(2,#TimCustNo+-+#FacmNo)) 

!保險單號碼 可不輸入
#NowInsuNo=X,16,I
C(3,#SearchFlag,4,$,s)
@V(7)
!保險公司 可不輸入
#InsuCompany=X,2,I
C(3,#SearchFlag,5,$,s)
HELP(#InsuCompanyHelp,cols:5)
@
V(7)
V(H,#InsuCompanyHelp)
!HELP(L2DEF,ISUCOMPANYDEF,ISUCOM,ISUCOMX,cols:5)
! HELP(L2DEF,InsuCompanyPANYDEF,InsuCompany,InsuCompanyX,cols:5)
!@C(4,#InsuCompany,S,I)
!V(E,0,L2DEF,ISUCOMPANYDEF)

#InsuCompanyX=X,10,L
C(4,#InsuCompany,S,$)
T(H,#InsuCompany,#InsuCompanyHelp)
!T(A,#InsuCompany,L2DEF,ISUCOMPANYDEF,ISUCOM,ISUCOMX)

!保險類別 可不輸入
#InsuTypeCode=X,2,I
C(3,#SearchFlag,6,$,s)
HELP(#InsuTypeCodeHelp,cols:5)
@C(4,#InsuTypeCode,S,I)
V(H,#InsuTypeCodeHelp)
!HELP(L2DEF,ISUTYPEDEF,ISUTYPE,ISUTYPEX,cols:5)
!@C(4,#InsuTypeCode,S,I)
!V(E,0,L2DEF,ISUTYPEDEF)

#InsuTypeCodeX=X,14,L
C(4,#InsuTypeCode,S,$)
T(H,#InsuTypeCode,#InsuTypeCodeHelp)
!T(A,#InsuTypeCode,L2DEF,ISUTYPEDEF,ISUTYPE,ISUTYPEX)

!保險到期日(搜尋範圍起~訖)  可不輸入
#InsuEndDateFrom=D,7,I
E(0,0010101)
C(3,#CHAIN,1,s,$)
@A(DATE,0,#InsuEndDateFrom)
#InsuEndDateTo=D,7,I
E(0,9991231)
C(3,#CHAIN,1,s,$)
@A(DATE,0,#InsuEndDateTo)


#RPTFG=A,1,S

!查詢
#FUNC2=A,1,S
E(0,2)

#CHAINXMT=X,1,S
C(3,#CHAIN,1,E(0,@CHAIN,0)XMT(),$)


<include src="ROM.icf::L0Rim.dec"/>
<include src="ROM.icf::L2Rim.dec"/>
<include src="ROM.icf::L3Rim.dec"/>
<include src="ROM.icf::L2R05.dec"/>
</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>


!---------- TXFORM = L4965 ----------
<sub type="FORM" name="L4965">
#SCRTIL=_,_,S
T(3,[L4965] 保險單明細資料)

#LOOP=X,1,S
E(0,1)ASGN(LOOP$)

#OOCustNo=A,7,O

#OOCustName=X,100,O

#OOFacmNo=A,3,O

#OOApplNo=A,7,O


#OOClCode1=A,1,O

#OOClCode2=A,2,O

#OOClNo=A,7,O

#OOClNoX=X,12,O
T(2,#OOClCode1+-+#OOClCode2+-+#OOClNo)

#OONowInsuNo=X,17,O

#OOEndoInsuNo=X,17,O

#OOInsuCompany=X,12,O

#OOInsuCompanyX=X,12,O
T(H,#OOInsuCompany,#InsuCompanyHelp)
!T(A,#OOInsuCompany,L2DEF,ISUCOMPANYDEF,ISUCOM,ISUCOMX)

#OOFireInsuCovrg=m,14.2,O

#OOFireInsuPrem=m,14.2,O

#OOEthqInsuCovrg=m,14.2,O

#OOEthqInsuPrem=m,14.2,O

#OOInsuStartDate=D,7,O

#OOInsuEndDate=D,7,O

!查詢
#OOBUF2=X,11,S
T(2,#FUNC2)

#OOBTN2=X,1,S
BIND(grid,{ cmd=CHAIN; ntxcd=L4A04; ntxbuf=#OOBUF2})


!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------

</sub>


!------ 上行電文 ------
<sub type="TIM">
#SearchFlag
#ClCode1
#ClCode2
#ClNo
#CustNo
#FacmNo
#ApplNo
#NowInsuNo
#InsuCompany
#InsuTypeCode
#InsuEndDateFrom
#InsuEndDateTo
#END
</sub>


!------ 下行電文TOM ------
<sub type="TOM">
TXFORM=L4965
#OOCustNo
#OOCustName
#OOFacmNo
#OOApplNo
#OOClCode1
#OOClCode2
#OOClNo
#OONowInsuNo
#OOEndoInsuNo
#OOInsuCompany
#OOFireInsuCovrg
#OOFireInsuPrem
#OOEthqInsuCovrg
#OOEthqInsuPrem
#OOInsuStartDate
#OOInsuEndDate
^
<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L2R05.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>

<sub type="PART" prompt='{{#SCRTIL}} world' name="L4965" layout="cols=3;screen.width=[100,900];order=1;">
[
["[L4965                                  保險單明細資料查詢"],
[""],
]
</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">

#PrtFlag=1,QUERY.GRID
#any={detail:true, header:'L4965.part',caption:'', width:1000, rowNum:20, rowList:[20,40,60]}
#OOCustNo=戶號
{width:50,align:'center'}
#OOCustName=戶名
{width:80,align:'center'}
#OOFacmNo=額度編號
{width:80,align:'center'}
#OOApplNo=核准號碼
{width:80,align:'center'}
#OOClNoX=擔保品編號
{width:100,align:'center'}
#OONowInsuNo=保險單號碼
{width:100,align:'center'}
#OOEndoInsuNo=批單號碼
{width:100,align:'center'}
#OOInsuCompanyX=保險公司
{width:80,align:'left'}
#OOFireInsuCovrg=火災險保險金額
{width:150,align:'right'}
#OOFireInsuPrem=火災險保費
{width:120,align:'right'}
#OOEthqInsuCovrg=地震險保險金額
{width:150,align:'right'}
#OOEthqInsuPrem=地震險保費
{width:120,align:'right'}
#OOInsuStartDate=保險起日
{width:80,align:'center'}
#OOInsuEndDate=保險到期日
{width:100,align:'center'}
^

<include src="PRT.icf::INQ01.sel" map="i=L4965;cpi=15"/>




<include src="PRT.icf::INQ01.sel"/>
</sub>
