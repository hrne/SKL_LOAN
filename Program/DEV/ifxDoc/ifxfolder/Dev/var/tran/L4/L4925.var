!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L3001)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,0)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,427)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,40)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

#button=x,1,S
K(MODIFYBUTTON,查詢)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L4925" layout="cols=1;screen.width=[130,870];printer.width=[20,80];order=1">
[
["[L4925]@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@整批入帳明細查詢(By日期區間)"],
[#<->#,"#FdEntryDateFrom+入帳日期",#EntryDateFrom,"-",#EntryDateTo],
[#<->#,"#FdRepayCode+還款來源",#RepayCode,#RepayCodeX],
[#<->#,"#FdCustNo+戶號",#CustNo],
[#<->#,"#FdProcStsCode+處理狀態",#ProcStsCode,#ProcStsCodeX],
]

#FdEntryDateFrom=X,2,L
T(3,*)
#FdRepayCode=X,2,L
#FdCustNo=X,2,L
#FdProcStsCode=X,2,L



! Help
<include src="HELPRIM.icf::HELPRIM.rtn"/>

![還款來源]
#CDDEF01=x,26,S
T(3,CdCode.BatchRepayCode)

#RepayCodeHelp=x,1024,S

![處理狀態]
#CDDEF02=x,26,S
T(3,CdCode.ProcStsCode)

#ProcStsCodeHelp=x,1024,S

![還款類別]
#CDDEF03=x,26,S
T(3,CdCode.RepayType)

#RepayTypeHelp=x,1024,S

![批次對帳類別]
#CDDEF04=x,26,S
T(3,CdCode.ReconCode)

#ReconCodeHelp=x,1024,S

![處理說明]
#CDDEF05=x,26,S
T(3,CdCode.ProcCode)

#ProcCodeHelp=x,1024,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDDEF01,#CDDEF02,#CDDEF03,#CDDEF04,#CDDEF05)
R(1,XXR99)
CALL(#HelpProc)
T(2,@RepayCodeHelp,00:全部;+#HelpDesc1)
T(2,@ProcStsCodeHelp,#HelpDesc2)
T(2,@RepayTypeHelp,#HelpDesc3)
T(2,@ReconCodeHelp,#HelpDesc4)
T(2,@ProcCodeHelp,#HelpDesc5)

#CHAIN=A,1,S
T(4,CHAIN$) 

#NTXBUF=X,26,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@EntryDateFrom,#NTXBUF,1,7)
T(1,@EntryDateTo,#NTXBUF,8,7)
T(1,@RepayCode,#NTXBUF,15,2)
T(1,@CustNo,#NTXBUF,17,7)
INVOKEJS(SHOW,p1,02,02,1)

! 入帳日期起日
#EntryDateFrom=D,7,I
C(3,#CHAIN,0,$,s)
T(1,#SYSDATE,2,7)
@V(7)A(DATE,0,#EntryDateFrom)
E(0,@EntryDateTo,#EntryDateFrom)

! 入帳日期迄日
#EntryDateTo=D,7,I
C(3,#CHAIN,0,$,s)
@V(7)A(DATE,0,#EntryDateTo)
IF(#EntryDateTo<#EntryDateFrom,V(P,迄日不可小於起日),$)

! 還款來源
#RepayCode=A,2,I
C(3,#CHAIN,0,$,s) 
HELP(#RepayCodeHelp)
@V(H,#RepayCodeHelp)
!HELP(00:全部;
!     01:匯款轉帳;
!     02:銀行扣款;
!     03:員工扣款;
!     04:支票兌現;
!     05:法院扣薪;
!     06:理賠金;
!     07:代收款-債權協商;
!     09:其他;
!     11:匯款轉帳預先作業;
!     90:暫收抵繳)
!@V(1,00,01,02,03,04,05,06,07,09,11,90)

! 還款來源中文
#RepayCodeX=X,16,L
C(3,#CHAIN,0,$,s) 
T(3,)T(H,#RepayCode,#RepayCodeHelp)
!SWITCH(#RepayCode,00,T(3,全部),
!              01,T(3,匯款轉帳),
!              02,T(3,銀行扣款),
!              03,T(3,員工扣款),
!              04,T(3,支票兌現),
!              05,T(3,法院扣薪),
!              06,T(3,理賠金),
!              07,T(3,代收款-債權協商),
!              09,T(3,其他),
!              11,T(3,匯款轉帳預先作業),
!              90,T(3,暫收抵繳),T(3,))

! 戶號
#CustNo=A,7,I
C(3,#CHAIN,0,$,s)

#MRKEY=_,_,S
C(3,#CustNo,0,S,T(2,#CustNo))

! 處理狀態
#ProcStsCode=X,1,I
C(3,#CHAIN,0,$,s)
T(2,A)    
HELP(#ProcStsCodeHelp)
@V(H,#ProcStsCodeHelp)
!HELP(0:未檢核;
!     1:不處理;
!     2:人工處理;
!     3:檢核錯誤;
!     4:檢核正常;
!     5:人工入帳;
!     6:批次入帳;
!     7:虛擬暫收;
!     A:全部;
!     S:已處理;
!     R:待處理 )
!@V(3,0,1,2,3,4,5,6,7,A,S,R)
! 處理狀態中文
#ProcStsCodeX=X,10,L
T(3,)T(H,#ProcStsCode,#ProcStsCodeHelp)
!SWITCH(#ProcStsCode,0,T(3,未檢核),
!                 1,T(3,不處理),
!                 2,T(3,人工處理),
!                 3,T(3,檢核錯誤),
!                 4,T(3,檢核正常),
!                 5,T(3,人工入帳),
!                 6,T(3,批次入帳),
!                 7,T(3,虛擬暫收),
!                 A,T(3,全部),
!                 S,T(3,已處理),
!                 R,T(3,待處理))

#RPTFG=A,1,S

#CHAINXMT=X,1,S
C(3,#CHAIN,1,E(0,@CHAIN,0)XMT(),$)

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L4925 -----------
<sub type="FORM" name="L4925">
#SCRTIL=_,_,S
T(3,[L4925] 整批入帳明細By日期區間)

#LOOP=X,1,S
E(0,1)ASGN(LOOP$)

! 會計日期
#OOAcDate=D,7,O
! 批號
#OOBatchNo=X,6,O
! 明細序號
#OODetailSeq=A,6,O
! 還款來源
#OORepayCode=A,2,O
#OORepayCodeX=X,16,L
T(3,)T(H,#OORepayCode,#RepayCodeHelp)
!SWITCH(#OORepayCode,00,T(3,全部),
!              01,T(3,匯款轉帳),
!              02,T(3,銀行扣款),
!              03,T(3,員工扣款),
!              04,T(3,支票兌現),
!              05,T(3,法院扣薪),
!              06,T(3,理賠金),
!              07,T(3,代收款-債權協商),
!              09,T(3,其他),
!              11,T(3,匯款轉帳預先作業),
!              90,T(3,暫收抵繳),T(3,))
! 入帳日期
#OOEntryDate=D,7,O
! 戶號　
#OOCustNo=A,7,O
! 額度編號
#OOFacmNo=A,3,O
! 還款類別
#OORepayType=A,2,O
#OORepayTypeX=X,10,O
T(3,)T(H,#OORepayType,#RepayTypeHelp)
!SWITCH(#OORepayType,1,T(3,期款),
!                    2,T(3,部分償還),
!                    3,T(3,結案),
!                    4,T(3,帳管費),
!                    5,T(3,火險費),
!                    6,T(3,契變手續費),
!                    7,T(3,法務費),
!                    9,T(3,其他),
!                    T(3, ))
! 對帳類別
#OOReconCode=X,3,S
#OOReconCodeX=X,30,O
T(3,)T(H,#OOReconCode,#ReconCodeHelp)
!SWITCH(#OOReconCode,P01,T(3,銀行存款－郵局),
!                    P02,T(3,銀行存款－新光),
!                    P03,T(3,銀行存款－新光),
!                    P04,T(3,銀行存款－台新),
!                    TEM,T(3,員工扣薪),
!                    TCK,T(3,支票),
!                    C01,T(3,暫收款－非核心資金運用),
!                    T(2,))

! 還款金額(+,-)
#OORepayAmt=m,14,O
#OORepayAmtX=X,21,O
T(2,#OORepayAmt)
! 已作帳金額
#OOAcctAmt=m,14,O
#OOAcctAmtX=X,21,O
T(2,#OOAcctAmt)
! 入暫收金額
#OODisacctAmt=m,14,O
#OODisacctAmtX=X,21,O
T(2,#OODisacctAmt)
! 處理狀態
#OOProcStsCode=X,1,O
#OOProcStsCodeX=X,10,L
T(3,)T(H,#OOProcStsCode,#ProcStsCodeHelp)
!SWITCH(#OOProcStsCode,0,T(3,未檢核),
!                      1,T(3,不處理),
!                      2,T(3,人工處理),
!                      3,T(3,檢核錯誤),
!                      4,T(3,檢核正常),
!                      5,T(3,人工入帳),
!                      6,T(3,批次入帳),
!                      7,T(3,虛擬暫收),
!                      A,T(3,全部),
!                      B,T(3,扣除不處理),
!                      C,T(3,未入帳))
! 處理說明
! "處理說明+備註(例:不足金額)
! 支票:
! (帳號、票號不足位需補零)
! 帳號:+#RP_CHQACT(14)+ 
! 票號:+#RP_CHQUENO(7)+ 
! 金額:+#RP_CHQUEAMTX(16)"
#OOProcCode=X,5,O
#OOProcCodeX=X,60,O
T(3,)T(H,#OOProcCode,#ProcCodeHelp)
!SWITCH(#OOProcCode,
!00003,T(3,溢繳),
!00004,T(3,不足利息),
!00005,T(3,積欠期款),
!00101,T(3,正負對沖),
!00102,T(3,提款（借方）),
!00103,T(3,預先作業),
!00104,T(3,ACH手續費),
!00105,T(3,銀扣清算),
!00106,T(3,特殊摘要),
!00110,T(3,更正轉帳),
!00120,T(3,法院),
!00201,T(3,存款不足),
!00202,T(3,非委託用戶),
!00203,T(3,已終止委託用戶),
!00204,T(3,無此帳號),
!00205,T(3,收受者統編錯誤),
!00206,T(3,無此用戶號碼),
!00207,T(3,用戶號碼不符),
!00208,T(3,信用卡額度不足),
!00209,T(3,未開卡),
!00210,T(3,部分存款不足),
!00211,T(3,超過扣款限額),
!00222,T(3,帳戶已結清),
!00223,T(3,靜止戶),
!00224,T(3,凍結戶),
!00225,T(3,帳戶存款遭法院強制執行),
!00226,T(3,警示戶),
!00227,T(3,該用戶已死亡),
!00228,T(3,發動行申請停止入扣帳),
!00291,T(3,請參考備註一),
!00299,T(3,其他),
!00303,T(3,已終止代繳 ),
!00306,T(3,凍結警示戶 ),
!00307,T(3,支票專戶 ),
!00308,T(3,帳號錯誤 ),
!00309,T(3,終止戶 ),
!00310,T(3,身分證不符),
!00311,T(3,轉出戶 ),
!00312,T(3,拒絕往來戶 ),
!00313,T(3,無此編號 ),
!00314,T(3,編號已存在 ),
!00316,T(3,管制帳戶 ),
!00317,T(3,掛失戶 ),
!00318,T(3,異常帳戶 ),
!00319,T(3,編號非英數 ),
!00391,T(3,期限未扣款 ),
!00398,T(3,其他),
!00401,T(3,員工扣薪失敗),
!00402,T(3,扣款不足),
!00501,T(3,退票),T(2,))

#OOProcNote=x,300,O

#OOTitaTlrNo=X,6,S
#OOTitaTxtNo=X,8,S

! 交易序號
#OOTxSn=X,18,O

! KEY=會計日 批號 明細序號
#OOBUF_L4201=X,170,S
T(2,#OOAcDate+
    #OOBatchNo+
    #OODetailSeq+
    #OOCustNo+
    #OORepayType+
    #OORepayAmtX+
    #OOAcctAmtX+
    #OODisacctAmtX+
    #OOProcStsCode+
    #OOProcCode+
    #OOProcNote+
    #OOTxSn)

#OOBUF_L4202=X,173,S
T(2,#OOAcDate+
    #OOBatchNo+
    #OODetailSeq+
    #OOCustNo+
    #OOFacmNo+
    #OORepayType+
    #OORepayAmtX+
    #OOAcctAmtX+
    #OODisacctAmtX+
    #OOProcStsCode+
    #OOProcCode+
    #OOProcNote+
    #OOTxSn)

#OOBUF_L4203=X,173,S
T(2,#OOAcDate+
    #OOBatchNo+
    #OODetailSeq+
    #OOCustNo+
    #OOFacmNo+
    #OORepayType+
    #OORepayAmtX+
    #OOAcctAmtX+
    #OODisacctAmtX+
    #OOProcStsCode+
    #OOProcCode+
    #OOProcNote+
    #OOTxSn)

#OOBUF_L4204=X,173,S
T(2,#OOAcDate+
    #OOBatchNo+
    #OODetailSeq+
    #OOCustNo+
    #OOFacmNo+
    #OORepayType+
    #OORepayAmtX+
    #OOAcctAmtX+
    #OODisacctAmtX+
    #OOProcStsCode+
    #OOProcCode+
    #OOProcNote+
    #OOTxSn)

#OOBUF_L4205=X,173,S
T(2,#OOAcDate+
    #OOBatchNo+
    #OODetailSeq+
    #OOCustNo+
    #OOFacmNo+
    #OORepayType+
    #OORepayAmtX+
    #OOAcctAmtX+
    #OODisacctAmtX+
    #OOProcStsCode+
    #OOProcCode+
    #OOProcNote+
    #OOTxSn)

#OOBUF_L4210=X,20,S
T(2,2+
    #OOAcDate+
    #OOBatchNo+
    #OODetailSeq)
    
#OOBUF_B=X,50,S
T(2,#OOAcDate+0000000+#OOTxSn)

#OOBTN_TXT=X,4,O
SWITCH(#OOProcStsCode,5,T(2,分錄),
                   6,T(2,分錄),
                   7,T(2,分錄),C(3,#OORepayCode,1,T(2,維護),T(2,維護)))

! 注意分號;;;;;;;;
#OOBTN_A=A,2,O
SWITCH(#OOProcStsCode,5,BIND(grid,{ cmd=CHAIN; ntxcd=L6901;text=#OOBTN_TXT; ntxbuf=#OOBUF_B}),
                      6,BIND(grid,{ cmd=CHAIN; ntxcd=L6901;text=#OOBTN_TXT; ntxbuf=#OOBUF_B}),
                      7,BIND(grid,{ cmd=CHAIN; ntxcd=L6901;text=#OOBTN_TXT; ntxbuf=#OOBUF_B}),
                        SWITCH(#OORepayCode,01,BIND(grid,{ cmd=CHAIN; ntxcd=L4201; text=#OOBTN_TXT; ntxbuf=#OOBUF_L4201}),
                                            02,C(5,#OOReconCode,P01,BIND(grid,{ cmd=CHAIN; ntxcd=L4203; text=#OOBTN_TXT; ntxbuf=#OOBUF_L4203}),
                                                                    BIND(grid,{ cmd=CHAIN; ntxcd=L4202; text=#OOBTN_TXT; ntxbuf=#OOBUF_L4202})),
                                            03,BIND(grid,{ cmd=CHAIN; ntxcd=L4204; text=#OOBTN_TXT; ntxbuf=#OOBUF_L4204}),
                                            04,BIND(grid,{ cmd=CHAIN; ntxcd=L4205; text=#OOBTN_TXT; ntxbuf=#OOBUF_L4205}),
                                            05,BIND(grid,{ cmd=CHAIN; ntxcd=L4210; text=#OOBTN_TXT; ntxbuf=#OOBUF_L4210}),
                                            06,BIND(grid,{ cmd=CHAIN; ntxcd=L4210; text=#OOBTN_TXT; ntxbuf=#OOBUF_L4210}),
                                            07,BIND(grid,{ cmd=CHAIN; ntxcd=L4210; text=#OOBTN_TXT; ntxbuf=#OOBUF_L4210}),
                                            09,BIND(grid,{ cmd=CHAIN; ntxcd=L4210; text=#OOBTN_TXT; ntxbuf=#OOBUF_L4210}),
                                            11,BIND(grid,{ cmd=CHAIN; ntxcd=L4210; text=#OOBTN_TXT; ntxbuf=#OOBUF_L4210}),
                                               BIND(grid,cancel)))
! 01:匯款轉帳
! 02:銀行扣款
! 03:員工扣款
! 04:支票
! 05:法院扣薪
! 06:理賠金
! 07:代收款－債權協商
! 09:其他
! 11:匯款轉帳預先作業

</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#EntryDateFrom
#EntryDateTo
#RepayCode
#CustNo
#ProcStsCode
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
TXFORM=L4925
#OOAcDate
#OOBatchNo
#OODetailSeq
#OORepayCode
#OOEntryDate
#OOCustNo
#OOFacmNo
#OORepayType
#OOReconCode
#OORepayAmt
#OOAcctAmt
#OODisacctAmt
#OOProcStsCode
#OOProcCode
#OOProcNote
#OOTitaTlrNo
#OOTitaTxtNo
#OOTxSn
^
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>
<sub type="PART" prompt='{{#SCRTIL}} world' name="L4925" layout="cols=1;screen.width=[100,900];order=1;">
[
["[L4925]@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@整批入帳明細查詢(By日期區間)"],
[""],
]
</sub>

<sub type="SELECT">

#RPTFG=0,QUERY.GRID
#any={detail:true, header:'L4925.part',caption:'', width:1020, rowNum:20, rowList:[20,40,60]}

#OOAcDate=會計日期
{width:80,align:'center'}
#OOBatchNo=批號
{width:65}
#OODetailSeq=明細序號
{width:80}
#OORepayCodeX=還款來源
{width:90}
#OOEntryDate=入帳日期
{width:90,align:'center'}
#OOCustNo=戶號　
{width:65}
#OOFacmNo=額度　
{width:65}
#OORepayTypeX=還款類別
{width:95}
#OOReconCodeX=對帳類別
{width:120}
#OORepayAmt=還款金額
{width:95}
#OOProcStsCodeX=處理狀態
{width:95}
#OOProcCodeX=處理說明
{width:160}
#OOProcNote=備註
{width:160}

#OOBTN_A=
{search:false,formatter:'cust:bind-button:#OOBTN_TXT',align:'center',canExport:false,width:35}

^
<include src="PRT.icf::INQ04.sel" map="i=L4925;cpi=15"/>
#EntryDateFrom#EntryDateTo#RepayCode#CustNo
%
#OOAcDate
#OOBatchNo
#OODetailSeq
#OORepayCode
#OOEntryDate
#OOCustNo
#OOFacmNo
#OORepayType
#OOReconCode
#OORepayAmt
#OOProcStsCode
#OOProcCode
#OOProcNote
#OOTitaTlrNo
#OOTitaTxtNo
@^
</sub>
