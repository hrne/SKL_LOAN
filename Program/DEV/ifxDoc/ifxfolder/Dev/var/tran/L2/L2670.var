----- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

!#TXCD
!T(3,L2670)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,57)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,0)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,20)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
T(2,@RimTxCode,#TXCD)

</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=1;screen.width=[150,1000];printer.width=[20,20];">
[
["[L2670]                                 貸後契變手續費維護"],
["#FdFUNCD+功能",#FunCdX],
["#FdCUSTNO+借戶戶號",#CustNo,#BTN1,#CustName],
["#FdFACMNO+額度編號",#FacmNo],
["#FdCHANGEDATE+契變日期",#ContractChgDate],
["#FdContractChgNo+契變序號",#ContractChgNo],
["#FdCHANGEITEM+貸後契變項目",#ContractChgCode,#ContractChgCodeX],
["#FdCURRENCY_IND+幣別",#CurrencyCode],
["#FdCC_EXP+契變手續費",#TwFeeAmt,#UsFeeAmt],
["#FdACCT_DATE+會計日期",#AcDate],
["#FdTXSEQ+交易序號",#TitaTxtNo],
["#FdTLR_NO+經辦",#TlrNo,#EmpName],
["#FdMODIFY_DT+作業日期",#ModifyDate],
["#FdMODIFY_TM+作業時間",#ModifyTime],

]
!---------- AP Button AREA ----------   
![Buttom資料查詢]

#BTN1=X,15,I,ui:button;value:顧客資料查詢;enable:1;tabbable:0

! 必輸欄位
#FdCURRENCY_IND=X,2,L
#FdCC_EXP=X,2,L
#FdACCT_DATE=X,2,L
#FdTXSEQ=X,2,L
#FdTLR_NO=X,2,L
#FdMODIFY_DT=X,2,L
#FdMODIFY_TM=X,2,L


! 永遠為必輸欄位
#FdFUNCD=X,2,L
T(3,*)
#FdCUSTNO=X,2,L
T(3,*)
#FdFACMNO=X,2,L
T(3,*)
#FdCHANGEDATE=X,2,L
T(3,*)
#FdContractChgNo=X,2,L
#FdCHANGEITEM=X,2,L
T(3,*)



!---------- AP TEXT AREA Variables ----------
! Help
<include src="HELPRIM.icf::HELPRIM.rtn"/>
!調RIM
<include src="ROM.icf::L2Rim.dec"/>
<include src="ROM.icf::L2R37.dec"/>
<include src="ROM.icf::L1R01.dec"/>
<include src="ROM.icf::L2R05.dec"/>
<include src="ROM.icf::L0Rim.dec"/>

#SetSysPar=X,1,S
E(0,1)ASGN(AGAIN$)

!ContractChgCode
#CDDEF0001=x,30,S
T(3,CdCode.ChangeItemCode)

#ContractChgCodeHelp=x,1024,S

#CDDEF0002=x,26,S
T(3,CdCode.CurrPrecision)

#CurrPrecisionHelp=x,1024,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDDEF0001,#CDDEF0002)
R(1,XXR99)
CALL(#HelpProc)
T(2,@ContractChgCodeHelp,#HelpDesc1) 
T(2,@CurrPrecisionHelp,#HelpDesc2)


#FunCdHelp=x,60,S
T(3,1:新增;2:修改;4:刪除;5:查詢;7:列印;8:補列印)

#CHAIN=A,1,S
T(4,CHAIN$)
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:[L2061貸後契變手續費明細資料查詢(未入帳)]進入),$)
#init=X,1,S
HIDE(#UsFeeAmt)



#NTXBUF=X,40,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@FunCd,#NTXBUF,1,1)
C(3,#FunCd,1,E(0,@CHAIN,0),$)
C(3,#FunCd,1,S,$)
T(1,@CustNo,#NTXBUF,2,7)
T(1,@FacmNo,#NTXBUF,9,3)
T(1,@ContractChgDate,#NTXBUF,12,7)
T(1,@ContractChgNo,#NTXBUF,19,2)
T(1,@ContractChgCode,#NTXBUF,21,2)



![功能] 
!下拉式選單 1.新增  2.修改  4.刪除  5.查詢  7.列印  8.補列印
#FunCd=A,1,S
C(3,#CHAIN,1,s,$)
HELP(#FunCdHelp)
@V(H,#FunCdHelp)
E(0,@FUNCIND,#FunCd)

#SetSysPar1=X,1,S
C(3,#FunCd,1,E(0,0)ASGN(AGAIN$),$)

#FunCdX=X,6,L
C(4,#FunCd,S,$)
T(H,#FunCd,#FunCdHelp)
C(2,#FunCd,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),K(MODIFYBUTTON,新增),K(MODIFYBUTTON,刪除),K(MODIFYBUTTON,查詢)K(NOBUTTON,CLOSEY),$,K(MODIFYBUTTON,列印),K(MODIFYBUTTON,補列印))

#ShowFd=X,1,S
C(2,#FunCd,T(3, ),T(3,*),T(3,*),T(3,*),T(3, ),T(3, ),T(3, ),T(3, ),T(3, ))
T(2,@FdFUNCD,#ShowFd)     
T(2,@FdCUSTNO,#ShowFd)
T(2,@FdFACMNO,#ShowFd)
T(2,@FdCHANGEDATE,#ShowFd)
T(2,@FdCHANGEITEM,#ShowFd)


#WKSPC=X,2,S

#WKSTAR=X,2,S
C(2,#FunCd,S,T(3,*),T(3,*),S,T(3, ),T(3, ))

#WKSTAR2=X,2,S
C(3,#FunCd,2,T(3,*),T(3, ))

#WKFDNAME=X,1,S
T(2,@FdCHANGEITEM,#WKSTAR)
T(2,@FdCURRENCY_IND,#WKSPC)
T(2,@FdCC_EXP,#WKSTAR)
T(2,@FdACCT_DATE,#WKSPC)
T(2,@FdTXSEQ,#WKSPC)
T(2,@FdTLR_NO,#WKSPC)
T(2,@FdMODIFY_DT,#WKSPC)
T(2,@FdMODIFY_TM,#WKSPC)

#WKTF=X,1,S
IF (#FunCd==1 || #FunCd==2,T(F,#TwFeeAmt,1)T(F,#ContractChgCode,1),
                           T(F,#ContractChgCode,0)T(F,#FacmNo,0)T(F,#ContractChgDate,0)T(F,#ContractChgNo,0)T(F,#ContractChgCode,0)
                           T(F,#ContractChgCodeX,0)T(F,#CurrencyCode,0)T(F,#TwFeeAmt,0)
                           T(F,#UsFeeAmt,0)T(F,#AcDate,0)T(F,#TitaTxtNo,0)T(F,#TlrNo,0)T(F,#ModifyDate,0)T(F,#CustNo,0)HIDE(#BTN1))
IF (#FunCd==2 ,HIDE(#BTN1)T(F,#CustNo,0)T(F,#FacmNo,0)T(F,#ContractChgDate,0)T(F,#ContractChgNo,0),$)
                           
#BUF1=X,18,S

#BIND1=X,1,S
BIND(#BTN1,click, {cmd=CHAIN; ntxcd=L1001; ntxbuf=#BUF1;ntxbuf5=type<-1:CustNo<-OOCustNo:CustName<-OOCustName})

![借戶戶號]
!必須輸入
#CustNo=A,7,I
C(3,#CHAIN,1,s,$)
@V(2,0)


!調RIML1R01取CustName
#RimL1r01=X,1,S
E(0,@RimFunCd,5)
E(0,@RimCustNo,#CustNo)
RESET_RIM(#RimL1r01,L1R01)
S(L1R01,1,#RimCustId,#RimFunCd,#RimCustNo)
R(1,L1R01)


#checkL1R01=X,1,S
T(2,@CustName,#L1r01CustName)

#CustName=X,100,L


!額度編號 
!必須輸入
#FacmNo=A,3,I
C(3,#CHAIN,1,s,$)
@V(2,0)
T(3,@CurrencyCode,TWD)

!檢查額度是否可用
#SendL2r05=X,1,S
IF(#FKEY==0 || #FKEY==7,$,s)
E(0,@RimFuncCode,5)
E(0,@RimCustNo,#CustNo)
E(0,@RimFacmNo,#FacmNo)
E(0,@RimApplNo,0)
E(0,@RimCaseNo,0)
S(L2R05,1,#RimFuncCode,#RimTxCode,#RimFKey,#RimCustNo,#RimFacmNo,#RimApplNo,#RimCaseNo)
R(1,L2R05)



![契變日期] 預設日曆日
!必須輸入
#POSINTDT=D,8,S
T(4,CDATE$)

#ContractChgDate=D,7,I
C(3,#CHAIN,1,s,$)
T(1,#POSINTDT,2,7)
@A(DATE,0,#ContractChgDate)
V(7)

!貸後契變序號
#ContractChgNo=A,2,L
C(3,#CHAIN,1,s,$)
C(3,#FunCd,1,E(0,0),$)
C(3,#FunCd,1,s,$)
@V(2,0)

#RimL2r37=X,1,S
C(3,#FunCd,1,S,$)
E(0,@RimFunCd,#FunCd)
E(0,@RimContractChgDate,#ContractChgDate)
E(0,@RimCustNo,#CustNo)
E(0,@RimFacmNo,#FacmNo)
E(0,@RimContractChgNo,#ContractChgNo)
RESET_RIM(#RimL2r37,L2R37)
S(L2R37,1,#RimFunCd,#RimContractChgDate,#RimCustNo,#RimFacmNo,#RimContractChgNo)
R(1,L2R37)

#checkL2r37=X,1,S
C(3,#FunCd,1,S,$)
E(0,@ContractChgCode,#L2r37ContractChgCode)
T(2,@CurrencyCode,#L2r37CurrencyCode)
E(0,@TwFeeAmt,#L2r37FeeAmt)
E(0,@UsFeeAmt,#L2r37FeeAmt)
E(0,@AcDate,#L2r37AcDate)
E(0,@TitaTxtNo,#L2r37TitaTxtNo)
T(2,@TlrNo,#L2r37TLR_NO)
E(0,@ModifyDate,#L2r37MODIFY_DT)
T(2,@ModifyTime,#L2r37WKTIME)


<include src="ROM.icf::L2R08.dec"/>
#SendL2r08B=X,1,S
C(3,#FunCd,1,s,$)
T(2,@RimEmployeeNo,#TlrNo)
T(3,@RimErrorSkip,Y)
S(L2R08,1,#RimTxCode,#RimEmployeeNo,#RimErrorSkip)
R(1,L2R08)
T(2,@EmpName,#L2r08FullName)

![貸後契變項目] 
!必須輸入
#ContractChgCode=A,2,I
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
C(3,#FunCd,7,s,$)
C(3,#FunCd,8,s,$)
HELP(#ContractChgCodeHelp)
@
C(3,#FunCd,2,IF (#ContractChgCode==#L2r37ContractChgCode,s,$),$)
V(H,#ContractChgCodeHelp)

#ContractChgCodeX=X,20,L
C(4,#ContractChgCode,S,$)T(H,#ContractChgCode,#ContractChgCodeHelp)

![幣別]
#CurrencyCode=X,3,L
T(3,TWD)

#PRECISION=N,1,S
T(H,#CurrencyCode,#CurrPrecisionHelp)
C(3,#PRECISION,0,SHOW(#TwFeeAmt)HIDE(#UsFeeAmt),HIDE(#TwFeeAmt)SHOW(#UsFeeAmt))

![契變手續費]
!新增、修改時必輸輸入,其他自動顯示不必輸入
#TwFeeAmt=m,14,I
C(3,#PRECISION,0,$,s)
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
C(3,#FunCd,7,s,$)
C(3,#FunCd,8,s,$)

#UsFeeAmt=m,14.2,I
C(3,#PRECISION,0,s,$)
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
C(3,#FunCd,7,s,$)
C(3,#FunCd,8,s,$)

#TimFeeAmt=m,14.2,S
C(3,#PRECISION,0,E(0,#TwFeeAmt),E(0,#UsFeeAmt))

! #fee=X,21,L
! P(R,#FeeAmt)

C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
C(3,#FunCd,7,s,$)
C(3,#FunCd,8,s,$)
@V(2,0)

![會計日期] 
!自動顯示不需輸入
#AcDate=D,7,L
!E(0,#SYSDATE)

![交易序號]
#TitaTxtNo=A,7,L
C(3,#CHAIN,1,s,$)

![經辦編號]
#TlrNo=X,6,L


#EmpName=X,10,L


![作業日期]
#ModifyDate=D,7,L
! E(0,#SYSDATE)

![作業時間]
#WKTIME=A,6,S
T(4,TIME$)

#TIME1=X,2,S
T(1,#WKTIME,1,2)

#TIME2=X,2,S
T(1,#WKTIME,3,2)

#TIME3=X,2,S
T(1,#WKTIME,5,2)

#SEMI=X,1,S
T(3,:)

#ModifyTime=X,10,L
C(3,#CHAIN,1,s,$)
! T(2,#TIME1+#SEMI+#TIME2+#SEMI+#TIME3)

#RPTFG=X,1,S
E(0,0)

#TXMT=A,1,S
C(3,#FunCd,7,XMT(),$)
C(3,#FunCd,8,XMT(),$)
</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>


!---------- TXFORM = L2670 ----------
<sub type="FORM" name="L2670">

!#SCRPRT=_,_,S
!C(5,#TXFORM,L2670,$,S)

#SCRTIL=_,_,S
T(3,[L2670] 貸後契變手續費維護)


#PRINTRIM=X,200,S
T(6B,LCR98+1+L2670)

#OContractChgNo=A,2,S
C(3,#FunCd,4,S,$)
C(3,#FunCd,5,S,$)
C(3,#FunCd,7,S,$)
E(0,@ContractChgNo,#OContractChgNo)

!------ TOM(HEAD)   Variables (FOR OUTPUT SCREEN) ------
#OModifyDate=D,7,S
C(3,#FunCd,4,S,$)
C(3,#FunCd,5,S,$)
C(3,#FunCd,7,S,$)
E(0,@ModifyDate,#OModifyDate)

#OAcDate=D,7,S
C(3,#FunCd,4,S,$)
C(3,#FunCd,5,S,$)
C(3,#FunCd,7,S,$)
E(0,@AcDate,#OAcDate)


#OTitaTxtNo=A,7,S
C(3,#FunCd,4,S,$)
C(3,#FunCd,5,S,$)
C(3,#FunCd,7,S,$)
E(0,@TitaTxtNo,#OTitaTxtNo)



#OTlrNo=X,6,S
C(3,#FunCd,4,S,$)
C(3,#FunCd,5,S,$)
C(3,#FunCd,7,S,$)
T(2,@TlrNo,#OTlrNo)

#OEmpName=X,10,S
C(3,#FunCd,4,S,$)
C(3,#FunCd,5,S,$)
C(3,#FunCd,7,S,$)
T(2,@EmpName,#OEmpName)


#OModifyTime=X,10,S

#OTIME1=X,2,S
T(1,#OModifyTime,1,2)

#OTIME2=X,2,S
T(1,#OModifyTime,3,2)

#OTIME3=X,2,S
T(1,#OModifyTime,5,2)

#OModifyTimeX=X,10,S
C(3,#FunCd,4,S,$)
C(3,#FunCd,5,S,$)
C(3,#FunCd,7,S,$)
C(3,#FunCd,8,s,$)
T(2,#OTIME1+:+#OTIME2+:+#OTIME3)
T(2,@ModifyTime,#OModifyTimeX)



!印錄PDF序號
#PdfSno=A,8,S

#PdfPrt=A,1,S
C(3,#PdfSno,0,E(0,0),E(0,1))

!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------

!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------

</sub>


!------ 上行電文 ------
<sub type="TIM">
#FunCd
#CustNo
#FacmNo
#ContractChgDate
#ContractChgNo
#ContractChgCode
#ContractChgCodeX
#CurrencyCode
#TimFeeAmt
#AcDate
#TitaTxtNo
#TlrNo
#ModifyDate
#ModifyTime
</sub>


!------ 下行電文TOM ------
<sub type="TOM">
TXFORM=L2670
#OContractChgNo
#OAcDate
#OTitaTxtNo
#OTlrNo
#OEmpName
#OModifyDate
#OModifyTime
#PdfSno
^

<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L2R37.tom"/>
<include src="ROM.icf::L1R01.tom"/>
<include src="ROM.icf::L2R05.tom"/>
<include src="ROM.icf::L2R08.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>

<sub type="PART" name="L2670" layout="cols=3;screen.width=[130,370,130,370];printer.width=[15,30,15,30];order=1">
[
["[L2670]                                 貸後契變手續費維護"],
[#<->#,"@案件編號"],
[#<->#,"@統一編號"],
["@借戶戶號"],
["@核准編號"],
]
</sub>
!---------- 單據輸出組合 ----------
<sub type="SELECT">

<include src="PRT.icf::UPD01.sel" map="printNo=PRINTRIM"/>
#PdfPrt=1,PDF,,,,,,,,,,,,,PdfSno,貸後契約內容變更手續費收據,PRINTRIM
^
</sub>
