----- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

!#TXCD
!T(3,L2306)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,27)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,75)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,20)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)

</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=1;screen.width=[150,1000];printer.width=[20,20];">
[
["[L2306]                                 借款戶關係人/關係企業維護"],
["#FdFunCd+功能",#FunCdX],
["#FdCustNo+借戶戶號",#CustNo,#BTN1,#CustName],
["#FdCaseNo+ELoan案件編號",#CaseNo],
["#FdRelId+關係人統編",#RelId],
["#FdRelName+關係人姓名",#RelName],
["#FdPosInd+關係",#PosInd,#PosIndX],
["#FdRemarkType+備註類型",#RemarkType,#RemarkTypeX],
["#FdRemark+備註",#Remark],
]

!---------- AP Button AREA ----------
![Buttom資料查詢]

#BTN1=X,15,I,ui:button;value:顧客資料查詢;enable:1;tabbable:0

<include src="ROM.icf::L1R09.dec"/>
<include src="ROM.icf::L2R15.dec"/>
! 必輸欄位
#FdCaseNo=X,2,L
#FdCustNo=X,2,L
#FdRelId=X,2,L
#FdRelName=X,2,L
#FdPosInd=X,2,L
#FdRemarkType=X,2,L
#FdRemark=X,2,L

! 永遠為必輸欄位
#FdFunCd=X,2,L
T(3, )




!---------- AP TEXT AREA Variables ----------
<include src="HELPRIM.icf::HELPRIM.rtn"/>

#SetSysPar=X,1,S
E(0,1)ASGN(AGAIN$)

#FunCdHelp=x,50,S
T(3,1:新增;2:修改;4:刪除;5:查詢)

#CDDEFRelationCode2=x,30,S
T(3,CdCode.RelationCode2)

#CDDEFRelationCode3=x,30,S
T(3,CdCode.RelationCode3)

#RelationCodeRim=X,1,S
RESET_RIM(#RelationCodeRim,XXR99)
S(XXR99,01,#CDDEFRelationCode2,#CDDEFRelationCode3)
R(1,XXR99)
CALL(#HelpProc)
T(2,@RelationCode2Help,#HelpDesc1)
T(2,@RelationCode3Help,#HelpDesc2)

#RelationCode2Help=x,200,S

#RelationCode3Help=x,200,S

#RimTxCode=X,5,S
#RimFKey=X,1,S

#CHAIN=A,1,S
T(4,CHAIN$)
T(2,@RimTxCode,#TXCD)
E(0,@RimFKey,#FKEY)
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:L2035進入),$)

#NTXBUF=X,228,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@FunCd,#NTXBUF,1,1)
C(3,#FunCd,1,s,$)
T(1,@CaseNo,#NTXBUF,2,7)
T(1,@CustNo,#NTXBUF,9,7)
T(1,@RelId,#NTXBUF,16,10)
!T(1,@RelName,#NTXBUF,26,100)
!T(1,@PosInd,#NTXBUF,126,2)
!T(1,@RemarkType,#NTXBUF,128,1)
!T(1,@Remark,#NTXBUF,129,100)

!FunCd=1,2 顯示框線
#WKTF=X,1,S
IF (#FunCd==2,T(F,@CaseNo,0)T(F,@CustNo,0)T(F,@RelId,0)T(F,@RelName,0)HIDE(#BTN1),$)
IF (#FunCd==4 || #FunCd==5,T(F,@CaseNo,0)T(F,@CustNo,0)T(F,@RelId,0)T(F,@RelName,0)T(F,@PosInd,0)T(F,@RemarkType,0)T(F,@Remark,0)HIDE(#BTN1),$)

!功能 下拉式選單 1.新增 2.修改 4.刪除 5.查詢
#FunCd=A,1,S
C(3,#CHAIN,1,s,$)
HELP(#FunCdHelp)
@V(H,#FunCdHelp)
E(0,@FUNCIND,#FunCd)

#FunCdX=X,4,L
C(4,#FunCd,S,$)
T(H,#FunCd,#FunCdHelp)
C(2,#FunCd,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),K(MODIFYBUTTON,新增),K(MODIFYBUTTON,刪除),K(MODIFYBUTTON,查詢)K(NOBUTTON,CLOSEY))

#WKSTAR=X,2,S
C(2,#FunCd,S,T(3,*),T(3,*),S,S,S)

#WKNAME=X,1,S
IF(#FunCd == 1,$,S)
T(2,@FdCustNo,#WKSTAR)
T(2,@FdRelId,#WKSTAR)
T(2,@FdRelName,#WKSTAR)
T(2,@FdPosInd,#WKSTAR)
T(2,@FdRemarkType,#WKSTAR)
T(2,@FdRemark,#WKSTAR)

#WKNAME1=X,1,S
IF(#FunCd == 2,$,S)
T(2,@FdPosInd,#WKSTAR)
T(2,@FdRemarkType,#WKSTAR)
T(2,@FdRemark,#WKSTAR)

#BUF1=X,18,S

#BIND1=X,1,S
BIND(#BTN1,click, {cmd=CHAIN; ntxcd=L1001; ntxbuf=#BUF1;ntxbuf5=type<-1:CustNo<-OOCustNo})


!戶號
#CustNo=A,7,I
C(3,#FunCd,1,$,s)
@V(2,0)
!調RIM參數
<include src="ROM.icf::L2Rim.dec"/>
<include src="ROM.icf::L2R10.dec"/>


#RimL1r09A=X,1,S
C(3,#FunCd,1,$,S)
E(0,@RimFunCd,1)
T(2,@RimCustId,)
E(0,@RimCustNo,#CustNo)
RESET_RIM(#RimL1r09,L1R09)
S(L1R09,1,#RimFunCd,#RimCustId,#RimCustNo)
R(1,L1R09)

#CheckL1R09A=X,1,S
C(3,#FunCd,1,$,s)
T(2,@CustName,#L1r09CustName)


#CustName=X,100,L
C(4,#CustNo,S,$)


#CaseNo=A,7,I
C(3,#FunCd,1,$,s)
!@V(2,0)

#RimFuncCode=E,1,S

#SendL2r10=X,1,S
E(0,@RimCaseNo,#CaseNo)
RESET_RIM(#SendL2r10,L2R10)
S(L2R10,1,#RimCaseNo)
R(1,L2R10)

#ReceiveL2r10=X,1,S
!C(3,#CustNo,#L2r10CustNo,$,V(P,借戶戶號與ELoan案件編號不一致))

#RelId=X,10,I
C(3,#FunCd,2,s,$)
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
@V(7)A(ID_UNINO,0,#RelId)
!關係人姓名 新增、修改時必須輸入,其他自動顯示不必輸入 若統一編號存在於顧客檔,則自動顯示不必輸入

#RimL1r09B=X,1,S
!C(3,#FunCd,1,$,S)
E(0,@RimFunCd,5)
T(2,@RimCustId,#RelId)
E(0,@RimCustNo,0)
RESET_RIM(#RimL1r09,L1R09)
S(L1R09,1,#RimFunCd,#RimCustId,#RimCustNo)
R(1,L1R09)

#CheckL1R09B=X,1,S
!C(3,#FunCd,1,$,s)
T(2,@TempName,#L1r09CustName)

#RimReltId=X,10,L

#TempName=X,100,L
T(2,@RelName,#TempName)

#RimL2r15=X,1,S
C(4,#TempName,s,$)
T(2,@RimCaseNo,#CaseNo)
T(2,@RimCustNo,#CustNo)
T(2,@RimReltId,#RelId)
E(0,@RimFuncCode,#FunCd)
! RESET_RIM(#RimL2r15,L2R15)
S(L2R15,1,#RimCaseNo,#RimCustNo,#RimReltId,#RimFuncCode)
R(1,L2R15)


#CheckL2R15=X,1,S
C(4,#TempName,s,$)
T(2,@PosInd,#L2r15PosInd)
T(2,@RemarkType,#L2r15RemarkType)
T(2,@Remark,#L2r15Remark)

#RelName=X,100,I
C(3,#FunCd,1,$,s)
C(4,#TempName,$,s)
@V(7)


!職稱代碼 新增、修改時必須輸入,其他自動顯示不必輸入

#PosInd=A,2,I
C(3,#FunCd,4,s,HELP(#RelationCode2Help))
C(3,#FunCd,5,s,HELP(#RelationCode2Help))
@V(H,#RelationCode2Help)

#PosIndX=X,20,L
T(H,#PosInd,#RelationCode2Help)


#RemarkType=A,1,I
C(3,#FunCd,4,s,HELP(#RelationCode3Help))
C(3,#FunCd,5,s,HELP(#RelationCode3Help))
@V(H,#RelationCode3Help)

#RemarkTypeX=X,10,L
T(H,#RemarkType,#RelationCode3Help)

#Remark=X,100,I
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
@V(7)

#RPTFG=A,1,S
</sub>
!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>


!---------- TXFORM = L2306 ----------
<sub type="FORM" name="L2306">

!#SCRPRT=_,_,S
!C(5,#TXFORM,L2306,$,S)

#SCRTIL=_,_,S
T(3,[L2306] 關係人資料建立)

!------ TOM(HEAD)   Variables (FOR OUTPUT SCREEN) ------
!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------

!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------

</sub>


!------ 上行電文 ------
<sub type="TIM">
#FunCd
#CaseNo
#CustNo
#RelId
#RelName
#PosInd
#RemarkType
#Remark
</sub>


!------ 下行電文TOM ------
<sub type="TOM">
TXFORM=L2306^
<include src="ROM.icf::L1R09.tom"/>
<include src="ROM.icf::L2R15.tom"/>
<include src="ROM.icf::L2R10.tom"/>
<include src="COM.icf::TRCTL.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>

<sub type="PART" name="L2306" layout="cols=3;screen.width=[130,370,130,370];printer.width=[15,30,15,30];order=1">
[
["[L2306]                                 借款戶關係人/關係企業維護"],
[#<->#,"@案件編號"],
[#<->#,"@統一編號"],
["@借款人戶號"],
["@核准編號"],
]
</sub>
!---------- 單據輸出組合 ----------
<sub type="SELECT">

<include src="PRT.icf::UPD01.sel"/>
</sub>
