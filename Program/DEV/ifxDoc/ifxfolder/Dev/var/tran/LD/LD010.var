!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

#TXCD=_,_,S
T(3,LD010)

</sub>
<sub type="PREDC" name="PreDC">
<include src="COM.icf::TITLE-RUN.pre"/>
</sub>


<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD2.dec"/>


</sub>



!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=1;screen.width=[140,850];printer.width=[20,80];">
[
["[LD010]                                  LD010介紹人換算業績報酬檢核表"],
["工作月",#inputYear," / ",#inputMonth],
]

!---------- AP TEXT AREA Variables ----------
#CHAIN=A,1,S
T(4,CHAIN$)

! #NTXBUF=X,3,S
! C(3,#CHAIN,1,T(4,NTXBUF$),S)
! T(1,@FUNCD,#NTXBUF,1,1)
! T(1,@TLR,#NTXBUF,2,2)
! T(2,@FKEY,7)


!-----------------------------------------------------
<include src="HELPRIM.icf::HELPRIM.rtn"/>

#TXCD2=X,5,S
T(3,LD010)

! 工作月必須小於等於系統會計日期所屬的工作月
! 工作月為合理月份

#inputYear=A,3,I

#inputMonth=A,2,I
@V(5,1,13)

#inputWorkMonth=A,5,S
T(2,#inputYear+#inputMonth)

#RimWorkMonth=A,5,S
T(2,#inputWorkMonth)
E(0,#RimWorkMonth-1)
! -1: 條件是小於等於會計日之工作月;
!     但L6R34僅分 小於 : 大於等於 兩種結果
!     例如會計日20200423, 工作月為202004(20200421-20200518) (此時.8的設定)
!     輸入10904, L6R34會回傳0 (等於)
!     因此做-1
!     若日後有問題時再修改這裡的邏輯

#SendL6R34=X,1,S
RESET_RIM(#SendL6R34,L6R34)
S(L6R34,1,#RimFuncCode,#RimTxCode,#RimWorkMonth)
R(1,L6R34)

#CheckMonth=X,1,S
C(5,#L6R34Flag,0,$,S)
V(P,工作月輸入錯誤)


<include src="ROM.icf::L0Rim.dec"/>
<include src="ROM.icf::L6R34.dec"/>
</sub>


!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>

#PRTSC_RFG=X,1,S
C(3,#HCODE,1,S,$)
C(5,#TXFORM,LD010,$,S)
C(3,#FKEY,2,E(0,0),E(0,1))

</sub>


!---------- TXFORM = C5100 ----------
<sub type="FORM" name="LD010">

#SCRPRT=_,_,S
C(5,#TXFORM,C5100,$,S)

#SCRTIL=_,_,S
T(3,[LD010] LD010介紹人換算業績報酬檢核表)

</sub>

!---------- TXFORM = LD010 ----------
<sub type="FORM" name="LD010">

#SCRPRT=_,_,S
C(5,#TXFORM,LD010,$,S)

#SCRTIL=_,_,S
T(3,[LD010] LD010介紹人換算業績報酬檢核表)


#OEMPNOS=X,6,S
IF(#KINBR=="0009"||#KINBR=="0008",T(2,#KINBR+#TlrNoNO),T(2,#EMPNOS))

</sub>


!------ 上行電文TIM：BASIC LABEL + AP TEXT AREA + AP TEXT ------
<sub type="TIM">
#inputWorkMonth
#END
</sub>
!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
<include src="ROM.icf::L6R34.tom"/>

TXFORM=LD010
^

</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
</sub>

