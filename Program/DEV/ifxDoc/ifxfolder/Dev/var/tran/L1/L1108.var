----- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

!#TXCD
!T(3,L1108)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,27)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,75)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,20)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)

</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=1;screen.width=[400,600];printer.width=[20,20];">
[
["[L1108]                                 申請不列印書面通知書維護"],
["#FdFunCdX+功能",#FunCdX],
["#FdCustNo+戶號",#CustNo,"-",#FacmNo,#BTN1,#CustName],
["#FdApplyDt+申請日期",#ApplyDt],
["#grid#,{id:1,expand:true,loop:40,row_height:1}","","","","",
[[#Paper0,"不寄送書面"],[#Msg0,"不發送簡訊"],[#EMail0,"不發送EMail"],"通知書名稱"],
[[#Paper1],[#Msg1],[#EMail1],[#Notice1]],
],
]

#FdFunCdX=X,2,L
#FdCustNo=X,2,L
T(2,*)
#FdApplyDt=X,2,L
T(2,*)
!---------- AP Button AREA ----------
![Buttom資料查詢]
#BTN1=X,15,I,ui:button;value:顧客資料查詢;enable:1;tabbable:0
!---------- AP TEXT AREA Variables ----------
#CHAIN=X,1,S
T(4,CHAIN$)
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:L1908進入),$)

#init=X,1,S
INVOKEJS(SHOW,grd1,0)

#NTXBUF=X,11,S
C(3,#CHAIN,1,T(4,NTXBUF$))

#CHAIN_FunCd=A,1,S
C(3,#CHAIN,1,T(1,#NTXBUF,1,1))
#CHAIN_CustNo=A,7,S
C(3,#CHAIN,1,T(1,#NTXBUF,2,7))
#CHAIN_FACMNO=A,3,S
C(3,#CHAIN,1,T(1,#NTXBUF,9,3))

<include src="HELPRIM.icf::HELPRIM.rtn"/>
#CDDEF0001=x,40,S
T(3,CdCode.FunctionCd)
#FunCdHelp=x,1024,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDDEF0001)
R(1,XXR99)
CALL(#HelpProc)
T(2,@FunCdHelp,#HelpDesc1)

! 第一行做成全選按鈕
! #Enable1=X,1,I,ui:button;value:全選;enable:1;tabbable:0
#Paper0=X,1,I,ui:button;value:全選;enable:1;tabbable:0
#Msg0=X,1,I,ui:button;value:全選;enable:1;tabbable:0
#EMail0=X,1,I,ui:button;value:全選;enable:1;tabbable:0

##loop{times:40,i:1}
#tmpFormNo{i}=X,10,S
#tmpPaper{i}=X,1,S
#tmpMsg{i}=X,1,S
#tmpEMail{i}=X,1,S
##end

!功能 下拉式選單 1: 新增 2:修改 4:刪除;5:查詢
#FunCd=A,1,S
C(3,#CHAIN,1,T(2,#CHAIN_FunCd))

#FunCdX=X,4,L
T(H,#FunCd,#FunCdHelp)

C(2,#FunCd,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),K(MODIFYBUTTON,新增),K(MODIFYBUTTON,刪除),K(MODIFYBUTTON,查詢))
#BUF1=X,1,S
#BIND1=X,1,S
BIND(#BTN1,click, {cmd=CHAIN; ntxcd=L1001; ntxbuf=#BUF1;ntxbuf5=type<-1:CustNo<-OOCustNo})

#checkfuncd1=X,1,S
C(3,#FunCd,1,E(0,@CHAIN,0),E(0,@CHAIN,1))

!刪除隱藏重新交易按鈕
#AGAIN=X,1,S
C(2,#FunCd,$,$,E(0,1),$,E(0,1))
ASGN(AGAIN$)

#Space=X,1,S
C(3,#FunCd,1,T(2,@FdCustNo,*),T(2,@FdCustNo, ))
C(3,#FunCd,1,T(F,#CustNo,1)T(F,#FacmNo,1),T(F,#CustNo,0)T(F,#FacmNo,0))

!戶號
#CustNo=A,7,I
C(3,#CHAIN,1,E(0,#CHAIN_CustNo),$)
C(3,#CHAIN,1,s,$)
@V(2,0)

#FacmNo=A,3,I
C(3,#CHAIN,1,T(2,#CHAIN_FACMNO),$)
C(3,#CHAIN,1,s,$)
@V(2,0)
!調RIM參數
#RimFunCd=A,1,S
E(0,#FunCd)
<include src="ROM.icf::L1R11.dec"/>
! 調報表代號名稱
#RimL1r11=X,1,S
RESET_RIM(#RimL1r11,L1R11)
C(3,#FunCd,1,$,S)
S(L1R11,1,#RimFunCd)
R(1,L1R11)
##loop{times:40,i:1}
T(2,@FormNo{i},#L1r11FormNo{i})
T(2,@Notice{i},#L1r11FormName{i})
##end

<include src="ROM.icf::L1R04.dec"/>
#RimCustNo=A,7,S
#RimFacmNo=A,3,S
#RimL1r04=X,1,S
E(0,@RimCustNo,#CustNo)
E(0,@RimFacmNo,#FacmNo)
RESET_RIM(#RimL1r04,L1R04)
C(3,#FunCd,2,$,S)
S(L1R04,1,#RimCustNo,#RimFacmNo)
R(1,L1R04)
E(0,@ApplyDt,#L1r04ApplyDt)
##loop{times:40,i:1}
T(2,@FormNo{i},#L1r04FormNo{i})
T(2,@Notice{i},#L1r04FormName{i})
T(2,@Paper{i},#L1r04Paper{i})
T(2,@Msg{i},#L1r04Msg{i})
T(2,@EMail{i},#L1r04EMail{i})
##end

##loop{times:40,i:1,j:3}

#FormNo{i}=X,10,S
! C(4,#FormNo{i},INVOKEJS(SHOW,grd1,{k},{k},0),INVOKEJS(SHOW,grd1,{k},{k},1))
! C(4,#FormNo{i},INVOKEJS(SHOW,grd1,{i},39,0),INVOKEJS(SHOW,grd1,{i},{i},1))

#Notice{i}=X,100,L
C(4,#Notice{i},INVOKEJS(SHOW,grd1,{j},{j},0),INVOKEJS(SHOW,grd1,{j},{j},1))

##end

#MsgFg=X,1,S
#EmailFg=X,1,S
!RIM參數使用

#RimFunc=A,1,S
E(0,#FunCd)
<include src="ROM.icf::L1R13.dec"/>
#RimL1r13=X,1,S

RESET_RIM(#RimL1r13,L1R13)
S(L1R13,1,#RimFunc,#RimCustNo,#RimFacmNo)
R(1,L1R13)
T(2,@CustName,#L1R13CustName)
T(2,@MsgFg,#L1R13MsgFg)
T(2,@EmailFg,#L1R13EmailFg)
! ! ! ! ! ! ! ! ! ! ! ! !

!戶名
#CustName=X,100,L
INVOKEJS(SHOW,grd1,1)



!  申請日期
#DATE=D,8,S
T(4,#SYSCDATE)
#ApplyDt=D,7,I
T(1,#DATE,2,7)
@V(7)
A(DATE,0,#ApplyDt)

! 按下全選按鈕後,呼叫相對應的處理
#BIND_Paper0=X,1,S
BIND(#Paper0,click, {cmd=CALLSEND;DOCODE=SELECT_Paper_ALL})
#BIND_Msg0=X,1,S
BIND(#Msg0,click, {cmd=CALLSEND;DOCODE=SELECT_Msg_ALL})
#BIND_EMail1=X,1,S
BIND(#EMail0,click, {cmd=CALLSEND;DOCODE=SELECT_EMail_ALL})

! 全選記號
#Paper_ALL_FG=A,1,S
E(0,0)
#Msg_ALL_FG=A,1,S
E(0,0)
#EMail_ALL_FG=A,1,S
E(0,0)

#MRKEY=_,_,S
C(3,#FacmNo,0,T(2,#CustNo),T(2,#CustNo+-+#FacmNo))


! 三顆全選按鈕的實際對應處理:1.變更"全選記號" -> 2.將各選項打勾
#SELECT_Paper_ALL=@,1,S
IF(#Paper_ALL_FG==0,E(0,@Paper_ALL_FG,1),E(0,@Paper_ALL_FG,0))
##loop{times:40,i:1}
IF(#Paper_ALL_FG==0,T(3,@Paper{i},),T(3,@Paper{i},Y))
##end

#SELECT_Msg_ALL=@,1,S
IF(#Msg_ALL_FG==0,E(0,@Msg_ALL_FG,1),E(0,@Msg_ALL_FG,0))
##loop{times:40,i:1}
IF(#Msg_ALL_FG==0,T(3,@Msg{i},),T(3,@Msg{i},Y))
##end

#SELECT_EMail_ALL=@,1,S
IF(#EMail_ALL_FG==0,E(0,@EMail_ALL_FG,1),E(0,@EMail_ALL_FG,0))
##loop{times:40,i:1}
IF(#EMail_ALL_FG==0,T(3,@EMail{i},),T(3,@EMail{i},Y))
##end


#CheckY=X,1,S
T(2,Y)
##loop{times:40,i:1}
! 不列印記號-書面
#Paper{i}=X,1,I,ui:checkbox;value:;
C(4,#FormNo{i},S,$)
@C(4,#Paper{i},$,IF(#Paper{i} == #CheckY,$,V(P,限輸入Y或空白)))
! 不列印記號-簡訊
#Msg{i}=X,1,I,ui:checkbox;value:;
C(4,#FormNo{i},S,$)
C(5,#MsgFg,0,T(3,Y),$)
@
C(5,#MsgFg,0,C(4,#Msg{i},V(P,此客戶尚未設定簡訊電話，故不可設定為發送),$),$)
C(4,#Msg{i},$,IF(#Msg{i} == #CheckY,$,V(P,限輸入Y或空白)))

! 不列印記號-EMail
#EMail{i}=X,1,I,ui:checkbox;value:;
C(4,#FormNo{i},S,$)
C(5,#EmailFg,0,T(3,Y),$)
@
C(5,#EmailFg,0,C(4,#EMail{i},V(P,此客戶尚未設定信箱，故不可設定為發送),$),$)
C(4,#EMail{i},$,IF(#EMail{i} == #CheckY,$,V(P,限輸入Y或空白)))

##end


</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>


!---------- TXFORM = L1108 ----------
<sub type="FORM" name="L1108">

!#SCRPRT=_,_,S
!C(5,#TXFORM,L1108,$,S)

#SCRTIL=_,_,S
T(3,[L1108] 申請不列印書面通知書維護)

!------ TOM(HEAD)   Variables (FOR OUTPUT SCREEN) ------
!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------


!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------
#LOOP=X,1,S
T(3,1)ASGN(LOOP$)



</sub>


!------ 上行電文 ------
<sub type="TIM">
#FunCd
#CustNo
#FacmNo
#ApplyDt
##loop{times:40,i:1}
#FormNo{i}
#Paper{i}
#Msg{i}
#EMail{i}
##end
</sub>


!------ 下行電文TOM ------
<sub type="TOM">
TXFORM=L1108^
<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L1R04.tom"/>
<include src="ROM.icf::L1R11.tom"/>
<include src="ROM.icf::L1R13.tom"/>
<include src="ROM.icf::L1R01.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
</sub>
