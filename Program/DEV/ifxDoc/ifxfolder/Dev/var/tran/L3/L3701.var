!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

![業務別] 01:撥款匯款(含暫收退還且非退票) 02:支票繳款 03:債協 09:放款
#SECNO=_,_,S
T(3,09)

!#TXCD
!T(3,XW111)

!#FKEY 0:登錄,1:更正,2:放行,3:審核/在途登錄,5:更正重登,6:在途設定,7修改,9檢視journal
![一段式/二段式/三段式]
#RELCD=_,_,S
C(2,#FKEY,$,s,s,s,$,$,s,s,$,$)
E(0,2)

#ACTFG=_,_,S
C(2,#FKEY,$,s,s,s,$,$,s,s,$,$)
E(0,1)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
T(2,@RimTxCode,#TXCD)
E(0,@RimFKey,#FKEY)
</sub>

!=====================================================================
!#FKEY>0時，重新執行
!=====================================================================
<sub type="PREDC" name="PreDC">
!#PDC=X,1,S
!C(3,#FKEY,0,NOP,T(R,#MRKEY,#REFNO))
!C(3,#FKEY,3,NO_RUN(#CIFKEY,#PREFG,#KINDCD,#REFNO),$)
!C(3,#FKEY,7,NO_RUN(#CIFKEY,#PREFG,#KINDCD,#REFNO),s)

!<include src="COM.icf::ACTFGX-RUN.pre"/>
!<include src="COM.icf::TITLE-RUN.pre"/>
!<include src="TITF.icf::RPRUN.dec"/>

!先隱藏欄位 FLAG 0=隱藏 1=顯示
#HIDE2FG=A,1,S
IF(#FKEY==0,E(0,0),$)

#HIDE3FG=A,1,S
IF(#FKEY==0,E(0,0),$)

#HIDE4FG=A,1,S
IF(#FKEY==0,E(0,0),$)

#HIDE5FG=A,1,S
IF(#FKEY==0,E(0,0),$)

#HIDE6FG=A,1,S
IF(#FKEY==0,E(0,0),$)

#EXPANDFG=A,1,S
IF(#FKEY==0,E(0,0),$)

#P2SH=A,2,S
E(0,10)

#P2S=A,2,S
E(0,11)

! 16
#P2E=A,2,S
E(0,#P2S+5)
! 18
#P3S=A,2,S
E(0,#P2E+2)

!催收戶需需隱藏 20
#P3S1=A,2,S
E(0,#P3S+2)

#P3E1=A,2,S
E(0,#P3S1+3)

!已繳期款需隱藏 27
#P3S2=A,2,S
E(0,#P3S+6)

#P3E2=A,2,S
E(0,#P3S2+3)

#P3E=A,2,S
E(0,#P3S+9)

! #P4S=A,2,S
! E(0,#P3E+2)

! #P4E=A,2,S
! E(0,#P4S+3)

! #P5S=A,2,S
! E(0,#P4E+2)

! #P5E=A,2,S
! E(0,#P5S+6)

#P6S=A,2,S
E(0,#P3E+1)

#P6E=A,2,S
E(0,#P6S+7)

#KLIGHT=@,1,S
C(3,#HIDE2FG,1,K(LIGHT,#BTNHIDEP2,TXTRED,0),K(LIGHT,#BTNHIDEP2,TXTRED,-1))
C(3,#HIDE3FG,1,K(LIGHT,#BTNHIDEP3,TXTRED,0),K(LIGHT,#BTNHIDEP3,TXTRED,-1))
C(3,#HIDE6FG,1,K(LIGHT,#BTNHIDEP6,TXTRED,0),K(LIGHT,#BTNHIDEP6,TXTRED,-1))
C(5,#OvduFlag,Y,INVOKEJS(SHOW,p1,30,31,1),INVOKEJS(SHOW,p1,30,31,0))

!--- P2 利率
#HIDEP2=@,1,S
C(3,#EXPANDFG,1,CALL(#EXPAND),$)
C(3,#HIDE2FG,1,E(0,@HIDE2FG,0),E(0,@HIDE2FG,1))
INVOKEJS(SHOW,p1,#P2S,#P2E,#HIDE2FG)
C(3,#HIDE2FG,1,K(LIGHT,#BTNHIDEP2,TXTRED,0),K(LIGHT,#BTNHIDEP2,TXTRED,-1))
C(3,#HIDE2FG,1,$,s)
C(3,#HIDE3FG,1,CALL(#HIDEP3),$)
! C(3,#HIDE4FG,1,CALL(#HIDEP4),$)
! C(3,#HIDE5FG,1,CALL(#HIDEP5),$)
C(3,#HIDE6FG,1,CALL(#HIDEP6),$)
CALL(#KLIGHT)


!--- P3 金額日期
#HIDEP3=@,1,S
C(3,#EXPANDFG,1,CALL(#EXPAND),$)
C(3,#HIDE3FG,1,E(0,@HIDE3FG,0),E(0,@HIDE3FG,1))
INVOKEJS(SHOW,p1,#P3S,#P3E,#HIDE3FG)
C(5,#OvduFlag,Y,INVOKEJS(SHOW,p1,#P3S1,#P3E1,0),$)
C(5,#PaidFlag,Y,INVOKEJS(SHOW,p1,#P3S2,#P3E2,0),$)
C(3,#HIDE3FG,1,K(LIGHT,#BTNHIDEP3,TXTRED,0),K(LIGHT,#BTNHIDEP3,TXTRED,-1))
C(3,#HIDE3FG,1,$,s)
C(3,#HIDE2FG,1,CALL(#HIDEP2),$)
! C(3,#HIDE4FG,1,CALL(#HIDEP4),$)
! C(3,#HIDE5FG,1,CALL(#HIDEP5),$)
C(3,#HIDE6FG,1,CALL(#HIDEP6),$)
CALL(#KLIGHT)
 
! !--- P4 扣款帳號
! #HIDEP4=@,1,S
! C(3,#EXPANDFG,1,CALL(#EXPAND),$)
! C(3,#HIDE4FG,1,E(0,@HIDE4FG,0),E(0,@HIDE4FG,1))
! INVOKEJS(SHOW,p1,#P4S,#P4E,#HIDE4FG)
! C(3,#HIDE4FG,1,K(LIGHT,#BTNHIDEP4,TXTRED,0),K(LIGHT,#BTNHIDEP4,TXTRED,-1))
! C(3,#HIDE4FG,1,$,s)
! C(3,#HIDE2FG,1,CALL(#HIDEP2),$)
! C(3,#HIDE3FG,1,CALL(#HIDEP3),$)
! C(3,#HIDE5FG,1,CALL(#HIDEP5),$)
! C(3,#HIDE6FG,1,CALL(#HIDEP6),$)
! CALL(#KLIGHT)

!--- P5 與借款人關係
! #HIDEP5=@,1,S
! C(3,#EXPANDFG,1,CALL(#EXPAND),$)
! C(3,#HIDE5FG,1,E(0,@HIDE5FG,0),E(0,@HIDE5FG,1))
! INVOKEJS(SHOW,p1,#P5S,#P5E,#HIDE5FG)
! C(3,#HIDE5FG,1,K(LIGHT,#BTNHIDEP5,TXTRED,0),K(LIGHT,#BTNHIDEP5,TXTRED,-1))
! C(3,#HIDE5FG,1,$,s)
! C(3,#HIDE2FG,1,CALL(#HIDEP2),$)
! C(3,#HIDE3FG,1,CALL(#HIDEP3),$)
! ! C(3,#HIDE4FG,1,CALL(#HIDEP4),$)
! C(3,#HIDE6FG,1,CALL(#HIDEP6),$)
! CALL(#KLIGHT)
 
!--- P6 其他
#HIDEP6=@,1,S
C(3,#EXPANDFG,1,CALL(#EXPAND),$)
C(3,#HIDE6FG,1,E(0,@HIDE6FG,0),E(0,@HIDE6FG,1))
INVOKEJS(SHOW,p1,#P6S,#P6E,#HIDE6FG)
C(3,#HIDE6FG,1,K(LIGHT,#BTNHIDEP6,TXTRED,0),K(LIGHT,#BTNHIDEP6,TXTRED,-1))
C(3,#HIDE6FG,1,$,s)
C(3,#HIDE2FG,1,CALL(#HIDEP2),$)
C(3,#HIDE3FG,1,CALL(#HIDEP3),$)
! C(3,#HIDE4FG,1,CALL(#HIDEP4),$)
! C(3,#HIDE5FG,1,CALL(#HIDEP5),$)
CALL(#KLIGHT)

!--- 展開
#EXPAND=@,1,S
C(3,#EXPANDFG,1,E(0,@EXPANDFG,0),E(0,@EXPANDFG,1))
INVOKEJS(SHOW,p1,#P2SH,#P6E,#EXPANDFG)
C(3,#EXPANDFG,1,K(LIGHT,#BTNEXPAND,TXTRED,0),K(LIGHT,#BTNEXPAND,TXTRED,-1))
C(3,#EXPANDFG,1,$,s)
E(0,@HIDE2FG,0)
E(0,@HIDE3FG,0)
E(0,@HIDE4FG,0)
E(0,@HIDE5FG,0)
E(0,@HIDE6FG,0)
CALL(#KLIGHT)

#ActFgHelp=x,20,S
T(3,1:登錄;2:放行)

#INVKALL=X,1,S
K(MODIFYBUTTON,登錄)
IF(#FKEY==0 || #FKEY==7,INVOKEJS(SHOW,p1,1)INVOKEJS(SHOW,p1,#P2SH,#P6E,0),$)
C(3,#FKEY,0,$,T(F,@CustNo,0)
              T(F,@CustId,0)
              T(F,@ApplNo,0)
              T(F,@FacmNo,0)
              T(F,@BormNo,0)
              HIDE(#BTN1,#BTN2,#BTN3,#BTN4))
C(3,#FKEY,2,T(H,@ACTFGX,#ACTFG,#ActFgHelp),$)

<include src="COM.icf::TITLE-RUN.pre"/>
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=3;screen.width=[140,220,40,610];printer.width=[20,20,5,20];order=1">
[
["[L3701]                                 放款內容變更"],
[#<->#,"#FdMain+條件","@借戶戶號、統一編號、核准編號，需擇一輸入"],
[#<->#,"#FdActFg+登放記號",#ACTFGX],
[#<->#,"#FdCustNo+．借戶戶號",#CustNo,"@@@",#BTN1,#CustNoX],
[#<->#,"#FdCustId+．統一編號",#CustId,"@@@",#BTN2,#CustIdX],
[#<->#,"#FdApplNo+．核准編號",#ApplNo,"@@@",#BTN3,#ApplNoX],
[#<->#,"#FdFacmNo+額度編號",#FacmNo,"@@@@@@",#BTN4],
[#<->#,"#FdBormNo+撥款序號",#BormNo],
[#<->#,"@@@",#BTNHIDEP2,"@@",#BTNHIDEP3,"@@",#BTNHIDEP6,"@@",#BTNEXPAND],
["@","@@@變更前"],["@","@@@變更後"],
!利率
["<font color=red>@利率",""],["",""],
["#FdRateCode+利率區分",#RateCode1X],[#RateCodeY,#RateCode2,#RateCode2X],
["#FdRateIncr+利率加減碼",#RateIncr1X],[#RateIncrY,#RateIncr2,#RateIncr2X],
["#FdIndividualIncr+個別加減碼",#IndividualIncr1X],[#IndividualIncrY,#IndividualIncr2,#IndividualIncr2X],
["#FdRateAdjFreq+利率調整週期",#RateAdjFreq1,"個月"],[#RateAdjFreqY,#RateAdjFreq2,#RateAdjFreq2X],
["#FdFirstRateAdjDate+首次調整日期",#FirstRateAdjDate1],[#FirstRateAdjDateY,#FirstRateAdjDate2],
["#FdNextRateAdjDate+下次調整日期",#NextRateAdjDate1],[#NextRateAdjDateY,#NextRateAdjDate2],
!金額、日期
["<font color=red>@金額、日期",""],["",""],
["#FdAcctCode+業務科目",#AcctCode1X],[#AcctCodeY,#AcctCode2,#AcctCode2X],
["#FdMaturityDate+到期日",#MaturityDate1],[#MaturityDateY,#MaturityDate2],
["#FdIntCalcCode+計息方式",#IntCalcCode1,#IntCalcCode1X],[#IntCalcCodeY,#IntCalcCode2,#IntCalcCode2X],
!["#FdIntCalcFlag+以日計息",#IntCalcFlag1,#IntCalcFlag1X],[#IntCalcFlagY,#IntCalcFlag2,#IntCalcFlag2X],
["#FdAmortizedCode+攤還方式",#AmortizedCode1X],[#AmortizedCodeY,#AmortizedCode2,#AmortizedCode2X],
["#FdPayIntFreq+繳息週期",#PayIntFreq1],[#PayIntFreqY,#PayIntFreq2],
["#FdRepayFreq+還本週期",#RepayFreq1],[#RepayFreqY,#RepayFreq2],
! ["#FdProhibitDate+限制清償期限",#ProhibitDate1X],[#ProhibitDateY,#ProhibitDate2],
["#FdFirstDueDate+首次應繳日",#FirstDueDate1],[#FirstDueDateY,#FirstDueDate2],
["#FdSpecificDd+指定應繳日",#SpecificDd1],[#SpecificDdY,#SpecificDd2,"@@@@@@@",#BTN31],
["#FdGraceDate+寬限到期日",#GraceDate1X],[#GraceDateY,#GraceDate2],
["#FdAcctFee+帳管費",#AcctFee1X],[#AcctFeeY,#AcctFee2],
! !扣款帳號
! ["<font color=red>@扣款帳號",""],["",""],
! ["#FdRepayCode+繳款方式",#RepayCode1X,],[#RepayCodeY,#RepayCode2,#RepayCode2X],
! ["#FdRepayBank+扣款銀行代號",#RepayBank1,#RepayBank1X],[#RepayBankY,#RepayBank2,"@",#BTN41,#RepayBank2X],
! ["#FdRepayAcctNo+扣款帳號",#RepayAcctNo1],[#RepayAcctNoY,#RepayAcctNo2],
! ["#FdPostCode+郵局存款別",#PostCode1,#PostCode1X],[#PostCodeY,#PostCode2,#PostCode2X],
! !與借款人關係
! ["<font color=red>@與借款人關係",""],["",""],
! ["#FdRelationCode+與借款人關係",#RelationCode1X],[#RelationCodeY,#RelationCode2,#RelationCode2X], 
! [#<->#,"#FdRelationName+帳戶戶名",#RelationName1],[#RelationIdY,#RelationId2],
! [#<->#,"@@",#RelationNameY,#RelationName2],[#RelationBirthdayY,#RelationBirthday2],
! ["#FdRelationId+身份證字號",#RelationId1],[#RelationGenderY,#RelationGender2,#RelationGender2X],
! ["#FdRelationBirthday+出生日期",#RelationBirthday1],
! ["#FdRelationGender+性別",#RelationGender1,#RelationGender1X],
!其他
["<font color=red>@其他",""],["",""],
["#FdPieceCode+計件代碼",#PieceCode1,#PieceCode1X],[#PieceCodeY,#PieceCode2,#PieceCode2X],
! ["#FdPieceCodeSecondAmt+計件代碼2金額",#PieceCodeSecondAmt1X],[#PieceCodeSecondAmtY,#PieceCodeSecondAmt2],
! ["#FdPieceCodeSecond+計件代碼2",#PieceCodeSecond1,#PieceCodeSecond1X],[#PieceCodeSecondY,#PieceCodeSecond2,#PieceCodeSecond2X],
["#FdRemark+催收備註",#Remark1],[#RemarkY,#Remark2],
["#FdProcessDate+催收備註日期",#ProcessDate1X],[#ProcessDateY,#ProcessDate2],
[#<->#,"變更理由",#Reason,#ReasonX],
[#<->#,"@",#Remark],
]
!---------- AP Button AREA ----------
![Buttom資料查詢]
#BTN1=X,15,I,ui:button;value:額度資料查詢;enable:1;tabbable:0;title: L2015 額度明細資料查詢;
#BTN2=X,15,I,ui:button;value:顧客資料查詢;enable:1;tabbable:0;title: L1001 顧客明細資料查詢;
#BTN3=X,15,I,ui:button;value:核准號碼查詢;enable:1;tabbable:0;title: L2016 核准號碼明細資料查詢;
#BTN4=X,15,I,ui:button;value:撥款資料查詢;enable:1;tabbable:0;title: L3002 撥款明細資料查詢;
#BTN31=X,15,I,ui:button;value:應繳日試算;enable:1;tabbable:0;title: L3923 應繳日試算;
! #BTN41=X,15,I,ui:button;value:行庫資料查詢;enable:1;tabbable:0;title: L6071 行庫資料查詢;
#BTNHIDEP2=X,15,I,ui:button;value:    利率    ;enable:1;tabbable:0
#BTNHIDEP3=X,15,I,ui:button;value: 金額、日期 ;enable:1;tabbable:0
! #BTNHIDEP4=X,15,I,ui:button;value:  扣款帳號  ;enable:1;tabbable:0
! #BTNHIDEP5=X,15,I,ui:button;value:與借款人關係;enable:1;tabbable:0
#BTNHIDEP6=X,15,I,ui:button;value:    其他    ;enable:1;tabbable:0
!#BTNEXPAND=X,15,I,ui:button;value:   展開     ;enable:1;tabbable:1
#WKHIDE=X,1,S
HIDE(#BTN1,#BTN2,#BTN3,#BTN4)
!---------- AP TEXT AREA Variables ----------
! Help
<include src="HELPRIM.icf::HELPRIM.rtn"/>
!ProdIntCalcCode 計息方式
#CDDEF01=x,25,S
T(3,CdCode.ProdIntCalcCode)

#ProdIntCalcCodeHelp=x,1024,S

!RelationCode 與借款人關係
#CDDEF02=x,20,S
T(3,CdCode.RelationCode)

#RelationCodeHelp=x,1024,S

!RateCode 利率區分
#CDDEF03=x,20,S
T(3,CdCode.FacmRateCode)

#RateCodeHelp=x,1024,S

!AcctCode 業務科目
#CDDEF04=x,20,S
T(3,CdCode.FacmAcctCode)

#AcctCodeHelp=x,1024,S

!AmortizedCode 攤還方式
#CDDEF05=x,30,S
T(3,CdCode.FacmAmortizedCode)

#AmortizedCodeHelp=x,1024,S

!PieceCode 計件代碼
#CDDEF06=x,30,S
T(3,CdCode.PieceCode)

#PieceCodeHelp=x,1024,S

!幣別小數位
#CDDEF07=x,26,S
T(3,CdCode.CurrPrecision)

#CurrPrecisionHelp=x,1024,S


!變更理由
#CDDEF08=x,26,S
T(3,CdCode.Reason)

#ReasonHelp=x,1024,S



#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDDEF01,#CDDEF02,#CDDEF03,#CDDEF04,#CDDEF05,#CDDEF06,#CDDEF07,#CDDEF08)
R(1,XXR99)
CALL(#HelpProc)
T(2,@ProdIntCalcCodeHelp,#HelpDesc1)
T(2,@RelationCodeHelp,#HelpDesc2)
T(2,@RateCodeHelp,#HelpDesc3)
T(2,@AcctCodeHelp,#HelpDesc4)
T(2,@AmortizedCodeHelp,#HelpDesc5)
T(2,@PieceCodeHelp,#HelpDesc6)
T(2,@CurrPrecisionHelp,#HelpDesc7)
T(2,@ReasonHelp,#HelpDesc8)

#FdMain=X,2,L
T(3,*)

![登放記號]
#FdActFg=X,2,L

#ACTFG=_,_,S

#ACTFGX=X,8,L
T(3,)T(H,#ACTFG,#ActFgHelp)

#BUF1A=X,18,S
T(3,00000019999999000)

#BIND1A=X,1,S
BIND(#BTN1,click, {cmd=CHAIN; ntxcd=L2015; ntxbuf=#BUF1A;ntxbuf5=type<-1:FacmNo<-OOFacmNo:CustNo<-OOCustNo})

![借戶戶號]
!借戶戶號, 統一編號或核准編號擇一輸入
#FdCustNo=X,2,L

#CustNo=A,7,I
C(3,#FKEY,0,$,s)
! INVOKEJS(SHOW,p1,2,4,1)
SHOW(#BTN1)HIDE(#BTN2,#BTN3)

#WKBTN1=X,1,S
! C(3,#CustNo,0,INVOKEJS(SHOW,p1,2,2,0),INVOKEJS(SHOW,p1,3,4,0))

#BUF1B=X,18,S
T(2,#CustNo+9999999000)

#BIND1B=X,1,S
BIND(#BTN1,click, {cmd=CHAIN; ntxcd=L2015; ntxbuf=#BUF1B;ntxbuf5=type<-1:FacmNo<-OOFacmNo:CustNo<-OOCustNo})

#SendL2r07A=X,1,S
C(3,#FKEY,0,$,s)
C(3,#CustNo,0,S,$)
T(3,@RimCustId, )
E(0,@RimCustNo,#CustNo)
E(0,@RimFacmNo,0)
RESET_RIM(#SendL2r07A,L2R07)
S(L2R07,1,#RimTxCode,#RimCustId,#RimCustNo,#RimFacmNo)
R(1,L2R07)

#CustNoX=X,100,L
C(3,#FKEY,0,$,s)
C(3,#CustNo,0,S,T(2,#L2r07CustName))

#BUF2A=X,100,S

#BIND2A=X,1,S
BIND(#BTN2,click, {cmd=CHAIN; ntxcd=L1001; ntxbuf=#BUF2A;ntxbuf5=type<-1:CustId<-OOCustId})

#init=X,1,S
T(F,@Remark,0)

![統一編號]
#FdCustId=X,2,L

#CustId=X,10,I
C(3,#FKEY,0,$,s)
T(3,@FdApplNo, )
C(3,#CustNo,0,$,S)
! INVOKEJS(SHOW,p1,3,4,1)
SHOW(#BTN2)HIDE(#BTN1,#BTN3)

#WKBTN2=X,1,S
! C(4,#CustId,INVOKEJS(SHOW,p1,3,3,0),INVOKEJS(SHOW,p1,4,4,0))

#BUF2B=X,100,S
T(2,0000000+#CustId)

#BIND2B=X,1,S
BIND(#BTN2,click, {cmd=CHAIN; ntxcd=L1001; ntxbuf=#BUF2B;ntxbuf5=type<-1:CustId<-OOCustId})

#CheckCustId=X,1,S
C(3,#FKEY,0,$,s)
C(4,#CustId,S,$)
A(ID_UNINO,0,#CustId)

#SendL2r07B=X,1,S
C(3,#FKEY,0,$,s)
C(4,#CustId,S,$)
T(2,@RimCustId,#CustId)
E(0,@RimCustNo,0)
E(0,@RimFacmNo,0)
RESET_RIM(#SendL2r07B,L2R07)
S(L2R07,1,#RimTxCode,#RimCustId,#RimCustNo,#RimFacmNo)
R(1,L2R07)

#CustIdX=X,100,L
C(3,#FKEY,0,$,s)
C(4,#CustId,S,T(2,#L2r07CustName))

#BUF3A=X,18,S
T(3,000000199999990)

#BIND3A=X,1,S
BIND(#BTN3,click, {cmd=CHAIN; ntxcd=L2016; ntxbuf=#BUF3A;ntxbuf5=type<-1:ApplNo<-OOApplNo:FacmNo<-OOFacmNo})

![核准編號]
#FdApplNo=X,2,L
C(3,#FKEY,0,$,s)
C(3,#CustNo,0,$,S)
C(4,#CustId,$,S)
T(3,*)

#ApplNo=A,7,I
C(3,#FKEY,0,$,s)
C(3,#CustNo,0,$,S)
C(4,#CustId,$,S)
! INVOKEJS(SHOW,p1,4,4,1)
SHOW(#BTN3)HIDE(#BTN1,#BTN2)
@V(2,0)

#BUF3B=X,18,S
T(2,#ApplNo+99999990)

#BIND3B=X,1,S
BIND(#BTN3,click, {cmd=CHAIN; ntxcd=L2016; ntxbuf=#BUF3B;ntxbuf5=type<-1:ApplNo<-OOApplNo:FacmNo<-OOFacmNo})

!用核准號碼(ApplNo)調L2R05
#SendL2r05A=X,1,S
C(3,#FKEY,0,$,s)
C(3,#ApplNo,0,S,$)
E(0,@RimFuncCode,5)
E(0,@RimCustNo,#CustNo)
E(0,@RimFacmNo,0)
E(0,@RimApplNo,#ApplNo)
E(0,@RimCaseNo,0)
RESET_RIM(#SendL2r05A,L2R05)
S(L2R05,1,#RimFuncCode,#RimTxCode,#RimFKey,#RimCustNo,#RimFacmNo,#RimApplNo,#RimCaseNo)
R(1,L2R05)
E(0,@FacmNo,#L2r05FacmNo)

#SendL2r07C=X,1,S
C(3,#FKEY,0,$,s)
C(3,#ApplNo,0,S,$)
T(2,@RimCustId,#L2r05CustId)
E(0,@RimCustNo,#CustNo)
RESET_RIM(#SendL2r07C,L2R07)
S(L2R07,1,#RimTxCode,#RimCustId,#RimCustNo,#RimFacmNo,#END)
R(1,L2R07)

#ApplNoX=X,100,L
C(3,#FKEY,0,$,s)
C(3,#ApplNo,0,S,T(2,#L2r07CustName))

#TimCustNo=A,7,S
C(3,#FKEY,0,$,s)
E(0,0)
C(3,#CustNo,0,$,E(0,#CustNo))
C(4,#CustId,$,E(0,#L2r07CustNo))
C(3,#ApplNo,0,$,E(0,#L2r05CustNo))
T(2,@LockCustNo,#TimCustNo)
! <include src="COM.icf::LockControl.rtn"/>

#FacmOnlyFlag=X,1,S
C(3,#FKEY,0,$,s)
C(3,#L2r07BormCount,0,T(3,Y),T(3,N))


#BUF4A=X,100,S
T(2,0000000+#CustNo+#CustId+#ApplNo+000)

#BIND4A=X,1,S
BIND(#BTN4,click, {cmd=CHAIN; ntxcd=L3002; ntxbuf=#BUF4A;ntxbuf5=type<-1:FacmNo<-OOFacmNo:BormNo<-OOBormNo})

![額度編號]
!必須輸入
#FdFacmNo=X,2,L

#FacmNo=A,3,I
C(3,#FKEY,0,$,s)
C(3,#ApplNo,0,$,s)
SHOW(#BTN4)
@C(3,#ApplNo,0,V(2,0),$)

#WKBTN4=X,1,S
C(3,#FKEY,0,$,s)
C(3,#ApplNo,0,SHOW(#BTN4),HIDE(#BTN4))

#WkFacmNo=A,3,S
C(3,#FacmNo,0,E(0,#L2r07FacmNo),E(0,#FacmNo))

!用CustNo,FacmNo調L2R05
#SendL2r05B=X,1,S
C(3,#FKEY,0,$,s)
C(3,#WkFacmNo,0,S,$)
E(0,@RimFuncCode,5)
E(0,@RimCustNo,#TimCustNo)
E(0,@RimFacmNo,#WkFacmNo)
E(0,@RimApplNo,0)
E(0,@RimCaseNo,0)
RESET_RIM(#SendL2r05B,L2R05)
S(L2R05,1,#RimFuncCode,#RimTxCode,#RimFKey,#RimCustNo,#RimFacmNo,#RimApplNo,#RimCaseNo)
R(1,L2R05)

![撥款序號]
#FdBormNo=X,2,L
C(3,#FKEY,0,$,s)
C(3,#FacmNo,0,T(F,@BormNo,0),T(F,@BormNo,1))
INVOKEJS(SHOW,p1,#P2S,#P6E,0)

#BormNo=A,3,I
C(3,#FKEY,0,$,s)
C(3,#FacmNo,0,S,$)

!有輸入撥款時塞Y否則N
#ChackBormNoFg=X,1,S
IF(#BormNo>0,T(3,Y),T(3,N))


#WkBormNo=A,3,S
C(3,#FacmNo,0,IF(#WkFacmNo==#L2r07FacmNo && #BormNo==0,E(0,#L2r07BormNo),E(0,#BormNo)),IF(#BormNo==0,E(0,#L2r07BormNo),E(0,#BormNo)))
C(3,#FKEY,0,$,s)
C(3,#WkBormNo,0,V(P,無撥款資料),$)



#SendL3r02=X,1,S
C(3,#FKEY,0,$,s)
C(3,#WkBormNo,0,S,$)
E(0,@RimFuncCode,5)
E(0,#RimCustNo,#TimCustNo)
E(0,@RimFacmNo,#WkFacmNo)
E(0,@RimBormNo,#WkBormNo)
RESET_RIM(#SendL3r02,L3R02)
S(L3R02,1,#RimTxCode,#RimFKey,#RimFuncCode,#RimCustNo,#RimFacmNo,#RimBormNo)
R(1,L3R02)


#BormStatus=A,2,S
C(3,#FKEY,0,$,s)
C(3,#WkBormNo,0,S,$)
E(0,#L3r02Status)

!T(3,@IntCalcFlag1,#L3r02)
!T(3,@ProhibitDate1,#L3r02)

#RcvL2r05=X,1,S
C(3,#FKEY,0,$,s)
E(0,@AcctCode1,#L2r05AcctCode)
E(0,@MaturityDate1,#L2r05MaturityDate)
T(2,@IntCalcCode1,#L2r05IntCalcCode)
E(0,@RateCode1,#L2r05RateCode)
E(0,@RateIncr1,#L2r05RateIncr)
E(0,@IndividualIncr1,#L2r05IndividualIncr)
E(0,@RateAdjFreq1,#L2r05RateAdjFreq)
E(0,@PayIntFreq1,#L2r05PayIntFreq)
E(0,@RepayFreq1,#L2r05RepayFreq)
E(0,@AmortizedCode1,#L2r05AmortizedCode)
E(0,@AcctFee1,#L2r05AcctFee)
T(2,@PieceCode1,#L2r05PieceCode)
! T(2,@RelationCode1,#L2r05RelationCode)
! T(2,@RelationName1,#L2r05RelationName)
! T(2,@RelationId1,#L2r05RelationId)
! E(0,@RelationBirthday1,#L2r05RelationBirthday)
! T(2,@RelationGender1,#L2r05RelationGender)

#RcvL3r02=X,1,S
C(3,#FKEY,0,$,s)
C(3,#WkBormNo,0,S,$)
E(0,@MaturityDate1,#L3r02MaturityDate)
T(2,@IntCalcCode1,#L3r02IntCalcCode)
E(0,@RateCode1,#L3r02RateCode)
E(0,@RateIncr1,#L3r02RateIncr)
E(0,@IndividualIncr1,#L3r02IndividualIncr)
E(0,@FirstRateAdjDate1,#L3r02FirstRateAdjDate)
E(0,@NextRateAdjDate1,#L3r02NextRateAdjDate)
E(0,@RateAdjFreq1,#L3r02RateAdjFreq)
E(0,@PayIntFreq1,#L3r02PayIntFreq)
E(0,@RepayFreq1,#L3r02RepayFreq)
E(0,@AmortizedCode1,#L3r02AmortizedCode)
E(0,@GraceDate1,#L3r02GraceDate)
E(0,@FirstDueDate1,#L3r02FirstDueDate)
E(0,@SpecificDd1,#L3r02SpecificDd)
E(0,@AcctFee1,#L3r02AcctFee)
T(2,@PieceCode1,#L3r02PieceCode)
T(2,@PieceCodeSecond1,#L3r02PieceCodeSecond)
E(0,@PieceCodeSecondAmt1,#L3r02PieceCodeSecondAmt)



! T(2,@RelationCode1,#L3r02RelationCode)
! T(2,@RelationName1,#L3r02RelationName)
! T(2,@RelationId1,#L3r02RelationId)
! E(0,@RelationBirthday1,#L3r02RelationBirthday)
! T(2,@RelationGender1,#L3r02RelationGender)

#SendL2r01=X,1,S
C(3,#FKEY,0,$,s)
E(0,@RimFuncCode,5)
T(2,@RimProdNo,#L2r05ProdNo)
RESET_RIM(#SendL2r01,L2R01)
S(L2R01,1,#RimFuncCode,#RimTxCode,#RimProdNo)
R(1,L2R01)

#SendL6r28=X,1,S
E(0,@RimFuncCode,5)
T(2,@RimBusinessType,LN)
RESET_RIM(#SendL6r28,L6R28)
S(L6R28,1,#RimFuncCode,#RimTxCode,#RimBusinessType)
R(1,L6R28)

!Y:已繳期款 N:未繳期款
#PaidFlag=X,1,S
C(3,#FKEY,0,$,s)
C(3,#L3r02PaidTerms,0,T(3,N),T(3,Y))

!催收戶
#OvduFlag=X,1,S
C(3,#FKEY,0,$,s)
C(3,#BormStatus,2,T(3,Y),T(3,N))
C(5,#OvduFlag,Y,INVOKEJS(SHOW,p1,30,31,1),INVOKEJS(SHOW,p1,30,31,0))

#CurrencyCode=X,3,S
C(3,#FKEY,0,$,s)
T(2,#L3r02CurrencyCode)

#Precision=N,1,S
E(0,0)T(H,#CurrencyCode,#CurrPrecisionHelp)
!-------------------- 變更前
!---- P2 利率

#INVK2A=X,1,S
C(5,#OvduFlag,Y,DISABLE(#BTNHIDEP2),$)
C(5,#OvduFlag,Y,S,$)
ENABLE(#BTNHIDEP2)
C(3,#HIDE2FG,0,CALL(#HIDEP2),$)

#BINDP2=X,1,S
BIND(#BTNHIDEP2,click, {cmd=CALLSEND;DOCODE=HIDEP2})

![利率區分]
!催收戶不可變更,須隱藏欄位
#FdRateCode=X,2,L

#RateCode1=X,1,S

#RateCode1X=X,10,L
T(3,)T(H,#RateCode1,#RateCodeHelp)            

![利率加減碼]
!催收戶不可變更,須隱藏欄位
#FdRateIncr=X,2,L
C(5,#L2r01IncrFlag,Y,T(F,@RateIncr2,1)
                     T(3,@RateIncr2X,%)
                     T(F,@IndividualIncr2,0)
                     T(3,@IndividualIncr2X, )
                    ,T(F,@RateIncr2,0)
                     T(3,@RateIncr2X, )
                     T(F,@IndividualIncr2,1)
                     T(3,@IndividualIncr2X,%))
  
#RateIncr1=n,2.4,S

#RateIncr1X=X,8,L
X(#RateIncr1)
T(B,#RateIncr1X+%)

![個別加減碼]
!催收戶不可變更,須隱藏欄位  
#FdIndividualIncr=X,2,L

#IndividualIncr1=n,2.4,S

#IndividualIncr1X=X,8,L
X(#IndividualIncr1)
T(B,#IndividualIncr1X+%)

![利率調整週期]
!催收戶不可變更,須隱藏欄位
#FdRateAdjFreq=X,2,L

#RateAdjFreq1=X,2,L

![首次調整日期]
!催收戶不可變更,須隱藏欄位
#FdFirstRateAdjDate=X,2,L

#FirstRateAdjDate1=D,7,L

![下次調整日期]
!催收戶不可變更,須隱藏欄位
#FdNextRateAdjDate=X,2,L

#NextRateAdjDate1=D,7,L

!---- P3 金額日期
#INVK3A=X,1,S
ENABLE(#BTNHIDEP3)
C(3,#HIDE3FG,0,CALL(#HIDEP3),$)

#BINDP3=X,1,S
BIND(#BTNHIDEP3,click, {cmd=CALLSEND;DOCODE=HIDEP3})

![業務科目]
#FdAcctCode=X,2,L

#AcctCode1=X,3,S

#AcctCode1X=X,20,L
T(3,)T(H,#AcctCode1,#AcctCodeHelp)

![到期日]
#FdMaturityDate=X,2,L

#MaturityDate1=D,7,L


! [計息方式]
#FdIntCalcCode=X,2,L

#IntCalcCode1=X,1,L

#IntCalcCode1X=X,10,L
T(H,#IntCalcCode1,#ProdIntCalcCodeHelp)




![以日計息]
!#FdIntCalcFlag=X,2,L

!#IntCalcFlag1=X,1,L

!#IntCalcFlag1X=X,2,L
!T(A,#IntCalcFlag1,L3DEF,YesNoDef,YesNo,YesNoX)

![攤還方式]
#FdAmortizedCode=X,2,L

#AmortizedCode1=X,1,S

#AmortizedCode1X=X,12,L
T(3,)T(H,#AmortizedCode1,#AmortizedCodeHelp)            

![繳息週期]
#FdPayIntFreq=X,2,L

#PayIntFreq1=X,2,L

![還本週期]
#FdRepayFreq=X,2,L

#RepayFreq1=X,2,L

#RepayFreq1N=A,2,S
E(0,#RepayFreq1)

![限制清償期限]
! #FdProhibitDate=X,2,L

! #ProhibitDate1=D,7,S

! #ProhibitDate1X=X,9,L
! CALL2(#AdjustDate,#ProhibitDate1,#ProhibitDate1X)

![寬限到期日]
!未繳期款才可變更,其他需隱藏
#FdGraceDate=X,2,L

#GraceDate1=D,7,L

#GraceDate1X=X,9,L
CALL2(#AdjustDate,#GraceDate1,#GraceDate1X)

![首次應繳日]
!未繳期款才可變更,其他需隱藏
#FdFirstDueDate=X,2,L

#FirstDueDate1=D,7,L

![指定應繳日]
!未繳期款才可變更,其他需隱藏
#FdSpecificDd=X,2,L

#SpecificDd1=X,2,L

![帳管費]
!未繳期款才可變更,其他需隱藏
#FdAcctFee=X,2,L

#AcctFee1=m,14.2,S

#AcctFee1X=X,22,L
CALL2(#ADJUSTDOT,#Precision,#AcctFee1,#AcctFee1X)

! !---- P4 扣款帳號
! #INVK4A=X,1,S
! ENABLE(#BTNHIDEP4)
! C(3,#HIDE4FG,0,CALL(#HIDEP4),$)

! #BINDP4=X,1,S
! BIND(#BTNHIDEP4,click, {cmd=CALLSEND;DOCODE=HIDEP4})

! ![繳款方式]
! #FdRepayCode=X,2,L

! #RepayCode1=X,2,L

! #RepayCode1X=X,16,L
! T(A,#RepayCode1,L3DEF,RepayCodeDef,RepayCode,RepayCodeX) 

! ![扣款銀行代號]
! #FdRepayBank=X,2,L

! #RepayBank1=X,3,L

! #SendL2r09A=X,1,S
! C(3,#FKEY,0,$,s)
! C(3,#RepayCode1,2,$,S)
! T(2,@RimBankCode,#RepayBank1)
! RESET_RIM(#SendL2r09A,L2R09)
! S(L2R09,1,#RimTxCode,#RimBankCode)
! R(1,L2R09)

! #RepayBank1X=X,20,L
! C(3,#FKEY,0,$,s)
! C(3,#RepayCode1,2,$,S)
! T(2,#L2r09BankItem)

! ![扣款帳號]
! #FdRepayAcctNo=X,2,L

! #RepayAcctNo1=X,14,L

! ![郵局存款別]
! #FdPostCode=X,2,L

! #PostCode1=X,1,L

! #PostCode1X=X,4,L
! C(3,#FKEY,0,$,s)
! C(3,#RepayBank1,700,$,S)
! T(A,#PostCode1,L3DEF,PostCodeDef,PostCode,PostCodeX) 

! !---- P5 與借款人關係
! #INVK5A=X,1,S
! ENABLE(#BTNHIDEP5)
! C(3,#HIDE5FG,0,CALL(#HIDEP5),$)

! #BINDP5=X,1,S
! BIND(#BTNHIDEP5,click, {cmd=CALLSEND;DOCODE=HIDEP5})

! ![與借款人關係]
! #FdRelationCode=X,2,L
 
! #RelationCode1=X,2,S

! #RelationCode1X=X,4,L
! T(H,#RelationCode1,#RelationCodeHelp)
! ! T(A,#RelationCode1,L3DEF,RelationCodeDef,RelationCode,RelationCodeX)            

! ![帳戶戶名]
! #FdRelationName=X,2,L

! #RelationName1=X,100,L

! ![身份證字號]
! #FdRelationId=X,2,L

! #RelationId1=X,10,L

! ![錯誤註記]
! !#RELACCTERR1=X,1,S

! !#RELACCTERR1X=X,10,S
! !T(A,#RELACCTERR1,L3DEF,ACCTERRDEF,ACCTERR,ACCTERRX) 

! ![出生日期]
! #FdRelationBirthday=X,2,L

! #RelationBirthday1=D,7,L

! ![性別]
! #FdRelationGender=X,2,L

! #RelationGender1=X,1,L

! #RelationGender1X=X,2,L
! T(A,#RelationGender1,L3DEF,GenderCodeDef,GenderCode,GenderCodeX)

!---- P6 其他
#INVK6A=X,1,S
ENABLE(#BTNHIDEP6)
C(3,#HIDE6FG,0,CALL(#HIDEP6),$)

#BINDP6=X,1,S
BIND(#BTNHIDEP6,click, {cmd=CALLSEND;DOCODE=HIDEP6})

![計件代碼]
!必須輸入
!借新還舊/展期作業時，舊案件的計件代碼若為[7:服務件]，新案件計件代碼需可選擇[3:原額度]或[4:新增額度]。
#FdPieceCode=X,2,L

#PieceCode1=X,1,L
! HELP(L3DEF,PieceCodeDef,PieceCode,PieceCodeX,cols:2)
! @V(7)V(E,0,L3DEF,PieceCodeDef)
! C(5,#RenewFlag,Y,V(3,C,D,3,4),$)

#PieceCode1X=X,20,L
T(3,)T(H,#PieceCode1,#PieceCodeHelp)     

!計件代碼2
#FdPieceCodeSecond=X,2,L
#PieceCodeSecond1=X,1,L
#PieceCodeSecond1X=X,20,L
T(3,)T(H,#PieceCodeSecond1,#PieceCodeHelp)     

!計件代碼2金額
#FdPieceCodeSecondAmt=X,2,L

#PieceCodeSecondAmt1=m,14.2,S

#PieceCodeSecondAmt1X=X,22,L
CALL2(#ADJUSTDOT,#Precision,#PieceCodeSecondAmt1,#PieceCodeSecondAmt1X)

![備註]
!催收戶才可變更,其他須隱藏欄位
#FdRemark=X,2,L

#Remark1=X,60,L



![處理日期]
!催收戶才可變更,其他須隱藏欄位
#FdProcessDate=X,2,L

#ProcessDate1=D,7,S

#ProcessDate1X=X,9,L
CALL2(#AdjustDate,#ProcessDate1,#ProcessDate1X)

!------------------- 變更後
!---- P2 利率
#INVK2B=X,1,S
C(5,#OvduFlag,Y,DISABLE(#BTNHIDEP2),$)
C(5,#OvduFlag,Y,S,$)
ENABLE(#BTNHIDEP2)
C(3,#HIDE2FG,0,CALL(#HIDEP2),$)
T(F,@FirstRateAdjDate2,1)
T(F,@NextRateAdjDate2,1)
T(F,@RateAdjFreq2,1)
T(3,@RateAdjFreq2X,個月)

![利率區分]
!催收戶不可變更,須隱藏欄位
#RateCode2=X,1,I
C(5,#ChackBormNoFg,Y,S,$)
C(5,#OvduFlag,Y,S,$)
HELP(#RateCodeHelp)
@C(4,#RateCode2,S,$)
V(H,#RateCodeHelp)
V(2,#RateCode1)

#RateCode2X=X,10,L
C(5,#ChackBormNoFg,Y,S,$)
T(3,)T(H,#RateCode2,#RateCodeHelp)            

#RateCodeY=X,1,L
C(5,#ChackBormNoFg,Y,S,$)
C(4,#RateCode2,S,T(3,X))

#WkRateAdjFreq=A,1,S
C(5,#ChackBormNoFg,Y,S,$)
E(0,0)
C(3,#RateCode2,3,E(0,1),$)
IF(#RateCode2=="" && #RateCode1=="3",E(0,1),$)
C(3,#WkRateAdjFreq,1,T(3,@RateAdjFreq2X,個月)
                     T(F,@RateAdjFreq2,1)
                     T(F,@FirstRateAdjDate2,1)
                     T(F,@NextRateAdjDate2,1)
                    ,T(3,@RateAdjFreq2X, )
                     T(F,@RateAdjFreq2,0)
                     T(F,@FirstRateAdjDate2,0)
                     T(F,@NextRateAdjDate2,0))

![利率加減碼]  
!催收戶不可變更,須隱藏欄位
#RateIncr2X=X,1,L
C(5,#ChackBormNoFg,Y,S,$)
C(5,#L2r01IncrFlag,Y,T(3,%),T(3, ))

#RateIncr2=X,7,I
C(5,#ChackBormNoFg,Y,S,$)
C(5,#OvduFlag,Y,S,$)
C(5,#L2r01IncrFlag,Y,$,S)
C(3,#HIDE2FG,0,CALL(#HIDEP2),$)

#RateIncr2N=n,7.4,S
C(5,#ChackBormNoFg,Y,S,$)
C(4,#RateIncr2,S,$)
E(0,#RateIncr2)
V(2,#RateIncr1)
V(5,0,99.9999)

#RateIncrY=X,1,L
C(5,#ChackBormNoFg,Y,S,$)
C(4,#RateIncr2,S,T(3,X))

![個別加減碼]
!催收戶不可變更,須隱藏欄位 
#IndividualIncr2X=X,1,L
C(5,#ChackBormNoFg,Y,S,$)
C(5,#L2r01IncrFlag,Y,T(3, ),T(3,%))
 
#IndividualIncr2=X,7,I
C(5,#ChackBormNoFg,Y,S,$)
C(5,#OvduFlag,Y,S,$)
C(5,#L2r01IncrFlag,Y,S,$)
C(3,#RateIncr2N,0,$,S)
C(3,#HIDE2FG,0,CALL(#HIDEP2),$)

#IndividualIncr2N=n,7.4,S
C(5,#ChackBormNoFg,Y,S,$)
C(4,#IndividualIncr2,S,$)
E(0,#IndividualIncr2)
V(2,#IndividualIncr1)
V(5,0,99.9999)

#IndividualIncrY=X,1,L
C(5,#ChackBormNoFg,Y,S,$)
C(4,#IndividualIncr2,S,T(3,X))

![利率調整週期]
!催收戶不可變更,須隱藏欄位
!利率區分為 '3' 者，必須輸入利率調整週
#RateAdjFreq2X=X,4,L
C(5,#ChackBormNoFg,Y,S,$)
C(3,#WkRateAdjFreq,1,$,S)
T(3,個月)

#RateAdjFreq2=X,2,I
C(5,#ChackBormNoFg,Y,S,$)
C(5,#OvduFlag,Y,S,$)
C(3,#WkRateAdjFreq,1,$,S)
C(3,#HIDE2FG,0,CALL(#HIDEP2),$)
@V(4,#RateAdjFreq1)
C(3,#RateAdjFreq1,0,C(3,#RateCode2,3,V(7),$),$)

#RateAdjFreq2W=A,2,S
C(5,#ChackBormNoFg,Y,S,$)
C(4,#RateAdjFreq2,S,$)
E(0,#RateAdjFreq2)
V(5,1,99)

#RateAdjFreqY=X,1,L
C(5,#ChackBormNoFg,Y,S,$)
C(4,#RateAdjFreq2,S,T(3,X))

![首次調整日期]
!催收戶不可變更,須隱藏欄位
!已過首次調整日,不可變更
!變更前自動顯示,變更後可修改
!利率區分為定期機動者，必須輸入,其他不可輸入
#FirstRateAdjDate2=D,7,I
C(5,#ChackBormNoFg,Y,S,$)
C(3,#HIDE2FG,0,CALL(#HIDEP2),$)
C(5,#FacmOnlyFlag,Y,S,$)
C(5,#OvduFlag,Y,S,$)
C(3,#WkRateAdjFreq,1,$,S)
IF(#FirstRateAdjDate1 > 0 && #FirstRateAdjDate1 < #SYSDATE,S,$)
D(8)
@IF(#RateCode1=="3" && #RateCode2=="" && #RateAdjFreq2=="" && #FirstRateAdjDate2==0,s,$)
A(DATE,0,#FirstRateAdjDate2)
V(5,#SYSDATE,#L3r02MaturityDate)
!V(2,#FirstRateAdjDate1)

#FirstRateAdjDateY=X,1,L
C(5,#ChackBormNoFg,Y,S,$)
C(4,#FirstRateAdjDate2,S,T(3,X))

![下次調整日期]
!催收戶不可變更,須隱藏欄位
!變更前自動顯示,變更後可修改
!利率區分為定期機動者，必須輸入,其他不可輸入
#NextRateAdjDate2=D,7,I
C(5,#ChackBormNoFg,Y,S,$)
C(3,#HIDE2FG,0,CALL(#HIDEP2),$)
C(5,#FacmOnlyFlag,Y,S,$)
C(5,#OvduFlag,Y,S,$)
C(3,#WkRateAdjFreq,1,$,S)
D(8)
IF(#RateCode1=="3" && #RateCode2=="" && #RateAdjFreq2=="" && #FirstRateAdjDate2==0,s,$)
@
A(DATE,0,#NextRateAdjDate2)
V(5,#FirstRateAdjDate2,#L3r02MaturityDate)
!V(2,#NextRateAdjDate1)

#NextRateAdjDateY=X,1,L
C(5,#ChackBormNoFg,Y,S,$)
C(4,#NextRateAdjDate2,S,T(3,X))

!---- P3 金額日期
#INVK3B=X,1,S
ENABLE(#BTNHIDEP3)
C(3,#HIDE3FG,0,CALL(#HIDEP3),$)

![業務科目]
!依核准額度自動顯示不必輸入
!撥款之業務科目與額度之業務科目,期限,區分需相同
#AcctCode2=X,3,L
C(5,#ChackBormNoFg,Y,S,$)
@C(4,#AcctCode2,S,$)
V(E,0,L2DEF,FacmAcctCodeDef)
V(2,#AcctCode1)

#AcctCode2X=X,20,L
C(5,#ChackBormNoFg,Y,S,$)
T(3,)T(H,#AcctCode2,#AcctCodeHelp)

#AcctCodeY=X,1,L
C(5,#ChackBormNoFg,Y,S,$)
C(4,#AcctCode2,S,T(3,X))

#AcctCode3=X,3,S
C(5,#ChackBormNoFg,Y,S,$)
C(4,#AcctCode2,T(2,#AcctCode1),T(2,#AcctCode2))

#WkAcctBeginMm=A,3,S
C(5,#ChackBormNoFg,Y,S,$)
C(5,#AcctCode3,310,E(0,#L6R28AcctCode310A*12),$)
C(5,#AcctCode3,320,E(0,#L6R28AcctCode320A*12),$)
C(5,#AcctCode3,330,E(0,#L6R28AcctCode330A*12),$)
C(5,#AcctCode3,340,E(0,#L6R28AcctCode330A*12),$)

#WkAcctEndMm=A,3,S
C(5,#ChackBormNoFg,Y,S,$)
C(5,#AcctCode3,310,E(0,#L6R28AcctCode310B*12),$)
C(5,#AcctCode3,320,E(0,#L6R28AcctCode320B*12),$)
C(5,#AcctCode3,330,E(0,#L6R28AcctCode330B*12),$)
C(5,#AcctCode3,340,E(0,#L6R28AcctCode330B*12),$)

#WkAcctBeginDate=D,8,S
C(3,#FKEY,0,$,s)
C(5,#ChackBormNoFg,Y,S,$)
C(5,#AcctCode3,310,E(0,#L3r02DrawdownDate),D(7,2,#L3r02DrawdownDate,#WkAcctBeginMm,1))
! M(H,#L3r02DrawdownDate,#L3r02PrevPayIntDate,#WkAcctBeginDate)

#WkAcctEndDate=D,8,S
C(3,#FKEY,0,$,s)
C(5,#ChackBormNoFg,Y,S,$)
D(7,2,#L3r02DrawdownDate,#WkAcctEndMm,0)

![到期日]
#MaturityDate2=D,7,I
C(3,#HIDE3FG,0,CALL(#HIDEP3),$)
C(5,#ChackBormNoFg,Y,S,$)
D(8)
@C(5,#AcctCodeY,X,$,C(3,#MaturityDate2,0,S,$))
A(DATE,0,#MaturityDate2)
V(5,#WkAcctBeginDate,#WkAcctEndDate)
C(5,#AcctCodeY,X,$,V(2,#MaturityDate1))

#MaturityDateY=X,1,L
C(5,#ChackBormNoFg,Y,S,$)
C(4,#MaturityDate2,S,T(3,X))

#MaturityDate3=D,7,S
C(5,#ChackBormNoFg,Y,S,$)
C(4,#MaturityDate2,E(0,#MaturityDate1),E(0,#MaturityDate2))

!貸後契變手續費維護
#SETNTXCD2=X,5,S
C(4,#MaturityDate2,S,$)
T(3,L2670)
ASGN(NTXCD$)

#WkSysDate=D,7,S
E(0,#SYSDATE)

#NTXBUF2=X,50,S
C(4,#MaturityDate2,S,$)
T(2,1+#TimCustNo+#FacmNo+#WkSysDate+0001)
ASGN(NTXBUF$)


!計息方式
#IntCalcCode2=X,1,I
C(3,#HIDE3FG,0,CALL(#HIDEP3),$)
C(5,#OvduFlag,Y,S,$)
C(5,#ChackBormNoFg,Y,S,$)
HELP(#ProdIntCalcCodeHelp)
@C(4,#IntCalcCode2,S,$)
V(H,#ProdIntCalcCodeHelp)
V(4,#IntCalcCode1)

#IntCalcCode2X=X,8,L
C(5,#OvduFlag,Y,S,$)
C(5,#ChackBormNoFg,Y,S,$)
C(4,#IntCalcCode2,S,$)
T(H,#IntCalcCode2,#ProdIntCalcCodeHelp)

#IntCalcCodeY=X,1,L
C(5,#OvduFlag,Y,S,$)
C(5,#ChackBormNoFg,Y,S,$)
C(4,#IntCalcCode2,S,T(3,X))

![以日計息]
!催收戶不可變更,須隱藏欄位
!短期按日計息,中長期按月計息
!#IntCalcFlag2=X,1,I
!HELP(L3DEF,YesNoDef,YesNo,YesNoX)
!@C(4,#IntCalcFlag2,S,$)
!V(E,0,L3DEF,YesNoDef)
!V(4,#IntCalcFlag1)

!#IntCalcFlag2X=X,2,L
!T(A,#IntCalcFlag2,L3DEF,YesNoDef,YesNo,YesNoX)

!#IntCalcFlagY=X,1,L
!C(4,#IntCalcFlag2,S,T(3,X))

![攤還方式]
!催收戶不可變更,須隱藏欄位
!按月繳息限中、短期
#AmortizedCode2=X,2,I
C(3,#HIDE3FG,0,CALL(#HIDEP3),$)
C(5,#OvduFlag,Y,S,$)
C(5,#ChackBormNoFg,Y,S,$)
HELP(#AmortizedCodeHelp)
@C(4,#AmortizedCode2,S,$)
V(H,#AmortizedCodeHelp)
V(4,#AmortizedCode1)
C(5,#AcctCode3,330,V(2,1),$)
C(5,#AcctCode3,340,V(2,1),$)

#AmortizedCode2X=X,10,L
C(5,#ChackBormNoFg,Y,S,$)
T(3,)T(H,#AmortizedCode2,#AmortizedCodeHelp)            

#AmortizedCodeY=X,1,L
C(5,#ChackBormNoFg,Y,S,$)
C(4,#AmortizedCode2,S,T(3,X))

#AmortizedCode2N=A,2,S
C(5,#ChackBormNoFg,Y,S,$)
E(0,#AmortizedCode2)

#AmortizedCode3N=A,2,S
C(5,#ChackBormNoFg,Y,S,$)
C(3,#AmortizedCode2N,0,E(0,#AmortizedCode1),E(0,#AmortizedCode2N))

![繳息週期]
!催收戶不可變更,須隱藏欄位
!繳息週期不可為零
#PayIntFreq2=X,2,I
C(3,#HIDE3FG,0,CALL(#HIDEP3),$)
C(5,#ChackBormNoFg,Y,S,$)
C(5,#OvduFlag,Y,S,$)
!到期取息者是到期還本繳息，因此沒有繳息週期
C(5,#AmortizedCodeY,X,C(3,#AmortizedCode2N,2,S,$),$)
!週期基準為週者，繳息週期固定為雙週
!C(3,#L3r02FreqBase,3,T(3,02),$)
C(3,#L3r02FreqBase,3,S,$)  
@C(4,#PayIntFreq2,S,$)
V(4,#PayIntFreq1)

#PayIntFreq2X=A,2,S
C(5,#ChackBormNoFg,Y,S,$)
C(4,#PayIntFreq2,S,$)
E(0,#PayIntFreq2)
V(5,1,99)

#PayIntFreqY=X,1,L
C(5,#ChackBormNoFg,Y,S,$)
C(4,#PayIntFreq2,S,T(3,X))

#PayIntFreq3=X,2,S
C(5,#ChackBormNoFg,Y,S,$)
C(4,#PayIntFreq2,T(2,#PayIntFreq1),T(2,#PayIntFreq2))

#PayIntFreq2N=A,2,S
C(5,#ChackBormNoFg,Y,S,$)
E(0,#PayIntFreq2)

![還本週期]
!催收戶不可變更,須隱藏欄位
!還本週期如有變更,新推算出之下次還本日需>繳息迄日.
!攤還方式為本金或本息平均時，還本週期不可為零
!繳息週期不等於１時，還本週期須等於繳息週期
!攤還方式為本息平均法時，還本週期須等於繳息週期
#RepayFreq2=X,2,I
C(3,#HIDE3FG,0,CALL(#HIDEP3),$)
C(5,#OvduFlag,Y,S,$)
C(5,#ChackBormNoFg,Y,S,$)
!按月繳息者是到期還本，因此沒有還本週期
C(5,#AmortizedCodeY,X,C(3,#AmortizedCode2N,1,S,$),$)
!到期取息者是到期還本繳息，因此沒有還本週期     
C(5,#AmortizedCodeY,X,C(3,#AmortizedCode2N,2,S,$),$)           
!攤還方式為本息平均法時，還本週期須等於繳息週期 
IF(#AmortizedCodeY=="X" && #AmortizedCode2N==3 && #RepayFreq1N!=1,T(2,#PayIntFreq3),$) 
!C(5,#AmortizedCodeY,X,C(3,#AmortizedCode2N,3,s,$),$)            
!繳息週期不等於１時，還本週期須等於繳息週期
IF(#L3r02FreqBase==2 && #PayIntFreqY=="X" && #PayIntFreq2N > 1,T(2,#PayIntFreq3),$)
IF(#L3r02FreqBase==2 && #PayIntFreqY=="X" && #PayIntFreq2N > 1,s,$)
!繳息週期不等於１時，還本週期須等於繳息週期
IF(#L3r02FreqBase==3 && #PayIntFreqY=="X" && #PayIntFreq2N > 2,T(2,#PayIntFreq3),$)   
IF(#L3r02FreqBase==3 && #PayIntFreqY=="X" && #PayIntFreq2N > 2,s,$)
@C(4,#RepayFreq2,S,$)
V(4,#RepayFreq1)

#RepayFreqX=A,2,S
C(5,#ChackBormNoFg,Y,S,$)
C(4,#RepayFreq2,S,$)
E(0,#RepayFreq2)
V(5,1,99)

#RepayFreqY=X,1,L
C(5,#ChackBormNoFg,Y,S,$)
C(4,#RepayFreq2,S,T(3,X))

#PrevRepaidDate=D,7,S
C(5,#ChackBormNoFg,Y,S,$)
C(3,#L3r02PrevRepaidDate,0,E(0,#L3r02DrawdownDate),E(0,#L3r02PrevRepaidDate))

#wkRepayMm=A,3,S
C(5,#ChackBormNoFg,Y,S,$)
C(3,#L3r02FreqBase,2,E(0,#RepayFreq2),E(0,0))

#wkRepayDd=A,3,S
C(5,#ChackBormNoFg,Y,S,$)
C(3,#L3r02FreqBase,3,E(0,#RepayFreq2*7),E(0,0))

#WkNextRepayDate=D,8,S
C(5,#ChackBormNoFg,Y,S,$)
C(4,#RepayFreq2,S,$)
D(7,2,#PrevRepaidDate,#wkRepayMm,#wkRepayDd)

#NewNextRepayDate=D,7,S
C(5,#ChackBormNoFg,Y,S,$)
E(0,#WkNextRepayDate)

#RepayErrMsg=X,80,S
C(5,#ChackBormNoFg,Y,S,$)
T(2,還本週期有變更，新推算出之下次還本日[+#NewNextRepayDate+]需 > 繳息迄日[+#L3r02PrevPayIntDate+])
C(4,#RepayFreq2,S,$)
IF(#NewNextRepayDate > #L3r02PrevPayIntDate,S,$)
@
V(P,#RepayErrMsg)

![限制清償期限]
!催收戶不可變更,須隱藏欄位
! #ProhibitDate2=D,7,I
! C(5,#ChackBormNoFg,Y,S,$)
! C(5,#OvduFlag,Y,S,$)
! C(5,#ChackBormNoFg,Y,S,$)
! C(3,#HIDE3FG,0,CALL(#HIDEP3),$)
! D(8)
! @C(4,#ProhibitDate2,S,$)
! C(3,#ProhibitDate2,0,s,$)
! A(DATE,0,#ProhibitDate2)
! V(2,#ProhibitDate1)
! V(5,#MaturityDate3,9991231)

! #ProhibitDateY=X,1,L
! C(4,#ProhibitDate2,S,T(3,X))

![首次應繳日]
!未繳期款才可變更,其他需隱藏
!首次繳款日必須大於撥款日期
!首次繳款日不可大於到期日
!攤還方式為到期取息者，其首次應繳日應與為到期日
!到期取息者,沒有首次應繳日
#FirstDueDate2=D,7,I
C(5,#ChackBormNoFg,Y,S,$)
C(3,#HIDE3FG,0,CALL(#HIDEP3),$)
C(5,#FacmOnlyFlag,Y,S,$)
C(5,#PaidFlag,Y,S,$)
C(3,#AmortizedCode3N,2,S,$)
D(8)
@C(4,#FirstDueDate2,S,$)
C(3,#FirstDueDate2,0,s,$)
A(DATE,0,#FirstDueDate2)
V(2,#FirstDueDate1)
V(5,010101,#MaturityDate3)

#FirstDueDateY=X,1,L
C(5,#ChackBormNoFg,Y,S,$)
C(4,#FirstDueDate2,S,T(3,X))

#FirstDueDate3=D,7,S
C(5,#ChackBormNoFg,Y,S,$)
C(5,#FirstDueDateY,X,E(0,#FirstDueDate2),E(0,#FirstDueDate1))

#BUF31A=X,100,S
T(2,#RimTxCode+#TimCustNo+#FacmNo+#BormNo+#CurrencyCode)

#BIND31A=X,1,S
BIND(#BTN31,click, {cmd=CHAIN; ntxcd=L3923; ntxbuf=#BUF31A;ntxbuf5=type<-1})

![指定應繳日]
!未繳期款才可變更,其他需隱藏
#SpecificDd2=X,2,I
C(3,#HIDE3FG,0,CALL(#HIDEP3),$)
C(5,#FacmOnlyFlag,Y,S,$)
C(5,#PaidFlag,Y,S,$)
C(5,#ChackBormNoFg,Y,S,$)
@C(4,#SpecificDd2,S,$)
V(4,#SpecificDd1)

#SpecificDd2N=A,2,S
C(5,#ChackBormNoFg,Y,S,$)
C(4,#SpecificDd2,S,$)
E(0,#SpecificDd2)
V(2,#SpecificDd1)
V(5,1,31)
T(2,@SpecificDd2,#SpecificDd2N)

#SpecificDdY=X,1,L
C(5,#ChackBormNoFg,Y,S,$)
C(4,#SpecificDd2,S,T(3,X))

![寬限到期日]
!未繳期款才可變更,其他需隱藏
!攤還方式為本息或本金平均戶時，才可輸入寬限到期日
#GraceDate2=D,7,I
C(3,#HIDE3FG,0,CALL(#HIDEP3),$)
C(5,#PaidFlag,Y,S,$)
C(5,#ChackBormNoFg,Y,S,$)
C(3,#AmortizedCode3N,1,S,$)
C(3,#AmortizedCode3N,2,S,$)
D(8)
@C(4,#GraceDate2,S,$)
C(3,#GraceDate2,0,s,$)
C(3,#GraceDate2,9999999,s,$)
A(DATE,0,#GraceDate2)
V(2,#GraceDate1)
V(2,#MaturityDate3)
V(2,#FirstDueDate3)
V(5,#FirstDueDate3,#MaturityDate3)

#GraceDateY=X,1,L
C(4,#GraceDate2,S,T(3,X))

!貸後契變手續費維護
#SETNTXCD1=X,5,S
C(5,#ChackBormNoFg,Y,S,$)
C(4,#GraceDate2,S,$)
T(3,L2670)
ASGN(NTXCD$)

#NTXBUF1=X,50,S
C(4,#GraceDate2,S,$)
C(5,#ChackBormNoFg,Y,S,$)
T(2,1+#TimCustNo+#FacmNo+#WkSysDate+0001)
ASGN(NTXBUF$)

![帳管費]
!未繳期款才可變更,其他需隱藏
!帳管費已達帳,不可修改
#AcctFee2=X,17,I
C(3,#HIDE3FG,0,CALL(#HIDEP3),$)
C(5,#PaidFlag,Y,S,$)
C(5,#ChackBormNoFg,Y,S,$)

#TwAcctFee2N=n,17,S
C(3,#Precision,0,$,S)
C(5,#ChackBormNoFg,Y,S,$)
C(4,#AcctFee2,S,$)
E(0,#AcctFee2)
V(2,#AcctFee1)
V(5,0,99999999999999)

#UsAcctFee2N=n,17.2,S
C(3,#Precision,0,S,$)
C(5,#ChackBormNoFg,Y,S,$)
C(4,#AcctFee2,S,$)
E(0,#AcctFee2)
V(2,#AcctFee1)
V(5,0,99999999999999.99)

#AcctFee2X=X,17,S
C(4,#AcctFee2,S,$)
C(5,#ChackBormNoFg,Y,S,$)
C(3,#Precision,0,X(#TwAcctFee2N),X(#UsAcctFee2N))
P(R,#AcctFee2X)
T(2,@AcctFee2,#AcctFee2X)

#AcctFee2N=n,17.2,S
C(5,#ChackBormNoFg,Y,S,$)
C(3,#Precision,0,E(0,#TwAcctFee2N),E(0,#UsAcctFee2N))

#AcctFeeY=X,1,L
C(5,#ChackBormNoFg,Y,S,$)
C(4,#AcctFee2,S,T(3,X))

! !---- P4 扣款帳號
! #INVK4B=X,1,S
! ENABLE(#BTNHIDEP4)
! C(3,#HIDE4FG,0,CALL(#HIDEP4),$)

! ![繳款方式]
! !警告訊息(warning):變更繳款方式前應確認期款已繳至最近一期，若無，需通知客戶繳入。
! #RepayCode2=X,2,I
! C(3,#HIDE4FG,0,CALL(#HIDEP4),$)
! HELP(L3DEF,RepayCodeDef,RepayCode,RepayCodeX)
! @C(4,#RepayCode2,S,$)
! V(4,#RepayCode1)

! #RepayCode2A=A,2,S
! C(4,#RepayCode2,S,$)
! E(0,#RepayCode2)
! V(E,0,L3DEF,RepayCodeDef)
! V(2,#RepayCode1)
! T(2,@RepayCode2,#RepayCode2A)

! #RepayCode2X=X,16,L
! T(A,#RepayCode2A,L3DEF,RepayCodeDef,RepayCode,RepayCodeX) 

! #RepayCodeY=X,1,L
! C(4,#RepayCode2,S,T(3,X))

! #RepayCode3=A,2,S
! C(4,#RepayCode2,E(0,#RepayCode1),E(0,#RepayCode2A))

! #RepayAlert=X,80,S
! T(3,警告訊息:變更繳款方式前應確認期款已繳至最近一期，若無，需通知客戶繳入。)
! C(5,#RepayCodeY,X,$,S)


! #BUF41A=X,7,S

! #BIND41A=X,1,S
! BIND(#BTN41,click, {cmd=CHAIN; ntxcd=L6071; ntxbuf=#BUF41A;ntxbuf5=type<-1:RepayBank2<-OOBankCodeA})

! ![扣款銀行代號]
! !依核准額度自動顯示,不可修改
! #RepayBank2=X,3,I
! HIDE(#BTN41)
! C(3,#RepayCode3,2,$,S)
! C(3,#HIDE4FG,0,CALL(#HIDEP4),$)
! SHOW(#BTN41)
! @C(3,#RepayCode2A,2,V(7),$)

! #RepayBank2A=A,3,S
! C(4,#RepayBank2,S,4)
! E(0,#RepayBank2)
! T(2,@RepayBank2,#RepayBank2A)
! V(4,#RepayBank1)
! V(2,#RepayBank1)
! V(2,0)

! #SendL2r09B=X,1,S
! C(3,#RepayCode2,2,$,S)
! T(2,@RimBankCode,#RepayBank2)
! RESET_RIM(#SendL2r09B,L2R09)
! S(L2R09,1,#RimTxCode,#RimBankCode)
! R(1,L2R09)

! #RepayBank2X=X,20,L
! C(3,#RepayCode2,2,$,S)
! T(2,#L2r09BankItem)

! #RepayBankY=X,1,L
! T(3, )
! C(4,#RepayBank2,$,T(3,X))
! IF(#RepayCode2A > 0 && #RepayBank2=="" && #RepayBank2!=#RepayBank1,T(3,X),$)

! #RepayBank3=A,4,S
! C(4,#RepayBank2,E(0,#RepayBank1),E(0,#RepayBank2A))


! ![扣款帳號]
! #RepayAcctNo2=X,14,I
! C(3,#RepayCode3,2,$,S)
! C(3,#HIDE4FG,0,CALL(#HIDEP4),$)
! @C(3,#RepayCode2A,2,V(7),$)

! #RepayAcctNo2A=A,14,S
! C(4,#RepayAcctNo2,S,4)
! E(0,#RepayAcctNo2)
! T(2,@RepayAcctNo2,#RepayAcctNo2A)
! V(4,#RepayAcctNo1)
! V(2,0)

! #RepayAcctNoY=X,1,L
! T(3, )
! C(4,#RepayAcctNo2,$,T(3,X))
! IF(#RepayCode2A > 0 && #RepayAcctNo2=="" && #RepayAcctNo2!=#RepayAcctNo1,T(3,X),$)

! ![郵局存款別]
! #PostCode2=X,1,I
! C(3,#RepayCode3,2,$,S)
! C(3,#RepayBank3,700,$,S)
! C(3,#HIDE4FG,0,CALL(#HIDEP4),$)
! HELP(L3DEF,PostCodeDef,PostCode,PostCodeX)
! @C(3,#RepayBank2A,700,V(7),$)
! C(4,#PostCode2,S,$)
! V(E,0,L3DEF,PostCodeDef)
! V(4,#PostCode1)

! #PostCode2X=X,4,L
! C(3,#RepayBank2,700,$,S)
! T(A,#PostCode2,L3DEF,PostCodeDef,PostCode,PostCodeX) 

! #PostCodeY=X,1,L
! T(3, )
! C(4,#PostCode2,$,T(3,X))
! IF(#RepayCode2A > 0 && #PostCode2=="" && #PostCode2!=#PostCode1,T(3,X),$)

! !---- P5 與借款人關係
! #INVK5B=X,1,S
! ENABLE(#BTNHIDEP5)
! C(3,#HIDE5FG,0,CALL(#HIDEP5),$)

! ![與借款人關係] 
! #RelationCode2=X,2,I
! C(3,#HIDE5FG,0,CALL(#HIDEP5),$)
! HELP(#RelationCodeHelp)
! ! HELP(L3DEF,RelationCodeDef,RelationCode,RelationCodeX)
! @C(4,#RelationCode2,S,$)
! V(H,#RelationCodeHelp)
! V(4,#RelationCode1)
! ! V(E,0,L3DEF,RelationCodeDef)

! #RelationCode2X=X,4,L
! T(H,#RelationCode2,#RelationCodeHelp)     
! ! T(A,#RelationCode2,L3DEF,RelationCodeDef,RelationCode,RelationCodeX)            

! #RelationCodeY=X,1,L
! C(4,#RelationCode2,S,T(3,X))

! ![帳戶戶名]
! #RelationName2=X,100,I
! C(4,#RelationCode2,S,$)
! C(3,#HIDE5FG,0,CALL(#HIDEP5),$)
! @V(7)

! #RelationNameY=X,1,L
! C(4,#RelationName2,S,T(3,X))

! ![身份證字號]
! #RelationId2=X,10,I
! C(4,#RelationCode2,S,$)
! C(3,#HIDE5FG,0,CALL(#HIDEP5),$)
! @V(7)
! A(ID,0,#RelationId2)
! V(4,#RelationId1)

! #WKID=N,1,O
! T(4,STAT$)

! #RelationIdY=X,1,L
! C(4,#RelationId2,S,T(3,X))

! ![錯誤註記]
! !#RELACCTERR2=X,1,S
! !C(4,#RelationCode2,S,$)
! !C(3,#HIDE5FG,0,CALL(#HIDEP5),$)
! !C(3,#WKID,1,$,S)
! !HELP(L3DEF,ACCTERRDEF,ACCTERR,ACCTERRX)
! !@V(7)V(E,0,L3DEF,ACCTERRDEF)

! !#RELACCTERR2X=X,10,S
! !C(4,#RelationCode2,S,$)
! !C(3,#HIDE5FG,0,CALL(#HIDEP5),$)
! !C(3,#WKID,1,$,S)
! !T(A,#RELACCTERR2,L3DEF,ACCTERRDEF,ACCTERR,ACCTERRX) 

! !#RELACCTERRY=X,1,S
! !C(4,#RELACCTERR2,S,T(3,X))

! ![出生日期]
! #RelationBirthday2=D,7,I
! C(4,#RelationCode2,S,$)
! C(3,#HIDE5FG,0,CALL(#HIDEP5),$)
! D(8)
! @V(2,#RelationBirthday1)
! A(DATE,0,#RelationBirthday2)
! V(4,#RelationBirthday1)

! #RelationBirthdayY=X,1,L
! C(4,#RelationBirthday2,S,T(3,X))

! ![性別]
! #RelationGender2=X,1,I
! C(4,#RelationCode2,S,$)
! C(3,#HIDE5FG,0,CALL(#HIDEP5),$)
! HELP(L3DEF,GenderCodeDef,GenderCode,GenderCodeX)
! @V(E,0,L3DEF,GenderCodeDef)
! V(4,RelationGender1)

! #RelationGender2X=X,2,L
! T(A,#RelationGender2,L3DEF,GenderCodeDef,GenderCode,GenderCodeX)

! #RelationGenderY=X,1,L
! C(4,#RelationGender2,S,T(3,X))

!--- P6 其他
#INVK6B=X,1,S
! C(5,#OvduFlag,Y,$,DISABLE(#BTNHIDEP6))
! C(5,#OvduFlag,Y,$,S)
ENABLE(#BTNHIDEP6)
C(3,#HIDE6FG,0,CALL(#HIDEP6),$)

![計件代碼]
#PieceCode2=X,1,I
C(3,#HIDE6FG,0,CALL(#HIDEP6),$)
HELP(#PieceCodeHelp,cols:2)
@C(4,#PieceCode2,S,V(H,#PieceCodeHelp))
V(4,#PieceCode1)

#PieceCode2X=X,20,L
T(3,)T(H,#PieceCode2,#PieceCodeHelp)     

#PieceCodeY=X,1,L
C(4,#PieceCode2,S,T(3,X))


!計件代碼2金額
#PieceCodeSecondAmt2=X,17,S
C(3,#HIDE6FG,0,CALL(#HIDEP6),$)
! C(4,#PieceCodeSecond2,C(4,#PieceCodeSecond1,S,$),$)
V(4,#PieceCodeSecondAmt1)

#TwPieceCodeSecondAmt2=m,14,S
! C(4,#PieceCodeSecond2,C(4,#PieceCodeSecond1,S,$),$)
C(3,#Precision,0,$,S)
C(4,#PieceCodeSecondAmt2,S,$)
E(0,#PieceCodeSecondAmt2)
V(2,#PieceCodeSecondAmt1)
V(5,0,99999999999999)
IF(#TwPieceCodeSecondAmt2<=#L3r02DrawdownAmt,$,V(P,計件代碼2金額不可大於撥款金額))


#UsPieceCodeSecondAmt2=m,14.2,S
! C(4,#PieceCodeSecond2,C(4,#PieceCodeSecond1,S,$),$)
C(3,#Precision,0,S,$)
C(4,#PieceCodeSecondAmt2,S,$)
E(0,#PieceCodeSecondAmt2)
V(2,#PieceCodeSecondAmt1)
V(5,0,99999999999999)
IF(#TwPieceCodeSecondAmt2<=#L3r02DrawdownAmt,$,V(P,計件代碼2金額不可大於撥款金額))

#PieceCodeSecondAmt2X=X,17,S
C(4,#PieceCodeSecondAmt2,S,$)
C(3,#Precision,0,X(#TwPieceCodeSecondAmt2),X(#UsPieceCodeSecondAmt2))
P(R,#PieceCodeSecondAmt2X)
T(2,@PieceCodeSecondAmt2,#PieceCodeSecondAmt2X)

#TimPieceCodeSecondAmt2=m,14.2,S
C(3,#Precision,0,E(0,#TwPieceCodeSecondAmt2),E(0,#UsPieceCodeSecondAmt2))

#PieceCodeSecondAmtY=X,1,L
C(4,#PieceCodeSecondAmt2,S,T(3,X))
! C(3,#TimPieceCodeSecondAmt2,#PieceCodeSecondAmt1,S,T(3,X)) 


!計件代碼2
#PieceCodeSecond2=X,1,S
C(3,#HIDE6FG,0,CALL(#HIDEP6),$)
HELP(#PieceCodeHelp,cols:2)
C(4,#PieceCodeSecondAmt2,C(3,#PieceCodeSecondAmt1,0,S,$),C(3,#TimPieceCodeSecondAmt2,0,S,$))
@
C(5,#PieceCodeSecondAmtY,X,C(5,#PieceCodeSecondAmt2,0,$,C(4,#PieceCodeSecond1,V(H,#PieceCodeHelp),C(4,#PieceCodeSecond2,S,V(H,#PieceCodeHelp)))),C(4,#PieceCodeSecond2,S,V(H,#PieceCodeHelp)))
V(4,#PieceCodeSecond1)

#PieceCodeSecond2X=X,20,L
T(3,)T(H,#PieceCodeSecond2,#PieceCodeHelp)

#PieceCodeSecondY=X,1,L
C(5,#PieceCodeSecondAmtY,X,C(5,#PieceCodeSecondAmt2,0,T(3,X),C(4,#PieceCodeSecond2,S,T(3,X))),C(4,#PieceCodeSecond2,S,T(3,X)))


![備註]
!催收戶才可變更,其他須隱藏欄位
#Remark2=X,60,I
C(5,#FacmOnlyFlag,Y,S,$)
C(5,#OvduFlag,Y,$,S)
C(3,#HIDE6FG,0,CALL(#HIDEP6),$)
@C(4,#Remark1,$,V(4,#Remark1))

#RemarkY=X,1,L
C(5,#OvduFlag,Y,$,S)
C(4,#Remark2,S,T(3,X))


![處理日期]
!催收戶才可變更,其他須隱藏欄位
#ProcessDate2=D,7,I
C(5,#FacmOnlyFlag,Y,S,$)
C(5,#OvduFlag,Y,$,S)
C(5,#ChackBormNoFg,Y,S,$)
C(3,#ProcessDate2,0,E(0,#SYSDATE),$)
@V(2,#FirstDueDate1)
A(DATE,0,#ProcessDate2)

#ProcessDateY=X,1,L
C(5,#OvduFlag,Y,$,S)
C(4,#ProcessDate2,S,T(3,X))


#CHECKCHANGE=A,1,S
E(0,0)
C(5,#AcctCodeY,X,E(0,1),$)
C(5,#MaturityDateY,X,E(0,1),$)
C(5,#RateCodeY,X,E(0,1),$)
C(5,#RateIncrY,X,E(0,1),$)
C(5,#IndividualIncrY,X,E(0,1),$)
C(5,#RateAdjFreqY,X,E(0,1),$)
C(5,#IntCalcCodeY,X,E(0,1),$)
C(5,#NextRateAdjDateY,X,E(0,1),$)
C(5,#FirstRateAdjDateY,X,E(0,1),$)
C(5,#AmortizedCodeY,X,E(0,1),$)
C(5,#PayIntFreqY,X,E(0,1),$)
C(5,#RepayFreqY,X,E(0,1),$)
! C(5,#RepayCodeY,X,E(0,1),$)
! C(5,#RepayBankY,X,E(0,1),$)
! C(5,#RepayAcctNoY,X,E(0,1),$)
! C(5,#PostCodeY,X,E(0,1),$)
! C(5,#ProhibitDateY,X,E(0,1),$)
C(5,#GraceDateY,X,E(0,1),$)
C(5,#FirstDueDateY,X,E(0,1),$)
C(5,#SpecificDdY,X,E(0,1),$)
C(5,#AcctFeeY,X,E(0,1),$)
! C(5,#RelationCodeY,X,E(0,1),$)
! C(5,#RelationNameY,X,E(0,1),$)
! C(5,#RelationIdY,X,E(0,1),$)
! !C(5,#RELACCTERRY,X,E(0,1),$)
! C(5,#RelationBirthdayY,X,E(0,1),$)
C(5,#RemarkY,X,E(0,1),$)
C(5,#PieceCodeY,X,E(0,1),$)
C(5,#PieceCodeSecondY,X,E(0,1),$)
C(5,#PieceCodeSecondAmtY,X,E(0,1),$)
! C(5,#RelationGenderY,X,E(0,1),$)
C(5,#ProcessDateY,X,E(0,1),$)


#MSGERR=X,1,S
@C(3,#CHECKCHANGE,1,S,$)
V(P,內容變更，必須至少變更一個項目)

![變更理由]
#Reason=X,2,I
HELP(#ReasonHelp,cols:2)
@C(4,#Reason,S,V(H,#ReasonHelp))
IF(#Reason==99,$,s)
T(F,@Remark,1)

#ReasonX=X,100,L
T(3,)T(H,#Reason,#ReasonHelp)
IF(#Reason==99,T(3,@Remark,)SHOW(#Remark),T(2,@Remark,#ReasonX)HIDE(#Remark))


#Remark=x,100,I
IF(#Reason==99,$,s)
@V(7)


!---- EXPAND 展開

#INVKEXPAND=X,1,S
ENABLE(#BTNEXPAND)
E(0,@EXPANDFG,0)
C(3,#EXPANDFG,0,CALL(#EXPAND),$)

#BINDEXPAND=X,1,S
BIND(#BTNEXPAND,click, {cmd=CALLSEND;DOCODE=EXPAND})

#BTNEXPAND=X,15,I,ui:button;value:   展開     ;enable:1;tabbable:1



#MRKEY=_,_,S
T(2,#TimCustNo+-+#FacmNo+-+#BormNo)

<include src="ROM.icf::L0Rim.dec"/>
<include src="ROM.icf::L2Rim.dec"/>
<include src="ROM.icf::L2R01.dec"/>
<include src="ROM.icf::L2R05.dec"/>
<include src="ROM.icf::L2R07.dec"/>
<include src="ROM.icf::L2R09.dec"/>
<include src="ROM.icf::L3R02.dec"/>
<include src="ROM.icf::L6R28.dec"/>

</sub>
!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
<include src="PRT.icf::FM101.rtn"/>
</sub>


!---------- TXFORM = L3701 ----------
<sub type="FORM" name="L3701">

#SCRPRT=_,_,S
C(5,#TXFORM,L3701,$,S)

#SCRTIL=_,_,S
T(3,[L3701] 放款內容變更)

</sub>
!---------- TXFORM = FM101 交易分錄----------
<sub type="FORM" name="FM101">
<include src="PRT.icf::FM101.form"/>
</sub>
!------ 上行電文 TEXT ------
<sub type="TIM">

#TimCustNo#FacmNo#BormNo#FacmOnlyFlag
#RateCodeY#RateCode1#RateCode2
#RateIncrY#RateIncr1#RateIncr2#RateIncr2N
#IndividualIncrY#IndividualIncr1#IndividualIncr2#IndividualIncr2N
#RateAdjFreqY#RateAdjFreq1#RateAdjFreq2
#FirstRateAdjDateY#FirstRateAdjDate1#FirstRateAdjDate2
#NextRateAdjDateY#NextRateAdjDate1#NextRateAdjDate2
#AcctCodeY#AcctCode1#AcctCode2
#MaturityDateY#MaturityDate1#MaturityDate2
#IntCalcCodeY#IntCalcCode1#IntCalcCode2
#AmortizedCodeY#AmortizedCode1#AmortizedCode2
#PayIntFreqY#PayIntFreq1#PayIntFreq2
#RepayFreqY#RepayFreq1#RepayFreq2
#GraceDateY#GraceDate1#GraceDate2
#FirstDueDateY#FirstDueDate1#FirstDueDate2
#SpecificDdY#SpecificDd1#SpecificDd2
#AcctFeeY#AcctFee1#AcctFee2#AcctFee2N
#PieceCode1#PieceCode2#PieceCodeY
#PieceCodeSecond1#PieceCodeSecond2#PieceCodeSecondY
#PieceCodeSecondAmt1#TimPieceCodeSecondAmt2#PieceCodeSecondAmtY
#RemarkY#Remark1#Remark2
#ProcessDateY#ProcessDate1#ProcessDate2
#CustNo#CustId#ApplNo
#BormStatus#PaidFlag#OvduFlag#CurrencyCode
#L2r01IncrFlag
#L3r02MaturityDate#L3r02DrawdownDate#L3r02PrevPayIntDate
#L3r02FreqBase#L3r02PrevRepaidDate
#Reason#Remark
#PieceCodeSecondAmt2
</sub>


!------ 下行電文TOM ------
<sub type="TOM">
TXFORM=L3701^

<include src="COM.icf::TRCTL.tom"/>
<include src="COM.icf::LockControl.tom"/>
<include src="PRT.icf::FM101.tom"/>
<include src="ROM.icf::L2R01.tom"/>
<include src="ROM.icf::L2R05.tom"/>
<include src="ROM.icf::L2R07.tom"/>
<include src="ROM.icf::L2R09.tom"/>
<include src="ROM.icf::L3R02.tom"/>
<include src="ROM.icf::L6R28.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>


!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
<include src="PRT.icf::UPDH01.sel"/>
<include src="PRT.icf::FM01.sel"/>
<include src="PRT.icf::FMR01.sel"/>
<include src="PRT.icf::FMH01.sel"/>
<include src="PRT.icf::FMHR01.sel"/>
<include src="PRT.icf::FM101.sel" map="landscape=1;size=830:1170" />
</sub>
