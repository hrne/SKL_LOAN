----- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

#TXCD
T(3,L6502)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD2.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=1;screen.width=[220,780];printer.width=[20,20];">
[
["[L6502]                                 會計變動數值設定"],
["#FdFuncCode+功能",#FuncCodeX],
["#FdYearMonth+年月份",#YearMonth],
["#FdAvailableFunds+可運用資金",#AvailableFunds],
["#FdLoanTotalLmt+總借款限額",#LoanTotalLmt],
["#FdNoGurTotalLmt+無擔保限額（保留欄位）",#NoGurTotalLmt],
["#FdTotalequity+股東權益（淨值）",#Totalequity],
]
!---------- AP Button AREA ----------
![Buttom資料查詢]
!#BUF1=X,42,S

! 必輸欄位

! 永遠為必輸欄位
#FdFuncCode=X,2,L
#FdYearMonth=X,2,L
#FdAvailableFunds=X,2,L
#FdLoanTotalLmt=X,2,L
#FdNoGurTotalLmt=X,2,L
#FdTotalequity=X,2,L

!---------- AP TEXT AREA Variables ----------
<include src="HELPRIM.icf::HELPRIM.rtn"/>

!FuncCode2
#CDCODEFuncCode2=x,20,S                  
T(3,CdCode.FuncCode2)                  
#FuncCode2Help=x,100,S      

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDCODEFuncCode2)
R(1,XXR99)
CALL(#HelpProc)
T(2,@FuncCode2Help,#HelpDesc1)

#CHAIN=A,1,S
T(4,CHAIN$)
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:L6052進入),$)

#NTXBUF=X,62,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)

#CHAIN_FuncCode=X,1,S
T(1,#NTXBUF,1,1)

#CHAIN_YearMonth=A,5,S
T(1,#NTXBUF,2,5)

#CHAIN_AvailableFunds=m,14,S
T(1,#NTXBUF,7,14)

#CHAIN_LoanTotalLmt=m,14,S
T(1,#NTXBUF,21,14)

#CHAIN_NoGurTotalLmt=m,14,S
T(1,#NTXBUF,35,14)

#CHAIN_Totalequity=m,14,S
T(1,#NTXBUF,49,14)

#CHAINSET=X,1,S
C(3,#CHAIN,1,$,S)
T(2,@FuncCode,#CHAIN_FuncCode)
C(3,#FuncCode,1,S,$)
E(0,@YearMonth,#CHAIN_YearMonth)
E(0,@AvailableFunds,#CHAIN_AvailableFunds)
E(0,@LoanTotalLmt,#CHAIN_LoanTotalLmt)
E(0,@NoGurTotalLmt,#CHAIN_NoGurTotalLmt)
E(0,@Totalequity,#CHAIN_Totalequity)

! 功能 必須輸入(1:新增;2:修改;4:刪除)
#FuncCode=A,1,S
T(F,@FuncCode,0)
C(3,#CHAIN,1,s,$)
HELP(#FuncCode2Help)
@V(H,#FuncCode2Help)

#FuncCodeX=X,12,L
T(H,#FuncCode,#FuncCode2Help)
C(2,#FuncCode,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),$,K(MODIFYBUTTON,刪除))

!刪除隱藏重新交易按鈕
#AGAIN=X,1,S
IF(#FuncCode==2 || #FuncCode==4,$,S)
E(0,1)ASGN(AGAIN$)

#FUNCIND=_,_,S
E(0,#FuncCode)
<include src="COM.icf::CheckAuth.rtn"/>

!FuncCode=1,2 顯示框線  0:disable
#WKTF=X,1,S
T(F,@LoanTotalLmt,0)
T(F,@NoGurTotalLmt,0)

IF (#FuncCode==2 || #FuncCode==4,T(F,@YearMonth,0),T(F,@YearMonth,1))
IF (#FuncCode==1 || #FuncCode==2 ,T(F,@AvailableFunds,1)T(F,@Totalequity,1),
                                  T(F,@AvailableFunds,0)T(F,@Totalequity,0))

IF (#FuncCode==1 ,T(F,@Year,1)T(F,@Month,1),T(F,@Year,0)T(F,@Month,0))

#WKPSC=X,2,S

#WKSTAR1=X,2,S
C(2,#FuncCode,S,T(3,*),S,S,S,S)

#WKSTAR2=X,2,S
C(2,#FuncCode,S,T(3,*),T(3,*),S,S,S)

#WKNAME=X,1,S
T(2,@FdYearMonth,#WKSTAR1)
T(2,@FdAvailableFunds,#WKSTAR2)
T(2,@FdLoanTotalLmt,#WKPSC)
T(2,@FdNoGurTotalLmt,#WKPSC)
T(2,@FdTotalequity,#WKSTAR2)

! 年月份
!#Year=A,3,S
!C(3,#CHAIN,1,C(3,#FuncCode,1,$,s),$)
!@V(2,0)

!#Month=A,2,S
!C(3,#CHAIN,1,C(3,#FuncCode,1,$,s),$)
!@V(5,1,12)

#YearMonth=A,5,I
C(3,#CHAIN,1,C(3,#FuncCode,1,$,s),$)
@A(YM,1,#YearMonth)

!可運用資金
#AvailableFunds=m,14,I
C(3,#FuncCode,4,s)
@V(2,0)

!總借款限額
#LoanTotalLmt=m,14,S
C(3,#FuncCode,4,s)
E(3,#AvailableFunds*0.35)

!無擔保限額  -> 暫時未使用但保留預設0
#NoGurTotalLmt=m,14,S
C(3,#FuncCode,4,s)
E(0,0)

!股東權益(淨值)
#Totalequity=m,14,I
C(3,#FuncCode,4,s)
@V(2,0)

#RPTFG=A,1,S
E(0,0)

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!---------- TXFORM = L6502 ----------
<sub type="FORM" name="L6502">

#SCRPRT=_,_,S
C(5,#TXFORM,L6502,$,S)

#SCRTIL=_,_,S
T(3,[L6502] 會計變動數值設定)

</sub>

!------ 上行電文 ------
<sub type="TIM">
#FuncCode#YearMonth#AvailableFunds#LoanTotalLmt#NoGurTotalLmt#Totalequity
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">

TXFORM=L6502

^
<include src="COM.icf::TRCTL.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
</sub>
