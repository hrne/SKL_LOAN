!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L5401)
</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,0)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,40)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,40)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L5401" layout="cols=3;screen.width=[200,300,200,300];printer.width=[20,80];order=1">
[
["[L5401]                                 房貸專員資料維護"],
["#FdFunctionCode+功能",#FunctionCodeX],
[#<->#,"#FdWorkMonth+年月份",#WorkMonth],
["#FdEmpNo+員工代號",#EmpNo],["#FdEmpNoName+員工姓名",#EmpNoName],
[#<->#,"#FdStationName+駐在地",#StationName],
["#FdAreaCode+區域中心",#AreaCode],["#FdAreaItem+區域名稱",#AreaItem],
["#FdDeptCode+部室代號",#DeptCode],["#FdDepItem+部室名稱",#DepItem],
["#FdDistCode+區部代號",#DistCode],["#FdDistItem+區部名稱",#DistItem],
[#<->#,"#FdGoalAmt+目標金額",#GoalAmt],
[#<->#,"#FdSmryGoalAmt+累計目標金額",#SmryGoalAmt],
]

#CHAIN=A,1,S
T(4,CHAIN$) 
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:L5021進入),$)
C(3,#CHAIN,1,E(0,@FunctionCode,1),s)

! 必須輸入提示
#FdFunctionCode=X,1,L
T(2, )
#FdWorkMonth=X,1,L
T(2,*)
#FdEmpNo=X,1,L
T(2,*)
#FdEmpNoName=X,1,L
T(2,)
#FdStationName=X,1,L
T(2, )
#FdAreaCode=X,1,L
T(2,*)
#FdAreaItem=X,1,L
T(2, )
#FdDeptCode=X,1,L
T(2,*)
#FdDepItem=X,1,L
T(2, )
#FdDistCode=X,1,L
T(2,*)
#FdDistItem=X,1,L
T(2, )
#FdGoalAmt=X,1,L
T(2, )
#FdSmryGoalAmt=X,1,L
T(2, )
 
#NTXBUF=X,65,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@FunctionCode,#NTXBUF,1,1)
T(1,@WorkMonth,#NTXBUF,2,5)
T(1,@EmpNo,#NTXBUF,7,6)

C(2,#FunctionCode,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),K(MODIFYBUTTON,新增),K(MODIFYBUTTON,刪除),K(MODIFYBUTTON,顯示詳細資料))

! 選項下拉選單
<include src="HELPRIM.icf::HELPRIM.rtn"/>
#FuncCodeRimName=x,20,S
T(3,CdCode.FunctionCd)

#AreaCenterCodeRimName=x,25,S
T(3,CdCode.AreaCenterCode)

#FuncCodeHelpRim=X,1,S
RESET_RIM(#FuncCodeHelpRim,XXR99)
S(XXR99,01,#FuncCodeRimName,#AreaCenterCodeRimName)
R(1,XXR99)
CALL(#HelpProc)
T(2,@FuncCodeHelp,#HelpDesc1)
T(2,@AreaCenterCodeHelp,#HelpDesc2)
#FuncCodeHelp=x,1024,S
#AreaCenterCodeHelp=x,1024,S
! 房貸專員主檔rim
<include src="ROM.icf::L5R10.dec"/>     
#RimEmpNo=X,6,S
#RimWorkMonth=X,5,S
#RimL5R10=X,1,S
T(2,@RimEmpNo,#EmpNo)
T(2,@RimWorkMonth,#WorkMonth)
C(3,#FunctionCode,1,S,$)
RESET_RIM(#RimL5R10,L5R10)
C(3,#CHAIN,1,$,S)
S(L5R10,1,#RimEmpNo,#RimWorkMonth)
R(1,L5R10)
T(2,@EmpNoName,#L5R10FullName)
T(2,@AreaCode,#L5R10AreaCode)
T(2,@AreaItem,#L5R10AreaItem)
T(2,@DeptCode,#L5R10DeptCode)
T(2,@DepItem,#L5R10DepItem)
T(2,@DistCode,#L5R10DistCode)
T(2,@DistItem,#L5R10DistItem)
T(2,@GoalAmt,#L5R10GoalAmt)
T(2,@SmryGoalAmt,#L5R10SmryGoalAmt)
T(2,@StationName,#L5R10StationName)

!控制有無框限 FunCd=1,2顯示框限 其他不顯示
#WKTF=X,1,S              
IF(#FunctionCode==2,T(F,@WorkMonth,0)T(F,@EmpNo,0),$)                 
! IF(#FunctionCode==3,T(F,@AreaCode,0)T(F,@DeptCode,0)T(F,@DistCode,0)T(F,@GoalAmt,0)T(F,@SmryGoalAmt,0)T(F,@DistItem,0)T(F,@StationName,0),$)
IF(#FunctionCode==4,T(F,@WorkMonth,0)T(F,@EmpNo,0)T(F,@AreaCode,0)T(F,@DeptCode,0)T(F,@DistCode,0)T(F,@GoalAmt,0)T(F,@SmryGoalAmt,0)T(F,@DistItem,0)T(F,@StationName,0),$)
IF(#FunctionCode==5,T(F,@WorkMonth,0)T(F,@EmpNo,0)T(F,@AreaCode,0)T(F,@DeptCode,0)T(F,@DistCode,0)T(F,@GoalAmt,0)T(F,@SmryGoalAmt,0)T(F,@DistItem,0)T(F,@StationName,0),$)


! IF(#FunctionCode==5,K(NOBUTTON,CLOSEY),$)

IF(#FunctionCode==2 ,T(2,@FdEmpNo, )T(2,@FdWorkMonth, ),$)
! IF(#FunctionCode==3 ,T(2,@FdAreaCode, )T(2,@FdDeptCode, )T(2,@FdDistCode, ),$)
IF(#FunctionCode==4 || #FunctionCode==5,T(2,@FdFunctionCode, )T(2,@FdWorkMonth, )T(2,@FdEmpNo, )T(2,@FdAreaCode, )T(2,@FdDeptCode, )T(2,@FdDistCode, ),$)
#RimChoose=X,1,S
! 功能
#FunctionCode=A,1,S
E(0,@FUNCIND,#FunctionCode)

#FunctionCodeX=X,4,L
T(H,#FunctionCode,#FuncCodeHelp)

!刪除隱藏重新交易按鈕
#AGAIN=X,1,S
C(3,#FunctionCode,1,S,$)
E(0,1)ASGN(AGAIN$)

! 年月份
#WorkMonth=A,5,I
C(2,#FunctionCode,S,$,s,$,s,s)
@A(YM13,1,#WorkMonth)

! 員工代號
#EmpNo=X,6,I
C(2,#FunctionCode,S,$,s,$,s,s)
@V(7)

! CdEmp Rim
<include src="ROM.icf::L5R06.dec"/>     
#RimL5R06=X,1,S
#CdEmpRimEmpNo=X,6,S
T(2,#EmpNo)

RESET_RIM(#RimL5R06,L5R06)
S(L5R06,1,#CdEmpRimEmpNo)
R(1,L5R06)
T(2,@EmpNoName,#L5R06FullName)

#EmpNoName=X,20,L

! 駐在地
#StationName=X,20,I
C(2,#FunctionCode,S,$,$,$,s,s)

! 區域中心
#AreaCode=X,6,I
HELP(#AreaCenterCodeHelp)
C(2,#FunctionCode,S,$,$,$,s,s)
@V(H,#AreaCenterCodeHelp)

#AreaItem=x,40,L
T(H,#AreaCode,#AreaCenterCodeHelp)
! 部室代號
#DeptCode=X,6,I
C(2,#FunctionCode,S,$,$,$,s,s)
@V(7)
<include src="ROM.icf::L5R13.dec"/>   
#RimDeptCode=X,6,S
T(2,@RimDeptCode,#DeptCode)
T(2,@RimChoose,2)
RESET_RIM(#RimL5R13,L5R13)
S(L5R13,1,#RimDeptCode,#RimChoose)
R(1,L5R13)
T(2,@DepItem,#L5R13DeptItem)

#DepItem=x,40,L

! 區部代號
#DistCode=X,6,I
C(2,#FunctionCode,S,$,$,$,s,s)
! <include src="ROM.icf::L5R13.dec"/>   
#RimDistCode=X,6,S
T(2,@RimDistCode,#DistCode)
T(2,@RimChoose,3)
! IF(#DistCode=="",s,$)
T(F,@DistItem,0)
C(4,#DistCode,S,$)
RESET_RIM(#RimL5R13,L5R13)
S(L5R13,1,#RimDistCode,#RimChoose)
R(1,L5R13)
T(2,@DistItem,#L5R13DistItem)

#DistItem=x,20,I
C(2,#FunctionCode,S,$,$,$,s,s)
C(4,#DistCode,T(F,@DistItem,1),T(F,@DistItem,0))
C(4,#DistCode,$,s)
@C(4,#DistCode,C(4,#DistItem,V(P,區部代號、區部名稱需擇一輸入),$),$)


! 目標金額
! #PRE_GoalAmt=m,16,S
#GoalAmt=M,14,I
C(2,#FunctionCode,S,$,$,$,s,s)

! 累計目標金額
! #PRE_SmryGoalAmt=m,16,S
#SmryGoalAmt=M,14,I
C(2,#FunctionCode,S,$,$,$,s,s)

#RPTFG=X,1,S
C(3,#FunctionCode,5,E(0,0),E(0,1))

#checkTF=X,1,S
! C(3,#FunctionCode,5,XMT(),$)

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L5401 -----------
<sub type="FORM" name="L5401">

#LOOP=X,1,S
E(0,1)ASGN(LOOP$)
! 戶名
#OOCustName=X,200,O
! 戶號額度撥款
#OOCombine=X,20,O
#OOCustNo=A,7,O
#OOFacmNo=A,3,O
#OOBormNo=A,3,O
T(2,@OOCombine,#OOCustNo+-+#OOFacmNo+-+#OOBormNo)
! 撥款日期
#OODrawdownDate=D,7,O
! 撥款金額
#OODrawdownAmt=M,14,O
! 業績金額
#OOPerfAmt=m,14,O
! 業績件數
#OOPerfCnt=m,2.1,O
! 房貸/車貸
#OOProdCode=X,5,O
! 計件代碼
#OOPieceCode=X,1,O
</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#FunctionCode
#WorkMonth
#EmpNo
#EmpNoName
#StationName
#AreaCode
#AreaItem
#DeptCode
#DistCode
#DepItem
#DistItem
#GoalAmt
#SmryGoalAmt
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L5R06.tom"/>
<include src="ROM.icf::L5R10.tom"/>
<include src="ROM.icf::L5R13.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
TXFORM=L5401
#OOCustName#OOCustNo#OOFacmNo#OOBormNo#OODrawdownDate#OODrawdownAmt#OOPerfAmt#OOPerfCnt#OOProdCode#OOPieceCode
^
</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">

#RPTFG=0,QUERY.GRID,L5401
#any={detail:true, header:'L5401.part', caption:'', width:1080, rowNum:20, rowList:[20,40,60]}
#OOCustName=戶名
{width:100}
#OOCombine=戶號額度序號
{width:150,align:'center'}
#OODrawdownDate=撥款日期
{width:85,align:'center'}
#OODrawdownAmt=撥款金額
{width:85}
#OOPerfAmt=業績金額
{width:85}
#OOPerfCnt=業績件數
{width:85}
#OOProdCode=房貸/車貸
{width:90,align:'center'}
#OOPieceCode=計件代碼
{width:85,align:'center'}


^
</sub>
