!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L5021)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,0)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,40)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,40)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)

#button=x,100,S
T(2,{cmd=CHAIN; ntxcd=L5401; ntxbuf=1; ntxbuf5=type})ASGN(BTN_NEW1$)
K(MODIFYBUTTON,1,新增)
K(MODIFYBUTTON,查詢)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L5021" layout="cols=1;screen.width=[130,870];printer.width=[20,80];order=1">
[
["[L5021]                                 房貸專員明細資料查詢"],
[#<->#,"#FdEmpNo+員工編號",#EmpNo,#EmpNoX,"@不輸入，查詢全部房貸專員"],
[#<->#,"#FdYyy+年月份",#Yyy,#Mm,"@月份不輸入，查詢整年度"],
]
#FdEmpNo=X,2,L

#FdYyy=X,2,L
T(3,*)

#CHAIN=A,1,S
T(4,CHAIN$) 

#NTXBUF=X,7,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@Yyy,#NTXBUF,1,3)
INVOKEJS(SHOW,p1,02,02,1)

#PREVALUE=A,1,S
T(1,@Yyy,#SYSDATE,2,3)
! T(1,@Mm,#SYSDATE,5,2)

#EmpNo=X,6,I
<include src="ROM.icf::L5R06.dec"/>     
#RimL5R06=X,1,S
#CdEmpRimEmpNo=X,6,S
T(2,#EmpNo)
C(4,#EmpNo,S,$)
RESET_RIM(#RimL5R06,L5R06)
S(L5R06,1,#CdEmpRimEmpNo)
R(1,L5R06)
T(2,@EmpNoX,#L5R06FullName)

#EmpNoX=X,10,L
! 日期
#Yyy=A,3,I
C(3,#CHAIN,0,$,s)
@V(2,0)
! C(3,#Yyy,0,V(P,年份不可為0),$)

! 月份
#Mm=A,2,I
C(3,#CHAIN,0,$,s)
! @IF(#Mm>13,V(P,月份輸入錯誤),$)
@V(5,0,13)

#RPTFG=A,1,S

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L5021 -----------
<sub type="FORM" name="L5021">
#SCRTIL=_,_,S
T(3,[L5021] 房貸專員明細資料)

#LOOP=X,1,S
E(0,1)ASGN(LOOP$)
! 總和flag
#OODividFlag=A,1,S
! 年月份
#OOYyyMm=A,5,O
! 員工代號
#OOEmpNo=X,6,O
! 員工姓名
#OOTellerNm=X,20,O
! 目標金額
#OOGoalAmt=m,14,O
! ! 房貸撥款金額
! #OOPerfAmt=m,14,O
! ! 累積目標金額
#OOPerfAmt=m,14,O
! 累積房貸撥款金額
! #OOTotalPerfAmt=m,14,O
! 1+7+4+1+16+16+16=61
#OOBUF_EDIT=X,107,S
! T(2,2+#OOYyyMm+#OOEmpNo+#OOTellerNm+#OOGoalAmt+#OOPerfAmt)
T(2,2+#OOYyyMm+#OOEmpNo)
#OOBUF_COPY=X,107,S
T(2,3+#OOYyyMm+#OOEmpNo)
#OOBUF_DELETE=X,107,S
T(2,4+#OOYyyMm+#OOEmpNo)
#OOBUF_SEARCH=X,107,S
T(2,5+#OOYyyMm+#OOEmpNo)

#OOBTN_EDIT=A,2,O
C(3,#OODividFlag,1,BIND(grid,cancel),BIND(grid,{ cmd=CHAIN; ntxcd=L5401; ntxbuf=#OOBUF_EDIT}))
#OOBTN_COPY=A,2,O
C(3,#OODividFlag,1,BIND(grid,cancel),BIND(grid,{ cmd=CHAIN; ntxcd=L5401; ntxbuf=#OOBUF_COPY}))
#OOBTN_DELETE=A,2,O
C(3,#OODividFlag,1,BIND(grid,cancel),BIND(grid,{ cmd=CHAIN; ntxcd=L5401; ntxbuf=#OOBUF_DELETE}))
#OOBTN_SEARCH=A,2,O
C(3,#OODividFlag,1,BIND(grid,cancel),BIND(grid,{ cmd=CHAIN; ntxcd=L5401; ntxbuf=#OOBUF_SEARCH}))

</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#EmpNo
#Yyy#Mm
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L5R06.tom"/>
TXFORM=L5021
#OODividFlag#OOYyyMm#OOEmpNo#OOTellerNm#OOGoalAmt#OOPerfAmt
^
</sub>


!---------- 單據輸出組合 ----------
<sub type="PART" prompt='{{#SCRTIL}} world' name="L5021" layout="cols=1;screen.width=[130,870];order=1;">
[
["[L5021]                                 房貸專員明細資料查詢                                                                            "],
! [#<->#,"@年月份",#Yyy,#Mm,"@月份不輸入，查詢整年度"],
]
</sub>

<sub type="SELECT">

#RPTFG=0,QUERY.GRID,L5021
#any={detail:true, header:'L5021.part', caption:'', width:1020, rowNum:20, rowList:[20,40,60]}

#OOBTN_EDIT=修改
{search:false,formatter:'cust:bind-button:修改',align:'center',canExport:false,width:40}
#OOBTN_COPY=複製
{search:false,formatter:'cust:bind-button:複製',align:'center',canExport:false,width:40}
#OOBTN_DELETE=刪除
{search:false,formatter:'cust:bind-button:刪除',align:'center',canExport:false,width:40}
#OOBTN_SEARCH=查詢
{search:false,formatter:'cust:bind-button:查詢',align:'center',canExport:false,width:40}
! 年月份
#OOYyyMm=年月份
{width:80,align:'center'}
! 員工代號
#OOEmpNo=員工代號
{width:80,align:'center'}
! 員工姓名
#OOTellerNm=員工姓名
{width:105,align:'center'}
! 目標金額
#OOGoalAmt=目標金額
{width:105}
! ! 房貸撥款金額
#OOPerfAmt=房貸撥款金額
{width:105}
! 累積目標金額
! #OOTotalGoalAmt=累積目標金額
! {width:160}
! 累積房貸撥款金額
! #OOTotalPerfAmt=累積房貸撥款金額
! {width:160}
^
<include src="PRT.icf::INQ04.sel" map="i=L5021;cpi=15"/>
#Yyy#Mm
%
#OOYyyMm#OOEmpNo#OOTellerNm#OOGoalAmt#OOTotalGoalAmt
@^
</sub>
