!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L5022)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,0)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,109)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,40)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)

#button=x,100,S
T(2,{ cmd=CHAIN; ntxcd=L5407; ntxbuf=1})ASGN(BTN_NEW1$)
K(MODIFYBUTTON,1,新增)



</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L5022" layout="cols=1;screen.width=[130,870];printer.width=[20,80];order=1">
[
["[L5022]                                 協辦人員等級明細資料查詢"],
[#<->#,"#FdFunCd+功能",#FunCd,#FunCdX],
[#<->#,"#FdEmpNo+員工代號",#EmpNo,"空白查全部協辦人員"],
["#FdMain+查詢條件","@(狀態、生效日期，必須擇一輸入)"],
[#<->#,"#FdStatusFlag+．狀態",#StatusFlag,#StatusFlagX],
[#<->#,"#FdEffectiveDate+．生效日期",#EffectiveDateS,#EffectiveDateE],
[#<->#,"#FdWorkSeason+工作季",#WorkSeasonYY,"年"," 第 ",#WorkSeasonSS,"季"],
]
#FdFunCd=X,2,L
T(2,*)
#FdMain=X,2,L
#FdEmpNo=X,2,L
#FdStatusFlag=X,2,L
#FdEffectiveDate=X,2,L
! T(2,*)

#CHAIN=A,1,S
T(4,CHAIN$) 

#NTXBUF5=X,10,S
C(3,#CHAIN,1,T(4,NTXBUF5$),S)

<include src="HELPRIM.icf::HELPRIM.rtn"/>
#CDCODEClassType=x,20,S
T(3,CdCode.ClassType)
#ClassTypeHelp=x,100,S

#CDCODEEffectiveFlag=x,30,S
T(3,CdCode.EffectiveFlag)
#EffectiveFlagHelp=x,100,S

#CDCODEEffectiveStatus=x,30,S
T(3,CdCode.EffectiveStatus)
#EffectiveStatusHelp=x,100,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDCODEClassType,#CDCODEEffectiveFlag,#CDCODEEffectiveStatus)
R(1,XXR99)
CALL(#HelpProc)
T(2,@ClassTypeHelp,#HelpDesc1)
T(2,@EffectiveFlagHelp,#HelpDesc2)
T(2,@EffectiveStatusHelp,#HelpDesc3)
T(2,@EffectiveStatusHelp,9:全部;+#EffectiveStatusHelp)
#NTXBUF=X,6,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@EmpNo,#NTXBUF,1,6)

#FunCdHelp=x,1024,S
T(3,0:查詢;1:產生異動名單)
#FunCd=A,1,I
C(3,#FunCd,0,E(0,0),$)
HELP(#FunCdHelp)
@V(H,#FunCdHelp)
#FunCdX=X,15,L
T(H,#FunCd,#FunCdHelp)
C(3,#FunCd,1,INVOKEJS(SHOW,L5022,2,5,0)INVOKEJS(SHOW,L5022,6,6,1),INVOKEJS(SHOW,L5022,2,5,1)INVOKEJS(SHOW,L5022,6,6,0))


! 員工代號
! 若不輸入, 員工代號由最小開始查詢,否則由輸入之員工代號開始查詢
#EmpNo=X,6,I
C(3,#CHAIN,0,$,s)
C(3,#FunCd,1,S,$)

! #NewEmpNo=X,7,S
! T(2,1+#EmpNo)
@V(NL)
C(4,#EmpNo,$,K(MODIFYBUTTON,2,L5914歷程按鈕))


#Button2=x,100,S
T(2,{cmd=CHAIN; ntxcd=L5914; ntxbuf=#EmpNo; ntxbuf5=type})
ASGN(BTN_NEW2$)
! K(MODIFYBUTTON,2,L5914歷程按鈕)


#StatusFlag=X,1,I
C(3,#FunCd,1,S,$)
HELP(#EffectiveStatusHelp)
@T(3,#StatusFlagX,)
C(4,#StatusFlag,T(2,@StatusFlagX, ),V(H,#EffectiveStatusHelp)T(H,@StatusFlagX,#StatusFlag,#EffectiveStatusHelp))


#StatusFlagX=X,10,L

#EffectiveDateS=D,7,I
C(3,#FunCd,1,S,$)
C(4,#StatusFlag,$,S)
! @C(4,#EffectiveDateS,$,A(DATE,0,#EffectiveDateS))
@C(4,#StatusFlag,C(4,#EffectiveDateS,V(P,狀態、生效日期，必須擇一輸入),A(DATE,0,#EffectiveDateS)),$)
#EffectiveDateE=D,7,I
C(3,#FunCd,1,S,$)
C(4,#StatusFlag,$,S)
C(4,#EffectiveDateS,S,$)
@C(4,#EffectiveDateS,$,V(7))
C(4,#EffectiveDateE,$,A(DATE,0,#EffectiveDateE))
IF(#EffectiveDateE<#EffectiveDateS,V(P,止日需大於起日),$)


#RimL5r38=X,1,S
C(3,#FunCd,1,$,S)
E(0,@L5R38iCode,3)
E(0,@L5R38iDate,#SYSCDATE)
S(L5R38,1,#L5R38iCode,#L5R38iDate)
R(1,L5R38)
E(0,@WorkSeason,#L5R38LastWorkSeason)
#WorkSeason=A,4,S



!工作季
#FdWorkSeason=X,1,L

#WorkSeasonYY=A,3,L
C(3,#FunCd,1,$,S)
T(1,#WorkSeason,1,3)
#WorkSeasonSS=A,1,L
C(3,#FunCd,1,$,S)
T(1,#WorkSeason,4,1)

#RPTFG=A,1,S
E(0,0)
C(4,#NTXBUF5,E(0,0),E(0,1))


#CHAINXMT=X,1,S
C(3,#CHAIN,1,E(0,@CHAIN,0)XMT(),$)

<include src="ROM.icf::L5R38.rtn"/>
</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L5022 -----------
<sub type="FORM" name="L5022">

#SCRTIL=_,_,S
T(3,[L5022] 協辦人員等級明細資料)


#LOOP=X,1,S
E(0,1)ASGN(LOOP$)

! 員工代號
#OOEmpNo=X,6,O
! 員工姓名
#OOFullname=X,8,O
! 單位代號
#OOUnitCode=X,7,O
! 單位中文
#OOUnitCodeX=x,20,O
! 區部代號
#OODistCode=X,6,O
! 區部中文
#OODistCodeX=x,20,O
! 部室代號
#OODeptCode=X,6,O
! 部室中文
#OODeptCodeX=x,20,O
! 生效日期
#OOEffectiveDate=D,7,O
! 停效日期
#OOIneffectiveDate=D,7,O
C(3,#OOIneffectiveDate,0,S,$)
! 協辦等級
#OOEmpClass=A,1,O
#OOEmpClassX=X,4,O
T(H,#OOEmpClass,#ClassTypeHelp)
! 初階授信通過
#OOClassPass=X,1,O
! 狀態Fg 1:已生效 2:已停效 3:未生效
#OOStatusFg=A,1,S

#OOStatusFgX=X,10,S
T(H,#OOStatusFg,#EffectiveStatusHelp)
! 1+6+8+3(6+16)+7+1+1=90
#OOEvalueChgClass=X,1,S
#OOBUF_EDIT=X,41,S
T(2,2+#OOEmpNo+#OOEffectiveDate+#OOStatusFg)
#OOBUF_COPY=X,34,S
T(2,3+#OOEmpNo+#OOEffectiveDate)
#OOBUF_DELETE=X,34,S
T(2,4+#OOEmpNo+#OOEffectiveDate)
#OOBUF_SEARCH=X,34,S
T(2,#OOEmpNo+#OOEffectiveDate)
!6:離職異動 7:調職異動 8:考核職級異動
#OOBUF_QuitChg=X,41,S
T(2,6+#OOEmpNo+#OOEffectiveDate+#OOStatusFg+#OOQuitChgDate)
#OOBUF_PostChg=X,41,S
T(2,7+#OOEmpNo+#OOEffectiveDate+#OOStatusFg+#OOPostChgDate)
#OOBUF_EvalueChg=X,41,S
T(2,8+#OOEmpNo+#OOEffectiveDate+#OOStatusFg+#OOEvalueChgDate+#OOEvalueChgClass)



#OOBTN_EDIT=A,2,O
BIND(grid,{ cmd=CHAIN; ntxcd=L5407; ntxbuf=#OOBUF_EDIT})
!C(3,#OOStatusFg,2,BIND(grid,cancel),BIND(grid,{ cmd=CHAIN; ntxcd=L5407; ntxbuf=#OOBUF_EDIT}))
! C(2,#OOStatusFg,$,BIND(grid,{ cmd=CHAIN; ntxcd=L5407; ntxbuf=#OOBUF_EDIT}),
!                   BIND(grid,cancel),
!                   BIND(grid,{ cmd=CHAIN; ntxcd=L5407; ntxbuf=#OOBUF_EDIT}))
#OOBTN_COPY=A,2,O
BIND(grid,{ cmd=CHAIN; ntxcd=L5407; ntxbuf=#OOBUF_COPY})

#OOBTN_DELETE=A,2,O    
BIND(grid,{ cmd=CHAIN; ntxcd=L5407; ntxbuf=#OOBUF_DELETE})
!C(3,#OOStatusFg,3,BIND(grid,{ cmd=CHAIN; ntxcd=L5407; ntxbuf=#OOBUF_DELETE}),BIND(grid,cancel))   
! C(2,#OOStatusFg,$,BIND(grid,cancel),
!                   BIND(grid,cancel),
!                   BIND(grid,{ cmd=CHAIN; ntxcd=L5407; ntxbuf=#OOBUF_DELETE}))

#OOLogCount=A,6,S
#OOBTN_SEARCH=A,2,O
IF(#OOLogCount>0, BIND(grid,{ cmd=CHAIN; ntxcd=L5914; ntxbuf=#OOBUF_SEARCH}),BIND(grid,cancel))

#OOQuitChgDate=D,7,S
#OOBTN_QuitChg=A,2,O
IF(#OOQuitChgDate>0, BIND(grid,{ cmd=CHAIN; ntxcd=L5407; ntxbuf=#OOBUF_QuitChg}),BIND(grid,cancel))

#OOPostChgDate=D,7,S
#OOBTN_PostChg=A,2,O
IF(#OOPostChgDate>0, BIND(grid,{ cmd=CHAIN; ntxcd=L5407; ntxbuf=#OOBUF_PostChg}),BIND(grid,cancel))

#OOEvalueChgDate=D,7,S
#OOBTN_EvalueChg=A,2,O
IF(#OOEvalueChgDate>0, BIND(grid,{ cmd=CHAIN; ntxcd=L5407; ntxbuf=#OOBUF_EvalueChg}),BIND(grid,cancel))

</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#FunCd
#EmpNo
#StatusFlag
#EffectiveDateS
#EffectiveDateE
#WorkSeason
#WorkSeasonYY
#WorkSeasonSS
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
<include src="ROM.icf::L5R38.tom"/>
TXFORM=L5022
#OOEmpNo#OOFullname#OOUnitCode#OOUnitCodeX#OODistCode#OODistCodeX#OODeptCode#OODeptCodeX#OOEffectiveDate#OOIneffectiveDate#OOEmpClass#OOClassPass#OOStatusFg
#OOLogCount
#OOQuitChgDate
#OOPostChgDate
#OOEvalueChgDate
#OOEvalueChgClass
^
</sub>


!---------- 單據輸出組合 ----------
<sub type="PART" prompt='{{#SCRTIL}} world' name="L5022" layout="cols=1;screen.width=[1000,0];order=1;">
[
["[L5022]                                 協辦人員等級明細資料查詢                                                                                                               "],
! [#<->#,"@員工代號",#EmpNo],
]
</sub>

<sub type="SELECT">

#RPTFG=0,QUERY.GRID,L5022
#any={detail:true, header:'L5022.part', caption:'', width:1080, rowNum:20, rowList:[20,40,60]}

#OOBTN_EDIT=修改
{search:false,formatter:'cust:bind-button:修改',align:'center',canExport:false,width:40}
#OOBTN_COPY=複製
{search:false,formatter:'cust:bind-button:複製',align:'center',canExport:false,width:40}
#OOBTN_DELETE=刪除
{search:false,formatter:'cust:bind-button:刪除',align:'center',canExport:false,width:40}
#OOBTN_QuitChg=離職<BR>異動
{search:false,formatter:'cust:bind-button:離職',align:'center',canExport:false,width:40}
#OOBTN_PostChg=調職<BR>異動 
{search:false,formatter:'cust:bind-button:調職',align:'center',canExport:false,width:40}
#OOBTN_EvalueChg=考核職級<BR>異動
{search:false,formatter:'cust:bind-button:考核',align:'center',canExport:false,width:80}
#OOBTN_SEARCH=歷程
{search:false,formatter:'cust:bind-button:歷程',align:'center',canExport:false,width:40}

#OOEmpNo=員工代號
{width:80,align:'center'}
#OOFullname=員工姓名
{width:85}

#OOUnitCode=單位代號
{width:95,align:'center'}
#OOUnitCodeX=單位中文
{width:95}
#OODistCode=區部代號
{width:85,align:'center'}
#OODistCodeX=區部中文
{width:95}
#OODeptCode=部室代號
{width:85,align:'center'}
#OODeptCodeX=部室中文
{width:95}
#OOEffectiveDate=生效日期
{width:85,align:'center'}
#OOIneffectiveDate=停效日期
{width:85,align:'center'}
#OOEmpClassX=協辦等級
{width:80,align:'center'}
#OOClassPass=初階授信通過
{width:120,align:'center'}
#OOStatusFgX=目前狀態
{width:120,align:'center'}
^
#RPTFG=1,QUERY.GRID,L5022
#any={detail:true, header:'L5022.part', caption:'', width:1080, rowNum:20, rowList:[20,40,60]}


!星號註記
#OOStart1=
{width:15,align:'center'}
#OOEmpNo=員工代號
{width:80,align:'center'}
#OOFullname=員工姓名
{width:85}

!星號註記
#OOStart2=
{width:15,align:'center'}
#OOUnitCode=單位代號
{width:85,align:'center'}
#OOUnitCodeX=單位中文
{width:95}
#OODistCode=區部代號
{width:85,align:'center'}
#OODistCodeX=區部中文
{width:95}
#OODeptCode=部室代號
{width:85,align:'center'}
#OODeptCodeX=部室中文
{width:95}
#OOEffectiveDate=生效日期
{width:85,align:'center'}
#OOIneffectiveDate=停效日期
{width:85,align:'center'}
#OOEmpClassX=協辦等級
{width:80,align:'center'}
#OOClassPass=初階授信通過
{width:120,align:'center'}
#OOStatusFgX=目前狀態
{width:120,align:'center'}
^
<include src="PRT.icf::INQ04.sel" map="i=L5022;cpi=15"/>
#EmpNo
%
#OOEmpNo#OOFullname#OOUnitCode#OOUnitCodeX#OODistCode#OODistCodeX#OODeptCode#OODeptCodeX#OOEffectiveDate#OOEmpClass#OOClassPass
@^
</sub>
