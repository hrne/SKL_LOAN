!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L5972)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,0)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,1407)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,1)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

#button=x,1,S
K(MODIFYBUTTON,查詢)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L5972" layout="cols=1;screen.width=[130,870];printer.width=[20,80];order=1">
[
["[L5972]                                 債務協商入帳明細資料查詢"],
["#FdCustId+身分證字號",#CustId],
["#FdDateType+日期選項",#DateType,#DateTypeX],
["#FdDateFrom+日期區間",#DateFrom,"~",#DateTo],
]

#FdCustId=X,2,L
#FdDateType=X,2,L
T(3,*)
#FdDateFrom=X,2,L

! 這些東西應該不用顯示
! ,["戶號",#CustNo],
! ["案件序號",#CaseSeq],["會計日期",#AcDate]
! ["經辦",#TitaTlrNo]
!---------- AP TEXT AREA Variables ----------
<include src="HELPRIM.icf::HELPRIM.rtn"/>

! TxKind
#TxKindCode=x,20,S
T(3,CdCode.NegTxKind)
#TxKindHelp=x,1024,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#TxKindCode)
R(1,XXR99)
CALL(#HelpProc)
T(2,@TxKindHelp,#HelpDesc1)

!日期選項
#DateTypeHelp=X,100,S
T(3,0:全部;1:會計日期;2:入帳日期)


#CHAIN=A,1,S
T(4,CHAIN$)
!來源路徑
! L5701(NegMain)->L5971(NegTrans 顯示)->L5972(NegTrans 修改)


!功能代碼
#FunctionCode=X,2,S

! 戶號
#CustNo=A,7,L

! 案件序號
#CaseSeq=9,3,L
! 會計日期
#AcDate=D,7,S

! 經辦
#TitaTlrNo=X,6,S

! 交易序號
#TitaTxtNo=9,8,S

! 連動過來(L5971,L5075)用KEY值查詢
! L5971 #OOBufNegTrans:<入帳明細>=交易代碼(01 查詢)(2)+身分證號(#CustId)(10)+戶號(#OCustNo)(7)+案件序號(#OOCaseSeq)(3)+會計日期(#OOAcDate)(7)+經辦(#OOTitaTlrNo)(6)+交易序號(#OOTitaTxtNo)(8)
#NTXBUF=X,43,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@FunctionCode,#NTXBUF,1,2)
IF(#FunctionCode=="01" || #FunctionCode=="02",$,s)
T(1,@CustId,#NTXBUF,3,10)
T(1,@CustNo,#NTXBUF,13,7)
T(1,@CaseSeq,#NTXBUF,20,3)
T(1,@AcDate,#NTXBUF,23,7)
T(1,@TitaTlrNo,#NTXBUF,30,6)
T(1,@TitaTxtNo,#NTXBUF,36,8)

INVOKEJS(SHOW,p1,02,02,1)

! 身分證字號
#CustId=X,10,I
C(3,#CHAIN,0,$,s)
@C(4,#CustId,S,$)
A(ID_UNINO,0,#CustId)

!身分證找戶號
<include src="ROM.icf::L2R47.dec"/>
#Rim2R47CustId=X,10,S

#RimL2R47=X,1,S
C(4,#CustId,S,$)
T(2,@Rim2R47CustId,#CustId)
RESET_RIM(#RimL2R47,L2R47)
S(L2R47,1,#Rim2R47CustId)
R(1,L2R47)

! 日期選項
#DateType=X,1,I
C(3,#CHAIN,0,$,s)
HELP(#DateTypeHelp)
@T(3,@DateTypeX,)
@IF(#DateType=="",T(2,0),V(H,#DateTypeHelp))
@IF(#DateType==0 && #CustId=="",V(P,[日期選項]為0時[身分證字號]不可空白),s)
!@IF(#DateType=="",T(2,0),s)

#DateTypeX=X,8,L
C(3,#CHAIN,0,$,s)
T(H,#DateType,#DateTypeHelp)

! 日期區間
#DateFrom=D,7,I
C(3,#CHAIN,0,$,s)
IF(#DateType==0,S,$)
D(8)
@V(7)
!@IF(#DateType!=0,$,V(P,請填寫日期))
@A(DATE,0,#DateFrom)


#DateTo=D,7,I
C(3,#CHAIN,0,$,s)
IF(#DateType==0,S,$)
D(8)
!@IF(#DateType!=0,$,V(P,請填寫日期))
@A(DATE,0,#DateTo)
@IF(#DateFrom>#DateTo,V(P,[日期區間-訖]不得小於[日期區間-起]),s)



#MRKEY=_,_,S
C(4,#CustId,S,$)
T(2,#L2R47CustNo)

#RPTFG=A,1,S

! 自動SUBMIT
#CHAINXMT=X,1,S
C(3,#CHAIN,1,E(0,@CHAIN,0)XMT(),$)
</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L5972 -----------
<sub type="FORM" name="L5972">

#SCRTIL=_,_,S
T(3,[L5972] 債務協商入帳明細表)

#LOOP=X,1,S
E(0,1)ASGN(LOOP$)

! 身分證字號
#OOCustId=X,10,O
! 戶號
#OOCustNo=A,7,O
! 案件序號
#OOCaseSeq=9,3,O
! 戶名
#OOCustNM=X,100,O
! 入帳日期
#OOEntryDate=D,7,O
! 交易別
#OOTxKind=X,1,O
#OOTxKindX=X,8,O
T(H,#OOTxKind,#TxKindHelp)

! 交易金額
#OOTxAmt=+m,14,O
! 繳息迄日
#OOIntEndDate=D,7,O
! 暫收抵繳
#OOTempRepayAmt=m,14,O
! 溢收抵繳
#OOOverRepayAmt=m,14,O
! 本金
#OOPrincipalAmt=m,14,O
! 利息
#OOInterestAmt=+m,14,O
! 轉入溢收
#OOOverAmt=m,14,O
! 新壽攤分
#OOSklShareAmt=m,14,O
! 會計日期
#OOAcDate=D,7,O
! 交易序號
#OOTitaTxtNo=A,8,O
!! 案件序號
!#OOCaseSeq=9,3,S
! 經辦
#OOTitaTlrNo=X,6,S
! 本金餘額
#OOPrincipalBal=m,14,S
! 退還金額
#OOReturnAmt=m,14,S
! 撥付金額
#OOApprAmt=m,14,S
! 撥付製檔日
#OOExportDate=D,7,S
! 繳息起日
#OOIntStartDate=D,7,S
! 還款期數
#OORepayPeriod=A,3,S

! keyValue=#OOCustId(10)+#OOCustNo(7)+#CaseSeq(3)+#OOAcDate(7)+#OOTitaTlrNo(6)+#OOTitaTxtNo(8)
! #OOBufKey=X,41,S
! T(2,#OOCustId+#OOCustNo+#CaseSeq+#OOAcDate+#OOTitaTlrNo+#OOTitaTxtNo)

</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#FunctionCode
#CustNo
#CaseSeq
#AcDate
#TitaTlrNo
#TitaTxtNo
#CustId
#DateType
#DateFrom
#DateTo
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L2R47.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
TXFORM=L5972
#OOCustId
#OOCustNo
#OOCustNM
#OOEntryDate
#OOTxKind
#OOTxAmt
#OOIntEndDate
#OOTempRepayAmt
#OOOverRepayAmt
#OOPrincipalAmt
#OOInterestAmt
#OOOverAmt
#OOSklShareAmt
#OOAcDate
#OOTitaTxtNo
#OOCaseSeq
#OOTitaTlrNo
#OOPrincipalBal
#OOReturnAmt
#OOApprAmt
#OOExportDate
#OOIntStartDate
#OORepayPeriod
^
</sub>


!---------- 單據輸出組合 ----------
<sub type="PART" prompt='{{#SCRTIL}} world' name="L5972" layout="cols=1;screen.width=[130,870];order=1;">
[
["[L5972]@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@債務協商入帳明細資料查詢"],
[""],
]
</sub>

<sub type="SELECT">

#RPTFG=0,QUERY.GRID,L5972
#any={detail:true, header:'L5972.part', caption:'', width:1020, rowNum:20, rowList:[20,40,60]}

#OOCustId=身分證字號
{width:100}
#OOCustNo=戶號
{width:65}
#OOCaseSeq=案件序號
{width:65}
#OOCustNM=戶名
{width:85}
#OOEntryDate=入帳日期
{width:85,align:'center'}
#OOTxKindX=交易別
{width:65,align:'center'}
#OOTxAmt=暫收金額
{width:85}
#OOIntEndDate=繳息迄日
{width:85,align:'center'}
#OOTempRepayAmt=暫收抵繳
{width:85}
#OOOverRepayAmt=溢收抵繳
{width:85}
#OOPrincipalAmt=本金
{width:85}
#OOInterestAmt=利息
{width:85}
#OOOverAmt=轉入溢收
{width:85}
#OOSklShareAmt=新壽攤分
{width:85}
#OOAcDate=會計日期
{width:85,align:'center'}
#OOTitaTxtNo=交易序號
{width:85,align:'right'}
^
<include src="PRT.icf::INQ04.sel" map="i=L5972;cpi=15"/>
#DateType
#DateFrom
#DateTo
#CustId
%
#OOCustId
#OOCustNo
#OOCustNM
#OOEntryDate
#OOTxKind
#OOTxAmt
#OOIntEndDate
#OOTempRepayAmt
#OOOverRepayAmt
#OOPrincipalAmt
#OOInterestAmt
#OOOverAmt
#OOSklShareAmt
#OOAcDate
#OOTitaTxtNo
#OOCaseSeq
#OOTitaTlrNo
#OOPrincipalBal
#OOReturnAmt
#OOApprAmt
#OOExportDate
#OOIntStartDate
#OORepayPeriod

^
</sub>
