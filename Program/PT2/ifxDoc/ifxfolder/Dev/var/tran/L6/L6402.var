!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

!#FunCodeH=X,100,S
!T(3,1:新增;2:修改;4:刪除;5:查詢)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD2.dec"/>
</sub>

<sub type="DC" name="p1" layout="cols=2;screen.width=[200,250,200,400];printer.width=[20,30,15,45];order=1;">
!<sub type="DC" name="p1" layout="cols=2;screen.width=[160,250,180,400];printer.width=[20,30,15,45];order=1;">
[
["[L6402]                                 交易控制檔維護"],
[#<->#,"#FdFunCode+功能",#FunCodeX],
[#<->#,"#FdTranNo+交易代碼",#TranNo],
[#<->#,"#FdTranItem+交易名稱    ",#TranItem],
[#<->#,"#FdDesc+交易說明    ",#Desc],
["#FdTypeFg+交易類別     ",#TypeFg,#TypeFgX],
["#FdStatus+交易狀態     ",#Status,#StatusX],
["#FdCancelFg+訂正權限設定 ",#CancelFg,#CancelFgX],
["#FdModifyFg+修正權限設定 ",#ModifyFg,#ModifyFgX],
["#FdMenuNo+主類別",#MenuNo,#MenuNoX],
["#FdSubMenuNo+子類別",#SubMenuNo,#SubMenuNoX],
["#FdMenuFg+掛入選單",#MenuFg,#MenuFgX],
["#FdSubmitFg+登錄需提交",#SubmitFg,#SubmitFgX],
["#FdCustDataCtrlFg+結清戶個資控管",#CustDataCtrlFg,#CustDataCtrlFgX],
["#FdCustRmkFg+顧客控管警訊記號",#CustRmkFg,#CustRmkFgX],
["#FdApLogFlag+敏感性資料記錄記號",#ApLogFlag,#ApLogFlagX],
["#FdApLogRim+敏感性資料記錄Rim代碼",#ApLogRim],
[#<->#,"#FdChainTranMsg+入口交易提示訊息",#ChainTranMsg],
]

!---------- AP Button AREA ----------
<include src="HELPRIM.icf::HELPRIM.rtn"/>

#CHAIN=A,1,S
T(4,CHAIN$)
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:[L6042 交易控制檔查詢]進入),$)

#NTXBUF=X,6,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@FunCode,#NTXBUF,1,1)
T(1,@TranNo,#NTXBUF,2,5)
T(2,@FKEY,7)

!FuncCode1 (1:新增;2:修改;4:刪除;5:查詢)
#CDCODEFuncCode1=x,20,S                  
T(3,CdCode.FuncCode1)                  
#FunCodeH=x,50,S    

!ApType
#CDCODEMenu=x,20,S                  
T(3,CdCode.Menu)                  
#ApHelp=x,1024,S

!TranType(1:查詢交易;2:維護交易)
#CDCODETranType=x,20,S                  
T(3,CdCode.TranType)                  
#TypeHelp=x,100,S

!CancelType(0:不可訂正;1:可訂正)
#CDCODECancelType=x,20,S                  
T(3,CdCode.CancelType) 
#CancelHelp=X,100,S

!ReviseType(0:不可訂正;1:可訂正)
#CDCODEReviseType=x,20,S                  
T(3,CdCode.ReviseType) 
#ModifyHelp=X,100,S

! 結清戶個資控管下拉選單
#CustDataCtrlFgHelpRim=x,30,S
T(3,CdCode.CustDataCtrlFg)
#CustDataCtrlFgHelp=X,100,S

!ApLogFlag(0:否;1:是)
#CDCODEApLogFlag=x,20,S                  
T(3,CdCode.ApLogFlag) 
#ApLogFlagHelp=X,100,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDCODEFuncCode1,#CDCODEMenu,#CDCODETranType,#CDCODECancelType,#CDCODEReviseType,#CustDataCtrlFgHelpRim,#CDCODEApLogFlag)
R(1,XXR99)
CALL(#HelpProc)
T(2,@FunCodeH,#HelpDesc1)
T(2,@ApHelp,#HelpDesc2)
T(2,@TypeHelp,#HelpDesc3)
T(2,@CancelHelp,#HelpDesc4)
T(2,@ModifyHelp,#HelpDesc5)
T(2,@CustDataCtrlFgHelp,#HelpDesc6)
T(2,@ApLogFlagHelp,#HelpDesc7)

#StatusHelp=X,50,S
T(3,0:正常;1:停用)

#YesNoHelp=X,50,S
T(3,0:否;1:是)
!提交
#YesNoHelp2=X,50,S
T(3,0:否;1:是;2:自動)

!---------- AP TEXT AREA Variables ----------

#FdFunCode=X,2,L
#FdTranNo=X,2,L
#FdTranItem=X,2,L
#FdDesc=X,2,L
#FdTypeFg=X,2,L
#FdStatus=X,2,L
#FdCancelFg=X,2,L
#FdModifyFg=X,2,L
#FdMenuNo=X,2,L
#FdSubMenuNo=X,2,L
#FdMenuFg=X,2,L
#FdSubmitFg=X,2,L
#FdCustDataCtrlFg=X,2,L
#FdCustRmkFg=X,2,L
#FdChainTranMsg=X,2,L
#FdApLogFlag=X,2,L	
#FdApLogRim=X,2,L

#ShowFd1=X,1,S
C(3,#CHAIN,1,T(3,@FdFunCode, ),T(3,@FdFunCode,*))
C(3,#CHAIN,1,T(F,@FunCode,0),T(F,@FunCode,1))
C(3,#CHAIN,1,C(3,#FunCode,1,T(3,@FdTranNo,*),T(3,@FdTranNo, )),T(3,@FdTranNo,*))
C(3,#CHAIN,1,C(3,#FunCode,1,T(F,@TranNo,1),T(F,@TranNo,0)),T(F,@TranNo,1))


![功能選項]
#FunCode=A,1,S
C(2,#CHAIN,$,s)
HELP(#FunCodeH)
@V(H,#FunCodeH)
E(0,@FUNCIND,#FuncCode)

![功能選項說明]
#FunCodeX=X,4,L
T(H,#FunCode,#FunCodeH)
K(MODIFYBUTTON,#FunCodeX)
C(3,#FunCode,5,K(NOBUTTON,CLOSEY),$)

!刪除隱藏重新交易按鈕
#AGAIN=X,1,S
IF(#FunCode==4 || #FunCode==2,$,S)
E(0,1)ASGN(AGAIN$)

#FUNCIND=_,_,S
E(0,#FunCode)
<include src="COM.icf::CheckAuth.rtn"/>
			  

#ShowFd=X,1,S
C(2,#FunCode,T(3, ),T(3,*),T(3,*),T(3,*),T(3, ),T(3, ))
T(2,@FdTranItem,#ShowFd)     
T(2,@FdStatus,#ShowFd)
T(2,@FdCancelFg,#ShowFd)
T(2,@FdModifyFg,#ShowFd)
T(2,@FdSubMenuNo,#ShowFd)
T(2,@FdMenuFg,#ShowFd)
T(2,@FdSubmitFg,#ShowFd)
T(2,@FdCustDataCtrlFg,#ShowFd)
T(2,@FdCustRmkFg,#ShowFd))
			       
!顯示框線
#ShowFrame=A,1,S
C(2,#FunCode,T(3,0),T(3,1),T(3,1),T(3,1),T(3,0),T(3,0))
T(F,@TranItem,#ShowFrame)
T(F,@Desc,#ShowFrame)
T(F,@TypeFg,#ShowFrame)
T(F,@Status,#ShowFrame)
T(F,@CancelFg,#ShowFrame)
T(F,@ModifyFg,#ShowFrame)
T(F,@MenuNo,#ShowFrame)
T(F,@SubMenuNo,#ShowFrame)
T(F,@MenuFg,#ShowFrame)
T(F,@SubmitFg,#ShowFrame)
T(F,@CustDataCtrlFg,#ShowFrame)
T(F,@CustRmkFg,#ShowFrame)
T(F,@ApLogFlag,#ShowFrame)
T(F,@ApLogRim,#ShowFrame)
T(F,@ChainTranMsg,#ShowFrame)

![業務/交易代碼]
#TranNo=X,5,I
C(2,#CHAIN,$,C(3,#FunCode,1,$,s))
@V(7)

#Aptype1=X,1,S
T(1,#TranNo,1,1)
@V(3,L)

! 2021-04-08 智偉增加判斷,LM LD 放L9
! 2021-04-27 智偉增加判斷,LH LP LW LY 放L9
#Aptype2=X,1,S
T(1,#TranNo,2,1)
@
SWITCH(#Aptype2,M,T(3,9),
                D,T(3,9),
                H,T(3,9),
                P,T(3,9),
                Q,T(3,9),
                W,T(3,9),
                Y,T(3,9),
                $)
V(3,1,2,3,4,5,6,7,8,9,C,M)

#Aptype3=X,1,S
T(1,#TranNo,3,1)
@V(3,0,1,2,3,4,5,6,7,8,9)
!
#Aptype4=X,1,S
T(1,#TranNo,4,1)
!@V(3,0,1,2,3,4,5,6,7,8,9)

#Aptype5=X,1,S
T(1,#TranNo,5,1)
!@V(3,0,1,2,3,4,5,6,7,8,9)

! 2021-04-08 智偉增加判斷,LM LD 放L9
! 2021-04-27 智偉增加判斷,LH LP LW LY 放L9
#Aptype=X,2,S
T(1,#TranNo,1,2)
SWITCH(#Aptype,LM,T(3,L9),
               LD,T(3,L9),
               LH,T(3,L9),
               LP,T(3,L9),
               LQ,T(3,L9),
               LW,T(3,L9),
               LY,T(3,L9),
               $)

#AptypeX=X,20,S
T(H,#Aptype,#ApHelp)

!-------------------
#MenuNo=X,2,L
T(2,#Aptype)

#MenuNoX=X,24,L
T(2,#AptypeX)

#RIMT1=x,15,S
T(3,CdCode.SubMenuL)

#RIMT=x,16,S
T(2,#RIMT1+#Aptype2)

#CustRmk=x,30,S
T(3,CdCode.CustRmkFlag)

#CustRmkFgHelp=X,1024,S

#SubMenuHelp=X,1024,S
C(4,#MenuNo,s,$)
S(XXR99,01,#RIMT,#CustRmk)
R(1,XXR99)
CALL(#HelpProc)
T(2,#HelpDesc1)
T(2,@CustRmkFgHelp,#HelpDesc2)

!--------------------

#R1=A,1,S
RESET_RIM(#R1,L6R24)
S(L6R24,01,#FunCode,#TranNo,#END)
R(1,L6R24)
@
C(3,#FunCode,5,s,$)
T(H,@TypeFgX,#TypeFg,#TypeHelp)
T(H,@StatusX,#Status,#StatusHelp)
T(H,@CancelFgX,#CancelFg,#CancelHelp)
T(H,@ModifyFgX,#ModifyFg,#ModifyHelp)
T(2,@MenuNo,#Aptype)
T(2,@MenuNoX,#AptypeX)
T(H,@MenuFgX,#MenuFg,#YesNoHelp)
T(H,@SubmitFgX,#SubmitFg,#YesNoHelp2)
T(H,@SubMenuNoX,#SubMenuNo,#SubMenuHelp)
T(H,@CustDataCtrlFgX,#CustDataCtrlFg,#CustDataCtrlFgHelp)
T(H,@CustRmkFgX,#CustRmkFg,#CustRmkFgHelp)
T(H,@ApLogFlagX,#ApLogFlag,#ApLogFlagHelp)



#TranItem=x,40,I
C(2,#FunCode,s,$,$,s,s,s)
@V(7)

#Desc=x,60,I
C(2,#FunCode,s,$,$,s,s,s)

!-------------------
#TypeFg=A,1,L
C(2,#FunCode,s,$,$,s,s,s)
C(5,#Aptype3,0,E(0,1),C(5,#Aptype3,9,E(0,1),E(0,2)))
HELP(#TypeHelp)
@T(3,@TypeFgX,)
V(H,#TypeHelp)

#TypeFgX=X,8,L
T(H,#TypeFg,#TypeHelp)

!-------------------
#Status=A,1,I
C(2,#FunCode,s,$,$,s,s,s)
HELP(#StatusHelp)
@T(3,@StatusX,)
V(H,#StatusHelp)

#StatusX=X,4,L
T(H,#Status,#StatusHelp)


!-------------------
#CancelFg=A,1,I
C(2,#FunCode,s,$,$,s,s,s)
C(3,#TypeFg,1,S,$)
HELP(#CancelHelp)
@T(3,@CancelFgX,)
V(H,#CancelHelp)

#CancelFgX=X,8,L
!C(3,#TypeFg,1,S,$)
T(H,#CancelFg,#CancelHelp)

!-------------------
#ModifyFg=A,1,I
C(2,#FunCode,s,$,$,s,s,s)
C(3,#TypeFg,1,S,$)
HELP(#ModifyHelp)
@T(3,@ModifyFgX,)
V(H,#ModifyHelp)

#ModifyFgX=X,8,L
!C(3,#TypeFg,1,S,$)
T(H,#ModifyFg,#ModifyHelp)


#SubMenuNo=X,2,I
C(4,#MenuNo,S,$)
C(2,#FunCode,s,$,$,s,s,s)
HELP(#SubMenuHelp)
@T(3,@SubMenuNoX,)
V(H,#SubMenuHelp)

#SubMenuNoX=X,40,L
C(4,#MenuNo,S,$)
T(H,#SubMenuNo,#SubMenuHelp)

!-------------------
#MenuFg=A,1,I
C(2,#FunCode,s,$,$,s,s,s)
HELP(#YesNoHelp)
@T(3,@MenuFgX,)
V(H,#YesNoHelp)

#MenuFgX=X,2,L
T(H,#MenuFg,#YesNoHelp)

#SubmitFg=A,1,I
C(2,#FunCode,s,$,$,s,s,s)
HELP(#YesNoHelp2)
@T(3,@SubmitFgX,)
V(H,#YesNoHelp2)

#SubmitFgX=X,4,L
T(H,#SubmitFg,#YesNoHelp2)

#CustDataCtrlFg=A,1,I
C(2,#FunCode,s,$,$,s,s,s)
HELP(#CustDataCtrlFgHelp)
@T(3,@CustDataCtrlFgX,)
V(H,#CustDataCtrlFgHelp)

#CustDataCtrlFgX=X,10,L
T(H,#CustDataCtrlFg,#CustDataCtrlFgHelp)

#CustRmkFg=A,1,I
C(2,#FunCode,s,$,$,s,s,s)
HELP(#CustRmkFgHelp)
@T(3,@CustRmkFgX,)
V(H,#CustRmkFgHelp)

#CustRmkFgX=X,10,L
T(H,#CustRmkFg,#CustRmkFgHelp)

!-------------------EM2661
#ApLogFlag=A,1,I
C(2,#FunCode,s,$,$,s,s,s)
HELP(#ApLogFlagHelp)
@T(3,@ApLogFlagX,)
V(H,#ApLogFlagHelp)

#ApLogFlagX=X,8,L
T(H,#ApLogFlag,#ApLogFlagHelp)

#ApLogRim=X,5,I
C(2,#FunCode,s,$,$,s,s,s)

#ChainTranMsg=x,100,I
C(2,#FunCode,s,$,$,s,s,s)



#MRKEY=_,_,S
T(2,CODE:+#TranNo)


</sub>


!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------ 上行電文TIM：BASIC LABEL + AP TEXT AREA + AP TEXT ------
<sub type="TIM">
#FunCode
#TranNo
#TranItem
#Desc
#TypeFg
#Status
#CancelFg
#ModifyFg
#MenuNo
#SubMenuNo
#MenuFg
#SubmitFg
#CustDataCtrlFg
#CustRmkFg
#ChainTranMsg
#ApLogFlag
#ApLogRim
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
TXFORM=L6402^

TXFORM=L6R24
#TranItem
#Desc
#TypeFg
#Status
#CancelFg
#ModifyFg
#MenuNo
#SubMenuNo
#MenuFg
#SubmitFg
#CustDataCtrlFg
#CustRmkFg
#ChainTranMsg
#ApLogFlag
#ApLogRim
^
</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
</sub>
