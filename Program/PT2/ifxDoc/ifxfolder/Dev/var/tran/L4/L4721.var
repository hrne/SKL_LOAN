!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L4721)
</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L4721" layout="cols=1;screen.width=[130,870];printer.width=[20,80];order=1">
[
["[L4721]                                 整批批次產出利率變動對帳單"],
[#<->#,"#FdAdjDate+利率調整日",#sAdjDate,"~",#eAdjDate],
[#<->#,"#FdTxKind+利率種類",#TxKind,#TxKindX],
[#<->#,"#FdCustType+個金/企金",#CustType,#CustTypeX],
["#grid#,{id:1,expand:true,loop:50,row_height:1,s_cols:[50,200]}","#FdProdNo+商品代碼",
["代碼","商品名稱"],
[#ProdNo1,#ProdNoX1],
],
]


#FdAdjDate=X,2,L
T(3,*)
#FdTxKind=X,2,L
T(3,*)
#FdCustType=X,2,L
T(3,*)
#FdProdNo=X,2,L
T(3,*)
! Help
<include src="HELPRIM.icf::HELPRIM.rtn"/>

!預設進入畫面不會有商品別，需選擇全部或按商品
INVOKEJS(SHOW,L4721,4,4,0)
##loop{times:50,i:1}
C(4,#ProdNoX{i},INVOKEJS(SHOW,grd1_{i},0),INVOKEJS(SHOW,grd1_{i},1))
##end

![戶別]
#CDDEF01=x,26,S
T(3,CdCode.EntCode2)


#EntCodeHelp=x,1024,S 

![利率種類]
#CDDEF02=x,50,S
T(3,CdCode.TxKind)


#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDDEF01,#CDDEF02)
R(1,XXR99)
CALL(#HelpProc) 
T(2,@EntCodeHelp,#HelpDesc1)
T(2,@BaseRateHelp,#HelpDesc2)  
! T(B,@BaseRateHelp,#HelpDesc2+;98:員工利率;99:自訂利率)  


#BaseRateHelp=x,1024,S 
T(2,0:全部;+#BaseRateHelp)

#CHAIN=A,1,S
T(4,CHAIN$) 

#NTXBUF=X,14,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
! T(1,@FunctionCode,#NTXBUF,1,1)

!會計日期 必須輸入
#DATE=D,8,S
T(4,DATE$)

#DT=D,7,S
T(1,#DATE,2,7)

#sAdjDate=D,7,I
T(2,#DT)
@V(7)A(4,0,#sAdjDate)

#eAdjDate=D,7,I
T(2,#DT)
@V(7)A(4,0,#eAdjDate)
IF(#eAdjDate < #sAdjDate,V(P,不可小於利率調整起日),$)

#TxKind=A,1,I
HELP(#BaseRateHelp)
@V(H,#BaseRateHelp)
IF(#TxKind==0 || #TxKind==5,INVOKEJS(SHOW,L4721,4,4,1),INVOKEJS(SHOW,L4721,4,4,0))
IF(#TxKind==0 || #TxKind==5,INVOKEJS(SHOW,grd1_0,1),INVOKEJS(SHOW,grd1_0,0))


#TxKindX=X,16,L
T(3,)T(H,#TxKind,#BaseRateHelp)

! 戶別
#CustType=A,1,I
E(0,1)
HELP(#EntCodeHelp)
@V(H,#EntCodeHelp)
!HELP(1:個金;2:企金（含企金自然人）)
!@V(1,1,2)     

#CustTypeX=X,30,L
T(3,)T(H,#CustType,#EntCodeHelp)

#RPTFG=A,1,S
E(0,0)


#RimFuncCode=A,1,S
#RimTxCode=X,5,S
#RimProdNo=X,5,S

##loop{times:50,i:1}

#ProdNoX{i}=X,20,L

#ProdNo{i}=X,5,I
IF(#TxKind==0,$,IF(#TxKind==5,$,s))
@C(4,#ProdNo{i},INVOKEJS(SHOW,grd1_{i},0),INVOKEJS(SHOW,grd1_{i},1))
C(4,#ProdNo{i},s,$)
T(2,@RimProdNo,#ProdNo{i})
E(0,@RimFuncCode,5)
T(2,@RimTxCode,#TXCD)
S(L2R01,1,#RimFuncCode,#RimTxCode,#RimProdNo)
R(1,L2R01)
T(2,@ProdNoX{i},#L2r01ProdName)
T(2,@ProdNo{i},#L2r01ProdNo)
##end


<include src="ROM.icf::L2R01.dec"/>

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L4721 -----------
<sub type="FORM" name="L4721">

#SCRPRT=_,_,S
C(5,#TXFORM,L4721,$,S)

#SCRTIL=_,_,S

T(3,[L4721] 整批批次產出利率變動對帳單)

! 筆數(TOTA)
#CntPaper=N,16,L

! 筆數(TOTA)
#CntEmail=N,16,L

! 筆數(TOTA)
#CntMsg=N,16,L

</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#sAdjDate
#eAdjDate
#TxKind
#TxKindX
#CustType

##loop{times:50,i:1}
#ProdNo{i}
##end

#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="HELPRIM.icf::HELPRIM.tom"/>
TXFORM=L4721
^
<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L2R01.tom"/>
</sub>




!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>

</sub>


