!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>


!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L4210" layout="cols=3;screen.width=[150,400,150,300];printer.width=[20,80];order=1">
[
["[L4210]                                 其他還款來源建檔"],
[#<->#,"#FdFunctionCodeX+功能",#FunctionCodeX], 
["#FdAcDate+資料日期+:",#AcDate,"(會計日)"],["#FdBatchNo+整批批號+:",#BatchNo],
["#FdRepayCode+來源+:",#RepayCode,#RepayCodeX],["#FdRepayType+還款類別+:",#RepayType,#RepayTypeX],
["#FdAcNoCode+會科+:",#AcNoCode,#DashA,#AcSubCode,#DashB,#AcDtlCode,#BTNA,#AcNoX,#ReConCode],["#FdRepayAmt+金額+:",#RepayAmt],
[#<->#,"#FdEntryDate+入帳日期",#EntryDate],
[#<->#,"#FdRepayId+來源統編",#RepayId],
[#<->#,"#FdRepayName+來源戶名+:",#RepayName],
[#<->#,"#FdCustNo+借款人戶號+:",#CustNo,"-",#FacmNo],
[#<->#,"#FdCustNm+借款人戶名+:",#CustNm],
[#<->#,"#FdTitaEntdy+會計日期+:",#TitaEntdy],
[#<->#,"#FdTitaTlrNo+經辦+:",#TitaTlrNo],
[#<->#,"#FdTitaTxtNo+交易序號+:",#TitaTxtNo],
[#<->#,"#FdRvNo+銷帳碼+:",#RvNo],
[#<->#,"#FdNote+摘要+:",#Note],
]

#FdFunctionCodeX=X,2,L
#FdAcDate=X,2,L
#FdRepayCode=X,2,L
T(3,*)
#FdAcNoCode=X,2,L
#FdEntryDate=X,2,L
T(3,*)
#FdRepayId=X,2,L
T(3,*)
#FdRepayName=X,2,L
T(3,*)
#FdCustNo=X,2,L
T(3,*)
#FdCustNm=X,2,L
#FdTitaEntdy=X,2,L
#FdTitaTlrNo=X,2,L
#FdTitaTxtNo=X,2,L
#FdRvNo=X,2,L
!T(3,*)
#FdNote=X,2,L
#FdBatchNo=X,2,L
#FdRepayType=X,2,L
T(3,*)
#FdRepayAmt=X,2,L
T(3,*)



#BTNA=X,4,I,ui:button;value:會科查詢;enable:1;tabbable:0

<include src="HELPRIM.icf::HELPRIM.rtn"/>
! 還款類別
#CDDEF01=x,50,S
T(3,CdCode.RepayType)

#RepayTypeHelp=x,1024,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDDEF01)
R(1,XXR99)
CALL(#HelpProc)
T(2,@RepayTypeHelp,#HelpDesc1)

!來源,本交易限05,06,09,11
#RepayCodeHelp=x,60,S
T(3,05:法院扣薪;06:理賠金;09:其他;11:大額匯款手工增入入帳)

!作業項目
#FunctionHelp=x,40,S
T(3,1:新增;2:修改;4:刪除;5:查詢)



#CHAIN=A,1,S
T(4,CHAIN$)
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:L4921進入),$)
! PK = AcDate,BatchNo,DetailSeq

#NTXBUF=X,20,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@FunctionCode,#NTXBUF,1,1)
T(1,@AcDate,#NTXBUF,2,7)
T(1,@BatchNo,#NTXBUF,9,6)
T(1,@DetailSeq,#NTXBUF,15,6)

! 停留註記
#STAYFG=A,1,S
C(3,#FunctionCode,1,E(0,1),E(0,0))
HIDE(#AcNoCode,#DashA,#AcSubCode,#DashB,#AcDtlCode,#BTNA,#AcNoX,#ReConCode)

#DashA=X,1,L
T(2,-)

#DashB=X,1,L
T(2,-)

! 作業項目
#FunctionCode=A,1,S
C(3,#CHAIN,0,E(0,1),$)
C(3,#FunctionCode,1,s,$)
HELP(#FunctionHelp)
@C(3,#CHAIN,0,V(1,1),V(H,#FunctionHelp))

#FunctionCodeX=X,4,L
E(0,@FUNCIND,#FunctionCode)
T(3,)T(H,#FunctionCode,#FunctionHelp)
C(2,#FunctionCode,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),$,K(MODIFYBUTTON,刪除),K(MODIFYBUTTON,查詢))
C(3,#FunctionCode,5,K(NOBUTTON,CLOSEY),$)
!SWITCH(#FunctionCode,1,T(2,新增),
!                   2,T(2,修改),
!                   4,T(2,刪除))

!刪除隱藏重新交易按鈕
#AGAIN=X,1,S
C(3,#FunctionCode,1,S,$)
E(0,1)ASGN(AGAIN$)

#ShowFd=X,1,S
C(2,#FunctionCode,T(3, ),T(3,*),T(3,*),T(3,*),T(3, ),T(3, ))
T(2,@FdRepayCode,#ShowFd)     
T(2,@FdEntryDate,#ShowFd)
T(2,@FdRepayId,#ShowFd)
T(2,@FdRepayName,#ShowFd)
T(2,@FdCustNo,#ShowFd)
!T(2,@FdRvNo,#ShowFd)
T(2,@FdRepayType,#ShowFd)
T(2,@FdRepayAmt,#ShowFd)

!刪除時關閉框線
#WKTF=X,1,S
IF (#FunctionCode==4 || #FunctionCode==5,T(F,@AcDate,0)T(F,@BatchNo,0)T(F,@RepayCode,0)T(F,@RepayType,0)T(F,@RepayAmt,0)
                                         T(F,@EntryDate,0)T(F,@RepayId,0)T(F,@RepayName,0)T(F,@CustNo,0)T(F,@FacmNo,0)
										 T(F,@CustNm,0)T(F,@RvNo,0)T(F,@Note,0)   
										 ,$)
            
! 會計日期
#AcDate=D,7,L
C(3,#FunctionCode,1,$,s)
E(0,#SYSDATE)

<include src="ROM.icf::L4R10.dec"/>

#RimAcDate=X,10,S

#RimTxCode=X,5,S
T(2,L4210)

#RimL4r10=X,1,S
C(3,#FunctionCode,1,$,S)
E(0,@RimAcDate,#AcDate)
RESET_RIM(#RimL4r10,L4R10)
S(L4R10,1,#RimAcDate,#RimTxCode)
R(1,L4R10)
T(2,@BatchNo,#L4r10BatchNo)

![整批批號]
#BatchNo=X,6,L
C(3,#CHAIN,0,$,s)

! 明細序號
#DetailSeq=A,6,S

<include src="ROM.icf::L4R09.dec"/>

! 會計日期
#RimAcDate=_,_,S
! 整批批號
#RimBatchNo=X,6,L
! 明細序號
#RimDetailSeq=A,6,L

! 塞值調rim，無值提error
#RimL4r09=X,1,S
C(3,#FunctionCode,1,s,$)
E(0,@RimAcDate,#AcDate)
T(2,@RimBatchNo,#BatchNo)
E(0,@RimDetailSeq,#DetailSeq)
RESET_RIM(#RimL4r09,L4R09)
S(L4R09,1,#RimAcDate,#RimBatchNo,#RimDetailSeq)
R(1,L4R09)
E(0,@RepayType,#L4r09RepayType)
E(0,@RepayCode,#L4r09RepayCode)
T(1,@AcNoCode,#L4r09AcNo,1,11)
T(1,@AcSubCode,#L4r09AcNo,12,5)
T(1,@AcDtlCode,#L4r09AcNo,17,2)
E(3,@RepayAmt,#L4r09RepayAmt)
T(2,@EntryDate,#L4r09EntryDate)
T(2,@RepayId,#L4r09RepayId)
T(2,@RepayName,#L4r09RepayName)
E(0,@CustNo,#L4r09CustNo)
E(0,@FacmNo,#L4r09FacmNo)
T(2,@CustNm,#L4r09CustNm)
T(2,@RvNo,#L4r09RvNo)
T(2,@Note,#L4r09Note)
E(0,@TitaEntdy,#L4r09TitaEntdy)
T(2,@TitaTlrNo,#L4r09TitaTlrNo)
T(2,@TitaTxtNo,#L4r09TitaTxtNo)

![來源]
#RepayCode=A,2,I
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)
HELP(#RepayCodeHelp)
@V(H,#RepayCodeHelp)


#Check=X,1,S
C(3,#RepayCode,11,
HIDE(#AcNoCode,#DashA,#AcSubCode,#DashB,#AcDtlCode,#BTNA,#AcNoX)SHOW(#ReConCode),
SHOW(#AcNoCode,#DashA,#AcSubCode,#DashB,#AcDtlCode,#BTNA,#AcNoX)HIDE(#ReConCode))
IF(#FunctionCode == 4 || #FunctionCode == 5,T(F,@AcNoCode,0)T(F,@AcSubCode,0)T(F,@AcDtlCode,0)HIDE(#BTNA),$)


#RimRepayCode=A,2,S

<include src="ROM.icf::L6R46.dec"/>
#RimL6r46=X,1,S
E(0,@RimRepayCode,#RepayCode)
RESET_RIM(#RimL6r46,L6R46)
S(L6R46,1,#RimRepayCode)
R(1,L6R46)


#RecevL6r46=X,1,S
C(3,#RepayCode,5,T(2,@ReConCode,)T(2,@AcNoCode,#L6R46AcNoCode)T(2,@AcSubCode,)T(2,@AcNoX,其他應付款-法扣內部憑單),$)
C(3,#RepayCode,6,T(2,@ReConCode,)T(2,@AcNoCode,#L6R46AcNoCode)T(2,@AcSubCode,)T(2,@AcNoX,暫收及待結轉帳項-理賠抵繳房貸),$)
C(3,#RepayCode,11,T(2,@ReConCode,P03)T(2,@AcNoCode,#L6R46AcNoCode)T(2,@AcSubCode,#L6R46AcSubCode)T(2,@AcNoX,),$)

![來源中文]
#RepayCodeX=X,16,L
T(3,)T(H,#RepayCode,#RepayCodeHelp)
!SWITCH(#RepayCode,05,T(3,法院扣薪),
!                 06,T(3,理賠金),
!                 07,T(3,代收款-債權協商),
!                 09,T(3,其他),
!                 11,T(3,匯款轉帳預先作業))

! 還款類別 
#RepayType = A,2,I
C(3,#RepayCode,7,E(0,11),$)
C(3,#RepayCode,7,s,$)
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)
HELP(#RepayTypeHelp)
@V(H,#RepayTypeHelp)

! 還款類別中文
#RepayTypeX = X,10,L
T(3,)T(H,#RepayType,#RepayTypeHelp)
!SWITCH(#RepayType,01,T(3,期款),
!                  02,T(3,部分償還),
!                  03,T(3,結案),
!                  04,T(3,帳管費),
!                  05,T(3,火險費),
!                  06,T(3,契變手續費),
!                  07,T(3,法務費),
!                  09,T(3,其他),
!                  11,T(3,債協匯入款),
!                  T(3, ))

#BUFA=X,1,S
T(2,)
#BINDA=X,1,S
BIND(#BTNA,click, {cmd=CHAIN; ntxcd=L6061; ntxbuf=#BUFA;ntxbuf5=type<-1:
AcNoCode<-OOAcNoCode:
AcSubCode<-OOAcSubCode:
AcDtlCode<-OOAcDtlCode:
AcNoX<-OOAcctItem})



![會科] 來源RepayCode為09-其他需點選會計科目，其他自動帶入 待提供???
#AcNoCode=X,11,I
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)
C(3,#RepayCode,09,$,s)
@C(4,#AcNoCode,V(P,請輸入會計科目),$)
#AcSubCode=X,5,I
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)
C(3,#RepayCode,09,$,s)
#AcDtlCode=X,2,I
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)
C(3,#RepayCode,09,$,s)

#ReConCode=X,3,L

#AcNo=X,18,S
T(2,#AcNoCode+#AcSubCode+#AcDtlCode)

![會科中文]
#AcNoX=X,40,L
C(3,#STAYFG,1,$,s)

![金額]
#RepayAmt=m,14,I
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)
@
C(3,#RepayAmt,0,V(P,請輸入金額),$)
C(4,#AcNoCode,C(4,#ReConCode,V(P,請點選瀏覽選取會計科目),$),$)

<include src="ROM.icf::L4R02.dec"/>
<include src="ROM.icf::L4R19.dec"/>

#RimCustId=X,10,S

#RimCustNo=A,7,S

#ExistFlag=X,1,S

#RimEntryCode=A,1,S

! 入帳日
#EntryDate=D,7,I
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)
C(3,#FunctionCode,1,E(0,@EntryDate,#SYSDATE),$)
@V(7)A(DATE,0,#EntryDate)
IF(#EntryDate<=#AcDate,$,V(P,輸入範圍需<=會計日))

![來源統編]
#RepayId=X,10,I
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)
@V(7)A(ID_UNINO,0,#RepayId)
E(0,@RimEntryCode,1)

#RimL4r02_RepayId=X,1,S
C(4,#RepayId,s,$)
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)
T(2,@RimCustId,#RepayId)
RESET_RIM(#RimL4r02_RepayId,L4R02)
S(L4R02,1,#RimCustId,#RimCustNo,#RimEntryCode)
R(1,L4R02)
T(2,@RepayName,#L4r02CustName)
E(0,@CustNo,#L4r02CustNo)
T(2,@ExistFlag,#L4r02ExistFlag)
C(5,#ExistFlag,N,V(Q,無此客戶資料，請自行輸入),$)


![來源戶名]--調RIM取值,無值自行輸入
#RepayName=c,100,I
C(4,#RepayId,s,$)
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)
! C(4,#RepayName,$,s)
@V(7)

![借款人戶號]
#CustNo=A,7,I
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)
@E(0,@RimEntryCode,2)
V(2,0)

#RimL4r19_CustNo=X,1,S
C(3,#CustNo,0,s,$)
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)
IF(#RepayCode==5||#RepayCode==6,$,s)
E(0,@RimCustNo,#CustNo)
T(2,@RimCustId,#RepayId)
RESET_RIM(#RimL4r19_CustNo,L4R19)
S(L4R19,1,#RimCustId,#RimCustNo)
R(1,L4R19)
E(0,@CheckCode,#L4r19CheckCode)

#CheckCode=A,1,S
IF(#RepayCode==5||#RepayCode==6,$,s)
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)
C(3,#CheckCode,0,V(P,來源統編需為借款人本人或保證人),$)

#RimL4r02_CustNo=X,1,S
C(4,#CustNo,s,$)
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)
E(0,@RimCustNo,#CustNo)
RESET_RIM(#RimL4r02_CustNo,L4R02)
S(L4R02,1,#RimCustId,#RimCustNo,#RimEntryCode)
R(1,L4R02)
T(2,@CustNm,#L4r02CustName)

![借款人戶名]--調RIM取值
#CustNm=x,100,L
C(3,#STAYFG,1,$,s)

#TitaEntdy=D,7,L
#TitaTlrNo=X,6,L
#TitaTxtNo=X,8,L

#FacmNo=A,3,I
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)

![銷帳碼]
#RvNo=x,12,I
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)
@
IF(#RepayCode==5 || #RepayCode==6,C(4,#RvNo,V(P,請輸入銷帳碼),$),s)
! C(3,#RepayCode,6,C(4,#RvNo,V(P,請輸入理賠日期及保單號碼),$),s)

![摘要]
#Note=x,100,I
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)
@C(3,#RepayCode,9,V(7),$)

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>


!------ 上行電文 TEXT ------
<sub type="TIM">
#FunctionCode
#AcDate
#BatchNo
#DetailSeq
#RepayCode
#RepayType
#AcNoCode
#AcSubCode
#AcDtlCode
#RepayAmt
#RepayId
#RepayName
#CustNo
#FacmNo
#CustNm
#RvNo
#Note
#EntryDate
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
TXFORM=L4210
^
<include src="ROM.icf::L4R02.tom"/>
<include src="ROM.icf::L4R09.tom"/>
<include src="ROM.icf::L4R10.tom"/>
<include src="ROM.icf::L4R19.tom"/>
<include src="ROM.icf::L6R46.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>


!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
</sub>
