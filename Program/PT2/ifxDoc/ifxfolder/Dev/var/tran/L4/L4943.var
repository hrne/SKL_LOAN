!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L4943)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,42)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,387)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,40)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)

#button=x,100,S
T(2,{cmd=CHAIN; ntxcd=L4451; ntxbuf=1; ntxbuf5=type})ASGN(BTN_NEW1$)
K(MODIFYBUTTON,1,新增扣款資料)
K(MODIFYBUTTON,查詢)

</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L4943" layout="cols=1;screen.width=[180,820];printer.width=[20,80];order=1">
[
["[L4943]@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@銀行扣款檔資料查詢"],
["#FdFunctionCode+查詢選項",#FunctionCode,#FunctionCodeX],
["#FdCustNo+戶號",#CustNo],
["#FdBankCode+銀行別",#BankCode,#BankCodeX],
["#FdRepayType+還款類別",#RepayType,#RepayTypeX],
["#FdEntryDateFm+入帳日期",#EntryDateFm,"~",#EntryDateTo],
["#FdOpItem+作業項目",#OpItem,#OpItemX],
["#FdPostLimitAmt+郵局同戶超過限額",#PostLimitAmt,"@@0為全部"],
["#FdSingleLimit+單筆超過限額",#SingleLimit,"@@0為全部"],
["#FdLowLimit+單筆低於金額",#LowLimit],
["#FdEntryDate+入帳日期",#EntryDate],
]
! 銀行別[瀏覽]
! #BTNA=X,1,I,ui:button;value:行庫資料查詢;enable:1;tabbable:0

#FdFunctionCode=X,2,L
T(3,*)
#FdCustNo=X,2,L
T(3,*)
#FdBankCode=X,2,L
T(3,*)
#FdRepayType=X,2,L
T(3,*)
#FdEntryDateFm=X,2,L
T(3,*)
#FdOpItem=X,2,L
T(3,*)
#FdPostLimitAmt=X,2,L
#FdSingleLimit=X,2,L
#FdLowLimit=X,2,L
T(3,*)
#FdEntryDate=X,2,L
T(3,*)

#OpItemHelp=x,40,S
T(3,1:ACH扣款;2:郵局扣款;9:全部)

! Help
<include src="HELPRIM.icf::HELPRIM.rtn"/>

! 銀行下拉選單
#BankDeductCdRimName=x,50,S
T(3,CdCode.BankDeductCd)

#BankDeductCdHelp=x,1024,S

#RimHelpRepayType=x,30,S
T(3,CdCode.RepayType)

#RepayTypeHelp=x,1024,S

#RimHelpAmlRsp=x,30,S
T(3,CdCode.AmlCheckItem)

#AmlRspHelp=x,1024,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#BankDeductCdRimName,#RimHelpRepayType,#RimHelpAmlRsp)
R(1,XXR99)
CALL(#HelpProc)
T(2,@BankDeductCdHelp,#HelpDesc1)
T(B,@RepayTypeHelp,#HelpDesc2+;99:全部)
T(B,@AmlRspHelp,#HelpDesc3)

#FunctionHelp=x,140,S
T(3,01:戶號;02:上限金額;03:下限金額;04:檢核不正常;05:扣款金額為0;06:媒體檔總金額;07:已到期未至應繳日;09:整批;10:入帳後溢短收;11:入帳後有費用未收)

#CHAIN=A,1,S
T(4,CHAIN$) 

#NTXBUF=x,71,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@FunctionCode,#NTXBUF,1,2)
T(1,@CustNo,#NTXBUF,3,7)
T(1,@BankCode,#NTXBUF,10,3)
T(1,@RepayType,#NTXBUF,13,2)
T(1,@EntryDateFm,#NTXBUF,15,7)
T(1,@EntryDateTo,#NTXBUF,22,7)
T(1,@PostLimitAmt,#NTXBUF,29,14)
T(1,@SingleLimit,#NTXBUF,43,14)
T(1,@LowLimit,#NTXBUF,57,14)

! 功能-預設 9.整批
! 1.戶號 = 戶號+入帳日
! 2.上限金額 = 入帳日+限額
! 3.下限金額 = 入帳日+限額
! 4.檢核不正常(Aml) = 入帳日+銀行別
! 9.整批 = 銀行別+還款別+入帳日
!10.入帳後溢短收
#FunctionCode=A,2,I
INVOKEJS(SHOW,L4943,2,10,0)
C(3,#CHAIN,1,s,$)
HELP(#FunctionHelp)
@V(H,#FunctionHelp)
!HELP(
!1:戶號;
!2:上限金額;
!3:下限金額;
!4:檢核不正常;
!9:整批;
!10:入帳後溢短收)
!@V(1,1,2,3,4,9,10)
E(0,@FUNCIND,5)

#FunctionCodeX=x,30,L
C(3,#CHAIN,1,s,$)
T(3,)T(H,#FunctionCode,#FunctionHelp)
!SWITCH(#FunctionCode
!,1,T(2,戶號)
!,2,T(2,上限金額)
!,3,T(2,下限金額)
!,4,T(2,檢核不正常)
!,9,T(2,整批)
!,10,T(2,入帳後溢短收))

#ColValue=A,1,S
T(2,@BankCode,999)
E(0,@RepayType,99)
C(3,#FunctionCode,1,
INVOKEJS(SHOW,L4943_2,1)
INVOKEJS(SHOW,L4943_5,1),$)
C(3,#FunctionCode,2,
E(0,@PostLimitAmt,500000)
E(0,@SingleLimit,100000)
INVOKEJS(SHOW,L4943_5,1)
INVOKEJS(SHOW,L4943_6,1)
INVOKEJS(SHOW,L4943_7,1)
INVOKEJS(SHOW,L4943_8,1),$)
C(3,#FunctionCode,3,
E(0,@LowLimit,500)
INVOKEJS(SHOW,L4943_5,1)
INVOKEJS(SHOW,L4943_6,1)
INVOKEJS(SHOW,L4943_9,1),$)
C(3,#FunctionCode,4,
INVOKEJS(SHOW,L4943_3,1)
INVOKEJS(SHOW,L4943_5,1),$)
C(3,#FunctionCode,5,
INVOKEJS(SHOW,L4943_3,1)
INVOKEJS(SHOW,L4943_4,1)
INVOKEJS(SHOW,L4943_5,1),$)
C(3,#FunctionCode,6,
INVOKEJS(SHOW,L4943_3,1)
INVOKEJS(SHOW,L4943_4,1)
INVOKEJS(SHOW,L4943_5,1),$)
C(3,#FunctionCode,7,
INVOKEJS(SHOW,L4943_3,1)
INVOKEJS(SHOW,L4943_10,1),$)
C(3,#FunctionCode,9,
INVOKEJS(SHOW,L4943_3,1)
INVOKEJS(SHOW,L4943_4,1)
INVOKEJS(SHOW,L4943_5,1),$)
C(3,#FunctionCode,10,
INVOKEJS(SHOW,L4943_3,1)
INVOKEJS(SHOW,L4943_4,1)
INVOKEJS(SHOW,L4943_5,1),$)
C(3,#FunctionCode,11,
INVOKEJS(SHOW,L4943_3,1)
INVOKEJS(SHOW,L4943_4,1)
INVOKEJS(SHOW,L4943_5,1),$)

! 戶號
#CustNo=A,7,I
C(3,#CHAIN,1,s,$)
C(3,#FunctionCode,1,$,s)
@C(3,#CustNo,0,V(P,請輸入戶號),$)

#MRKEY=_,_,S
C(3,#CustNo,0,S,T(2,#CustNo))

#BUF_A=x,38,S
T(2,)

! #BIND_A=X,1,S
! BIND(#BTNA,click, {cmd=CHAIN; ntxcd=L6071; ntxbuf=#BUF_A;ntxbuf5=type<-1:
! BankCode<-OOBankCode:
! BankCodeX<-OOItem})

! 銀行別
#BankCode=A,3,I
C(3,#CHAIN,1,s,$)
IF(#FunctionCode==4 || #FunctionCode==5 || #FunctionCode==6 || #FunctionCode==7 || #FunctionCode==9 || #FunctionCode==10|| #FunctionCode==11,$,s)
HELP(#BankDeductCdHelp,cols:4)
@V(H,#BankDeductCdHelp)

#BankCodeX=x,40,L
T(H,#BankCode,#BankDeductCdHelp)

#RepayTypeHelp1=x,1024,S
T(HELP,@RepayTypeHelp1,#RepayTypeHelp,+,01;05;99)

! 還款類別
#RepayType=A,2,I
C(3,#CHAIN,1,s,$)
IF(#FunctionCode==5 || #FunctionCode==6 || #FunctionCode==9 || #FunctionCode==10|| #FunctionCode==11,$,s)
IF(#FunctionCode==6,HELP(#RepayTypeHelp1),HELP(#RepayTypeHelp))
@IF(#FunctionCode==6,V(H,#RepayTypeHelp1),V(H,#RepayTypeHelp))

#RepayTypeX=x,10,L
IF(#FunctionCode==5 || #FunctionCode==6 || #FunctionCode==9 || #FunctionCode==10|| #FunctionCode==11,$,s)
IF(#FunctionCode==6,T(H,#RepayType,#RepayTypeHelp1),T(H,#RepayType,#RepayTypeHelp))


! 入帳日期
#EntryDateFm=D,7,I
C(3,#CHAIN,1,s,$)
C(3,#CHAIN,1,$,E(0,#SYSDATE))
C(3,#FunctionCode,7,s,$)
@
V(7)A(DATE,0,#EntryDateFm)

! 入帳日期
#EntryDateTo=D,7,I
E(0,#EntryDateFm)
C(3,#CHAIN,1,s,$)
C(3,#FunctionCode,7,s,$)
@V(7)A(DATE,0,#EntryDateTo)
IF(#EntryDateTo<#EntryDateFm,V(P,起日不可大於迄日),$)

#OpItem=A,1,I
C(3,#CHAIN,1,s,$)
IF(#FunctionCode == 2 || #FunctionCode == 3 ,$,S)
HELP(#OpItemHelp)
@V(H,#OpItemHelp)

#OpItemX=X,10,L
T(3,)T(H,#OpItem,#OpItemHelp)

! 郵局同戶超過限額
#PostLimitAmt=m,14,I
C(3,#FunctionCode,2,$,s)

! 單筆超過限額
#SingleLimit=m,14,I
C(3,#CHAIN,1,s,$)
C(3,#FunctionCode,2,$,s)

#LowLimit=m,14,I
C(3,#FunctionCode,3,$,s)
@V(2,0)

! 入帳日期
#EntryDate=D,7,I
C(3,#CHAIN,1,s,$)
C(3,#CHAIN,1,$,E(0,#SYSDATE))
C(3,#FunctionCode,7,$,s)
@
V(7)A(DATE,0,#EntryDate)


#RPTFG=A,1,S

#CHAINXMT=X,1,S
C(3,#CHAIN,1,E(0,@CHAIN,0)XMT(),$)

#CHECKFunction=A,1,S
C(3,#FunctionCode,6,E(0,@RPTFG,1),E(0,@RPTFG,0))
C(3,#FunctionCode,7,E(0,@RPTFG,7),$)
C(3,#FunctionCode,10,E(0,@RPTFG,2),$)
C(3,#FunctionCode,11,E(0,@RPTFG,2),$)
</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L4943 -----------
<sub type="FORM" name="L4943">
#SCRTIL=_,_,S
T(3,[L4943] 銀行扣款檔資料)

#OTotalUnpaidAmt=m,14,O
#OTotalTempAmt=m,14,O
#OTotalRepayAmt=m,14,O

#LOOP=X,1,S
E(0,1)ASGN(LOOP$)

! 入帳日期
#OOEntryDate=D,7,O
! 戶號　
#OOCustNo=A,7,O
! 額度
#OOFacmNo=A,3,O
! 繳息迄日
#OOPrevIntDate=D,7,O
! 應繳日
#OOPayIntDate=D,7,O
! 還款類別 
#OORepayType=A,2,O 
! 還款類別中文
#OORepayTypeX=X,50,O
T(H,#OORepayType,#RepayTypeHelp)
! SWITCH(#OORepayType,01,T(3,期款),
!                     02,T(3,部分償還),
!                     03,T(3,結案),
!                     04,T(3,帳管費),
!                     05,T(3,火險費),
!                     06,T(3,契變手續費),
!                     07,T(3,法務費),
!                     09,T(3,其他),
!                     T(3, ))

! 應扣金額
#OOUnpaidAmt=m,14,O 
! 暫收抵繳金額
#OOTempAmt=m,14,O 
! 扣款金額
#OORepayAmt=m,14,O 

#OOUnpaidAmtX=X,20,O 
X(#OOUnpaidAmt)

#OOTempAmtX=X,20,O
X(#OOTempAmt)

!溢短收
#OOOverShort=m,14,O

!回應代碼
#OReturnCode=X,2,O

! 會計日期
#OOAcDate=D,7,O
#OOAcDateA=A,3,O
T(1,#OOAcDate,1,3)
#OOAcDateB=A,2,O
T(1,#OOAcDate,4,2)
#OOAcDateC=A,2,O
T(1,#OOAcDate,6,2)
#OOAcDateX=X,9,O
IF(#OOAcDate=="0000000",T(2,),T(2,#OOAcDateA+/+#OOAcDateB+/+#OOAcDateC))

! 整批入帳後回寫會計日，已入帳者不可修改、刪除
! <修改> 6+7+7+3+7+1+16+7=54
#OOBUF_A=X,390,S
T(2,2+#OOEntryDate+#OOCustNo+#OOFacmNo+#OOPrevIntDate+#OOPayIntDate+#OORepayType+#OOAcDate+#OOUnpaidAmtX+#OOTempAmtX+#OOProcNote)
#OOBTN_A=A,2,O
C(3,#FunctionCode,7,BIND(grid,cancel),$)
C(3,#FunctionCode,7,s,$)
IF(#OOAcDate=="0000000"&&#OReturnCode=="",BIND(grid,{ cmd=CHAIN; ntxcd=L4451; ntxbuf=#OOBUF_A}),BIND(grid,cancel))



! <刪除> 6+7+7+3+7+1+16+7=54
#OOBUF_B=X,390,S
T(2,4+#OOEntryDate+#OOCustNo+#OOFacmNo+#OOPrevIntDate+#OOPayIntDate+#OORepayType+#OOAcDate+#OOUnpaidAmtX+#OOTempAmtX+#OOProcNote)
#OOBTN_B=A,2,O
C(3,#FunctionCode,7,BIND(grid,cancel),$)
C(3,#FunctionCode,7,s,$)
IF(#OOAcDate=="0000000"&&#OReturnCode=="",BIND(grid,{ cmd=CHAIN; ntxcd=L4451; ntxbuf=#OOBUF_B}),BIND(grid,cancel))



! <查詢> 6+7+7+3+7+1+16+7=54
#OOBUF_C=X,390,S
T(2,5+#OOEntryDate+#OOCustNo+#OOFacmNo+#OOPrevIntDate+#OOPayIntDate+#OORepayType+#OOAcDate+#OOUnpaidAmtX+#OOTempAmtX+#OOProcNote)

#OOBTN_C=A,2,O
!C(3,#FunctionCode,7,BIND(grid,cancel),$)
!C(3,#FunctionCode,7,s,$)
!IF(#OOAcDate!="0000000",BIND(grid,{ cmd=CHAIN; ntxcd=L4451; ntxbuf=#OOBUF_C}),BIND(grid,cancel))
BIND(grid,{ cmd=CHAIN; ntxcd=L4451; ntxbuf=#OOBUF_C})

! <交易>
#OOBUF_D=X,390,S
T(2,#TXCD+#OOCustNo+#OOFacmNo+000+#OOEntryDate)
#OOBTN_D=A,2,O
IF(#FunctionCode==10||#FunctionCode==11,BIND(grid, {cmd=CHAIN; ntxcd=L3005; ntxbuf=#OOBUF_D}),BIND(grid,cancel))
! C(3,#FunctionCode,10,BIND(grid, {cmd=CHAIN; ntxcd=L3005; ntxbuf=#OOBUF_D}),BIND(grid,cancel))
!C(3,#FunctionCode,10,BIND(grid, {cmd=CHAIN; ntxcd=L3005; ntxbuf=#OOBUF_D;ntxbuf5=type<-1:CustNo<-OOCustNo:FacmNo<-OOFacmNo:EntryDate<-OOEntryDate}),BIND(grid,cancel))

#OOMediaCode=X,1,O

#OOAmlRsp=x,1,S

! 0.非可疑名單/已完成名單確認 1.需審查/確認 2.為凍結名單/未確定名單
#OOAmlRspX=x,30,O
T(3,)T(H,#OOAmlRsp,#AmlRspHelp)
!SWITCH(#OOAmlRsp
!,0,T(2,非可疑名單/已完成名單確認)
!,1,T(2,需審查/確認)
!,2,T(2,為凍結名單/未確定名單),T(2,))

#OOProcNote=x,300,O

</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#FunctionCode
#CustNo
#BankCode
#RepayType
#EntryDateFm
#EntryDateTo
#PostLimitAmt
#SingleLimit
#LowLimit
#OpItem
#EntryDate
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
TXFORM=L4943
#OTotalUnpaidAmt
#OTotalTempAmt
#OTotalRepayAmt
#OOEntryDate
#OOCustNo
#OOFacmNo
#OOPrevIntDate
#OOPayIntDate
#OORepayType
#OOUnpaidAmt
#OOTempAmt
#OORepayAmt
#OOMediaCode
#OOAcDate
#OOAmlRsp
#OOProcNote
#OOOverShort
#OReturnCode
^
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>

!---------- 單據輸出組合 ----------
<sub type="PART" prompt='{{#SCRTIL}} world' name="L4943" layout="cols=3;screen.width=[200,300,100,400];order=1;">
[
["[L4943]@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@銀行扣款檔資料查詢@@@@"],
[""],
[#<->#,"@應扣金額合計",#OTotalUnpaidAmt],
[#<->#,"@暫收抵繳金額合計",#OTotalTempAmt],
[#<->#,"@扣款金額合計",#OTotalRepayAmt],
]
</sub>

!---------- 單據輸出組合 ----------
<sub type="PART" prompt='{{#SCRTIL}} world' name="L4943_7" layout="cols=3;screen.width=[200,300,100,400];order=1;">
[
["[L4943]@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@銀行扣款檔資料查詢@@@@"],
[""],
]
</sub>

<sub type="SELECT">

#RPTFG=0,QUERY.GRID,L4943
#any={detail:true, header:'L4943.part', caption:'', rowNum:20, rowList:[20,40,60]}
#OOBTN_D=交易
{search:false,formatter:'cust:bind-button:交易',align:'center',canExport:false,width:35}
#OOBTN_A=修改
{search:false,formatter:'cust:bind-button:修改',align:'center',canExport:false,width:35}
#OOBTN_B=刪除
{search:false,formatter:'cust:bind-button:刪除',align:'center',canExport:false,width:35}
#OOBTN_C=查詢
{search:false,formatter:'cust:bind-button:查詢',align:'center',canExport:false,width:35}
#OOEntryDate=入帳日期
{width:95}
#OOCustNo=戶號　
{width:95}
#OOFacmNo=額度
{width:95}
#OOPrevIntDate=繳息迄日
{width:95}
#OOPayIntDate=應繳日
{width:95}
#OORepayTypeX=還款類別
{width:95}
#OOUnpaidAmt=應扣金額
{width:95,sum:true}
#OOTempAmt=暫收抵繳金額
{width:125,sum:true}
#OORepayAmt=扣款金額
{width:95,sum:true}
#OOMediaCode=媒體碼
{width:80}
#OOAcDateX=會計日期
{width:95}
#OOProcNote=檢核結果
{width:150}
^

#RPTFG=1,QUERY.GRID,L4943
#any={detail:false, header:'L4943.part', caption:'', rowNum:20, rowList:[20,40,60]}
^

#RPTFG=2,QUERY.GRID,L4943
#any={detail:true, header:'L4943.part', caption:'', rowNum:20, rowList:[20,40,60]}
#OOBTN_D=交易
{search:false,formatter:'cust:bind-button:交易',align:'center',canExport:false,width:35}
#OOBTN_A=修改
{search:false,formatter:'cust:bind-button:修改',align:'center',canExport:false,width:35}
#OOBTN_B=刪除
{search:false,formatter:'cust:bind-button:刪除',align:'center',canExport:false,width:35}
#OOBTN_C=查詢
{search:false,formatter:'cust:bind-button:查詢',align:'center',canExport:false,width:35}
#OOEntryDate=入帳日期
{width:95}
#OOCustNo=戶號　
{width:95}
#OOFacmNo=額度
{width:95}
#OOPrevIntDate=繳息迄日
{width:95}
#OOPayIntDate=應繳日
{width:95}
#OORepayTypeX=還款類別
{width:95}
#OORepayAmt=扣款金額
{width:95,sum:true}
#OOTempAmt=暫收抵繳金額
{width:125,sum:true}
#OOOverShort=溢短收
{width:95,sum:true}
#OOMediaCode=媒體碼
{width:80}
#OOAcDateX=會計日期
{width:95}
#OOProcNote=檢核結果
{width:150}
^

#RPTFG=7,QUERY.GRID,L4943
#any={detail:true, header:'L4943_7.part', caption:'', rowNum:20, rowList:[20,40,60]}

#OOCustNo=戶號　
{width:95}
#OOFacmNo=額度
{width:95}
#OOPrevIntDate=到期日
{width:95}
#OOPayIntDate=應繳日
{width:95}
#OOUnpaidAmt=放款餘額
{width:95,sum:true}
#OOProcNote=檢核結果
{width:300}
^

<include src="PRT.icf::INQ04.sel" map="i=L4943;cpi=15"/>
#CustNo
#EntryDateFm
#EntryDateTo
#PostLimitAmt
#SingleLimit
%
#OOEntryDate#OOCustNo#OOFacmNo#OOPrevIntDate
#OORepayType#OORepayAmt#OOMediaCode#OOAcDate
@^
</sub>
