----- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

!#TXCD
!T(3,L2418)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,27)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,75)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,20)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD2.dec"/>
</sub>

<sub type="PREDC" name="PreDC">

!先隱藏欄位 FLAG 0=隱藏 1=顯示
#HIDE1FG=A,1,S
IF(#FKEY==0,E(0,0),$)



!--- P1 主要戶號額度
#HIDEP1=@,1,S
C(3,#HIDE1FG,1,E(0,@HIDE1FG,0),E(0,@HIDE1FG,1))
INVOKEJS(SHOW,p2,#HIDE1FG)
C(3,#HIDE1FG,1,$,s)
CALL(#CALLGRID)



!--- 控制grd顯示欄位
#CALLGRID=@,1,S
##loop{times:10,n:1}
IF(#ApplNo{n}==0,INVOKEJS(SHOW,grd1_{n},0),INVOKEJS(SHOW,grd1_{n},1))
##end
INVOKEJS(SHOW,grd1_1,1)


</sub>
!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=1;screen.width=[200,850];printer.width=[15,30]">
[
["[L2418]                                 擔保品他項權利登錄"],
["#FdFunCd+功能",#FunCdX],
!["#FdCustNo+戶號",#CustNo,#BTN1,#CustNoX],
["#FdClMain+擔保品查詢",#BTN1],
["#FdClCode1+擔保品代號1",#ClCode1,#ClCode1X],
["#FdClCode2+擔保品代號2",#ClCode2,#ClCode2X],
["#FdClNo+擔保品編號",#ClNo,#Other],
["#FdSeq+序號",#ClSeq,#SeqForm,#cntmsg],
["#FdCity+縣市",#City,#CityX,#InCityX],
["#FdLandAdm+地政",#LandAdm,#LandAdmX,#InLandAdmX],
["#FdRecYear+收件年",#RecYear],
["#FdRecWord+收件字",#RecWord,#RecWordX,#InRecWordX],
["#FdRecNumber+收件號",#RecNumber],
["#FdRightsNote+權利價值說明",#RightsNote,#RightsNoteX],
["#FdSecuredTotal+擔保債權總金額",#TwSecuredTotal,#UsSecuredTotal,"@萬元"],
["#FdSecuredDate+擔保債權確定日期",#SecuredDate],
["#FdLocation+建物坐落地號",#Location],
]
!---------- AP Button AREA ----------
![Buttom資料查詢]
#BTN1=X,15,I,ui:button;value:擔保品查詢;enable:1;tabbable:0;title:L2038 擔保品明細資料查詢;
!---------- AP TEXT AREA Variables ----------
#SetSysPar=X,1,S
E(0,1)ASGN(AGAIN$)


#init=X,1,S
INVOKEJS(SHOW,grd1,2,10,0)

!#CDDEF01=x,20,S
!T(3,CdCode.ClCode1)

#ClCode1Help=X,1024,S
T(3,1:房地;2:土地)

!#HelpRim=X,1,S
!RESET_RIM(#HelpRim,XXR99)
!R(1,XXR99)
!CALL(#HelpProc)
!T(2,@ClCode1Help,#HelpDesc1)

!FuncCode
#FuncCodeHelp=x,30,S
T(3,1:新增;2:修改;4:刪除;5:查詢)

!調RIM參數
#RimCityCode=X,4,S
#RimAreaCode=X,3,S
#RimApproveNo=A,7,S


! 縣市代碼的下拉選單
#L6r03ResultCity=x,50000,S
T(2,:自行輸入)

! 權利價值說明下拉選單
#CDDEF001=x,50,S
T(3,CdCode.ClRightsNote)

#ClRightsNoteHelp=x,1024,S

! 他項權利縣市別
#CDDEF002=x,50,S
T(3,CdCode.ClOtherRightsCityCd)

#ClOtherRightsCityHelp=x,1024,S


#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDDEF001,#CDDEF002)
R(1,XXR99)
CALL(#HelpProc)
T(2,@ClRightsNoteHelp,#HelpDesc1)
T(2,@ClOtherRightsCityHelp,#HelpDesc2)
T(B,@L6r03ResultCity,#L6r03ResultCity+;+#ClOtherRightsCityHelp)

#CHAIN=A,1,S
T(4,CHAIN$)
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:[L2918擔保品他項權利查詢]進入),$)
T(2,@RimTxCode,#TXCD)

!序號ClSeq原7碼拆為4+-+3碼,長度共8位
#NTXBUF=X,200,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@FunCd,#NTXBUF,1,1)
E(0,@FUNCIND,#FunCd)
T(1,@ClCode1,#NTXBUF,2,1)
T(1,@ClCode2,#NTXBUF,3,2)
T(1,@ClNo,#NTXBUF,5,7)
T(1,@ClSeq,#NTXBUF,12,8)


!    L2R46 : 依擔保品編號取他項權利資料
#RimL2r46A=X,1,S
C(3,#FunCd,1,S,$)
E(0,@RimClCode1,#ClCode1)
E(0,@RimClCode2,#ClCode2)
E(0,@RimClNo,#ClNo)
T(2,@RimClSeq,#ClSeq)
RESET_RIM(#RimL2r46A,L2R46)
S(L2R46,1,#RimClCode1,#RimClCode2,#RimClNo,#RimClSeq)
R(1,L2R46)
T(2,@City,#L2r46City)
T(H,@CityX,#City,#L6r03ResultCity)
C(4,#L2r46OtherCity,$,SHOW(#InCityX))
T(2,@InCityX,#L2r46OtherCity)
T(2,@LandAdm,#L2r46LandAdm)
C(4,#L2r46OtherLandAdm,$,SHOW(#InLandAdmX))
T(2,@InLandAdmX,#L2r46OtherLandAdm)
E(0,@RecYear,#L2r46RecYear)
T(2,@RecWord,#L2r46RecWord)
C(4,#L2r46OtherRecWord,$,SHOW(#InRecWordX))
T(2,@InRecWordX,#L2r46OtherRecWord)
T(2,@RecNumber,#L2r46RecNumber)
T(2,@RightsNote,#L2r46RightsNote)
E(0,@TwSecuredTotal,#L2r46SecuredTotal)
E(0,@UsSecuredTotal,#L2r46SecuredTotal)
E(0,@SecuredDate,#L2r46SecuredDate)
T(2,@Location,#L2r46Location)
##loop {times:10,i:1}
T(2,@ApplNo{i},#L2r46ApplNo{i})
##end


##loop {times:10,n:1}
#L2r05B{n}=X,1,S
IF(#FKEY==0 || #FKEY==7,$,s)
C(3,#ApplNo{n},0,S,$)
E(0,@RimFuncCode,5)
E(0,@RimCustNo,0)
E(0,@RimFacmNo,0)
E(0,@RimApplNo,#ApplNo{n})
E(0,@RimCaseNo,0)
S(L2R05,1,#RimFuncCode,#RimTxCode,#RimFKey,#RimCustNo,#RimFacmNo,#RimApplNo,#RimCaseNo)
R(1,L2R05)

#SendL2r02B{n}=X,1,S
IF(#FKEY==0 || #FKEY==7,$,s)
C(3,#ApplNo{n},0,S,$)
E(0,@RimApplNo,#ApplNo{n})
E(0,@RimFuncCode,5)
T(2,@RimCustId,)
S(L2R02,1,#RimFuncCode,#RimTxCode,#RimFKey,#RimApplNo,#RimCustId)
R(1,L2R02)

#L2r07B{n}=X,1,S
IF(#FKEY==0 || #FKEY==7,$,s)
C(3,#ApplNo{n},0,S,$)
T(2,@RimCustId,#L2r02CustId)
E(0,@RimCustNo,0)
S(L2R07,1,#RimTxCode,#RimCustId,#RimCustNo)
R(1,L2R07)
C(3,#ApplNo{n},0,S,$)
E(0,@CustNo{n},#L2r05CustNo)
E(0,@FacmNo{n},#L2r05FacmNo)
T(2,@CustName{n},#L2r07CustName)
T(2,@CustNameS{n},#CustName{n})
C(3,#L2r05CustNo,0,$,T(2,@CustFacmNo{n},#L2r05CustNo+-+#L2r05FacmNo))
##end


! 依縣市別組地政下拉選單
#RimL6r49CityA=X,1,S
E(0,@RimFunCd,2)
T(2,@RimCityCode,#City)
RESET_RIM(#RimL6r49CityA,L6R49)
S(L6R49,1,#RimFunCd,#RimCityCode)
R(1,L6R49)
C(4,#L6r49Result,T(2,@LoanOfficeHelp,:自行輸入),T(2,@LoanOfficeHelp,:自行輸入;+#L6r49Result))
T(H,@LandAdmX,#LandAdm,#LoanOfficeHelp)




! 依縣市別地政組收件字下拉選單
#RimL2r60A=X,1,S
C(3,#FunCd,1,S,$)
T(2,@RimCityCode,#City)
T(2,@RimLandOfficeCode,#LandAdm)
RESET_RIM(#RimL2r60A,L2R60)
S(L2R60,1,#RimCityCode,#RimLandOfficeCode)
R(1,L2R60)
T(2,@RecWordHelp,:自行輸入;+#L2r60Help1)
C(4,#L2r60Help1,T(3,@RecWordHelp,:自行輸入),$)
T(H,@RecWordX,#RecWord,#RecWordHelp)



#Precision=N,1,S

#Init=X,1,S
HIDE(#UsSecuredTotal)
HIDE(#InCityX,#InLandAdmX,#InRecWordX)
T(2,@FdClCode1,*)
T(2,@FdClCode2,*)
T(2,@FdClNo,*)
T(2,@FdSeq,*)
T(2,@FdCity,*)
T(2,@FdLandAdm,*)
T(2,@FdRecYear,*)
T(2,@FdRecWord,*)
T(2,@FdRecNumber,*)
T(2,@FdRightsNote,)
T(2,@FdSecuredTotal,*)
T(F,@CityX,0)
T(F,@LandAdmX,0)
T(2,@FdSecuredDate,*)


#FdFunCd=X,2,L
#FdClCode1=X,2,L
#FdClCode2=X,2,L
#FdClNo=X,2,L
#FdSeq=X,2,L
#FdCity=X,2,L
#FdLandAdm=X,2,L
#FdRecYear=X,2,L
#FdRecWord=X,2,L
#FdRecNumber=X,2,L
#FdRightsNote=X,2,L
#FdSecuredTotal=X,2,L
#FdSecuredDate=X,2,L
#FdLocation=X,2,L

#FunCd=A,1,S

#FunCdX=X,10,L
E(0,@FUNCIND,#FunCd)
C(3,#FunCd,1,INVOKEJS(SHOW,p1_2,1),INVOKEJS(SHOW,p1_2,0))
T(H,#FunCd,#FuncCodeHelp)
C(2,#FunCd,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),K(MODIFYBUTTON,新增),K(MODIFYBUTTON,刪除),K(MODIFYBUTTON,查詢)K(NOBUTTON,CLOSEY))
CALL(#HIDEP1)

#checkFunCd=X,1,S
C(3,#CHAIN,1,C(3,#FunCd,1,S,$),S)
T(F,@ClCode1,0)
T(F,@ClCode2,0)
T(F,@ClNo,0)
T(F,@ClSeq,0)
T(2,@FdClCode1,)
T(2,@FdClCode2,)
T(2,@FdClNo,)
T(2,@FdSeq,)
IF(#FunCd>=4,$,S)
T(F,@City,0)
T(F,@InCityX,0)
T(F,@LandAdm,0)
T(F,@InLandAdmX,0)
T(F,@RecYear,0)
T(F,@RecWord,0)
T(F,@InRecWordX,0)
T(F,@RecNumber,0)
T(F,@RightsNote,0)
T(F,@TwSecuredTotal,0)
T(F,@UsSecuredTotal,0)
T(F,@SecuredDate,0)
T(F,@Location,0)
##loop{times:10,n:1}
T(F,#ApplNo{n},0)
##end
T(2,@FdClCode1,)
T(2,@FdClCode2,)
T(2,@FdClNo,)
T(2,@FdSeq,)
T(2,@FdCity,)
T(2,@FdLandAdm,)
T(2,@FdRecYear,)
T(2,@FdRecWord,)
T(2,@FdRecNumber,)
T(2,@FdRightsNote,)
T(2,@FdSecuredTotal,)
T(2,@FdSecuredDate,)


!日曆日
#CDATE=D,8,S
T(4,CDATE$)
#CDATEX=D,7,S
T(1,#CDATE,2,7)


!除功能為1新增時,其他隱藏重新交易按鈕
#AGAIN=X,1,S
C(3,#FunCd,1,$,S)
E(0,0)ASGN(AGAIN$)

#BUF1A=X,55,S
T(2, +0+00+       +   +       +          +       +            +#TXCD)

#BIND1A=X,1,S
BIND(#BTN1,click, {cmd=CHAIN; ntxcd=L2038; ntxbuf=#BUF1A;ntxbuf5=type<-1:ClCode2<-OOClCode2:ClCode1<-OOClCode1:CustNo<-OOCustNo:Other<-OOL2418Other:ClNo<-OOClNo})


!戶號
!#FdCustNo=X,2,L

!#CustNo=A,7,I
!C(3,#CHAIN,1,C(3,#FunCd,1,$,s),$)

!擔保品查詢
#FdClMain=X,2,L

#BUF1B=X,55,S
!T(2, +0+00+       +   +       +          +#CustNo+            +#TXCD)
T(2, +0+00+       +   +       +          +0000000+            +#TXCD)

#BIND1B=X,1,S
!BIND(#BTN1,click, {cmd=CHAIN; ntxcd=L2038; ntxbuf=#BUF1B;ntxbuf5=type<-1:ClCode2<-OOClCode2:ClCode1<-OOClCode1:CustNo<-OOCustNo:Other<-OOL2418Other:ClNo<-OOClNo})
BIND(#BTN1,click, {cmd=CHAIN; ntxcd=L2038; ntxbuf=#BUF1B;ntxbuf5=type<-1:ClCode2<-OOClCode2:ClCode1<-OOClCode1:Other<-OOL2418Other:ClNo<-OOClNo})


!#SendL2r07B=X,1,S
!T(3,#CustNoX,)
!C(3,#CustNo,0,S,$)
!T(3,@RimCustId, )
!E(0,@RimCustNo,#CustNo)
!RESET_RIM(#SendL2r07B,L2R07)
!S(L2R07,1,#RimTxCode,#RimCustId,#RimCustNo)
!R(1,L2R07)

!#CustNoX=X,2.50,L
!C(3,#CustNo,0,S,T(2,#L2r07CustName))

!#TimCustNo=A,7,S
!C(3,#CustNo,0,$,E(0,#CustNo))
!T(2,@RmkCustNo,#TimCustNo)
<include src="COM.icf::CustRmk.rtn"/>

! [擔保品代號1]
#ClCode1=A,1,I
C(3,#CHAIN,1,C(3,#FunCd,1,$,s),$)
HELP(#ClCode1Help)
@V(H,#ClCode1Help)


#ClCode1X=X,20,L
T(H,#ClCode1,#ClCode1Help)

!調RIM參數
!L2r46 取他項權利資料
!L2r48 取擔保品代號2Help
#RimClNo=A,7,S

!取擔保品代號2Help
#RimL2R48=X,1,S
E(0,@RimClCode1,#ClCode1)
RESET_RIM(#RimL2R48,L2R48)
S(L2R48,1,#RimClCode1)
R(1,L2R48)

! [擔保品代號2]
#ClCode2=A,2,I
C(3,#CHAIN,1,C(3,#FunCd,1,$,s),$)
HELP(#L2r48Help1)
@V(H,#L2r48Help1)

#ClCode2X=X,30,L
T(H,#ClCode2,#L2r48Help1)

! [擔保品編號]

#ClNo=A,7,I
C(3,#CHAIN,1,C(3,#FunCd,1,$,s),$)
@V(2,0)
IF(#ClCode1==1||#ClCode1==2,$,V(P,僅可輸入房地土地資料))


! 調RIM查擔保品主檔(ClMain)資料
#RimL2r22=X,1,S
E(0,@RimClCode1,#ClCode1)
E(0,@RimClCode2,#ClCode2)
E(0,@RimClNo,#ClNo)
E(0,@RimFunCd,5)
T(2,@Other,)
RESET_RIM(#RimL2r22,L2R22)
S(L2R22,1,#RimClCode1,#RimClCode2,#RimClNo,#RimFunCd)
R(1,L2R22)
T(2,@Other,#L2r22Other)

#Other=x,100,L

#SeqForm=X,18,L
C(3,#FunCd,1,$,S)
T(2,輸入格式為9999-999)

!登記次序0000-000
#ClSeq=X,8,I
!C(3,#FunCd,1,T(3,),$)
C(3,#FunCd,1,$,s)
@V(7)
T(1,@ClSeq4,#ClSeq,1,4)
T(1,@ClSeqD,#ClSeq,5,1)
T(1,@ClSeq3,#ClSeq,6,3)
IF(#ClSeq4==0,V(P,新增時序號前四碼不可0),$)
IF(#ClSeqD!="-",V(P,新增時序號第五碼應為-),$)
!IF(#ClSeq3==0,V(P,新增時序號後三碼不可空白，可為000),$)

#ClSeq4=A,4,S
#ClSeqD=X,1,S
#ClSeq3=A,3,S


#RimClSeq=X,8,S
!L2R46 : 依擔保品編號取他項權利資料
#RimL2r46B=X,1,S
E(0,@RimClCode1,#ClCode1)
E(0,@RimClCode2,#ClCode2)
E(0,@RimClNo,#ClNo)
T(2,@RimClSeq,#ClSeq)
RESET_RIM(#RimL2r46B,L2R46)
S(L2R46,1,#RimClCode1,#RimClCode2,#RimClNo,#RimClSeq)
R(1,L2R46)

#cntmsg=X,50,L


#CHECKL2R46=X,1,S
T(2,@ClSeq,#L2r46Seq)
C(3,#FunCd,1,K(LIGHT,#cntmsg,TXTRED,0,1),$)
!C(3,#L2r46Cnt,1,T(2,@cntmsg,),T(B,@cntmsg,該擔保品項下，第+#L2r46Cnt+筆他項權利資料。))
C(3,#FunCd,1,T(B,@cntmsg,該擔保品項下，第+#L2r46Cnt+筆他項權利資料。),$)
C(3,#FunCd,1,S,$)
T(2,@City,#L2r46City)
C(4,#L2r46OtherCity,$,SHOW(#InCityX))
T(2,@InCityX,#L2r46OtherCity)
T(2,@LandAdm,#L2r46LandAdm)
C(4,#L2r46OtherLandAdm,$,SHOW(#InLandAdmX))
T(2,@InLandAdmX,#L2r46OtherLandAdm)
E(0,@RecYear,#L2r46RecYear)
T(2,@RecWord,#L2r46RecWord)
C(4,#L2r46OtherRecWord,$,SHOW(#InRecWordX))
T(2,@InRecWordX,#L2r46OtherRecWord)
T(2,@RecNumber,#L2r46RecNumber)
T(2,@RightsNote,#L2r46RightsNote)
E(0,@TwSecuredTotal,#L2r46SecuredTotal)
E(0,@UsSecuredTotal,#L2r46SecuredTotal)
E(0,@SecuredDate,#L2r46SecuredDate)
T(2,@Location,#L2r46Location)
##loop {times:10,i:1}
T(2,@ApplNo{i},#L2r46ApplNo{i})
##end

#CityCode=X,2,S
!縣市
#City=X,4,I
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
HELP(#L6r03ResultCity)
@V(H,#L6r03ResultCity)

#CityX=X,17,L
T(H,#City,#L6r03ResultCity)
C(4,#City,SHOW(#InCityX),HIDE(#InCityX))
C(4,#City,$,s)

#InCityX=x,20,I
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
C(4,#City,$,S)
@C(4,#InCityX,V(P,自行輸入時不可為空),$)

#LoanOfficeHelp=X,2000,S

! 依縣市別組地政下拉選單
#RimL6r49CityB=X,1,S
E(0,@RimFunCd,2)
T(2,@RimCityCode,#City)
RESET_RIM(#RimL6r49CityB,L6R49)
S(L6R49,1,#RimFunCd,#RimCityCode)
R(1,L6R49)
C(4,#L6r49Result,T(2,@LoanOfficeHelp,:自行輸入),T(2,@LoanOfficeHelp,:自行輸入;+#L6r49Result))

#CHECKRIML6r49=X,1,S
C(4,#City,$,S)
C(4,#L6r49Result,T(3,@LoanOfficeHelp,:自行輸入),$)

!地政
#LandAdm=X,2,I
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
C(4,#City,T(F,@LandAdm,0),T(F,@LandAdm,1))
C(4,#City,S,HELP(#LoanOfficeHelp))
@
V(H,#LoanOfficeHelp)

#LandAdmX=X,17,L
T(H,#LandAdm,#LoanOfficeHelp)
C(4,#LandAdm,SHOW(#InLandAdmX),HIDE(#InLandAdmX))

#InLandAdmX=x,10,I
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
C(4,#LandAdm,$,S)
@C(4,#InLandAdmX,V(P,自行輸入時不可為空),$)

!收件字help
#RecWordHelp=X,2000,S
C(4,#L2r60Help1,T(3,@RecWordHelp,:自行輸入),$)

#RimLandOfficeCode=X,2,S
! 依縣市別地政組收件字下拉選單
#RimL2r60B=X,1,S
C(4,#LandAdm,S,$)
T(2,@RimCityCode,#City)
T(2,@RimLandOfficeCode,#LandAdm)
RESET_RIM(#RimL2r60B,L2R60)
S(L2R60,1,#RimCityCode,#RimLandOfficeCode)
R(1,L2R60)
C(4,#L2r60Help1,T(3,@RecWordHelp,:自行輸入),T(2,@RecWordHelp,:自行輸入;+#L2r60Help1))



!收件年
#RecYear=A,3,I
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
@V(2,0)

!收件字
#RecWord=X,3,I
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
C(4,#City,T(F,@RecWord,0),T(F,@RecWord,1))
C(4,#LandAdm,S,HELP(#RecWordHelp))
@
V(H,#RecWordHelp)

#RecWordX=x,16,L
T(H,#RecWord,#RecWordHelp)
C(4,#RecWord,SHOW(#InRecWordX),HIDE(#InRecWordX))

#InRecWordX=x,18,I
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
C(4,#RecWord,$,S)
@C(4,#InRecWordX,V(P,自行輸入時不可為空),$)


!收件號
#RecNumber=X,6,I
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
@V(9)V(7)


!權利價值說明
#RightsNote=X,2,I
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
HELP(#ClRightsNoteHelp)
@
C(4,#RightsNote,S,$)
V(H,#ClRightsNoteHelp)

#RightsNoteX=X,20,L
C(4,#RightsNote,S,$)
T(H,#RightsNote,#ClRightsNoteHelp)

!擔保債權總金額
#TwSecuredTotal=m,14,I
C(3,#Precision,0,$,s)
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
@V(2,0)

#UsSecuredTotal=m,14.2,I
C(3,#Precision,0,s,$)
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
@V(2,0)


#TimSecuredTotal=m,14.2,S
C(3,#Precision,0,E(0,#TwSecuredTotal),E(0,#UsSecuredTotal))

!擔保債權確定日期
#SecuredDate=D,7,I
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
D(8)
@
V(7)
A(DATE,0,#SecuredDate)
IF(#SecuredDate>#CDATEX,V(P,不可大於日曆日),$)

!建物坐落地號
#Location=x,40,I
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)


!---  關聯
#MMainCustNo0=A,7,S
#ApplNo0=A,7,S

##loop{times:10,l:0,n:1,m:2}
!核准號碼

#ApplNo{n}=A,7,I
C(3,#FunCd,4,s,$)
C(3,#FunCd,5,s,$)
C(3,#HIDE1FG,0,CALL(#HIDEP1),$)
INVOKEJS(SHOW,grd1_{n},1)
! IF({n}==1,$,C(3,#ApplNo{l},0,INVOKEJS(SHOW,grd1_{n},0),INVOKEJS(SHOW,grd1_{n},1)))
! IF({n}==1,$,C(3,#ApplNo{l},0,S,$))
!IF(#FunCd==2 && {n}!=1,C(3,#ApplNo{l},0,INVOKEJS(SHOW,grd1_{n},0),INVOKEJS(SHOW,grd1_{n},1)),$)
!IF(#FunCd==2 && {n}!=1 ,C(3,#ApplNo{l},0,S,$),$)
IF(#FunCd==1 && {n}!=1,C(3,#ApplNo{l},0,INVOKEJS(SHOW,grd1_{n},0),INVOKEJS(SHOW,grd1_{n},1)),$)
IF(#FunCd==1 && {n}!=1,C(3,#ApplNo{l},0,S,$),$)
IF(#FunCd==2 && {n}==1,C(3,#ApplNo{n},0,INVOKEJS(SHOW,grd1_{n},0),INVOKEJS(SHOW,grd1_{n},1)),$)
IF(#FunCd==2 && {n}!=1,IF(#ApplNo{n}==0 && #ApplNo{l}==0 ,INVOKEJS(SHOW,grd1_{n},0),INVOKEJS(SHOW,grd1_{n},1)),$)
IF(#FunCd==2 && {n}!=1 ,IF(#ApplNo{n}==0 && #ApplNo{l}==0,S,$),$)
@
IF(#FunCd==1 && {n}==1,V(2,0),$)
!IF({n}==1,$,C(3,#ApplNo{n},0,INVOKEJS(SHOW,grd1_{n},0),INVOKEJS(SHOW,grd1_{n},1)))
C(3,#ApplNo{n},0,INVOKEJS(SHOW,grd1_{n},0),INVOKEJS(SHOW,grd1_{n},1))

#CustId{n}=X,10,L

!檢查擔保品與核准號碼關聯
#L2r40{n}=X,1,S
IF(#FKEY==0 || #FKEY==7,$,s)
C(3,#ApplNo{n},0,S,$)
E(0,@RimClCode1,#ClCode1)
E(0,@RimClCode2,#ClCode2)
E(0,@RimClNo,#ClNo)
E(0,@RimApproveNo,#ApplNo{n})
RESET_RIM(#L2r40{n},L2R40)
S(L2R40,1,#RimClCode1,#RimClCode2,#RimClNo,#RimApproveNo)
R(1,L2R40)


#L2r05A{n}=X,1,S
IF(#FKEY==0 || #FKEY==7,$,s)
C(3,#ApplNo{n},0,S,$)
E(0,@RimFuncCode,5)
E(0,@RimCustNo,0)
E(0,@RimFacmNo,0)
E(0,@RimApplNo,#ApplNo{n})
E(0,@RimCaseNo,0)
RESET_RIM(#L2r05A{n},L2R05)
S(L2R05,1,#RimFuncCode,#RimTxCode,#RimFKey,#RimCustNo,#RimFacmNo,#RimApplNo,#RimCaseNo)
R(1,L2R05)

#SendL2r02A{n}=X,1,S
IF(#FKEY==0 || #FKEY==7,$,s)
C(3,#ApplNo{n},0,S,$)
E(0,@RimApplNo,#ApplNo{n})
E(0,@RimFuncCode,5)
T(2,@RimCustId,)
RESET_RIM(#SendL2r02A{n},L2R02)
S(L2R02,1,#RimFuncCode,#RimTxCode,#RimFKey,#RimApplNo,#RimCustId)
R(1,L2R02)

#L2r07A{n}=X,1,S
IF(#FKEY==0 || #FKEY==7,$,s)
C(3,#ApplNo{n},0,S,$)
T(2,@RimCustId,#L2r02CustId)
E(0,@RimCustNo,0)
RESET_RIM(#L2r07A{n},L2R07)
S(L2R07,1,#RimTxCode,#RimCustId,#RimCustNo)
R(1,L2R07)
C(3,#ApplNo{n},0,S,$)
E(0,@CustNo{n},#L2r05CustNo)
E(0,@FacmNo{n},#L2r05FacmNo)
T(2,@CustName{n},#L2r07CustName)
C(3,#L2r05CustNo,0,$,T(2,@CustFacmNo{n},#L2r05CustNo+-+#L2r05FacmNo))

!戶號-額度
#CustNo{n}=A,7,L
C(3,#ApplNo{n},0,S,$)

#FacmNo{n}=A,3,L
C(3,#ApplNo{n},0,S,$)

#CustFacmNo{n}=X,12,L
C(3,#ApplNo{n},0,S,$)

#CustName{n}=x,100,L
C(3,#ApplNo{n},0,S,$)
#CustNameS{n}=x,30,L
C(3,#ApplNo{n},0,S,$)
T(B,#CustName{n})


##end


#RPTFG=A,1,S

<include src="ROM.icf::L0Rim.dec"/>
<include src="ROM.icf::L2Rim.dec"/>
<include src="ROM.icf::L2R05.dec"/>
<include src="ROM.icf::L2R02.dec"/>
<include src="ROM.icf::L2R22.dec"/>
<include src="ROM.icf::L2R40.dec"/>
<include src="ROM.icf::L2R46.dec"/>
<include src="ROM.icf::L2R48.dec"/>
<include src="ROM.icf::L2R60.dec"/>
<include src="ROM.icf::L2R07.dec"/>
<include src="ROM.icf::L6R49.dec"/>
<include src="ROM.icf::L6R03.dec"/>
<include src="HELPRIM.icf::HELPRIM.rtn"/>
</sub>

<sub type="DC" name="p2" layout="cols=2;screen.width=[10,1050];printer.width=[15,30];order=1;">
[
["<font color=red>@關聯  (核准號碼原值改為0代表刪除)"],
["#grid#,{id:1,expand:true,loop:10,row_height:1,s_cols:[70,120,250], p_cols:[5,15,20]}","","",
["核准號碼","戶號","戶名"],
[[#ApplNo1],[#CustFacmNo1],[#CustNameS1]],
],
]
</sub>
!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>

#PRTSCRFG=_,_,S
E(0,2)

</sub>


!---------- TXFORM = L2418 ----------
<sub type="FORM" name="L2418">

!#SCRPRT=_,_,S
!C(5,#TXFORM,L2418,$,S)

#SCRTIL=_,_,S
T(3,[L2418] 他項權利資料登錄)

!------ TOM(HEAD)   Variables (FOR OUTPUT SCREEN) ------



!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------

!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------

</sub>


!------ 上行電文 ------
<sub type="TIM">
#ClCode1
#ClCode2
#ClNo
#ClSeq
#City
#LandAdm
#RecYear
#RecWord
#RecNumber
#RightsNote
#TimSecuredTotal
#SecuredDate
#Location
#END
#InCityX
#InLandAdmX
#InRecWordX
##loop {times:10,i:1}
#ApplNo{i}
##end

</sub>


!------ 下行電文TOM ------
<sub type="TOM">
TXFORM=L2418

^
<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L2R02.tom"/>
<include src="ROM.icf::L2R05.tom"/>
<include src="ROM.icf::L2R07.tom"/>
<include src="ROM.icf::L2R22.tom"/>
<include src="ROM.icf::L2R40.tom"/>
<include src="ROM.icf::L2R46.tom"/>
<include src="ROM.icf::L2R48.tom"/>
<include src="ROM.icf::L6R49.tom"/>
<include src="ROM.icf::L2R60.tom"/>
<include src="ROM.icf::L2R07.tom"/>
<include src="ROM.icf::L6R03.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
<include src="PRT.icf::UPDH01.sel"/>
</sub>
