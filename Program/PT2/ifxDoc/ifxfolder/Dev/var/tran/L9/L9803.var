----- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

!#TXCD
!T(3,L9803)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,27)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,75)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,20)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)

</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p0" layout="cols=1;screen.width=[147,850];printer.width=[20,80];">

[
["[L9803]                                 月報"],
["@會計日期",#ACCTDATE],
["@課組別",#Ap1,#Ap2,#Ap3],

]


!---------- PREMADE VARIABLES ----------

! This makes the trades possible to execute on DEV,SIT,UAT
! 功能 必須輸入(1: 新增;2: 修改;4: 刪除;5: 查詢)
#FUNCIND=_,_,S
E(0,5)
<include src="COM.icf::CheckAuth.rtn"/>

! for later loop use
#tmpTargetCat=X,1,S

#tmpLineCounter=N,3,S



#Ap1=X,16,I,ui:button;value:逾期暨風險控管月報;enable:1;tabbable:0
#Ap2=X,16,I,ui:button;value:放款服務課月報;enable:1;tabbable:0
#Ap3=X,16,I,ui:button;value:放款推展課月報;enable:1;tabbable:0


#RptCode = X,10,L
T(2,報表代號)
#RptName=X,100,L
T(2,報表名稱)
#RptBtn=X,1,L


! 會計日期
! legacy from old version.
#DT1=D,8,S
T(4,DATE$)

#DT2=D,7,S
T(1,#DT1,2,7)

#ACCTDATE=D,7,L
T(2,#DT2)
@V(7)A(DATE,0,#ACCTDATE)
V(5,0,#DT2)



!需手動調整，配合此交易內所有報表的數量而訂，目前是訂上限總共150份(平均分在三個課組別，每課不會超過50份)
#TotalItem =A,3,S
#OOTotalRptSize =A,3,S


!全選勾選功能 start..........
##loop{times:3,i:1}
#BtnAllShell{i}=X,1,I,ui:button;value:  ;enable:1;tabbable:0

#ApAllBIND{i}=X,1,S
BIND(#BtnAllShell{i},click, {cmd=CALLSEND;DOCODE=ApAllBtnProc{i}})
##end

#ApAllBtnProc1=@,1,S
C(5,#BtnAllShell1,V,T(3,@BtnAllShell1,  ),T(3,@BtnAllShell1,V))
##loop{times:50,i:1}
!全勾選前，先排除沒有交易代號行數不勾選
C(5,#TradeCode{i},     ,T(3,@BtnShell{i},  ),C(5,#BtnAllShell1,V,T(3,@BtnShell{i},V),T(3,@BtnShell{i},  )))
##end

#ApAllBtnProc2=@,1,S
C(5,#BtnAllShell2,V,T(3,@BtnAllShell2,  ),T(3,@BtnAllShell2,V))
##loop{times:50,i:51}
!全勾選前，先排除沒有交易代號行數不勾選
C(5,#TradeCode{i},     ,T(3,@BtnShell{i},  ),C(5,#BtnAllShell2,V,T(3,@BtnShell{i},V),T(3,@BtnShell{i},  )))
##end

#ApAllBtnProc3=@,1,S
C(5,#BtnAllShell3,V,T(3,@BtnAllShell3,  ),T(3,@BtnAllShell3,V))
##loop{times:50,i:101}
!全勾選前，先排除沒有交易代號行數不勾選
C(5,#TradeCode{i},     ,T(3,@BtnShell{i},  ),C(5,#BtnAllShell3,V,T(3,@BtnShell{i},V),T(3,@BtnShell{i},  )))
##end
!全選勾選功能 end..........


##loop{times:150,i:1}
!權限勾選按鈕
#BtnShell{i}=X,1,I,ui:button;value:  ;enable:1;tabbable:0

#Ap1GBIND{i}=X,1,S
BIND(#BtnShell{i},click, {cmd=CALLSEND;DOCODE=Ap1GBtnProc{i}})

#Ap1GBtnProc{i}=@,1,S
C(5,#BtnShell{i},V,T(3,@BtnShell{i},  ),T(3,@BtnShell{i},V))

#TradeCat{i}=X,1,S
#TradeCode{i}=X,10,L
#TradeName{i}=X,100,L
#TradeSub{i}=X,1,S
HIDE(#TradeSub{i})

#OOGroupNo{i}=X,1,S
#OOTradeCode{i}=X,10,L
#OOTradeName{i}=X,100,L
#OOTradeSub{i}=X,1,S
##end

!JAVA回傳的資料賦值
#tranNo=X,5,S
T(3,L9803)
S(L9R99,0,#tranNo)
R(1,L9R99)
E(0,@TotalItem,#OOTotalRptSize)
##loop{times:150,i:1}
T(2,@TradeCode{i},#OOTradeCode{i})
T(2,@TradeName{i},#OOTradeName{i})
E(0,@TradeSub{i},#OOTradeSub{i})
E(0,@TradeCat{i},#OOGroupNo{i})
##end

!多餘行數的不顯示
##loop{times:50,i:1}
IF(#TradeCat{i}==0,INVOKEJS(SHOW,grd1_{i},0),INVOKEJS(SHOW,grd1_{i},1))
##end

##loop{times:50,i:51,k:1}
IF(#TradeCat{i}==0,INVOKEJS(SHOW,grd2_{k},0),INVOKEJS(SHOW,grd2_{k},1))
##end

##loop{times:50,i:101,k:1}
IF(#TradeCat{i}==0,INVOKEJS(SHOW,grd3_{k},0),INVOKEJS(SHOW,grd3_{k},1))
##end


##loop {times:3,i:1}
INVOKEJS(SHOW,p{i},0)
##end
INVOKEJS(SHOW,p1,1)

##loop {times:3,i:1}
BIND(#Ap{i},click, {cmd=CALLSEND;DOCODE=ApProc{i}})
##end


#ApProc1=@,1,S
##loop {times:3,i:1}
INVOKEJS(SHOW,p{i},0)
##end
INVOKEJS(SHOW,p1,1)

#ApProc2=@,1,S
##loop {times:3,i:1}
INVOKEJS(SHOW,p{i},0)
##end
INVOKEJS(SHOW,p2,1)

#ApProc3=@,1,S
##loop {times:3,i:1}
INVOKEJS(SHOW,p{i},0)
##end
INVOKEJS(SHOW,p3,1)



</sub>



!區塊p1
<sub type="DC" name="p1" layout="cols=3;screen.width=[147,850];printer.width=[20,80];order=1;">
[
[],
["#grid#,{id:4,expand:true,loop:0,row_height:1,s_cols:[150,100,120], p_cols:[16,8,8]}","","",
[[#BtnAllShell1,"@全選"]],
], 

!["#grid#,{id:7,expand:true,loop:0,row_height:1}","","",
![],[#RptBtn,#RptCode,#RptName]
!],

["#grid#,{id:1,expand:true,loop:50,row_height:1}","","",
[],[#BtnShell1,#TradeCode1,#TradeName1]
],
]
</sub>

!區塊p2
<sub type="DC" name="p2" layout="cols=2;screen.width=[147,850];printer.width=[20,80];order=1;">
[
[],
["#grid#,{id:5,expand:true,loop:0,row_height:1,s_cols:[150,100,120], p_cols:[16,8,8]}","","",
[[#BtnAllShell2,"@全選"]],
], 
!["#grid#,{id:8,expand:true,loop:0,row_height:1}","","",
![],["","報表代號","報表名稱"]
!],

["#grid#,{id:2,expand:true,loop:50,row_height:1}","","",
[],[#BtnShell51,#TradeCode51,#TradeName51]
],
]
</sub>

!區塊p3
<sub type="DC" name="p3" layout="cols=2;screen.width=[147,850];printer.width=[20,80];order=1;">
[
[],
["#grid#,{id:6,expand:true,loop:0,row_height:1,s_cols:[150,100,120], p_cols:[16,8,8]}","","",
[[#BtnAllShell3,"@全選"]],
], 
!["#grid#,{id:9,expand:true,loop:0,row_height:1}","","",
![],["","報表代號","報表名稱"]
!],
["#grid#,{id:3,expand:true,loop:50,row_height:1}","","",
[],[#BtnShell101,#TradeCode101,#TradeName101]
],
]
</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>



!---------- TXFORM = L9803 ----------
<sub type="FORM" name="L9803">

</sub>


!------ 上行電文 ------
! 修改這裡的 loop times
<sub type="TIM">
#TotalItem
##loop{times:150,i:1}
#BtnShell{i}
#TradeCat{i}
#TradeSub{i}
#TradeCode{i}
#TradeName{i}
##end


</sub>


!------ 下行電文TOM ------
<sub type="TOM">
TXFORM=L9803^

TXFORM=L9R99
#OOTotalRptSize
##loop{times:150,i:1}
#OOGroupNo{i}
#OOTradeCode{i}
#OOTradeName{i}
#OOTradeSub{i}
##end
^




<include src="COM.icf::TRCTL.tom"/>
</sub>

<sub type="PART" name="L9803" layout="cols=3;screen.width=[130,800];printer.width=[15,80];order=1">
[
["[L9803]                                 月報"], 
]
</sub>
!---------- 單據輸出組合 ----------
<sub type="SELECT">

<include src="PRT.icf::UPD01.sel"/>
</sub>