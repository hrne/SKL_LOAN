----- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

#TXCD
T(3,L7204)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD2.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=1;screen.width=[150,850];printer.width=[20,20];">
[
["[L7204]                                 特殊客觀減損狀況維護"],
[#<->#,"#FdFunctionCd+功能",#FuncCodeX],
!["@功能",#FuncCodeX],
[#<->#,"#FdCustNo+戶號",#CustNo,"@",#CustName],
[#<->#,"#FdFacmNo+額度",#FacmNo],
[#<->#,"#FdMarkDate+發生日期",#MarkDate],
[#<->#,"#FdMarkCode+註記碼",#MarkCode,#MarkCodeX],
[#<->#,"#FdMarkRsn+原因代碼",#MarkRsn,#MarkRsnX],
[#<->#,"#FdMarkRsnDesc+原因說明",#MarkRsnDesc],
[#<->#,"#FdStartDate+起始日期",#StartDate],
[#<->#,"#FdEndDate+終止日期",#EndDate],
[#<->#,"#FdLosCod+客觀減損條件",#LosCod,#LosCodX],
]

!["#grid#,{id:1,expand:true,loop:10,row_height:1,s_cols:[], p_cols:[]}","","",
!["戶號","額度","戶名","發生日期","註記碼","原因代碼","原因說明","客觀減損條件","起始日期","終止日期"],
![
!  [#CustNo1],[#FacmNo1],[#CustName1],[#MarkDate1],[#MarkCode1,#MarkCodeX1],[#MarkRsn1,#MarkRsnX1],[#MarkRsnDesc1],[#LosCod1],[#StartDate1],[#EndDate1]
!],
!],
!]
!["戶號","額度","戶名","發生日期","註記碼","原因代碼","原因說明","客觀減損條件","起始日期","終止日期"],
!  [#CustNo1],[#FacmNo1],[#CustName1],[#MarkDate1],[#MarkCode1,#MarkCodeX1],[#MarkRsn1,#MarkRsnX1],[#MarkRsnDesc1],[#LosCod1],[#StartDate1],[#EndDate1]
!---------- AP Button AREA ----------
![Buttom資料查詢]
!#BTN1=X,15,I,ui:button;value:瀏覽;enable:0;tabbable:0
!#BTN2=X,15,I,ui:button;value:瀏覽;enable:0;tabbable:0
!#BTN3=X,15,I,ui:button;value:瀏覽;enable:0;tabbable:0
#BUF1=X,42,S
!ENABLE(#BTN1)
!ENABLE(#BTN2)
!ENABLE(#BTN3)
!---------- AP TEXT AREA Variables ----------

#FdFunctionCd=X,1,L
#FdCustNo=X,1,L
T(3,*)
#FdFacmNo=X,1,L
T(3,*)
#FdMarkDate=X,1,L
T(3,*)
#FdMarkCode=X,1,L
T(3,*)
#FdMarkRsn=X,1,L
T(3,*)
#FdMarkRsnDesc=X,1,L
T(3, )
#FdStartDate=X,1,L
T(3,*)
#FdEndDate=X,1,L
T(3,*)
#FdLosCod=X,1,L
T(3,*)


<include src="HELPRIM.icf::HELPRIM.rtn"/>
<include src="ROM.icf::L1R01.dec"/>
<include src="ROM.icf::L7R04.dec"/>
#CDCODEFuncCode2=x,20,S
T(3,CdCode.FuncCode2)

! 註記碼下拉選單2
#MarkCodeRimName=x,20,S
T(3,CdCode.MarkCode)
#MarkCodeHelp=x,1024,S
! 原因代碼下拉選單3
#MarkRsnRimName=x,20,S
T(3,CdCode.MarkRsn)
#MarkRsnHelp=x,1024,S
! 客觀減損條件代碼下拉選單4
#LosCodRimName=x,20,S
T(3,CdCode.LosCod)
#LosCodHelp=x,1024,S


#FuncCode2HelpRim=X,1,S
RESET_RIM(#FuncCode2HelpRim,XXR99)
S(XXR99,01,#CDCODEFuncCode2,#MarkCodeRimName,#MarkRsnRimName,#LosCodRimName)
R(1,XXR99)
CALL(#HelpProc)
T(2,@FuncCode2Help,#HelpDesc1)
T(2,@MarkCodeHelp,#HelpDesc2)
T(2,@MarkRsnHelp,#HelpDesc3)
T(2,@LosCodHelp,#HelpDesc4)

#FuncCode2Help=x,300,S


!註記碼
!#MarkCodeHelp=x,100,S
!T(3,1:重整;2:破產;9:其他)
!原因代碼
!#MarkRsnHelp=x,100,S
!T(3,01:個別評價;99:其他)

#INIT=X,1,S
##loop {times:9,i:2}
INVOKEJS(SHOW,grd1_{i},0)
##end

!#INIT1=X,1,S
!##loop {times:10,i:1}
!T(F,@MarkCodeDesc{i},0)
!##end

#CHAIN=X,1,S
T(4,CHAIN$)
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:[L7904特殊客觀減損狀況查詢]進入),$)

!做完交易自動更新原畫面
#AutoReFresh=A,1,S
C(3,#CHAIN,1,$,S)
E(0,1)
ASGN(CAUTO$)

#NTXBUF=X,34,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)

#CHAIN_FuncCode=X,1,S
T(1,#NTXBUF,1,1)

#CHAIN_CustNo=X,7,S
T(1,#NTXBUF,2,7)

#CHAIN_FacmNo=X,3,S
T(1,#NTXBUF,9,3)

#CHAIN_MarkDate=X,7,S
T(1,#NTXBUF,12,7)

#CHAIN_MarkCode=X,2,S
T(1,#NTXBUF,19,2)

#CHAIN_StartDate=X,7,S
T(1,#NTXBUF,21,7)

#CHAIN_EndDate=X,7,S
T(1,#NTXBUF,28,7)

#CHAINSET=X,1,S
C(3,#CHAIN,1,$,S)
T(2,@FuncCode,#CHAIN_FuncCode)
C(3,#FuncCode,1,S,$)
E(0,@CustNo,#CHAIN_CustNo)
E(0,@FacmNo,#CHAIN_FacmNo)
E(0,@MarkDate,#CHAIN_MarkDate)
!E(0,@MarkCode,#CHAIN_MarkCode)
!T(H,@MarkCodeDesc,#MarkCode1,#MarkCodeHelp)
!E(0,@StartDate,#CHAIN_StartDate)
!E(0,@EndDate,#CHAIN_EndDate)


! 功能 必須輸入(1: 新增;2: 修改;4: 刪除)
#FuncCode=A,1,S
T(F,@FuncCode,0)
C(3,#CHAIN,1,s,$)
HELP(#FuncCode2Help)
@V(H,#FuncCode2Help)

#FuncCodeX=X,12,L
T(H,#FuncCode,#FuncCode2Help)
C(2,#FuncCode,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),$,K(MODIFYBUTTON,刪除))

!刪除隱藏重新交易按鈕
#AGAIN=X,1,S
C(3,#FuncCode,1,S,$)
E(0,1)ASGN(AGAIN$)

#FUNCIND=_,_,S
E(0,#FuncCode)
<include src="COM.icf::CheckAuth.rtn"/>

!FuncCode=1,2 顯示框線
#WKTF=X,1,S
IF (#FuncCode==1 || #FuncCode==2 ,T(F,#MarkCode,1)T(F,#StartDate,1)T(F,#EndDate,1)T(F,#MarkRsn,1)T(F,#MarkRsnDesc,1)T(F,#LosCod,1),
                                  T(F,#MarkCode,0)T(F,#StartDate,0)T(F,#EndDate,0)T(F,#MarkRsn,0)T(F,#MarkRsnDesc,0)T(F,#LosCod,0))
IF (#FuncCode==1 ,T(F,#CustNo,1)T(F,#FacmNo,1)T(F,#MarkDate,1),
                  T(F,#CustNo,0)T(F,#FacmNo,0)T(F,#MarkDate,0))
T(F,#CustName,0)

#RimFunCd=A,1,S
#RimCustId=X,10,S
#RimCustNo=A,7,S
#RimCustName=c,100,S

! 戶號
#CustNo=A,7,I
C(3,#CHAIN,1,C(3,#FuncCode,1,$,s),$)
@V(7)V(2,0)

#RimL1r01=X,1,S
E(0,@RimFunCd,5)
E(0,@RimCustNo,#CustNo)
RESET_RIM(#RimL1r01,L1R01)
S(L1R01,1,#RimCustId,#RimCustNo,#RimFunCd)
R(1,L1R01)
T(2,@RimCustName,#L1r01CustName)
T(2,@CustName,#RimCustName)

! 額度
#FacmNo=A,3,I
C(3,#CHAIN,1,C(3,#FuncCode,1,$,s),$)
@V(7)V(2,0)

! 戶名
#CustName=c,100,L
!C(3,#CHAIN,1,C(3,#FuncCode,1,$,s),$)

#DATE=D,8,S
T(4,#SYSCDATE)

! 發生日期
#MarkDate=D,7,I
C(3,#CHAIN,1,C(3,#FuncCode,1,$,s),$)
T(1,#DATE,2,7)
@V(7)A(DATE,0,#MarkDate)

#RimFacmNo=A,3,S
#RimMarkDate=A,7,S

#RimL7R04=X,1,S
C(2,#FuncCode,S,$,$,S,$)
E(0,@RimCustNo,#CustNo)
E(0,@RimFacmNo,#FacmNo)
E(0,@RimMarkDate,#MarkDate)
E(0,@RimFunCd,#FuncCode)
RESET_RIM(#RimL7R04,L7R04)
S(L7R04,4,#RimCustNo,#RimFacmNo,#RimMarkDate,#RimFunCd)
R(1,L7R04)

#SetRim=X,1,S
C(2,#FuncCode,S,S,$,S,$)
E(0,@MarkCode,#L7R04MarkCode)
T(2,@MarkRsn,#L7R04MarkRsn)
T(2,@MarkRsnDesc,#L7R04MarkRsnDesc)
T(2,@LosCod,#L7R04LosCod)
E(0,@StartDate,#L7R04StartDate)
E(0,@EndDate,#L7R04EndDate)

! 調Rim完成預先帶入
T(H,@MarkCodeX,#MarkCode,#MarkCodeHelp)
T(H,@MarkRsnX,#MarkRsn,#MarkRsnHelp)
T(H,@LosCodX,#LosCod,#LosCodHelp)


! 註記碼
#MarkCode=A,1,I
C(3,#FuncCode,4,s)
HELP(#MarkCodeHelp)
@V(H,#MarkCodeHelp)

#MarkCodeX=X,30,L
T(H,#MarkCode,#MarkCodeHelp)

! 註記碼說明
!#MarkCodeDesc1=X,6,L
!C(3,#FuncCode,4,s)
!T(H,#MarkCode1,#MarkCodeHelp)

! 原因代碼
#MarkRsn=A,2,I
C(3,#FuncCode,4,s)
HELP(#MarkRsnHelp)
@V(H,#MarkRsnHelp)

#MarkRsnX=X,30,L
T(H,#MarkRsn,#MarkRsnHelp)

! 原因說明
#MarkRsnDesc=x,10.50,I
C(3,#FuncCode,4,s)
!@V(7)

! 起始日期
#StartDate=D,7,I
C(3,#FuncCode,4,s)
@V(7)A(DATE,0,#StartDate)

! 終止日期
#EndDate=D,7,I
C(3,#FuncCode,4,s)
@V(7)A(DATE,0,#EndDate)
IF(#EndDate < #StartDate,V(P,終止日期不可小於起始日期),s)

! 客觀減損條件
#LosCod=A,2,I
C(3,#FuncCode,4,s)
HELP(#LosCodHelp)
@V(H,#LosCodHelp)
!@V(7)V(5,1,99)

#LosCodX=X,30,L
T(H,#LosCod,#LosCodHelp)


!##loop{times:9,i:2,j:1}

!! 戶號
!#CustNo{i}=A,7,I
!C(3,#CHAIN,1,C(2,#FuncCode,$,$,s,$,s,s),$)
!C(3,#CustNo{j},0,INVOKEJS(SHOW,grd1_{i},0),INVOKEJS(SHOW,grd1_{i},1))
!C(3,#CustNo{j},0,S,$)
!@C(3,#CustNo{i},0,INVOKEJS(SHOW,grd1_{i},0),INVOKEJS(SHOW,grd1_{i},1))

!#Space{i}=X,1,S
!C(3,#CustNo{i},0,S,$)
!E(0,@RimFunCd,5)
!E(0,@RimCustNo,#CustNo{i})
!RESET_RIM(#RimL1r01,L1R01)
!S(L1R01,1,#RimCustId,#RimCustNo,#RimFunCd)
!R(1,L1R01)
!T(2,@CustName,#L1r01CustName)
!T(1,@CustName{i},#CustName,1,50)

! 額度
!#FacmNo{i}=A,3,I
! C(4,#CustNo{i},INVOKEJS(SHOW,grd1_{k},0),INVOKEJS(SHOW,grd1_{k},1))
!C(3,#CustNo{i},0,S,$)
!C(3,#FuncCode,4,s)
!@V(7)

! 戶名
!#CustName{i}=c,50,S
! C(4,#CustNo{i},INVOKEJS(SHOW,grd1_{l},0),INVOKEJS(SHOW,grd1_{l},1))
!C(3,#CustNo{i},0,S,$)
!C(3,#FuncCode,4,s)

! 發生日期
!#MarkDate{i}=D,7,I
! C(4,#CustNo{i},INVOKEJS(SHOW,grd1_{l},0),INVOKEJS(SHOW,grd1_{l},1))
!C(3,#CustNo{i},0,S,$)
!C(3,#FuncCode,4,s)
!@V(7)A(DATE,0,#MarkDate{i})

!#RimL7R04{i}=X,1,S
!C(3,#CustNo{i},0,S,$)
!C(2,#FuncCode,S,$,$,S,$)
!E(0,@RimCustNo,#CustNo{i})
!E(0,@RimFacmNo,#FacmNo{i})
!E(0,@RimMarkDate,#MarkDate{i})
!E(0,@RimFunCd,#FuncCode)
!RESET_RIM(#RimL7R04,L7R04)
!S(L7R04,4,#RimCustNo,#RimFacmNo,#RimMarkDate,#RimFunCd)
!R(1,L7R04)
!E(0,@MarkCode{i},#L7R04MarkCode)
!T(2,@MarkCodeDesc{i},#L7R04MarkCodeDesc)
!E(0,@StartDate{i},#L7R04StartDate)
!E(0,@EndDate{i},#L7R04EndDate)

! 註記碼
!#MarkCode{i}=A,1,I
!C(3,#CustNo{i},0,S,$)
!C(3,#FuncCode,4,s)
!HELP(#MarkCodeHelp)
!@V(H,#MarkCodeHelp)

!#MarkCodeX{i}=X,6,L
!T(H,#MarkCode{i},#MarkCodeHelp)

!! 註記碼說明
!#MarkCodeDesc{i}=X,6,L
!!C(4,#CustNo{i},INVOKEJS(SHOW,grd1_{l},0),INVOKEJS(SHOW,grd1_{l},1))
!C(4,#CustNo{i},S,$)
!!C(3,#FuncCode,4,s)
!T(H,#MarkCode{i},#MarkCodeHelp)

! 原因代碼
!#MarkRsn{i}=A,2,I
!C(3,#CustNo{i},0,S,$)
!C(3,#FuncCode,4,s)
!HELP(#MarkRsnHelp)
!@V(H,#MarkRsnHelp)

!#MarkRsnX{i}=X,8,L
!T(H,#MarkRsn{i},#MarkRsnHelp)

! 原因說明
!#MarkRsnDesc{i}=x,2.50,I
!C(3,#CustNo{i},0,S,$)
!C(3,#FuncCode,4,s)
!@V(7)

! 客觀減損條件
!#LosCod{i}=A,2,I
!C(3,#CustNo{i},0,S,$)
!C(3,#FuncCode,4,s)
!@V(7)V(2,0)


! 起始日期
!#StartDate{i}=D,7,I
! C(4,#CustNo{i},INVOKEJS(SHOW,grd1_{l},0),INVOKEJS(SHOW,grd1_{l},1))
!C(3,#CustNo{i},0,S,$)
!C(3,#FuncCode,4,s)
!@V(7)A(DATE,0,#StartDate{i})

! 終止日期
!#EndDate{i}=D,7,I
! C(4,#CustNo{i},INVOKEJS(SHOW,grd1_{l},0),INVOKEJS(SHOW,grd1_{l},1))
!C(3,#CustNo{i},0,S,$)
!C(3,#FuncCode,4,s)
!@V(7)A(DATE,0,#EndDate{i})
!IF(#EndDate{i} < #StartDate{i},V(P,終止日期不可小於起始日期),s)

!##end


#RPTFG=A,1,S
E(0,0)

!參考編號
#MRKEY=_,_,S
T(2,#CustNo+#FacmNo+#MarkDate)

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!---------- TXFORM = L7204 ----------
<sub type="FORM" name="L7204">

#SCRPRT=_,_,S
C(5,#TXFORM,L7204,$,S)

#SCRTIL=_,_,S
T(3,[L7204] 特殊客觀減損狀況維護)

</sub>


!------ 上行電文 ------
<sub type="TIM">
#FuncCode
#CustNo
#FacmNo
#MarkDate
#MarkCode
#MarkRsn
#MarkRsnDesc
#StartDate
#EndDate
#LosCod
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
TXFORM=L7204^

<include src="ROM.icf::L1R01.tom"/>
<include src="ROM.icf::L7R04.tom"/>
<include src="COM.icf::TRCTL.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
</sub>
