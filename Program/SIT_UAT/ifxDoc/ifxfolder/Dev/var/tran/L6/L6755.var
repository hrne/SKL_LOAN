----- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

#TXCD
T(3,L6755)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD2.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=1;screen.width=[150,850];printer.width=[20,50];">
[
["[L6755]                                 單位及主管代號維護"],
["#FdFuncCode+功能",#FuncCodeX],
["#FdUnitCode+單位代號",#UnitCode],
["#FdUnitItem+單位名稱",#UnitItem],
["#FdDistCode+區部代號",#DistCode,#DistCodeBTN],
["#FdDistItem+區部名稱",#DistItem],
["#FdDeptCode+部室代號",#DeptCode,#DeptCodeBTN],
["#FdDeptItem+部室名稱",#DeptItem],
["#FdUnitManager+單位主管代號",#UnitManager,#UnitManagerNm],
["#FdDistManager+區部主管代號",#DistManager,#DistManagerNm],
["#FdDeptManager+部室主管代號",#DeptManager,#DeptManagerNm],
["#FdEnable+啟用記號",#Enable,#EnableX],
]
!---------- AP Button AREA ----------
![Buttom資料查詢]
!#BUF1=X,42,S


#FdFuncCode=X,2,L
#FdUnitCode=X,2,L
#FdUnitItem=X,2,L
#FdDeptCode=X,2,L
#FdDeptItem=X,2,L
#FdDistCode=X,2,L
#FdDistItem=X,2,L
#FdUnitManager=X,2,L
#FdDeptManager=X,2,L
#FdDistManager=X,2,L
#FdEnable=X,2,L

!---------- AP TEXT AREA Variables ----------
<include src="HELPRIM.icf::HELPRIM.rtn"/>

!FuncCode1 (1:新增;2:修改;4:刪除;5:查詢)
#CDCODEFuncCode1=x,20,S                  
T(3,CdCode.FuncCode1)                  
#FuncCodeHelp=x,100,S

#CDCODEEnable=x,20,S
T(3,CdCode.StartStop)
#EnableHelp=x,100,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDCODEFuncCode1,#CDCODEEnable)
R(1,XXR99)
CALL(#HelpProc)
T(2,@FuncCodeHelp,#HelpDesc1)
T(2,@EnableHelp,#HelpDesc2)

#CHAIN=A,1,S
T(4,CHAIN$)
T(2,@RimTxCode,#TXCD)
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:L6085進入),$)

#NTXBUF=X,37,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)

#CHAIN_FuncCode=X,1,S
T(1,#NTXBUF,1,1)

#CHAIN_UnitCode=X,6,S
T(1,#NTXBUF,2,6)

#CHAIN_DeptCode=X,6,S
T(1,#NTXBUF,8,6)

#CHAIN_DistCode=X,6,S
T(1,#NTXBUF,14,6)

#CHAIN_UnitManager=X,6,S
T(1,#NTXBUF,20,6)

#CHAIN_DeptManager=X,6,S
T(1,#NTXBUF,26,6)

#CHAIN_DistManager=X,6,S
T(1,#NTXBUF,32,6)


#CHAINSET=X,1,S
C(3,#CHAIN,1,$,S)
T(2,@FuncCode,#CHAIN_FuncCode)
T(2,@UnitCode,#CHAIN_UnitCode)
!C(3,#FuncCode,1,S,$)
!T(2,@DeptCode,#CHAIN_DeptCode)
!T(2,@DistCode,#CHAIN_DistCode)
!T(2,@UnitManager,#CHAIN_UnitManager)
!T(2,@DeptManager,#CHAIN_DeptManager)
!T(2,@DistManager,#CHAIN_DistManager)


!!!!! Help
!!!!#ApHelp1=x,1024,S
!!!!T(3,CdBcm) 
!!!!
!!!!#ApHelp2=x,1024,S
!!!!T(3,CdBcmDept)
!!!!
!!!!#ApHelp3=x,1024,S
!!!!T(3,CdBcmDist)
!!!!
!!!!#RIM1=X,1,S
!!!!S(XXR99,01,#ApHelp1,#ApHelp2,#ApHelp3)
!!!!R(1,XXR99)
!!!!CALL(#HelpProc)
!!!!T(2,@ApHelp1,#HelpDesc1)
!!!!T(2,@ApHelp2,#HelpDesc2)
!!!!T(2,@ApHelp3,#HelpDesc3)
!!!!

! 功能 必須輸入(1: 新增;2: 修改;4: 刪除;5: 查詢)
#FuncCode=A,1,S
T(F,@FuncCode,0)
C(3,#CHAIN,1,s,$)
HELP(#FuncCodeHelp)
@V(H,#FuncCodeHelp)

#FuncCodeX=X,4,L
C(4,#FuncCode,S,$)
T(3, )
T(H,#FuncCode,#FuncCodeHelp)
C(2,#FuncCode,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),$,K(MODIFYBUTTON,刪除),K(MODIFYBUTTON,查詢))
C(3,#FuncCode,5,K(NOBUTTON,CLOSEY),$)
IF(#FuncCode==4 || #FuncCode==5,HIDE(#DeptCodeBTN,#DistCodeBTN),SHOW(#DeptCodeBTN,#DistCodeBTN))

#FUNCIND=_,_,S
E(0,#FuncCode)
<include src="COM.icf::CheckAuth.rtn"/>


!FuncCode=1,2 顯示框線
#WKTF=X,1,S
IF (#FuncCode==1 || #FuncCode==2 ,T(F,@DeptCode,1)T(F,@DeptItem,1)T(F,@DistCode,1)T(F,@DistItem,1)T(F,@UnitManager,1)T(F,@DeptManager,1)T(F,@DistManager,1),
                                  T(F,@DeptCode,0)T(F,@DeptItem,0)T(F,@DistCode,0)T(F,@DistItem,0)T(F,@UnitManager,0)T(F,@DeptManager,0)T(F,@DistManager,0))

#WKPSC=X,2,S

#WKSTAR1=X,2,S
C(2,#FuncCode,S,T(3,*),S,S,S,S)

#WKSTAR2=X,2,S
C(2,#FuncCode,S,T(3,*),T(3,*),S,S,S)

#WKNAME=X,1,S
T(2,@FdFuncCode,#WKSTAR1)
T(2,@FdUnitCode,#WKSTAR1)
T(2,@FdUnitItem,#WKSTAR1)
T(2,@FdDeptCode,#WKSTAR2)
T(2,@FdDeptItem,#WKSTAR2)
T(2,@FdDistCode,#WKPSC)
T(2,@FdDistItem,#WKPSC)
T(2,@FdUnitManager,#WKSTAR2)
T(2,@FdDeptManager,#WKSTAR2)
T(2,@FdDistManager,#WKPSC)
T(2,@FdEnable,#WKSTAR2)

! 單位代號
#UnitCode=X,6,I
C(3,#FuncCode,1,$,T(F,@UnitCode,0))
C(3,#CHAIN,1,C(3,#FuncCode,1,$,s),$)
!!!!HELP(#ApHelp1)
@V(7)
!!!!C(3,#FuncCode,1,$,V(H,#ApHelp1))

#SendL6R13=X,1,S
E(0,@RimFuncCode,#FuncCode)
T(2,@RimUnitCode,#UnitCode)
RESET_RIM(#SendL6R13,L6R13)
S(L6R13,1,#RimFuncCode,#RimTxCode,#RimUnitCode)
R(1,L6R13)

T(2,@UnitItem,#L6R13UnitItem)
T(2,@DeptCode,#L6R13DeptCode)
T(2,@DeptItem,#L6R13DeptItem)
T(2,@DistCode,#L6R13DistCode)
T(2,@DistItem,#L6R13DistItem)
T(2,@UnitManager,#L6R13UnitManager)
T(2,@DeptManager,#L6R13DeptManager)
T(2,@DistManager,#L6R13DistManager)
T(2,@UnitManagerNm,#L6R13UnitManagerNm)
T(2,@DeptManagerNm,#L6R13DeptManagerNm)
T(2,@DistManagerNm,#L6R13DistManagerNm)
T(2,@Enable,#L6R13Enable)
T(H,@EnableX,#Enable,#EnableHelp)

! 單位名稱
#UnitItem=x,40,I
C(3,#FuncCode,1,$,T(F,@UnitItem,0))
C(3,#CHAIN,1,C(3,#FuncCode,1,$,s),$)
!!!!T(H,#UnitCode,#ApHelp1)
@V(7)


! 區部代號
#DistCodeBTN=X,1,I,ui:button;value:單位代號查詢;enable:1;tabbable:0
#DistCodeBUF=X,6,S
#DistCodeBIND=X,1,S
BIND(#DistCodeBTN,click, {cmd=CHAIN; ntxcd=L6086; ntxbuf=#DistCodeBUF;ntxbuf5=type<-1:DistCode<-OODistCode:DistItem<-OODistItem})

#DistCode=X,6,I
C(2,#FuncCode,$,$,$,$,s,s)
!!!!HELP(#ApHelp3)
@T(3,@DistItemTmp,)
!!!!C(4,#DistCode,T(3,@DistItem,),T(H,@DistItemTmp,#DistCode,#ApHelp3))
!!!!C(4,#DistCode,$,C(4,#DistItemTmp,$,V(H,#ApHelp3)))

#DistItemTmp=x,40,S

! 區部名稱
#DistItem=x,40,I
C(4,#DistCode,S,$)
C(2,#FuncCode,$,$,$,$,s,s)
C(4,#DistItemTmp,$,T(2,#DistItemTmp))
C(4,#DistItemTmp,$,s)
@V(7)

! 部室代號
#DeptCodeBTN=X,1,I,ui:button;value:單位代號查詢;enable:1;tabbable:0
#DeptCodeBUF=X,6,S
#DeptCodeBIND=X,1,S
BIND(#DeptCodeBTN,click, {cmd=CHAIN; ntxcd=L6086; ntxbuf=#DeptCodeBUF;ntxbuf5=type<-1:DeptCode<-OODeptCode:DeptItem<-OODeptItem})

#DeptCode=X,6,I
C(3,#CHAIN,1,C(2,#FuncCode,$,$,$,$,s,s),$)
!!!!HELP(#ApHelp2)
!!!!@C(3,#FuncCode,1,V(7),V(H,#ApHelp2))
@V(7)

! 部室名稱
#DeptItem=x,40,I
C(3,#CHAIN,1,C(2,#FuncCode,$,$,$,$,s,s),$)
!!!!T(H,#DeptCode,#ApHelp2)
@V(7)

! 單位主管代號
#UnitManager=X,6,I
C(2,#FuncCode,$,$,$,$,s,s)
@V(7)

! 單位主管名稱
#UnitManagerNm=X,40,L
C(2,#FuncCode,$,$,$,$,s,s)
#SendL6R17a=X,1,S
E(0,@RimFuncCode,5)
T(2,@RimEmployeeNo,#UnitManager)
RESET_RIM(#SendL6R17,L6R17)
S(L6R17,1,#RimFuncCode,#RimTxCode,#RimEmployeeNo)
R(1,L6R17)
T(2,@UnitManagerNm,#L6R17Fullname)

! 區部主管代號
#DistManager=X,6,I
C(2,#FuncCode,$,$,$,$,s,s)

! 區部主管名稱
#DistManagerNm=X,40,L
C(2,#FuncCode,$,$,$,$,s,s)
#SendL6R17c=X,1,S
E(0,@RimFuncCode,5)
T(2,@RimEmployeeNo,#DistManager)
RESET_RIM(#SendL6R17,L6R17)
S(L6R17,1,#RimFuncCode,#RimTxCode,#RimEmployeeNo)
R(1,L6R17)
T(2,@DistManagerNm,#L6R17Fullname)

! 部室主管代號
#DeptManager=X,6,I
C(2,#FuncCode,$,$,$,$,s,s)
@V(7)

! 部室主管名稱
#DeptManagerNm=X,40,L
C(2,#FuncCode,$,$,$,$,s,s)
#SendL6R17b=X,1,S
E(0,@RimFuncCode,5)
T(2,@RimEmployeeNo,#DeptManager)
RESET_RIM(#SendL6R17,L6R17)
S(L6R17,1,#RimFuncCode,#RimTxCode,#RimEmployeeNo)
R(1,L6R17)
T(2,@DeptManagerNm,#L6R17Fullname)



!啟用記號
#Enable=X,1,I
C(3,#FuncCode,1,T(2,Y),$)
HELP(#EnableHelp)
@V(H,#EnableHelp)

#EnableX=X,10,L
T(H,#Enable,#EnableHelp)

#RPTFG=A,1,S
E(0,0)

#AGAIN=X,1,S
IF(#FuncCode==4 || #FuncCode==2,$,S)
E(0,1)ASGN(AGAIN$)

!參考編號
#MRKEY=_,_,S
T(2,#UnitCode)

<include src="ROM.icf::L0Rim.dec"/>
<include src="ROM.icf::L6R13Rim.dec"/>
<include src="ROM.icf::L6R13.dec"/>
<include src="ROM.icf::L6R17Rim.dec"/>
<include src="ROM.icf::L6R17.dec"/>
</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!---------- TXFORM = L6755 ----------
<sub type="FORM" name="L6755">

#SCRPRT=_,_,S
C(5,#TXFORM,L6755,$,S)

#SCRTIL=_,_,S
T(3,[L6755] 單位及主管代號維護)

</sub>

!------ 上行電文 ------
<sub type="TIM">
#FuncCode
#UnitCode
#UnitItem
#DeptCode
#DeptItem
#DistCode
#DistItem
#UnitManager
#DeptManager
#DistManager
#Enable
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">

TXFORM=L6755

^

<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L6R13.tom"/>
<include src="ROM.icf::L6R17.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
</sub>
