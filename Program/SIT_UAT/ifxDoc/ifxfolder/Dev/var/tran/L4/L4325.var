!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L4325)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,0)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,94)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,40)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L4325" layout="cols=1;screen.width=[];printer.width=[20,80];order=1">
[
["[L4325]@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@個別利率批次輸入"],
[#<->#,"@利率調整日",#AdjDate],
[#<->#,"@作業項目",#TxKindX],
[#<->#,"@戶別種類",#CustTypeX],
["#grid#,{id:1,expand:true,loop:100,row_height:1,s_cols:[,,,,,,,,,,200,100,,,], p_cols:[]}","","",
["戶號","額度","撥款","戶名","商品代碼","利率加減碼","合約利率","目前利率","擬調利率","調整後利率","調整確認","調整週期","目前生效日","本次生效日","繳息迄日"],
[[#CustNo1],
[#FacmNo1],
[#BormNo1],
[#CustName1],
[#ProdNo1],
[#RateIncr1],
[#ContractRate1],
[#PresentRate1],
[#ProposalRate1],
[#AdjustedRate1],
[#KeyInColA1,#TextA1,#LableA1],
[#AdjFreq1],
[#PresEffDate1],
[#CurtEffDate1],
[#PrevIntDate1]
]],
]

! Help
<include src="HELPRIM.icf::HELPRIM.rtn"/>

![戶別]
#CDDEF01=x,26,S
T(3,CdCode.EntCode2)

#EntCodeHelp=x,1024,S 

![作業項目]
#CDDEF02=x,26,S
T(3,CdCode.TxKind)

#TxKindHelp=x,1024,S 

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDDEF01,#CDDEF02)
R(1,XXR99)
CALL(#HelpProc) 
T(2,@EntCodeHelp,#HelpDesc1)
T(2,@TxKindHelp,#HelpDesc2)  

#CHAIN=A,1,S
T(4,CHAIN$) 
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:L4031進入),$)


#NTXBUF=X,14,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@AdjDate,#NTXBUF,1,7)
T(1,@TxKind,#NTXBUF,8,1)
T(1,@CustType,#NTXBUF,9,1)

#PreCol=A,1,S
INVOKEJS(SHOW,grd1,0)

! 利率調整日
#AdjDate=D,7,L
C(3,#CHAIN,0,$,s)
E(0,#SYSDATE)

! 作業項目
#TxKind=A,1,L
C(3,#CHAIN,0,$,s)
HELP(#TxKindHelp)
@V(H,#TxKindHelp)

#TxKindX=X,16,L
T(3,)T(H,#TxKind,#TxKindHelp)
!SWITCH(#TxKind,
!1,T(3,定期機動調整),
!2,T(3,指數型利率調整),
!3,T(3,機動利率調整),
!4,T(3,員工利率調整),
!5,T(3,按商品別調整),
!  T(3,))

! 戶別
#CustType=A,1,L
C(3,#CHAIN,0,$,s)
E(0,1)
HELP(#EntCodeHelp)
@V(H,#EntCodeHelp)

#CustTypeX=X,30,L
T(3,)T(H,#CustType,#EntCodeHelp)
!SWITCH(#CustType,1,T(3,個金),2,T(3,企金（含企金自然人）),T(3,))
INVOKEJS(SHOW,grd1,1)


<include src="ROM.icf::L4R13.dec"/>

#RimAdjDate=D,7,S
E(0,#AdjDate)
#RimTxKind=A,1,S
E(0,#TxKind)
#RimCustType=A,1,S
E(0,#CustType)


#RimL4r13=X,1,S
RESET_RIM(#RimL4r13,L4R13)
S(L4R13,1,#RimAdjDate,#RimTxKind,#RimCustType)
R(1,L4R13)
##loop {times:100,i:1,j:1}
E(0,@CustNo{i},#L4r13CustNo{i})
E(0,@FacmNo{i},#L4r13FacmNo{i})
E(0,@BormNo{i},#L4r13BormNo{i})
T(2,@CustName{i},#L4r13CustName{i})
T(2,@ProdNo{i},#L4r13ProdNo{i})

E(0,@AdjFreq{i},#L4r13AdjFreq{i})
E(0,@PresEffDate{i},#L4r13PresEffDate{i})
E(0,@CurtEffDate{i},#L4r13CurtEffDate{i})
E(0,@PrevIntDate{i},#L4r13PrevIntDate{i})

E(5,@RateIncr{i},#L4r13RateIncr{i})
E(5,@ContractRate{i},#L4r13ContractRate{i})
E(5,@PresentRate{i},#L4r13PresentRate{i})
E(5,@ProposalRate{i},#L4r13ProposalRate{i})
E(5,@AdjustedRate{i},#L4r13AdjustedRate{i})
E(5,@LowLimitRate{i},#L4r13LowLimitRate{i})

! 欄位顯示
#COLDIS{i}=A,1,S
IF(#CustNo{i}==0,INVOKEJS(SHOW,grd1_{j},0),INVOKEJS(SHOW,grd1_{j},1))
##end

##loop {times:100,i:1}
#ShowColA{i}=A,1,S
HIDE(#TextA{i},#KeyInColA{i},#LableA{i})
##end

##loop {times:100,i:1}
#CustNo{i}=A,7,L
#FacmNo{i}=A,3,L
#BormNo{i}=A,3,L
#CustName{i}=X,20,L
#ProdNo{i}=X,5,L

#AdjFreq{i}=m,2,L
#PresEffDate{i}=D,7,L
#CurtEffDate{i}=D,7,L
#PrevIntDate{i}=D,7,L

#RateIncr{i}=m,2.4,L
#ContractRate{i}=m,2.4,L
#PresentRate{i}=m,2.4,L
#ProposalRate{i}=m,2.4,L
#LowLimitRate{i}=m,2.4,L

#LowLimitRateX{i}=x,7,L
X(#LowLimitRate{i})

#TextB{i}=x,50,S
T(2,請確認輸入利率，不可低於商品檔設定之下限: +#LowLimitRateX{i})

#AdjustedRate{i}=m,2.4,I
IF(#CustNo{i}==0,s,$)
@IF(#AdjustedRate{i}<#LowLimitRate{i},V(P,#TextB{i}),$)

#ShowColB{i}=A,1,S
C(3,#AdjustedRate{i},0,SHOW(#TextA{i},#KeyInColA{i})HIDE(#LableA{i}),SHOW(#LableA{i})HIDE(#TextA{i},#KeyInColA{i}))

#TextA{i}=x,23,L
T(2,請確認輸入利率為0.0000)

#KeyInColA{i}=X,1,I
IF(#CustNo{i}==0,s,$)
IF(#AdjustedRate{i}==0,$,s)
SHOW(#TextA{i},#KeyInColA{i})
HELP(Y: )
@C(4,#KeyInColA{i},HIDE(#TextA{i},#KeyInColA{i}),SHOW(#TextA{i},#KeyInColA{i}))


#LableA{i}=x,13,L
T(2,            Y)

##end

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L4325 -----------
<sub type="FORM" name="L4325">
</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#RimAdjDate
##loop {times:100,i:1}
#CustNo{i}
#FacmNo{i}
#BormNo{i}
#AdjustedRate{i}
#KeyInColA{i}
##end
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
TXFORM=L4325
^
<include src="ROM.icf::L4R13.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>


!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
</sub>
