!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L4510)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L4510" layout="cols=1;screen.width=[130,870];printer.width=[20,80];order=1">
[
["[L4510]@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@產出員工扣薪明細檔"],
[#<->#,"#FdMediaDate+媒體日期",#MediaDate],
[#<->#,"#FdFunctionCode+查詢選項",#FunctionCode,#FunctionCodeX],
[#<->#,"@@@@@@產出報表","火險費扣薪明細表"],
[#<->#,"@@@@@@@@@","帳管費扣薪明細表"],
[#<->#,"@@@@@@@@@","扣薪媒體明細表"],
["#grid#,{id:1,expand:true,loop:9,row_height:1,s_cols:[80,100,100,100], p_cols:[10,10,10,10]}","","",
["流程別","工作月份","媒體日期","入帳日期"],
[[#Flow1],[#WorkMonth1],[#MediaDate1],[#EntryDate1],
[]]],
]

#FdMediaDate=X,2,L
T(3,*)
#FdFunctionCode=X,2,L
T(3,*)

#CHAIN=A,1,S
T(4,CHAIN$) 

#FORE_MONTH=D,8,S
D(7,3,#SYSDATE,1,0)

! 預設:第一次三個都印
!      第二次只印媒體明細
#ColDIS=A,1,S
E(0,@MediaDate,#SYSDATE)
C(3,#BATNO,0,T(2,@FlagA,Y)T(2,@FlagB,Y),T(2,@FlagA, )T(2,@FlagB, ))

#NTXBUF=X,8,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@FunctionCode,#NTXBUF,7,1)

#MediaDate=D,7,I
INVOKEJS(SHOW,L4510_5,0)
@C(3,#MediaDate,0,V(P,請輸入日期),$)
A(DATE,0,#MediaDate)
INVOKEJS(SHOW,L4510_5,1)

! 查詢選項
#FunctionHelp=x,20,S
T(3,1:15日薪;2:非15日薪)

#FunctionCode=A,1,I
HELP(#FunctionHelp)
@V(H,#FunctionHelp)
#FunctionCodeX=X,10,L
T(3,)T(H,#FunctionCode,#FunctionHelp)

#RimToday=D,7,S
E(0,#MediaDate)

<include src="ROM.icf::L4R16.dec"/>

#RimL4r16=X,1,S
RESET_RIM(#RimL4r16,L4R16)
S(L4R16,1,#RimToday)
R(1,L4R16)
##loop {times:9,i:1}
E(0,@EntryDate{i},#L4r16EntryDate{i})
E(0,@MediaDate{i},#L4r16MediaDate{i})
E(0,@WorkMonth{i},#L4r16WorkMonth{i})
##end

##loop {times:9,i:1,j:1}
#Flow{i}=m,1,L
E(0,{i})
#Col{i}=A,1,S
C(3,#WorkMonth{i},0,INVOKEJS(SHOW,grd1_{j},0),INVOKEJS(SHOW,grd1_{j},1))
##end

! 非15日薪
##loop {times:9,i:1}
#WorkMonth{i}=A,5,L

#MediaDate{i}=D,7,L

#EntryDate{i}=D,7,L

##end


#FlagA=X,1,S
! HELP(Y: ;N: )
! 查詢選項

#FlagB=X,1,S
! HELP(Y: ;N: )
! 查詢選項

! 每天RESET
#BATNO=A,3,S

#ReportA=A,1,S
C(4,#FlagA,$,s)
E(0,1)

#ReportB=A,1,S
C(4,#FlagB,$,s)
E(0,1)

#ReportC=A,1,S
E(0,1)

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>

</sub>

!------------ TXFORM = L4510 -----------
<sub type="FORM" name="L4510" tota-mode="1">

#OReportA=X,8,O
#SnoA=A,8,S
E(0,@SnoA,#OReportA)
#PdfPrtA=A,1,S
C(3,#SnoA,0,E(0,0),E(0,1))

#OReportB=X,8,O
#SnoB=A,8,S
E(0,@SnoB,#OReportB)
#PdfPrtB=A,1,S
C(3,#SnoB,0,E(0,0),E(0,1))

#OReportC=X,8,O
#SnoC=A,8,S
E(0,@SnoC,#OReportC)
#PdfPrtC=A,1,S
C(3,#SnoC,0,E(0,0),E(0,1))

#OReportD=X,8,O
#SnoD=A,8,S
E(0,@SnoD,#OReportD)
#PdfPrtD=A,1,S
C(3,#SnoD,0,E(0,0),E(0,1))

#OReportE=X,8,O
#SnoE=A,8,S
E(0,@SnoE,#OReportE)
#PdfPrtE=A,1,S
C(3,#SnoE,0,E(0,0),E(0,1))

#OReportF=X,8,O
#SnoF=A,8,S
E(0,@SnoF,#OReportF)
#PdfPrtF=A,1,S
C(3,#SnoF,0,E(0,0),E(0,1))

</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#MediaDate
#FunctionCode
#FlagA
#FlagB
#BATNO
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
TXFORM=L4510
#OReportA
#OReportB
#OReportC
#OReportD
#OReportE
#OReportF
^
<include src="ROM.icf::L4R16.tom"/>

</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
#PdfPrtA=1,PDF,,,,,,,,,,,,,SnoA,非15日薪-火險費扣薪明細表
^
#PdfPrtB=1,PDF,,,,,,,,,,,,,SnoB,非15日薪-帳管費扣薪明細表
^
#PdfPrtC=1,PDF,,,,,,,,,,,,,SnoC,非15日薪-扣薪媒體明細表
^
#PdfPrtD=1,PDF,,,,,,,,,,,,,SnoD,15日薪-火險費扣薪明細表
^
#PdfPrtE=1,PDF,,,,,,,,,,,,,SnoE,15日薪-帳管費扣薪明細表
^
#PdfPrtF=1,PDF,,,,,,,,,,,,,SnoF,15日薪-扣薪媒體明細表
^

</sub>
