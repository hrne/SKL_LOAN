----- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

!#TXCD
!T(3,L4610)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)

</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=3;screen.width=[200,320,150,320];printer.width=[20,20,20,20];order=1;">
[
["[L4610]                                 保險單明細資料登錄"],
[#<->#,"#FdFunctionCodeX+功能",#FunctionCodeX],
[#<->#,"#FdClCode1+代號1",#ClCode1,#ClCode1X],
[#<->#,"#FdClCode2+代號2",#ClCode2,#ClCode2X],
[#<->#,"#FdClNo+擔保品號碼",#ClNo],
["#FdPrevInsuNo+保險單號碼",#PrevInsuNo],["#FdEndoInsuNo+批單號碼",#EndoInsuNo,#EndoInsuNoX],
["#FdInsuCompany+保險公司",#InsuCompany,#InsuCompanyX],["#FdInsuTypeCode+保險類別",#InsuTypeCode,#InsuTypeCodeX],
["#FdFireInsuCovrg+火災險保險金額",#FireInsuCovrg,#FireInsuCovrgL],["#FdFireInsuPrem+火災險保費",#FireInsuPrem,#FireInsuPremL],
["#FdEthqInsuCovrg+地震險保險金額",#EthqInsuCovrg,#EthqInsuCovrgL],["#FdEthqInsuPrem+地震險保費",#EthqInsuPrem,#EthqInsuPremL],
["#FdInsuStartDate+保險起日",#InsuStartDate],["#FdInsuEndDate+保險迄日",#InsuEndDate],
[#<->#,"#FdCommericalFlag+住宅險改商業險註記",#CommericalFlag],
[#<->#,"#FdRemark+備註",#Remark],
]

#FdFunctionCodeX=X,2,L
#FdClCode1=X,2,L
#FdClCode2=X,2,L
#FdClNo=X,2,L
#FdPrevInsuNo=X,2,L
T(3,*)
#FdInsuCompany=X,2,L
T(3,*)

! 20210911 xiangwei
! 這裡的星號顯示判定改在下方做
#FdFireInsuCovrg=X,2,L
#FdEthqInsuCovrg=X,2,L

#FdInsuStartDate=X,2,L
T(3,*)
#FdEndoInsuNo=X,2,L
#FdInsuTypeCode=X,2,L
T(3,*)

#FdCommericalFlag=X,2,L

! 20210911 xiangwei
! 這裡的星號顯示判定改在下方做
#FdFireInsuPrem=X,2,L
#FdEthqInsuPrem=X,2,L

#FdInsuEndDate=X,2,L
T(3,*)

#FdRemark=X,2,L

!---------- AP Button AREA ----------
![Buttom資料查詢]

!Help
<include src="HELPRIM.icf::HELPRIM.rtn"/>

![代號2]
#CDDEF01=x,26,S
T(3,CdCode.ClCode21)

#ClCode2Help=x,1024,S

![保險公司]
#CDDEF02=x,26,S
T(3,CdCode.InsuCompany)

#InsuCompanyHelp=x,1024,S

![保險類別]
#CDDEF03=x,26,S
T(3,CdCode.InsuTypeCode)

#InsuTypeCodeHelp=x,1024,S

![代號1]
#CDDEF04=x,26,S
T(3,CdCode.ClCode1)

#ClCode1Help=x,1024,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDDEF01,#CDDEF02,#CDDEF03,#CDDEF04)
R(1,XXR99)
CALL(#HelpProc)
T(2,@ClCode2Help,#HelpDesc1)
T(2,@InsuCompanyHelp,#HelpDesc2)
T(2,@InsuTypeCodeHelp,#HelpDesc3)
T(2,@ClCode1Help,#HelpDesc4)

#FunctionHelp=x,50,S
T(3,1:新增;2:修改;4:刪除;5:查詢)

#CHAIN=A,1,S
T(4,CHAIN$)
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:L4060進入),$)

#NTXBUF=X,200,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@FunctionCode,#NTXBUF,1,1)
T(1,@ClCode1,#NTXBUF,2,1)
T(1,@ClCode2,#NTXBUF,3,2)
T(1,@ClNo,#NTXBUF,5,7)
T(1,@PrevInsuNo,#NTXBUF,12,16)
T(1,@EndoInsuNo,#NTXBUF,28,16)

! 按鈕傳值不會補零，需先轉型態
#FireInsuCovrgX=X,18,S
E(0,@FireInsuCovrgL,#FireInsuCovrgX)
E(0,@FireInsuCovrg,#FireInsuCovrgX)
#EthqInsuCovrgX=X,18,S
E(0,@EthqInsuCovrgL,#EthqInsuCovrgX)
E(0,@EthqInsuCovrg,#EthqInsuCovrgX)
#FireInsuPremX=X,18,S
E(0,@FireInsuPremL,#FireInsuPremX)
E(0,@FireInsuPrem,#FireInsuPremX)
#EthqInsuPremX=X,18,S
E(0,@EthqInsuPremL,#EthqInsuPremX)
E(0,@EthqInsuPrem,#EthqInsuPremX)




!隱藏INPUT,LABEL

! 新保:1 、 自保:2
#InsuFlag=A,1,S

#WKHIDE=X,1,S
HIDE(#FireInsuCovrg,#FireInsuCovrgL
,#EthqInsuCovrg,#EthqInsuCovrgL
,#FireInsuPrem,#FireInsuPremL
,#EthqInsuPrem,#EthqInsuPremL
,#InsuStartDate,#InsuStartDateL
,#InsuEndDate,#InsuEndDateL)

!---------- AP TEXT AREA Variables ----------

!功能 下拉式選單 1.新增 2.修改 4.刪除 5.查詢
#FunctionCode=A,1,S
C(3,#CHAIN,0,E(0,1),$)
C(2,#FunctionCode,$,s,$,s,$)
HELP(#FunctionHelp)
@V(H,#FunctionHelp)
E(0,@FUNCIND,#FunctionCode)

#FunctionCodeX=X,4,L
T(3,)T(H,#FunctionCode,#FunctionHelp)
C(2,#FunctionCode,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),$,K(MODIFYBUTTON,刪除),K(MODIFYBUTTON,查詢))
C(3,#FunctionCode,5,K(NOBUTTON,CLOSEY),$)
!C(2,#FunctionCode,T(3,),
!           T(3,新增),
!           T(3,修改),
!           T(3,),
!           T(3,刪除),
!           T(3,查詢))

!刪除隱藏重新交易按鈕
#AGAIN=X,1,S
C(3,#FunctionCode,1,S,$)
E(0,1)ASGN(AGAIN$)

! 修改、刪除調Rim
<include src="ROM.icf::L4R25.dec"/>

! InsuOrignal續保檔Key
#RimClCode1=A,1,S
#RimClCode2=A,2,S
#RimClNo=A,7,S
#RimPrevInsuNo=x,16,S
#RimEndoInsuNo=x,16,S

! 塞值調rim，無值提error
#RimL4R25=X,1,S
C(3,#FunctionCode,1,s,$)
E(0,@RimClCode1,#ClCode1)
E(0,@RimClCode2,#ClCode2)
E(0,@RimClNo,#ClNo)
T(2,@RimPrevInsuNo,#PrevInsuNo)
T(2,@RimEndoInsuNo,#EndoInsuNo)
RESET_RIM(#RimL4R25,L4R25)
S(L4R25,1,#RimClCode1,#RimClCode2,#RimClNo,#RimPrevInsuNo,#RimEndoInsuNo)
R(1,L4R25)

#ReceiveL4r25=X,1,S
C(3,#FunctionCode,1,s,$)
E(0,@InsuCompany,#L4r25InsuCompany)
E(0,@InsuTypeCode,#L4r25InsuTypeCode)
E(0,@FireInsuCovrg,#L4r25FireInsuCovrg)
E(0,@FireInsuCovrgL,#L4r25FireInsuCovrg)
E(0,@EthqInsuCovrg,#L4r25EthqInsuCovrg)
E(0,@EthqInsuCovrgL,#L4r25EthqInsuCovrg)
E(0,@FireInsuPrem,#L4r25FireInsuPrem)
E(0,@FireInsuPremL,#L4r25FireInsuPrem)
E(0,@EthqInsuPrem,#L4r25EthqInsuPrem)
E(0,@EthqInsuPremL,#L4r25EthqInsuPrem)
E(0,@InsuStartDate,#L4r25InsuStartDate)
E(0,@InsuEndDate,#L4r25InsuEndDate)
T(2,@CommericalFlag,#L4r25CommericalFlag)
T(2,@Remark,#L4r25Remark)

! 20210911 xiangwei
! 地震險/火險: 這裡改為預設將星號放在火險上
#ShowFd=X,1,S
C(2,#FunctionCode,T(3, ),T(3,*),T(3,*),T(3,*),T(3, ),T(3, ))
T(2,@FdPrevInsuNo,#ShowFd)     
T(2,@FdInsuCompany,#ShowFd)
T(2,@FdInsuStartDate,#ShowFd)
T(2,@FdInsuTypeCode,#ShowFd)
T(2,@FdInsuEndDate,#ShowFd)
T(2,@FdFireInsuCovrg,#ShowFd)
T(2,@FdFireInsuPrem,#ShowFd)

#Function2=X,1,S
IF(#FunctionCode==2,
T(F,#PrevInsuNo,0)
T(F,#EndoInsuNo,0),$)

#Border=A,1,S
IF(#FunctionCode == 4 || #FunctionCode == 5,
T(F,#PrevInsuNo,0)
T(F,#EndoInsuNo,0)
T(F,#InsuCompany,0)
T(F,#InsuTypeCode,0)
T(F,#InsuStartDate,0)
T(F,#InsuEndDate,0)
T(F,#CommericalFlag,0)
T(F,#Remark,0)
,
HIDE(#EndoInsuNoX))


!顯示INPUT,LABEL
#WKSHOW=X,1,S
IF (#FunctionCode==1 || #FunctionCode==2,
   SHOW(#FireInsuCovrg,#EthqInsuCovrg,#FireInsuPrem,#EthqInsuPrem,#InsuStartDate,#InsuEndDate)
   HIDE(#FireInsuCovrgL,#EthqInsuCovrgL,#FireInsuPremL,#EthqInsuPremL),
   SHOW(#FireInsuCovrgL,#EthqInsuCovrgL,#FireInsuPremL,#EthqInsuPremL,#InsuStartDate,#InsuEndDate)
   HIDE(#FireInsuCovrg,#EthqInsuCovrg,#FireInsuPrem,#EthqInsuPrem))
C(3,#FunctionCode,1,SHOW(#EndoInsuNo),HIDE(#EndoInsuNoX))

!代號1 固定為房地,不需輸入
#ClCode1=A,1,L
T(1,@ClCode1,#NTXBUF,2,1)
T(1,@ClCode2,#NTXBUF,3,2)

#ClCode1X=X,4,L
T(3,)T(H,#ClCode1,#ClCode1Help)

!代號2 下拉式選單 必須輸入且檢核
#ClCode2=A,2,L
! C(4,#ClCode2,$,s)
!C(2,#FunctionCode,s,$,$,s,s,s)
HELP(#ClCode2Help)
@V(H,#ClCode2Help)

#ClCode2X=X,11,L
T(3,)T(H,#ClCode2,#ClCode2Help)
!SWITCH(#ClCode2,
!       01,T(3,房地-住宅),
!       02,T(3,房地-辦公),
!       03,T(3,房地-商場),
!       04,T(3,房地-廠房),
!       05,T(3,房地-停車位),
!       99,T(3,房地-其他),
!      )

!擔保品號碼 必須輸入
#ClNo=A,7,L
!C(2,#FunctionCode,s,$,$,s,s,s)
@V(2,0)

!原保單號碼
#PrevInsuNo=X,16,I
C(2,#FunctionCode,s,$,s,s,s,s)
@V(7)
V(2,0)

#EndoInsuNo=X,16,I
C(2,#FunctionCode,s,$,s,s,s,s)

#EndoInsuNoX=X,16,L

!保險單號碼 必須輸入 TODO:新增時需檢查保單號碼是否已存在(調RIM檢查)
#NowInsuNo=X,16,S
C(2,#FunctionCode,s,$,$,s,s,s)
C(4,#PrevInsuNo,$,s)


!保險公司 必須輸入
#InsuCompany=A,2,I
C(2,#FunctionCode,s,$,$,s,s,s)
HELP(#InsuCompanyHelp)
@V(H,#InsuCompanyHelp)

!HELP(L2DEF,ISUCOMPANYDEF,ISUCOM,ISUCOMX,cols:5)
!@V(E,0,L2DEF,ISUCOMPANYDEF)

#InsuCompanyX=X,10,L
C(4,#InsuCompany,S,$)
T(H,#InsuCompany,#InsuCompanyHelp)
!T(A,#InsuCompany,L2DEF,ISUCOMPANYDEF,ISUCOM,ISUCOMX)

! 保險類別
#InsuTypeCode=A,2,I
C(2,#FunctionCode,s,$,$,s,s,s)
HELP(#InsuTypeCodeHelp)
@C(4,#InsuTypeCode,S,$)       
V(H,#InsuTypeCodeHelp)
!HELP(L2DEF,ISUTYPEDEF,ISUTYPE,ISUTYPEX,cols:5)
!@C(4,#InsuTypeCode,S,I)
!V(E,0,L2DEF,ISUTYPEDEF)

#InsuTypeCodeX=X,14,L
C(4,#InsuTypeCode,S,$)
T(H,#InsuTypeCode,#InsuTypeCodeHelp)
!T(A,#InsuTypeCode,L2DEF,ISUTYPEDEF,ISUTYPE,ISUTYPEX)


!火災險保險金額 新增、修改時必須輸入,其他自動顯示不必輸入
! 20210911 xiangwei
! 當火險輸入完金額仍為0時, 將星號放到地震險那裏去
! 同時也改變保費星號的顯示
#FireInsuCovrg=m,14,I
C(2,#FunctionCode,s,$,$,s,s,s)
@IF(#FireInsuCovrg==0,T(2,@FdFireInsuCovrg, )T(2,@FdEthqInsuCovrg,#ShowFd)T(2,@FdFireInsuPrem, )T(2,@FdEthqInsuPrem,#ShowFd),T(2,@FdFireInsuCovrg,#ShowFd)T(2,@FdEthqInsuCovrg, )T(2,@FdFireInsuPrem,#ShowFd)T(2,@FdEthqInsuPrem, ))

#FireInsuCovrgL=m,14,L

!火災險保費
#FireInsuPrem=m,14,I
C(2,#FunctionCode,s,$,$,s,s,s)
C(3,#FireInsuCovrg,0,S,$)
@C(3,#FireInsuPrem,0,V(P,請輸入金額),$)
#FireInsuPremL=m,14,L

!地震險保險金額
#EthqInsuCovrg=m,14,I
C(2,#FunctionCode,s,$,$,s,s,s)

#EthqInsuCovrgL=m,14,L

!檢查 地震險保險金額 + 火災險保險金額 > 0
! 20210911 xiangwei
! 加上@號, 否則原本好像不會實際判定
#CHECK_AMT=m,14,S
@E(2,#FireInsuCovrg+#EthqInsuCovrg)
C(2,#FunctionCode,s,$,$,s,s,s)
IF(#CHECK_AMT==0,V(P,保險金額不可皆為0),$)

!地震險保費
#EthqInsuPrem=m,14,I
C(2,#FunctionCode,s,$,$,s,s,s)
C(3,#EthqInsuCovrg,0,S,$)
@C(3,#EthqInsuPrem,0,V(P,請輸入金額),$)
! C(2,#FunctionCode,S,I,I,S,L,L)
#EthqInsuPremL=m,14,L

!保險起日 新增、修改時必須輸入,其他自動顯示不必輸入
#InsuStartDate=D,7,I
C(2,#FunctionCode,s,$,$,s,s,s)
@IF(#InsuStartDate<10101,V(P,請輸入日期),$)
A(4,0,#InsuStartDate)
#InsuStartDateL=D,7,L
!保險迄日 新增、修改時必須輸入,其他自動顯示不必輸入 保險迄日須＞保險起日
#InsuEndDate=D,7,I
C(2,#FunctionCode,s,$,$,s,s,s)
@IF(#InsuEndDate<=#InsuStartDate,V(P,保險迄日須＞保險起日),$)
A(4,0,#InsuEndDate)



#InsuEndDateL=D,7,L


#CommericalFlag=X,1,I
C(2,#FunctionCode,s,$,$,s,s,s)
@V(3, ,Y)


#Remark=X,50,I
C(2,#FunctionCode,s,$,$,s,s,s)

#RPTFG=A,1,S

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>


!---------- TXFORM = L4610 ----------
<sub type="FORM" name="L4610">

!#SCRPRT=_,_,S
!C(5,#TXFORM,L4610,$,S)

#SCRTIL=_,_,S
T(3,[L4610] 保險單明細資料登錄)

!------ TOM(HEAD)   Variables (FOR OUTPUT SCREEN) ------
!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------

!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------

</sub>


!------ 上行電文 ------
<sub type="TIM">
#FunctionCode
#InsuFlag
#ClCode1
#ClCode2
#ClNo
#PrevInsuNo
#EndoInsuNo
#NowInsuNo
#InsuCompany
#InsuTypeCode
#FireInsuCovrg
#EthqInsuCovrg
#FireInsuPrem
#EthqInsuPrem
#InsuStartDate
#InsuEndDate
#CommericalFlag
#Remark
</sub>


!------ 下行電文TOM ------
<sub type="TOM">
TXFORM=L4610^
<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L4R25.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>


!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
</sub>
