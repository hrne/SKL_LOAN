!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L4101" layout="cols=1;screen.width=[250,750];printer.width=[20,80];order=1">
[
["[L4101]                                 撥款退款作業"],
[#<->#,"#FdAcDate+會計日期",#AcDate],
[#<->#,"#FdItemCode+作業項目",#ItemCode,#ItemCodeX],
[#<->#,"#FdReleaseCheck+是否檢核未放行",#ReleaseCheck,#ReleaseCheckX],
[#<->#,"#FdBatchNo+整批批號",#BatchNo],
]

#FdAcDate=X,2,L
#FdItemCode=X,2,L
T(3,*)
#FdReleaseCheck=X,2,L
#FdBatchNo=X,2,L

#ReleaseCheckHELP=X,1024,S
T(3,Y:是;N:否)

#ItemCodeHelp=x,1024,S
T(3,1:撥款;2:退款)

#CHAIN=A,1,S
T(4,CHAIN$) 

#Init=X,1,S
INVOKEJS(SHOW,L4101,3,3,0)

#NTXBUF=X,17,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@BatchNo,#NTXBUF,1,6)


! 會計日期
#AcDate=D,7,L
E(0,#SYSDATE)

!作業項目

#ItemCode=X,1,I
HELP(#ItemCodeHelp)
@V(H,#ItemCodeHelp)

#ItemCodeX=X,10,L
T(3,)
T(H,#ItemCode,#ItemCodeHelp)
IF(#ItemCode=="1",INVOKEJS(SHOW,L4101,3,3,1),INVOKEJS(SHOW,L4101,3,3,0))



!是否檢核未放行
#ReleaseCheck=X,1,I
IF(#ItemCode=="1",$,S)
C(4,#ReleaseCheck,T(3,Y),$)
HELP(#ReleaseCheckHELP)
@V(H,#ReleaseCheckHELP)

#ReleaseCheckX=X,2,L
T(3,)T(H,#ReleaseCheckHELP,#ReleaseCheckX)



![整批批號]
#BatchNo=X,6,L

#FlagA=X,1,S
T(2,Y)
</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
![顯示註記]
#L411APRT=A,1,S
C(4,#FlagA,E(0,0),E(0,1))
![資料表頭(HEADER)長度]
#L411AHD=n,3,S
C(4,#FlagA,S,$)E(0,36)ASGN(INQHD$)
![每筆明細(OCCURS)長度]
#L411ALN=n,3,S
C(4,#FlagA,S,$)E(0,112)ASGN(INQLEN$)
![每張印錄單列印的筆數]
#L411AQPRT=n,2,S
C(4,#FlagA,S,$)E(0,30)ASGN(INQPRT$)
![畫面顯示的明細間的高度]
#L411ALOOP=n,3,S
C(4,#FlagA,S,$)E(0,1)ASGN(LOOPHEIGHT$)

![顯示註記]
#L411BPRT=A,1,S
C(4,#FlagA,E(0,0),E(0,1))
![資料表頭(HEADER)長度]
#L411BHD=n,3,S
C(4,#FlagA,S,$)E(0,26)ASGN(INQHD$)
![每筆明細(OCCURS)長度]
#L411BLN=n,3,S
C(4,#FlagA,S,$)E(0,210)ASGN(INQLEN$)
![每張印錄單列印的筆數]
#L411BQPRT=n,2,S
C(4,#FlagA,S,$)E(0,30)ASGN(INQPRT$)
![畫面顯示的明細間的高度]
#L411BLOOP=n,3,S
C(4,#FlagA,S,$)E(0,1)ASGN(LOOPHEIGHT$)
</sub>

!------------ TXFORM = L4101 -----------
<sub type="FORM" name="L411A" tota-mode="1">
#ReportABatchNo=A,2,O
#ReportACnt=m,6,O
#ReportADdSum=m,14,O
#ReportACrSum=m,14,O

#L411A_LOOP=X,1,S
E(0,1)ASGN(LOOP$)

#ReportAAcDate=D,7,O

![科子細目]
#ReportAAcNoCode=X,16,O

![科子目名稱]
#ReportAAcNoCodeX=X,40,O

![登放序號]
#ReportARelTxseq=X,18,O

![借方金額]
#ReportADbAmt=m,14,O

![貸方金額]
#ReportACrAmt=m,14,O



![防止二次單據]
E(0,@L411BPRT,0)
</sub>

<sub type="FORM" name="L411B" tota-mode="1">
!		編號 戶號 戶名 銀行別 分行別 匯款帳號 收款人 匯款金額 核貸金額 站別 專辦
!	        					小計
!		總計  戶數 小計合計 沖轉數

#ReportBCnt=m,6,O
#ReportBTotalSum=m,14,O
#ReportBCorCnt=m,6,O

#L411B_LOOP=X,1,S
E(0,1)ASGN(LOOP$)

#ReportBLine=X,210,O
![防止二次單據]
E(0,@L411APRT,0)
</sub>
<sub type="FORM" name="L4101" tota-mode="1">

! 媒體檔FileNo
#PdfSnoM=X,8,S
E(2,@SnoM,#PdfSnoM)
#SnoM=A,8,S

! 媒體檔FileNo
#PdfPrtM=A,1,S
C(3,#SnoM,0,E(0,0),E(0,1))
![防止二次單據]
E(0,@L411BPRT,0)
E(0,@L411APRT,0)

! 匯款單FileNo
#PdfSnoF=X,8,S
E(2,@SnoF,#PdfSnoF)

#OBatchNo=X,6,S
T(2,@BatchNo,#OBatchNo)

#SnoF=A,8,S

! 匯款單FileNo
#PdfPrtF=A,1,S
C(3,#SnoF,0,E(0,0),E(0,1))
![防止二次單據]
E(0,@L411BPRT,0)
E(0,@L411APRT,0)

</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#AcDate
#ReleaseCheck
#BatchNo
#ItemCode
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
TXFORM=L411A
#ReportABatchNo
#ReportACnt
#ReportADdSum
#ReportACrSum

#ReportAAcDate
#ReportAAcNoCode
#ReportAAcNoCodeX
#ReportARelTxseq
#ReportADbAmt
#ReportACrAmt
^
TXFORM=L411B
#ReportBCnt
#ReportBTotalSum
#ReportBCorCnt

#ReportBLine
^
TXFORM=L4101
#OBatchNo
^
</sub>

! pdf:1, excel:2, txt:3(分號區隔)
!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
#L411APRT=1,L411A,NA,,D,15
#ReportABatchNo
%
#ReportAAcDate
#ReportAAcNoCode
#ReportAAcNoCodeX
#ReportARelTxseq
#ReportADbAmt
#ReportACrAmt
@
#ReportACnt
#ReportADdSum
#ReportACrSum
^

#L411BPRT=1,L411B,NA,,D,15
%
#ReportBLine
@
#ReportBCnt
#ReportBTotalSum
#ReportBCorCnt
^
#PdfPrtM=1,PDF,,,,,,,,,,,,,PdfSnoM;3,撥款匯款媒體檔
^
#PdfPrtF=1,PDF,,,,,,,,,,,,,PdfSnoF,撥款匯款申請書
^

</sub>
