!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

#TXCD=_,_,S
T(3,LD006)

</sub>
<sub type="PREDC" name="PreDC">
<include src="COM.icf::TITLE-RUN.pre"/>
</sub>


<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD2.dec"/>


</sub>



!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=1;screen.width=[140,850];printer.width=[20,80];">
[
["[LD006]                                  LD006三階放款明細統計"],
["#FdMain+查詢條件","@(工作月期間、撥款起訖日，需擇一輸入)"],
["#FdWorkMonth+．工作月區間",#workMonthStart," ~ ",#workMonthEnd],
["#FddrawdownDate+．撥款起訖日",#drawdownDateStart,"~",#drawdownDateEnd],
["#FdCustNo+戶號",#custNo,"-",#facmNo],
["#FdIntroducer+介紹人",#Introducer,#BtnCdEmp,#IntroducerX],
]
<include src="ROM.icf::L2R08.dec"/>

!---------- AP TEXT AREA Variables ----------
#CHAIN=A,1,S
T(4,CHAIN$)

!-----------------------------------------------------
<include src="HELPRIM.icf::HELPRIM.rtn"/>

![Button資料查詢]
#BtnCdEmp=X,15,I,ui:button;value:員工資料查詢;enable:1;tabbable:0;title:L190A 員工資料檔查詢;
#BindCdEmp=X,1,S
BIND(#BtnCdEmp,click, {cmd=CHAIN; ntxcd=L190A; ntxbuf=;ntxbuf5=type<-1:Introducer<-OOEmployeeNo:Introducer2<-OOEmployeeNo:IntroducerX<-OOFullname})

#FdMain=X,2,L
T(3,*)

#FdWorkMonth=X,2,L
T(3, )

#FddrawdownDate=X,2,L
T(3, )

#FdCustNo=X,2,L
T(3, )

#FdIntroducer=X,2,L
T(3, )

! 工作月
#workMonthStart=A,5,I
C(3,#workMonthStart,0,T(1,@workMonthStart,#SYSDATE,2,5),$)
@
C(3,#workMonthStart,0,S,A(YM13,1,#workMonthStart))

#workMonthEnd=A,5,I
C(3,#workMonthStart,0,S,C(3,#workMonthEnd,0,E(0,#workMonthStart),$))
@
A(YM13,1,#workMonthEnd)
IF(#workMonthEnd<#workMonthStart,V(P,工作月訖起不得小於工作月起),$)

! 業績日期
#drawdownDateStart=D,7,I
C(3,#workMonthStart,0,$,S)
C(3,#drawdownDateStart,0,T(1,#SYSDATE,2,7),$)
D(8)
@
V(7)
A(DATE,0,#drawdownDateStart)

#drawdownDateEnd=D,7,I
C(3,#workMonthStart,0,$,S)
C(3,#drawdownDateEnd,0,E(0,#drawdownDateStart),$)
D(8)
@
V(7)
A(DATE,0,#drawdownDateEnd)

#checkdrawdownDate=X,1,S
@IF(#drawdownDateEnd>=#drawdownDateStart,$,V(P,撥款訖日不得大於等於起日))

#custNo=A,7,I

#facmNo=A,3,I
C(3,#custNo,0,S,$)

#Introducer=X,6,I

#Introducer2=X,6,S

#IntroducerX=X,40,L
C(4,#Introducer,S,$)

#RimEmployeeNo=X,6,S

#RIM_L2R08=X,1,S
C(4,#Introducer,S,$)
C(5,#Introducer,#Introducer2,S,$)
T(3,@IntroducerX,)
C(4,#Introducer,S,$)
RESET_RIM(#RIM_L2R08,L2R08)
T(2,@RimEmployeeNo,#Introducer)
S(L2R08,1,#RimTxCode,#RimEmployeeNo)
R(1,L2R08)
T(2,@IntroducerX,#L2r08FullName)
T(2,@Introducer2,#Introducer)

<include src="ROM.icf::L0Rim.dec"/>
<include src="ROM.icf::L6R34.dec"/>
</sub>


!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>

#PRTSC_RFG=X,1,S
C(3,#HCODE,1,S,$)
C(5,#TXFORM,LD006,$,S)
C(3,#FKEY,2,E(0,0),E(0,1))

</sub>


!---------- TXFORM = C5100 ----------
<sub type="FORM" name="LD006">

#SCRPRT=_,_,S
C(5,#TXFORM,C5100,$,S)

#SCRTIL=_,_,S
T(3,[LD006] LD006三階放款明細統計)

</sub>

!---------- TXFORM = LD006 ----------
<sub type="FORM" name="LD006">

#SCRPRT=_,_,S
C(5,#TXFORM,LD006,$,S)

#SCRTIL=_,_,S
T(3,[LD006] LD006三階放款明細統計)


#OEMPNOS=X,6,S
IF(#KINBR=="0009"||#KINBR=="0008",T(2,#KINBR+#TlrNoNO),T(2,#EMPNOS))

</sub>


!------ 上行電文TIM：BASIC LABEL + AP TEXT AREA + AP TEXT ------
<sub type="TIM">
#workMonthStart
#workMonthEnd
#drawdownDateStart
#drawdownDateEnd
#custNo
#facmNo
#Introducer
#END
</sub>
!------ 下行電文TOM ------
<sub type="TOM">
<include src="ROM.icf::L2R08.tom"/>
<include src="COM.icf::TRCTL.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>

TXFORM=LD006
^

</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
</sub>

