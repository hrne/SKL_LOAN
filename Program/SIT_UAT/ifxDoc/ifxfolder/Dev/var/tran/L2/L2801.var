!---------- BASIC LABEL Variables ----------
<sub type="SYS">
#KeyInq=X,1,S
K(MODIFYBUTTON,登錄)
</sub>

<sub type="SYS" name="label">

!#TXCD
!T(3,XW111)

![一段式/二段式/三段式]
!#RELCD=_,_,S
!E(0,1)

!#ACTFG=_,_,S
!E(0,1)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!=====================================================================
!#FKEY>0時，重新執行
!=====================================================================
<sub type="PREDC" name="PreDC">

<include src="COM.icf::TITLE-RUN.pre"/>

</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=1;screen.width=[150,1000];printer.width=[20,80];">
[
["[L2801]                                 未齊案件管理"],
["#FdFunCd+功能",#FunCdX],
["#FdCaseNo+案件編號",#CaseNo,#CaseNoX],
["#FdCustNo+借戶戶號",#CustNo,#BTN2,#CustNoX],
["#FdCustId+統一編號",#CustId],
["#FdApplNo+核准編號",#ApplNo],
["#FdFacmNo+額度編號",#FacmNo,#BTN5],
["#FdNotYetCode+未齊件代碼",#NotYetCode,#NotYetCodeX],
["#FdYetDate+齊件訖日",#YetDate],
["#FdCloseDate+銷號日期",#CloseDate],
["#FdReMark+備註",#ReMark],
]

!---------- AP Button AREA ----------
![Buttom資料查詢]
#BTN2=X,15,I,ui:button;value:額度資料查詢;enable:1;tabbable:0;title:L2015 額度明細資料查詢;
#BTN5=X,15,I,ui:button;value:放款資料查詢;enable:1;tabbable:0;title:L3001 放款明細資料查詢

! 永遠為必輸欄位
#FdFunCd=X,2,L
#FdNotYetCode=X,2,L
#FdNotYetCodeX=X,2,L
#FdYetDate=X,2,L
#FdCloseDate=X,2,L
#FdReMark=X,2,L
!---------- AP TEXT AREA Variables ----------
! Help
<include src="HELPRIM.icf::HELPRIM.rtn"/>
!NotYetCode
#CDDEF0001=x,30,S
T(3,CdLoanNotYet)

#NotYetCodeHelpRim=X,1,S
RESET_RIM(#NotYetCodeHelpRim,XXR99)
S(XXR99,01,#CDDEF0001)
R(1,XXR99)
CALL(#HelpProc)
T(2,@NotYetCodeHelp,#HelpDesc1) 

#NotYetCodeHelp=x,1024,S

#SetSysPar=X,1,S
E(0,1)ASGN(AGAIN$)

#FunCdHelp=x,100,S
T(3,1:新增;2:修改;4:刪除;5:查詢)

#CHAIN=A,1,S
T(4,CHAIN$) 
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:[L2921未齊件資料查詢]進入),$)
T(2,@RimTxCode,#TXCD)
E(0,@RimFKey,#FKEY)

#NTXBUF=X,37,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@CHAINFUNCD,#NTXBUF,1,1)
E(0,@FunCd,#CHAINFUNCD)
T(1,@CaseNo,#NTXBUF,2,7)
T(1,@CustNo,#NTXBUF,9,7)
T(1,@CustId,#NTXBUF,16,10)
T(1,@ApplNo,#NTXBUF,26,7)
T(1,@FacmNo,#NTXBUF,33,3)
T(1,@NotYetCode,#NTXBUF,36,2)

#ShowFd=X,1,S
T(3,*)

!CHAIN進時隱藏按鈕
#chainHIDE=X,1,S
C(3,#FunCd,1,$,HIDE(#BTN2)HIDE(#BTN5))
!CHAIN進時隱藏輸入框
IF(#FunCd == 1,T(2,@FdCustNo,#ShowFd)T(2,@FdCustNo,#ShowFd)T(2,@FdFacmNo,#ShowFd)T(2,@FdNotYetCode,#ShowFd)T(2,@FdYetDate,#ShowFd)T(F,@CloseDate,0),$)
IF(#FunCd == 2,T(F,@NotYetCode,0)T(2,@FdYetDate,#ShowFd),$)
IF(#FunCd >= 2,T(F,@CaseNo,0)T(F,@CustNo,0)T(F,@CustNo,0)T(F,@CustId,0)T(F,@ApplNo,0)T(F,@FacmNo,0),$)
IF(#FunCd >= 3,T(F,@NotYetCode,0)T(F,@YetDate,0)T(F,@CloseDate,0)T(F,@ReMark,0),$)


#CHAINFUNCD=A,1,S

![功能]
! 下拉式選單 1.新增 2.修改 3.複製 4.刪除 5.查詢
#FunCd=A,1,S
E(0,#CHAINFUNCD)
C(3,#CHAIN,1,s,$)
HELP(#FunCdHelp) 
@V(H,#FunCdHelp)
E(0,@FUNCIND,#FunCd)

#SetSysPar1=X,1,S
IF(#FunCd ==1 || #FunCd ==3,E(0,0)ASGN(AGAIN$),$)

#FunCdX=X,4,L
C(4,#FunCd,S,$)
T(H,#FunCd,#FunCdHelp)
C(2,#FunCd,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),K(MODIFYBUTTON,複製),K(MODIFYBUTTON,刪除),K(MODIFYBUTTON,查詢)K(NOBUTTON,CLOSEY))

![案件編號]
#FdCaseNo=X,2,L

#CaseNo=A,7,L
C(3,#FunCd,1,$,s)

#SendL2r10=X,1,S
C(3,#CaseNo,0,S,$)
E(0,@RimCaseNo,#CaseNo)
RESET_RIM(#SendL2r10,L2R10)
S(L2R10,1,#RimCaseNo)
R(1,L2R10)

#SendL2r07A=X,1,S
C(3,#CaseNo,0,S,$)
T(2,@RimCustId, )
E(0,@RimCustNo,#L2r10CustNo)
RESET_RIM(#SendL2r07A,L2R07)
S(L2R07,1,#RimTxCode,#RimCustId,#RimCustNo)
R(1,L2R07)
E(0,@FacmNo,#L2r10FacmNo)


#CaseNoX=X,100,L
C(3,#CaseNo,0,S,T(2,#L2r07CustName))


#BUF2A=X,18,S
T(3,00000019999999000)

#BIND2A=X,1,S
BIND(#BTN2,click, {cmd=CHAIN; ntxcd=L2015; ntxbuf=#BUF2A;ntxbuf5=type<-1:CustNo<-OOCustNo:FacmNo<-OOFacmNo})

![借戶戶號]
!借戶戶號, 統一編號或核准編號擇一輸入
#FdCustNo=X,2,L

#CustNo=A,7,I
C(3,#FunCd,1,$,s)
@V(2,0)

#BUF2B=X,18,S
T(2,#CustNo+9999999000)

#BIND2B=X,1,S
BIND(#BTN2,click, {cmd=CHAIN; ntxcd=L2015; ntxbuf=#BUF2B;ntxbuf5=type<-1:CustNo<-OOCustNo:FacmNo<-OOFacmNo})

#SendL2r07B=X,1,S
C(3,#CustNo,0,S,$)
T(3,@RimCustId, )
E(0,@RimCustNo,#CustNo)
RESET_RIM(#SendL2r07B,L2R07)
S(L2R07,1,#RimTxCode,#RimCustId,#RimCustNo)
R(1,L2R07)

#CustNoX=X,100,L
C(3,#CustNo,0,S,T(2,#L2r07CustName))

![統一編號]
#FdCustId=X,2,L

#CustId=X,10,L
C(3,#CustNo,0,S,T(2,#L2r07CustId))

#CheckCustId=X,1,S
C(4,#CustId,S,$)
A(ID_UNINO,0,#CustId)


#SendL2r07C=X,1,S
C(4,#CustId,S,$)
T(2,@RimCustId,#CustId)
E(0,@RimCustNo,0)
RESET_RIM(#SendL2r07C,L2R07)
S(L2R07,1,#RimTxCode,#RimCustId,#RimCustNo)
R(1,L2R07)

#CustIdX=X,100,L
C(4,#CustId,S,T(2,#L2r07CustName))

![核准編號]
#FdApplNo=X,2,L

#ApplNo=A,7,L


!用核准號碼(ApplNo)調L2R05
!#SendL2r05A=X,1,S
!C(3,#ApplNo,0,S,$)
!E(0,@RimFuncCode,5)
!E(0,@RimCustNo,0)
!E(0,@RimFacmNo,0)
!E(0,@RimApplNo,#ApplNo)
!E(0,@RimCaseNo,0)
!RESET_RIM(#SendL2r05A,L2R05)
!S(L2R05,1,#RimFuncCode,#RimTxCode,#RimFKey,#RimCustNo,#RimFacmNo,#RimApplNo,#RimCaseNo)
!R(1,L2R05)
!E(0,@FacmNo,#L2r05FacmNo)

!#SendL2r07D=X,1,S
!C(3,#ApplNo,0,S,$)
!T(2,@RimCustId,#L2r05CustId)
!E(0,@RimCustNo,#CustNo)
!RESET_RIM(#SendL2r07D,L2R07)
!S(L2R07,1,#RimTxCode,#RimCustId,#RimCustNo)
!R(1,L2R07)


!#TimCustNo=A,7,S
!C(3,#CaseNo,0,$,E(0,#L2r10CustNo))
!C(3,#CustNo,0,$,E(0,#CustNo))
!C(4,#CustId,$,E(0,#L2r07CustNo))
!C(3,#ApplNo,0,$,E(0,#L2r05CustNo))
!T(2,@LockCustNo,#CustNo)

#WkCaseNo=A,3,S

#WkFacmNo=A,3,S

#BUF5A=X,32,S
T(2,#CaseNo+#CustNo+#CustId+#ApplNo+0)

#BIND5A=X,1,S
BIND(#BTN5,click, {cmd=CHAIN; ntxcd=L3001; ntxbuf=#BUF5A;ntxbuf5=type<-1:FacmNo<-OOFacmNo})

![額度編號]
!必須輸入
#FdFacmNo=X,2,L

#FacmNo=A,3,I
C(3,#FunCd,1,$,s)
@V(2,0)

!核准號碼已調L2R05除外
#SendL2r05B=X,1,S
E(0,@RimFuncCode,5)
E(0,@RimCustNo,#CustNo)
E(0,@RimFacmNo,#FacmNo)
E(0,@RimApplNo,0)
E(0,@RimCaseNo,0)
RESET_RIM(#SendL2r05B,L2R05)
S(L2R05,1,#RimFuncCode,#RimTxCode,#RimFKey,#RimCustNo,#RimFacmNo,#RimApplNo,#RimCaseNo)
R(1,L2R05)
E(0,@ApplNo,#L2r05ApplNo)


#FIRSTDRAWDATE=D,7,S
C(3,#L2r05FirstDrawdownDate,0,E(0,#SYSCDATE),E(0,#L2r05FirstDrawdownDate))

#WkYetDate=D,8,S
E(0,#FIRSTDRAWDATE+19110000)
!--------------------------------------------------------


![未齊件代碼]
#NotYetCode=A,2,I
C(3,#FunCd,1,$,s)
HELP(#NotYetCodeHelp,cols:2)
@V(H,#NotYetCodeHelp)

#RimNotYetCode=A,2,S

![未齊件說明]
#NotYetCodeX=X,40,L
C(3,#NotYetCode,0,s,$)
T(H,#NotYetCode,#NotYetCodeHelp)

#SendL3r01A=X,1,S
E(0,@RimCustNo,#CustNo)
E(0,@RimFacmNo,#FacmNo)
E(0,@RimNotYetCode,#NotYetCode)
E(0,@RimFunCd,#FunCd)
RESET_RIM(#SendL3r01A,L3R01)
S(L3R01,1,#RimCustNo,#RimFacmNo,#RimNotYetCode,#RimFunCd)
R(1,L3R01)

#RcvL3r01A=X,1,S
E(0,@YetDays,#L3r01YetDays)
E(0,@YetDate,#L3r01YetDate)
E(0,@CloseDate,#L3r01CloseDate)  
T(2,@ReMark,#L3r01ReMark)  

#YetDays=n,3,L

#AYetDate=D,8,L
D(7,2,#WkYetDate,0,#YetDays)
E(0,#AYetDate-19110000)

![齊件日期]
#YetDate=D,7,I
IF(#FunCd == 1 || #FunCd == 2,$,s)
C(3,#FunCd,1,E(0,#AYetDate),$)
@V(7)A(DATE,0,#YetDate)

![銷號日期]
#CloseDate=D,7,I
IF(#FunCd == 2,$,s)
@A(DATE,0,#CloseDate)

#ReMark=x,80,I
IF(#FunCd == 1 || #FunCd == 2,$,s)

<include src="ROM.icf::L0Rim.dec"/>
<include src="ROM.icf::L2Rim.dec"/>
<include src="ROM.icf::L2R01.dec"/>
<include src="ROM.icf::L2R05.dec"/>
<include src="ROM.icf::L2R07.dec"/>
<include src="ROM.icf::L2R10.dec"/>
<include src="ROM.icf::L3R01.dec"/>

</sub>
!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>


!---------- TXFORM = L2801 ----------
<sub type="FORM" name="L2801">

#SCRPRT=_,_,S
C(5,#TXFORM,L2801,$,S)

#SCRTIL=_,_,S
T(3,[L2801] 未齊案件管理)

</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#FunCd
#CaseNo
#CustNo
#CustId
#ApplNo
#FacmNo
#NotYetCode
#YetDate
#CloseDate
#ReMark
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
TXFORM=L2801
^

<include src="COM.icf::TRCTL.tom"/>
<include src="COM.icf::LockControl.tom"/>
<include src="ROM.icf::L2R01.tom"/>
<include src="ROM.icf::L2R05.tom"/>
<include src="ROM.icf::L2R07.tom"/>
<include src="ROM.icf::L2R10.tom"/>
<include src="ROM.icf::L3R01.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>


!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
<include src="PRT.icf::UPDH01.sel"/>
</sub>
