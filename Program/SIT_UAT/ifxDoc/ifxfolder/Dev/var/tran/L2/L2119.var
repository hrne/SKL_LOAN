!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

!#TXCD
!T(3,XW111)


</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
T(2,@RimTxCode,#TXCD)
E(0,@RimFKey,#FKEY)

</sub>

<sub type="PREDC" name="PreDC">

!先隱藏欄位 FLAG 0=隱藏 1=顯示
#HIDE1FG=A,1,S
IF(#FKEY==0,E(0,0),$)


#EXPANDFG=A,1,S
IF(#FKEY==0,E(0,0),$)


!--- P1 主要戶號額度
#HIDEP1=@,1,S
C(3,#EXPANDFG,1,CALL(#EXPAND),$)
C(3,#HIDE1FG,1,E(0,@HIDE1FG,0),E(0,@HIDE1FG,1))
INVOKEJS(SHOW,p2,#HIDE1FG)
C(3,#HIDE1FG,1,K(LIGHT,#BTNHIDEP1,TXTRED,0),K(LIGHT,#BTNHIDEP1,TXTRED,-1))
C(3,#HIDE1FG,1,$,s)
CALL(#CALLGRID)



!--- 展開
#EXPAND=@,1,S
C(3,#EXPANDFG,1,E(0,@EXPANDFG,0),E(0,@EXPANDFG,1))
INVOKEJS(SHOW,p2,#EXPANDFG)
C(3,#EXPANDFG,1,K(LIGHT,#BTNEXPAND,TXTRED,0),K(LIGHT,#BTNEXPAND,TXTRED,-1))
C(3,#EXPANDFG,1,$,s)
E(0,@HIDE1FG,0)
CALL(#CALLGRID)
CALL(#KLIGHT)

!--- 控制grd顯示欄位
#CALLGRID=@,1,S
##loop{times:10,n:1}
IF(#MApplNo{n}==0,INVOKEJS(SHOW,grd1_{n},0),INVOKEJS(SHOW,grd1_{n},1))
##end
C(3,#UpdateCode,1,$,s)
INVOKEJS(SHOW,grd1_1,1)

#KLIGHT=@,1,S
C(3,#HIDE1FG,1,K(LIGHT,#BTNHIDEP1,TXTRED,0),K(LIGHT,#BTNHIDEP1,TXTRED,-1))



</sub>


!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=3;screen.width=[240,120,120,150];printer.width=[15,35,15,35];order=1">
[
["[L2119]                                 合併額度控管登錄                                                   "],
[#<->#,"功能",#FuncCode,#FuncCodeX],
[#<->#,"幣別",#CurrencyCode],
[#<->#,"總額度",#TwLineAmt,#UsLineAmt],
]

!---------- AP Button AREA ----------   
![Buttom資料查詢]




!---------- AP TEXT AREA Variables ----------
! Help
<include src="HELPRIM.icf::HELPRIM.rtn"/>
#CDDEF0001=x,26,S
T(3,CdCode.CurrPrecision)

#CurrPrecisionHelp=x,1024,S 

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDDEF0001)
R(1,XXR99)
CALL(#HelpProc) 
T(2,@CurrPrecisionHelp,#HelpDesc1) 


! 進交易先隱藏主要戶號額度與共用戶號額度欄
#init=X,1,S
! INVOKEJS(SHOW,p2,0)
CALL(#CALLGRID)
C(4,#CurrencyCode,T(3,@CurrencyCode,TWD),$)
HIDE(#UsLineAmt)

!幣別小數位-預設為新台幣
#Precision=N,1,S
E(0,0)
T(H,#CurrencyCode,#CurrPrecisionHelp)

!依幣別小數位顯示小數位欄位
#change=X,1,S
C(3,#Precision,0,SHOW(#TwLineAmt)
                 HIDE(#UsLineAmt)
                ,HIDE(#TwLineAmt)
                 SHOW(#UsLineAmt))

!FuncCode
#FuncCodeHelp=x,30,S
T(3,1:新增;2:修改;4:刪除;5:查詢)

!YN
#YNHelp=X,30,S
T(3,Y:是;N:否)
!Y
#YHelp=X,30,S
T(3,Y:是)

#CHAIN=A,1,S
T(4,CHAIN$)

#NTXBUF=X,18,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@FuncCode,#NTXBUF,1,1)
C(3,#FuncCode,1,s,$)
T(1,@MApplNo1,#NTXBUF,2,7)

!功能
#FuncCode=A,1,L
C(3,#FuncCode,0,E(0,1),$)
C(3,#CHAIN,1,s,E(0,1))
HELP(#FuncCodeHelp)
@V(H,#FuncCodeHelp)

!依功能選項顯示submit按鈕名稱
#FuncCodeX=X,4,L
E(0,@FUNCIND,#FuncCode)
T(H,#FuncCode,#FuncCodeHelp)
C(2,#FuncCode,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),K(MODIFYBUTTON,新增),K(MODIFYBUTTON,刪除),K(MODIFYBUTTON,查詢)K(NOBUTTON,CLOSEY))


!維護記號 1-可維護 0-純顯示
#UpdateCode=A,1,S
IF(#FuncCode==1 || #FuncCode==2 || #FuncCode==3,E(0,1),E(0,0))

#ctrltf=X,1,S
C(3,#UpdateCode,1,S,$)
T(F,#TwLineAmt,0)
T(F,#UsLineAmt,0)
##loop{times:10,n:1}
T(F,#MApplNo{n},0)
##end

#CtrlBTN=X,1,S
##loop{times:10,n:1}
C(3,#UpdateCode,1,SHOW(#BTNA{n}),HIDE(#BTNA{n}))
##end

!幣別
#CurrencyCode=X,3,L


!總額度／循環動用
#TwLineAmt=m,14,I
C(3,#Precision,0,$,S)
C(3,#UpdateCode,1,$,s)

#UsLineAmt=m,14.2,I
C(3,#Precision,0,S,$)
C(3,#UpdateCode,1,$,s)

#TimLineAmt=m,14.2,S
C(3,#Precision,0,E(0,#TwLineAmt),E(0,#UsLineAmt))


!--- P1 合併額度

#MApplNo0=A,7,S


!核准號碼

#BTNA1=X,15,I,ui:button;value:核准號碼;enable:1;tabbable:0;title:L2016 核准號碼明細資料查詢;

#BUFa1=X,18,S
T(3,000000000000000)

#BINDa1=X,1,S
BIND(#BTNA1,click, {cmd=CHAIN; ntxcd=L2016; ntxbuf=#BUFa1;ntxbuf5=type<-1:MApplNo1<-OOApplNo})

#MApplNo1=A,7,I
C(3,#UpdateCode,1,$,s)
C(3,#HIDE1FG,0,CALL(#HIDEP1),$)
@V(2,0)

!檢查
#L2r51=X,1,S
IF(#FKEY==0 || #FKEY==7,$,s)
E(0,@RimFuncCode,#FuncCode)
E(0,@RimApplNo,#MApplNo1)
S(L2R51,1,#RimFuncCode,#RimApplNo)
R(1,L2R51)

#RcvL2r51=X,1,S
IF(#FKEY==0 || #FKEY==7,$,s)
C(3,#FuncCode,1,S,$)
T(2,@CurrencyCode,#L2r51CurrencyCode)
E(0,@TwLineAmt,#L2r51LineAmt)
E(0,@UsLineAmt,#L2r51LineAmt)
##loop{times:10,n:1}
E(0,@MApplNo{n},#L2r51MApplNo{n})
E(0,@MCustNo{n},#L2r51MCustNo{n})
E(0,@MFacmNo{n},#L2r51MFacmNo{n})
C(3,#L2r51MCustNo{n},0,$,T(2,@MCustFacmNo{n},#L2r51MCustNo{n}+-+#L2r51MFacmNo{n}))
T(2,@MCustName{n},#L2r51MCustName{n})
E(0,@MCaseNo{n},#L2r51MCaseNo{n})
E(0,@MUtilDeadline{n},#L2r51MDeadline{n})
T(2,@MRecycleCode{n},#L2r51MRecycleCode{n})
T(2,@MCurrencyCode{n},#L2r51MCurrencyCode{n})
E(0,@MLineAmt{n},#L2r51MLineAmt{n})
##end

#L2r05A1=X,1,S
IF(#FKEY==0 || #FKEY==7,$,s)
C(3,#FuncCode,1,$,S)
C(3,#MApplNo1,0,S,$)
E(0,@RimFuncCode,#FuncCode)
E(0,@RimCustNo,0)
E(0,@RimFacmNo,0)
E(0,@RimApplNo,#MApplNo1)
E(0,@RimCaseNo,0)
S(L2R05,1,#RimFuncCode,#RimTxCode,#RimFKey,#RimCustNo,#RimFacmNo,#RimApplNo,#RimCaseNo)
R(1,L2R05)

#L2r07A1=X,1,S
IF(#FKEY==0 || #FKEY==7,$,s)
C(3,#FuncCode,1,$,S)
C(3,#MApplNo1,0,S,$)
T(2,@RimCustId,#L2r05CustId)
E(0,@RimCustNo,#L2r05CustNo)
RESET_RIM(#L2r07A1,L2R07)
S(L2R07,1,#RimTxCode,#RimCustId,#RimCustNo)
R(1,L2R07)


#RcvL2r05A1=X,1,S
IF(#FKEY==0 || #FKEY==7,$,s)
C(3,#FuncCode,1,$,S)
C(3,#MApplNo1,0,S,$)
E(0,@MCustNo1,#L2r05CustNo)
E(0,@MFacmNo1,#L2r05FacmNo)
T(2,@MCustName1,#L2r07CustName)
C(3,#L2r05CustNo,0,$,T(2,@MCustFacmNo1,#L2r05CustNo+-+#L2r05FacmNo))
E(0,@MCaseNo1,#L2r05CreditSysNo)
E(0,@MUtilDeadline1,#L2r05UtilDeadline)
T(2,@MCurrencyCode1,#L2r05CurrencyCode)
E(0,@MLineAmt1,#L2r05LineAmt)
C(3,#L2r05RecycleCode,1,T(3,@MRecycleCode1,Y),T(3,@MRecycleCode1,))


!戶號-額度
#MCustNo1=A,7,L

#MFacmNo1=A,3,L

#MCustFacmNo1=X,12,L

#MCustName1=x,100,L
#MCustNameS1=x,30,L
T(B,#MCustName1)

!案件編號
#MCaseNo1=A,7,L

!動支期限
#MUtilDeadline1=D,7,L

!幣別
#MCurrencyCode1=X,3,L

!核准額度
#MLineAmt1=m,14.2,S
#MLineAmtX1=X,22,L
CALL2(#ADJUSTDOT,#Precision,#MLineAmt1,#MLineAmtX1)
P(R,#MLineAmtX1)

!循環動用 0-非循環動用 1-循環動用
#MRecycleCode1=X,1,L


!合併額度GRD1
##loop{times:9,l:1,n:2,m:3}

!核准號碼

#BTNA{n}=X,15,I,ui:button;value:核准號碼;enable:1;tabbable:0;title:L2016 核准號碼明細資料查詢;

#BUFa{n}=X,18,S
T(3,000000000000000)

#BINDa{n}=X,1,S
BIND(#BTNA{n},click, {cmd=CHAIN; ntxcd=L2016; ntxbuf=#BUFa{n};ntxbuf5=type<-1:MApplNo{n}<-OOApplNo})

#MApplNo{n}=A,7,I
C(3,#HIDE1FG,0,CALL(#HIDEP1),$)
IF({n}==1,$,C(3,#MApplNo{l},0,INVOKEJS(SHOW,grd1_{l},0),INVOKEJS(SHOW,grd1_{l},1)))
IF({n}==1,$,C(3,#MApplNo{l},0,INVOKEJS(SHOW,grd1_{n},0),INVOKEJS(SHOW,grd1_{n},1)))
IF({n}==1,$,C(3,#MApplNo{l},0,S,$))
C(3,#UpdateCode,1,$,s)
@
IF({n}==1,$,C(3,#MApplNo{l},0,INVOKEJS(SHOW,grd1_{n},0),INVOKEJS(SHOW,grd1_{n},1)))

#L2r05A{n}=X,1,S
IF(#FKEY==0 || #FKEY==7,$,s)
C(3,#FuncCode,1,$,S)
C(3,#MApplNo{n},0,S,$)
E(0,@RimFuncCode,#FuncCode)
E(0,@RimCustNo,0)
E(0,@RimFacmNo,0)
E(0,@RimApplNo,#MApplNo{n})
E(0,@RimCaseNo,0)
S(L2R05,1,#RimFuncCode,#RimTxCode,#RimFKey,#RimCustNo,#RimFacmNo,#RimApplNo,#RimCaseNo)
R(1,L2R05)

#L2r07A{n}=X,1,S
IF(#FKEY==0 || #FKEY==7,$,s)
C(3,#FuncCode,1,$,S)
C(3,#MApplNo{n},0,S,$)
T(2,@RimCustId,#L2r05CustId)
E(0,@RimCustNo,#L2r05CustNo)
RESET_RIM(#L2r07A{n},L2R07)
S(L2R07,1,#RimTxCode,#RimCustId,#RimCustNo)
R(1,L2R07)


#RcvL2r05A{n}=X,1,S
IF(#FKEY==0 || #FKEY==7,$,s)
C(3,#FuncCode,1,$,S)
C(3,#MApplNo{n},0,S,$)
E(0,@MCustNo{n},#L2r05CustNo)
E(0,@MFacmNo{n},#L2r05FacmNo)
T(2,@MCustName{n},#L2r07CustName)
C(3,#L2r05CustNo,0,$,T(2,@MCustFacmNo{n},#L2r05CustNo+-+#L2r05FacmNo))
E(0,@MCaseNo{n},#L2r05CreditSysNo)
E(0,@MUtilDeadline{n},#L2r05UtilDeadline)
T(2,@MCurrencyCode{n},#L2r05CurrencyCode)
E(0,@MLineAmt{n},#L2r05LineAmt)
C(3,#L2r05RecycleCode,1,T(3,@MRecycleCode{n},Y),T(3,@MRecycleCode{n},))


!戶號-額度
#MCustNo{n}=A,7,L

#MFacmNo{n}=A,3,L

#MCustFacmNo{n}=X,12,L

#MCustName{n}=x,100,L
#MCustNameS{n}=x,30,L
T(B,#MCustName{n})

!案件編號
#MCaseNo{n}=A,7,L

!動支期限
#MUtilDeadline{n}=D,7,L

!幣別
#MCurrencyCode{n}=X,3,L

!核准額度
#MLineAmt{n}=m,14.2,S
#MLineAmtX{n}=X,22,L
CALL2(#ADJUSTDOT,#Precision,#MLineAmt{n},#MLineAmtX{n})
P(R,#MLineAmtX{n})

!循環動用 0-非循環動用 1-循環動用
#MRecycleCode{n}=X,1,L

##end



<include src="ROM.icf::L0Rim.dec"/>
<include src="ROM.icf::L2R05.dec"/>
<include src="ROM.icf::L2R07.dec"/>
<include src="ROM.icf::L2R51.dec"/>
<include src="ROM.icf::L2Rim.dec"/>

</sub>


<sub type="DC" name="p2" layout="cols=2;screen.width=[250,1000];printer.width=[15,30];order=1;">
[
["<font color=red>@合併額度"],
["#grid#,{id:1,expand:true,loop:10,row_height:1,s_cols:[,70,140,210,70,70,70,70,], p_cols:[5,15,15,15,15,20,15,15,15]}","","",
["","核准號碼","戶號","戶名","案件編號","循環動用／動支期限",
"幣別","核准額度","循環動用"],
[[#BTNA1],[#MApplNo1],[#MCustFacmNo1],[#MCustNameS1],[#MCaseNo1],[#MUtilDeadline1],
[#MCurrencyCode1],[#MLineAmtX1],[#MRecycleCode1],],
],
]
</sub>


!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>


!---------- TXFORM = L2119 ----------
<sub type="FORM" name="L2119">

!#SCRPRT=_,_,S
!C(5,#TXFORM,L2119,$,S)

#SCRTIL=_,_,S
T(3,[L2119] 合併額度控管登錄)



!------ TOM(HEAD)   Variables (FOR OUTPUT SCREEN) ------




!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------

!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------

</sub>


!------ 上行電文 ------
<sub type="TIM">
#FuncCode
#CurrencyCode
#TimLineAmt
##loop{times:10,n:1}
#MApplNo{n}
#MCustNo{n}
#MFacmNo{n}
#MCaseNo{n}
#MUtilDeadline{n}
#MCurrencyCode{n}
#MLineAmt{n}
#MRecycleCode{n}
##end
#END
#TwLineAmt#UsLineAmt

</sub>


!------ 下行電文TOM ------
<sub type="TOM">
TXFORM=L2119

^
<include src="COM.icf::TRCTL.tom"/>
<include src="COM.icf::LockControl.tom"/>
<include src="ROM.icf::L2R05.tom"/>
<include src="ROM.icf::L2R07.tom"/>
<include src="ROM.icf::L2R51.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>

<sub type="PART" name="L2119" layout="cols=3;screen.width=[130,370,130,370];printer.width=[15,30,15,30];order=1">
[
["[L2119]                                 合併額度控管登錄"],
! [""],
]
</sub>
!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
<include src="PRT.icf::UPDH01.sel"/>
</sub>
