!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L5407)
</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L5407" layout="cols=1;screen.width=[130,870];printer.width=[20,80];order=1">
[
["[L5407]                                 房貸協辦人員等級維護"],
[#<->#,"#FdFunctionCdX+功能",#FunctionCdX],
[#<->#,"#FdEmpNo+員工代號",#EmpNo,#Fullname],
[#<->#,"#FdUnitCode+單位代號",#UnitCode,#UnitCodeX],
[#<->#,"#FdDistCode+區部代號",#DistCode,#DistCodeX],
[#<->#,"#FdDeptCode+部室代號",#DeptCode,#DeptCodeX],
[#<->#,"#FdEffectiveDate+生效日期",#EffectiveDate],
[#<->#,"#FdIneffectiveDate+停效日期",#IneffectiveDate],
! [#<->#,"#FdIneffectiveRsn+停效說明",#IneffectiveRsn],
[#<->#,"#FdEmpClass+協辦等級",#EmpClass,#EmpClassX],
[#<->#,"#FdClassPass+初階授信通過",#ClassPass],
]
!---------- AP TEXT AREA Variables ----------
<include src="HELPRIM.icf::HELPRIM.rtn"/>
!1功能
#CDCODEFuncCode=x,20,S
T(3,CdCode.FunctionCd)
#FuncCodeHelp=x,100,S

!2等級分類
#CDCODEClassType=x,20,S
T(3,CdCode.ClassType)
#ClassTypeHelp=x,100,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDCODEFuncCode,#CDCODEClassType)
R(1,XXR99)
CALL(#HelpProc)
T(2,@FuncCodeHelp,#HelpDesc1)
T(2,@ClassTypeHelp,#HelpDesc2)

#CHAIN=A,1,S
T(4,CHAIN$) 
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:L5022進入),$)
! 狀態Fg 0:已生效 1:已停效 2:未生效
#StatusFg=A,1,S
E(0,3)
#NTXBUF=X,34,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@FunctionCd,#NTXBUF,1,1)
T(1,@EmpNo,#NTXBUF,2,6)
T(1,@EffectiveDate,#NTXBUF,8,7)
C(3,#FunctionCd,2,T(1,@StatusFg,#NTXBUF,15,1),$)
C(2,#FunctionCd,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),K(MODIFYBUTTON,新增),K(MODIFYBUTTON,刪除))
#DealOther=X,1,S
<include src="ROM.icf::L5R39.dec"/>
#RimEmpNo=X,6,S
#RimEffectiveDate=D,7,S
#RimL5r39=X,1,S
T(2,@RimEmpNo,#EmpNo)
T(2,@RimEffectiveDate,#EffectiveDate)
C(2,#FunctionCd,s,s,$,$,$)
RESET_RIM(#RimL5r39,L5R39)
S(L5R39,1,#RimEmpNo,#RimEffectiveDate)
R(1,L5R39)
T(2,@Fullname,#L5r39Fullname)
T(2,@UnitCode,#L5r39UnitCode)
T(2,@UnitCodeX,#L5r39UnitCodeX)
T(2,@DistCode,#L5r39DistCode)
T(2,@DistCodeX,#L5r39DistCodeX)
T(2,@DeptCode,#L5r39DeptCode)
T(2,@DeptCodeX,#L5r39DeptCodeX)
E(0,@IneffectiveDate,#L5r39IneffectiveDate)
T(2,@EmpClass,#L5r39EmpClass)
T(2,@ClassPass,#L5r39ClassPass)
T(H,@EmpClassX,#EmpClass,#ClassTypeHelp)

#FdFunctionCdX=X,1,L
T(2, )
#FdEmpNo=X,1,L
T(2,*)
#FdUnitCode=X,1,L
T(2, )
#FdDistCode=X,1,L
T(2, )
#FdDeptCode=X,1,L
T(2, )
#FdEffectiveDate=X,1,L
T(2,*)
#FdIneffectiveDate=X,1,L
T(2, )
! #FdIneffectiveRsn=X,1,L
! T(2, )
#FdEmpClass=X,1,L
T(2,*)
#FdClassPass=X,1,L
T(2, )

IF(#FunctionCd == 2 ,T(2,@FdEmpNo, )T(2,@FdEffectiveDate, )T(2,@FdEmpClass, ),$)
IF(#FunctionCd == 4 ,T(2,@FdEmpNo, )T(2,@FdEffectiveDate, )T(2,@FdEmpClass, ),$)

! 功能
#FunctionCd=A,1,S
E(0,@FUNCIND,#FunctionCd)
#FunctionCdX=X,4,L
T(H,#FunctionCd,#FuncCodeHelp)

!刪除隱藏重新交易按鈕
#AGAIN=X,1,S
C(3,#FunctionCd,1,S,$)
E(0,1)ASGN(AGAIN$)

!顯示框線
#WKTF=X,1,S
C(3,#FunctionCd,2,T(F,@EmpNo,0)T(F,@UnitCode,0)T(F,@DistCode,0)T(F,@DeptCode,0)T(F,@EffectiveDate,0)C(3,#StatusFg,1,T(F,@IneffectiveDate,1)T(F,@EmpClass,0)T(F,@ClassPass,0),T(F,@IneffectiveDate,1)T(F,@EmpClass,1)T(F,@ClassPass,1)),$)
#WKTF1=X,1,S
C(3,#FunctionCd,4,T(F,@EmpNo,0)T(F,@UnitCode,0)T(F,@DistCode,0)T(F,@DeptCode,0)T(F,@EffectiveDate,0)T(F,@IneffectiveDate,0)T(F,@EmpClass,0)T(F,@ClassPass,0),$)
! 停效說明隱藏，修改時若與原本不同才開啟
! INVOKEJS(SHOW,L5407,8,8,0)


! 員工代號
#EmpNo=X,6,I
C(2,#FunctionCd,S,$,s,$,s)
@T(3,@Fullname,)
T(3,@UnitCode,)
T(3,@DistCode,)
T(3,@DeptCode,)
T(3,@UnitCodeX,)
T(3,@DistCodeX,)
T(3,@DeptCodeX,)
V(7)

#DealNew=X,1,S
<include src="ROM.icf::L5R07.dec"/>
#RimL5r07=X,1,S
T(2,@RimEmpNo,#EmpNo)
C(2,#FunctionCd,s,$,s,$,s)
RESET_RIM(#RimL5r07,L5R07)
S(L5R07,1,#RimEmpNo)
R(1,L5R07)
T(2,@Fullname,#L5r07Fullname)
T(2,@UnitCode,#L5r07UnitCode)
T(2,@UnitCodeX,#L5r07UnitCodeX)
T(2,@DistCode,#L5r07DistCode)
T(2,@DistCodeX,#L5r07DistCodeX)
T(2,@DeptCode,#L5r07DeptCode)
T(2,@DeptCodeX,#L5r07DeptCodeX)
C(4,#Fullname,T(F,@UnitCode,1)T(F,@DistCode,1)T(F,@DeptCode,1),T(F,@UnitCode,0)T(F,@DistCode,0)T(F,@DeptCode,0))

<include src="ROM.icf::L5R40.dec"/>
#RimL5r40=X,1,S
#RimChoose=X,1,S
#RimAreaCode=X,6,S
#RimDistCode=X,6,S
#RimDeptCode=X,6,S
! 員工姓名----調RIM
#Fullname=X,8,L

! 單位代號
#UnitCode=X,6,I
C(2,#FunctionCd,s,$,s,$,s)
C(4,#Fullname,$,s)
@C(4,#UnitCode,s,$)
T(2,@RimChoose,1)
T(2,@RimAreaCode,#UnitCode)
RESET_RIM(#UnitCode,L5R40)
S(L5R40,1,#RimChoose,#RimAreaCode,#RimDistCode,#RimDeptCode)
R(1,L5R40)
T(2,@DeptCode,#L5R40DeptCode)
T(2,@DistCode,#L5R40DistCode)
T(2,@UnitCodeX,#L5R40AreaItem)
T(2,@DeptCodeX,#L5R40DeptItem)
T(2,@DistCodeX,#L5R40DistItem)
! 單位代號----調RIM
#UnitCodeX=X,20,L

! 區部代號
#DistCode=X,6,I
C(2,#FunctionCd,s,$,s,$,s)
C(4,#Fullname,$,s)
@C(4,#DistCode,s,$)
T(2,@RimChoose,2)
T(2,@RimDistCode,#DistCode)
RESET_RIM(#DistCode,L5R40)
S(L5R40,1,#RimChoose,#RimAreaCode,#RimDistCode,#RimDeptCode)
R(1,L5R40)
T(2,@DeptCode,#L5R40DeptCode)
T(2,@DeptCodeX,#L5R40DeptItem)
T(2,@DistCodeX,#L5R40DistItem)
! 區部代號----調RIM
#DistCodeX=X,20,L

! 部室代號
#DeptCode=X,6,I
C(2,#FunctionCd,s,$,s,$,s)
C(4,#Fullname,$,s)
@C(4,#DeptCode,s,$)
T(2,@RimChoose,3)
T(2,@RimDeptCode,#DeptCode)
RESET_RIM(#DeptCode,L5R40)
S(L5R40,1,#RimChoose,#RimAreaCode,#RimDistCode,#RimDeptCode)
R(1,L5R40)
T(2,@DeptCodeX,#L5R40DeptItem)
! 部室代號----調RIM
#DeptCodeX=X,20,L

! 系統日期
#SYSTIMETMP=D,8,S
T(4,#SYSCDATE)


! 生效日期 
#EffectiveDate=D,7,I
C(2,#FunctionCd,s,$,s,$,s)
C(3,#FunctionCd,1,T(1,#SYSTIMETMP,2,7),$)
D(8)
@A(DATE,0,#EffectiveDate)
V(7)
    

! 停效說明開關
#RsnFg=A,1,S
E(0,0)
! 停效日期 
#IneffectiveDate=D,7,I
C(2,#FunctionCd,s,$,$,$,s)
D(8)
@
C(4,#IneffectiveDate,S,$)
A(DATE,0,#IneffectiveDate)
IF(#IneffectiveDate < #EffectiveDate,V(P,停效日期需大於生效日期),$)

! 是否開啟停效說明
! #IsRsnFg=X,1,S
! C(3,#FunctionCd,1,S,$)
! C(4,#IneffectiveDate,E(0,@RsnFg,0),E(0,@RsnFg,1))
! C(3,#RsnFg,0,INVOKEJS(SHOW,L5407,8,8,0),INVOKEJS(SHOW,L5407,8,8,1))
! 停效說明
! #IneffectiveRsn=x,120,I
! C(3,#RsnFg,1,$,S)

! 協辦等級
#EmpClass=A,1,I
C(2,#FunctionCd,s,$,$,$,s)
C(3,#FunctionCd,2,C(3,#StatusFg,1,s,$),$)
HELP(#ClassTypeHelp)
@T(3,#EmpClassX,)
V(H,#ClassTypeHelp)

#EmpClassX=X,4,L
T(H,#EmpClass,#ClassTypeHelp)

! 初階授信通過
#ClassPass=X,1,I
C(2,#FunctionCd,s,$,$,$,s)
C(3,#FunctionCd,2,C(3,#StatusFg,1,s,$),$)
@V(3, ,Y)
</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L5407 -----------
<sub type="FORM" name="L5407">
</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#FunctionCd#EmpNo#UnitCode#DistCode#DeptCode#UnitCodeX#DistCodeX#DeptCodeX#EffectiveDate#IneffectiveDate#EmpClass#ClassPass
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
<include src="ROM.icf::L5R07.tom"/>
<include src="ROM.icf::L5R39.tom"/>
<include src="ROM.icf::L5R40.tom"/>
TXFORM=L5407

^
</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
</sub>
