---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
![一段式/二段式/三段式]
#RELCD=_,_,S
E(0,1)

#ACTFG=_,_,S
C(2,#FKEY,E(0,1),$)

#TXCD
T(3,L5503)
</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD2.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------


<sub type="DC" name="L5503" layout="cols=3;screen.width=[180,500,180,400];printer.width=[20,30,20,30];order=1">
[
["L5503]                           介紹、協辦獎金維護"],
[#<->#,"#FdFunCode+功能選項",#FunCodeX],
["#FdBonusNo+序號",#BonusNo],
[#<->#,"#FdBonusType+獎金類別",#BonusType,#BonusTypeX],
[#<->#,"#FdCustNo+戶號",#CustNo,"-",#FacmNo,"-",#BormNo,#BtnL3002],
[#<->#,"#FdCustNm+戶名",#CustName],
["#FdProdCode+商品代碼",#ProdCode,#ProdName],
["#FdPieceCode+計件代碼",#PieceCode,#PieceCodeX],
[#<->#,"#FdEmployeeNo+發放員工",#EmployeeNo,#EmployeeName],
["#FdPerfDate+業績日期",#PerfDate],
["#FdBonusDate+獎金發放日",#BonusDate],
["#FdWorkMonth+工作月",#WorkMonth],
["#FdWorkSeason+工作季",#WorkSeason],
["#FdBonus+#FdBonus2",#Bonus],
["#FdAdjustBonus+#FdAdjustBonus2",#AdjustBonus],
[#<->#,"#FdRemark+備註",#Remark],
["#FdMediaDate+產出媒體檔日期",#MediaDate],
["#FdManualFg+人工新增記號",#ManualFgX],
]


![Buttom資料查詢]
!#BtnCdEmp=X,15,I,ui:button;value:員工資料查詢;enable:1;tabbable:0;title:L190A 員工資料檔查詢;
!#BinCdEmp=X,1,S
!BIND(#BtnCdEmp,click, {cmd=CHAIN; ntxcd=L190A; ntxbuf=;ntxbuf5=type<-1:EmployeeNo<-OOEmployeeNo:EmployeeNo2<-OOEmployeeNo:EmployeeName<-OOFullname})
!
#L3002Buf=X,5,S
T(3,L5503)

#BtnL3002=X,18,I,ui:button;value:撥款資料查詢;enable:1;tabbable:0;title:L3002 撥款明細資料查詢;
#BindL3002=X,1,S
BIND(#BtnL3002,click, {cmd=CHAIN; ntxcd=L3002; ntxbuf=#L3002Buf;ntxbuf5=type<-1:CustNo<-OOCustNo:FacmNo<-OOFacmNo:BormNo<-OOBormNo})
!
!#BtnL2001=X,15,I,ui:button;value:商品參數查詢;enable:1;tabbable:0;title:L190A 商品參數明細資料查詢;
!#BufL2001=X,7,S
!T(3,     10)
!#BindL2001=X,1,S
!BIND(#BtnL2001,click, {cmd=CHAIN; ntxcd=L2001; ntxbuf=#BufL2001;ntxbuf5=type<-1:ProdCode<-OOProdNo:ProdCode2<-OOProdNo:ProdName<-OOProdName})

<include src="HELPRIM.icf::HELPRIM.rtn"/>

#H1=x,16,S
T(3,CdCode.PieceCode)

#PieceHelp=X,1024,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#H1)
R(1,XXR99)
CALL(#HelpProc)
T(2,@PieceHelp,#HelpDesc1)

#FunCodeHelp=x,50,S
T(3,1:新增;2:修改;3:複製;4:刪除;5:查詢)

#BonusTypeHelp=x,50,S
T(3,1:介紹獎金;5:協辦獎金)
!T(3,1:介紹獎金;5:協辦獎金;6:專業獎勵金)

#CHAIN=A,1,S
T(4,CHAIN$) 
IF(#CHAIN==0,V(P,本交易為連動交易，請由L5053連動進入),$)

#NTXBUF=X,22,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@FunCode,#NTXBUF,1,1)
T(1,@BonusNo,#NTXBUF,2,8)

!#CheckFunc=X,1,S
!C(3,#FunCode,1,SHOW(#BtnL3002),HIDE(#BtnL3002))
!C(3,#FunCode,1,SHOW(#BtnEmpno),HIDE(#BtnEmpno))

#FdFunCode=X,2,L

![維護記號]
#FunCode=A,1,S

![維護記號名稱]
#FunCodeX=X,4,L
T(H,#FunCode,#FunCodeHelp)
C(3,#FunCode,5,K(NOBUTTON,CLOSEY),$)
K(MODIFYBUTTON,#FunCodeX)
C(3,#FunCode,5,INVOKEJS(SHOW,p2,1),INVOKEJS(SHOW,p2,0))

#CheckAuth=X,1,S
E(0,#FunCode)
<include src="COM.icf::CheckAuth.rtn"/>

!限新增可重新交易
#AGAIN=X,1,S
C(3,#FunCode,1,S,$)
E(0,1)ASGN(AGAIN$)

#Frame1=X,1,S
C(3,#FunCode,1,$,S)
T(3,@FdAdjustBonus2,)
HIDE(#AdjustBonus)
T(3,#ManualFgX,是))

#FdBonusDate=X,2,L
!C(2,#FunCode,s,T(3,*),S,S,S,S)

#FdBonusNo=X,2,L

#FdBonusType=X,2,L
C(2,#FunCode,s,T(3,*),S,S,S,S)

#FdPerfDate=X,2,L
!C(2,#FunCode,s,T(3,*),S,S,S,S)

#FdCustNo=X,2,L
C(2,#FunCode,s,T(3,*),S,S,S,S)

#FdCustNm=X,2,L

#FdEmployeeNo=X,2,L
!C(2,#FunCode,s,T(3,*),S,S,S,S)

#FdBonus=X,1,L
C(2,#FunCode,s,T(3,*),S,S,S,S)

#FdBonus2=X,12,L
T(3,發放獎金)

#FdAdjustBonus=X,1,L
C(2,#FunCode,S,S,T(3,*),S,S,S)

#FdAdjustBonus2=X,12,L

#FdProdCode=X,2,L

#FdPieceCode=X,2,L

#FdWorkMonth=X,2,L

#FdWorkSeason=X,2,L

#FdRemark=X,2,L

#FdMediaDate=X,2,L

#FdManualFg=X,2,L


#BonusNo=A,8,L

#RIM_L5R37=A,1,S
C(3,#FunCode,1,S,$)
RESET_RIM(#RIM_L5R37,L5R37)
S(L5R37,01,#FunCode,#BonusNo,#END)
R(1,L5R37)
E(0,@AdjustBonus,#RimAdjustBonus)
C(3,#AdjustBonusDate,0,C(3,#FunCode,2,T(3,@FdBonus2,原始獎金),$),T(3,@FdBonus2,原始獎金))

#T1=X,1,S
C(3,#ManualFg,1,T(3,@ManualFgX,是),T(3,@ManualFgX,否))

#BonusType=A,1,I
C(2,#FunCode,s,I,s,s,s,s)
HELP(#BonusTypeHelp)
@
V(H,#BonusTypeHelp)

#BonusTypeX=X,20,L
T(H,@BonusType,#BonusTypeHelp)

! 借款人戶號
#CustNo=A,7,I
C(2,#FunCode,s,$,s,s,s,s)
!C(3,#FunCode,1,$,C(3,#ManualFg,1,C(3,#AdjustBonus,0,s,$),$))
@
V(2,0)

! 額度編號
#FacmNo=A,3,I
C(2,#FunCode,s,$,s,s,s,s)
!C(3,#FunCode,1,$,C(3,#ManualFg,1,C(3,#AdjustBonus,0,s,$),$))
@
V(2,0)

! 撥款序號
#BormNo=A,3,I
C(2,#FunCode,s,$,s,s,s,s)
!C(3,#FunCode,1,$,C(3,#ManualFg,1,C(3,#AdjustBonus,0,s,$),$))
@
V(2,0)


!#RIM_L3R15=A,1,S
!C(2,#FunCode,s,$,C(2,#ManualFg,s,$),s,s,s)
!C(3,#FunCode,1,$,C(3,#ManualFg,1,C(3,#AdjustBonus,0,s,$),$))
!RESET_RIM(#RIM_L3R15,L3R15)
!S(L3R15,01,#CustNo,#FacmNo,#BormNo,#END)
!R(1,L3R15)

#RIM_L5R37B=A,1,S
C(3,#FunCode,1,$,S)
RESET_RIM(#RIM_L5R37B,L5R37)
S(L5R37,01,#FunCode,#BonusType,#CustNo,#FacmNo,#BormNo,#END)
R(1,L5R37)

! 戶名
#CustName=X,100,L

#ProdCode2=X,5,S

#ProdCode=X,5,L
!C(2,#FunCode,s,$,C(2,#ManualFg,s,$),s,s,s)
!C(3,#FunCode,1,$,C(3,#ManualFg,1,C(3,#AdjustBonus,0,s,$),$))
!C(3,#BonusType,6,S,$)
!@
!V(7)

!尋找商品參數檔資料
#SendL2r01A=X,1,S
!C(5,#ProdCode,#ProdCode2,S,$)
!C(2,#FunCode,s,$,C(2,#ManualFg,s,$),s,s,s)
!C(3,#FunCode,1,$,C(3,#ManualFg,1,C(3,#AdjustBonus,0,s,$),$))
!C(3,#BonusType,6,S,$)
!T(2,@RimProdNo,#ProdCode)
!T(3,@RimTxCode,L5503)
!E(0,@RimFuncCode,5)
!RESET_RIM(#SendL2r01A,L2R01)
!S(L2R01,1,#RimFuncCode,#RimTxCode,#RimProdNo)
!R(1,L2R01)
!T(2,@ProdName,#L2r01ProdName)

#ProdName=x,60,L

#PieceCode=X,1,L
!C(2,#FunCode,s,$,C(2,#ManualFg,s,$),s,s,s)
!C(3,#FunCode,1,$,C(3,#ManualFg,1,C(3,#AdjustBonus,0,s,$),$))
!C(3,#BonusType,6,S,$)
!HELP(#PieceHelp)
!@
!V(H,#PieceHelp)

#PieceCodeX=x,40,L
C(3,#BonusType,6,S,$)
T(H,#PieceCode,#PieceHelp)

#MRKEY=_,_,S
T(2,#CustNo+-+#FacmNo+-+#BormNo+-+#BonusType)

#Frame2=X,1,S
C(3,#FunCode,2,$,S)
T(F,@EmployeeNo,0)
T(F,@BonusDate,0)
T(F,@BonusType,0)
!C(3,#ManualFg,1,T(3,@FdPerfDate,*),$)
!C(3,#ManualFg,1,T(3,@FdCustNo,*),$)
!C(3,#ManualFg,1,T(3,@FdProdCode,*),$)
!C(3,#ManualFg,1,T(3,@FdPieceCode,*),$)
!C(3,#ManualFg,1,$,T(F,@PerfDate,0))
!C(3,#ManualFg,1,$,T(F,@CustNo,0))
!C(3,#ManualFg,1,$,T(F,@FacmNo,0))
!C(3,#ManualFg,1,$,T(F,@BormNo,0))
!C(3,#ManualFg,1,$,T(F,@EmployeeNo,0))
T(F,@CustNo,0)
T(F,@FacmNo,0)
T(F,@BormNo,0)
T(F,@Bonus,0)
!C(3,#ManualFg,1,$,T(F,@ProdCode,0))
!C(3,#ManualFg,1,$,T(F,@PieceCode,0))
!C(3,#ManualFg,1,$,T(F,@WorkMonth,0))
!C(3,#ManualFg,1,$,T(F,@WorkSeason,0))
!C(3,#ManualFg,1,HIDE(#AdjustBonus),$,SHOW(#AdjustBonus))
T(3,@FdAdjustBonus2,調整發放獎金)
HIDE(#BtnL3002)
!HIDE(#BtnCdEmp)
!C(3,#ManualFg,1,$,HIDE(#BtnL2001))


#Frame4=X,3,S
C(3,#FunCode,4,$,C(3,#FunCode,5,$,S))
T(F,@BonusDate,0)
T(F,@BonusType,0)
T(F,@PerfDate,0)
T(F,@CustNo,0)
T(F,@FacmNo,0)
T(F,@BormNo,0)
T(F,@EmployeeNo,0)
T(F,@Bonus,0)
T(F,@AdjustBonus,0)
T(F,@ProdCode,0)
T(F,@PieceCode,0)
T(F,@WorkMonth,0)
T(F,@WorkSeason,0)
T(F,@Remark,0)
C(3,#AdjustBonusDate,0,HIDE(#AdjustBonus),$,SHOW(#AdjustBonus))
C(3,#AdjustBonusDate,0,T(3,@FdAdjustBonus2,),T(3,@FdAdjustBonus2,調整發放獎金))
!HIDE(#BtnCdEmp)
!HIDE(#BtnL2001)
HIDE(#BtnL3002)

#EmployeeNo2=X,6,S

#EmployeeNo=X,6,L
!!C(2,#FunCode,s,$,C(2,#ManualFg,s,$),s,s,s)
!C(2,#FunCode,s,$,s,s,s,s)
!@
!V(7)

!#RIM_L2R08=X,1,S
!C(5,#EmployeeNo,#EmployeeNo2,S,$)
!C(2,#FunCode,s,$,C(2,#ManualFg,s,$),s,s,s)
!C(2,#FunCode,s,$,s,s,s,s)
!RESET_RIM(#RIM_L2R08,L2R08)
!T(2,@RimEmployeeNo,#EmployeeNo)
!T(3,@RimErrorSkip,X)
!S(L2R08,1,#RimTxCode,#RimEmployeeNo)
!R(1,L2R08)
!T(2,@EmployeeName,#L2r08FullName)

#EmployeeName=x,40,L


#AdjustBonusDate=D,7,S 

#Adj1=x,1,S
!C(3,#FunCode,1,S,$)
!C(3,#ManualFg,1,$,S)
!C(3,#AdjustBonus,0,T(3,),T(3,*))
!T(2,@FdPerfDate,#Adj1)
!T(2,@FdCustNo,#Adj1)
!T(2,@FdProdCode,#Adj1)
!T(2,@FdPieceCode,#Adj1)

#adj2=x,1,S
!C(5,#FdPerfDate,*,T(F,@PerfDate,1),T(F,@PerfDate,0))
!C(5,#FdCustNo,*,T(F,@CustNo,1)T(F,@FacmNo,1)T(F,@BormNo,1),T(F,@CustNo,0)T(F,@FacmNo,0)T(F,@BormNo,0))
!C(5,#FdProdCode,*,T(F,@ProdCode,1),T(F,@ProdCode,0))
!C(5,#FdPieceCode,*,T(F,@PieceCode,1),T(F,@PieceCode,0))


<include src="ROM.icf::L5R38.rtn"/>

! 業績日期
#PerfDate=D,7,L
!C(2,#FunCode,s,E(0,#SYSCDATE),C(2,#ManualFg,s,$),s,s,s)
!C(3,#FunCode,1,$,C(3,#ManualFg,1,C(3,#AdjustBonus,0,s,$),$))
!@
!V(7,0)
!A(DATE,0,#PerfDate)

!#RimL5R38=X,1,S
!C(2,#FunCode,S,$,C(3,#ManualFg,1,$,S),S,S,S)
!C(3,#FunCode,1,$,C(3,#ManualFg,1,C(3,#AdjustBonus,0,s,$),$))
!RESET_RIM(#RimL5R38,L5R38)
!E(0,@L5R38iCode,3)
!E(0,@L5R38iDate,#PerfDate)
!S(L5R38,01,#L5R38iCode,#L5R38iDate)
!R(1,L5R38)
!E(0,@WorkMonth,#L5R38oWorkYM)
!E(0,@WorkSeason,#L5R38oWorkSeason)

! 獎金發放日
#BonusDate=D,7,L
!C(2,#FunCode,s,I,s,s,s,s)
!@
!V(7)
!A(DATE,0,#BonusDate)

#WorkMonth=A,5,L
!C(2,#FunCode,s,$,C(2,#ManualFg,s,$),s,s,s)
!C(3,#BonusType,6,S,$)
!@
!A(YM13,1,#WorkMonth)

#WorkSeason=A,4,L
!C(2,#FunCode,s,$,C(2,#ManualFg,s,$),s,s,s)
!C(3,#BonusType,6,S,$)


#Bonus=+m,14,I
C(2,#FunCode,s,$,s,s,s,s)
@
V(2,0)

#RimAdjustBonus=+m,14,S

#AdjustBonus=+m,14,I
C(2,#FunCode,s,S,$,s,s,s)

#Remark=x,50,I
C(2,#FunCode,s,$,$,$,s,s)

#MediaFg=A,1,S

#MediaDate=D,7,L

#ManualFg=A,1,S

#ManualFgX=X,2,L
C(3,#ManualFg,1,T(3,是),T(3,否))

!-------------

<include src="ROM.icf::L0Rim.dec"/>
<include src="ROM.icf::L2Rim.dec"/>
<include src="ROM.icf::L2R01.dec"/>
<include src="ROM.icf::L2R08.dec"/>

</sub>

<sub type="DC" name="p2" layout="cols=3;screen.width=[180,500,180,400];printer.width=[20,30,20,30];order=1">
[
[],
["#FdLastUpdate+修改日期",#LastUpdate],
["#FdLastEmpName+修改人員",#LastEmpName],
]
#FdLastUpdate=X,2,L
#FdLastEmpName=X,2,L
#LastUpdate=x,20,L
#LastEmpName=x,40,L

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L5503 -----------
<sub type="FORM" name="L5503">
</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#FunCode
#BonusNo
#BonusDate
#BonusType
#PerfDate
#CustNo
#FacmNo
#BormNo
#EmployeeNo
#Bonus
#AdjustBonus
#ProdCode
#PieceCode
#WorkMonth
#WorkSeason
#Remark
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
<include src="ROM.icf::L2R01.tom"/>
<include src="ROM.icf::L2R08.tom"/>
<include src="ROM.icf::L5R38.tom"/>
TXFORM=L5503
^
TXFORM=L3R15
#CustName
^
TXFORM=L5R37
#BonusNo
#BonusDate
#BonusType
#PerfDate
#CustNo
#FacmNo
#BormNo
#EmployeeNo
#EmployeeName
#Bonus
#RimAdjustBonus
#AdjustBonusDate
#ProdCode
#ProdName
#PieceCode
#WorkMonth
#WorkSeason
#Remark
#MediaFg
#MediaDate
#ManualFg
#CustName
#LastUpdate
#LastEmpName
^
</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
</sub>
