!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L5513)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,8)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,171)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,40)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L5513" layout="cols=1;screen.width=[130,870];printer.width=[20,80];order=1">
[
["[L5513]                                 產生協辦獎金發放媒體"],
[#<->#,"#FdFuncType+功能",#FuncType,#FuncTypeX],
[#<->#,"#FdDrawdownDateFm+撥款起訖日",#DrawdownDateFm,"~",#DrawdownDateTo],
[#<->#,"#FdIntroducerBonusDate+獎金發放日",#IntroducerBonusDate],
]

#FdFuncType=X,2,L
#FdDrawdownDateFm=X,2,L
#FdIntroducerBonusDate=X,2,L

#CHAIN=A,1,S
T(4,CHAIN$)
T(3,@FuncType,1)
CALL(#FuncType0)

! 37*2+3*2+2=74+6
#FuncTypeHelp=X,82,S
T(3,1:產生協辦獎金發放資料;2:產生協辦獎金媒體檔;3:取消協辦獎金媒體檔)
! T(3,1:產生介紹、協辦獎金發放資料;2:產生介紹、協辦獎金媒體檔;3:取消介紹、協辦獎金媒體檔)
#FuncType0=@,1,S
INVOKEJS(SHOW,L5513_2,1)INVOKEJS(SHOW,L5513_3,1)

#FuncType1=@,1,S
INVOKEJS(SHOW,L5513_2,0)INVOKEJS(SHOW,L5513_3,1)

#FuncType=X,1,I
HELP(#FuncTypeHelp)
@T(3,@FuncTypeX,)
V(H,#FuncTypeHelp)
IF(#FuncType==1,CALL(#FuncType0),CALL(#FuncType1))

#FuncTypeX=X,26,L
T(H,#FuncType,#FuncTypeHelp)

! #SubmitBut=X,1,S
! K(MODIFYBUTTON,#FuncTypeX)

#PreValue=A,1,S
T(1,@DrawdownDateFm,#SYSDATE,2,7)
T(1,@DrawdownDateTo,#SYSDATE,2,7)
T(1,@IntroducerBonusDate,#SYSDATE,2,7)

!是否跳過 0:否 1:是
#CheckSkip=X,1,S
IF(#FuncType==2 || #FuncType==3,T(3,1),T(3,0))

! 撥款起始日
#DrawdownDateFm=D,7,I
IF(#CheckSkip==1,S,$)
D(8)
@A(DATE,0,#DrawdownDateFm)
V(7)
IF(#DrawdownDateFm==0,V(P,撥款開始日不可空白),$)

! 撥款結束日
#DrawdownDateTo=D,7,I
IF(#CheckSkip==1,S,$)
D(8)
@A(DATE,0,#DrawdownDateTo)
V(7)
IF(#DrawdownDateTo==0,V(P,撥款結束日不可空白),$)

#CheckPerfDate=X,1,S
@IF(#DrawdownDateTo>=#DrawdownDateFm,$,V(P,撥款日期起不得大於訖))

! 介紹獎金發放日
#IntroducerBonusDate=D,7,I
D(8)
@A(DATE,0,#IntroducerBonusDate)
V(7)
IF(#IntroducerBonusDate==0,V(P,介紹獎金發放日不可空白),$)

#RPTFG=A,1,S
E(0,0)
</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L5513 -----------
<sub type="FORM" name="L5513">
! 媒體檔FileNo
#TxtSnoL5513=X,8,S
E(0,@PdfSnoF,#TxtSnoL5513)
E(0,@PdfSnoF1,#TxtSnoL5513)

#PdfSnoF=A,8,S
#PdfSnoF1=A,8,S
! 媒體檔FileNo
#PdfPrtL5513=A,1,S
C(3,#PdfSnoF,0,E(0,0),E(0,1))

#PdfPrtL5513Detail=A,1,S
C(3,#PdfSnoF1,0,E(0,0),E(0,1))

#SCRTIL=_,_,S
T(3,[L5513] 產生介紹獎金發放媒體)

</sub>
! #LOOP=X,1,S
! E(0,1)ASGN(LOOP$)
! ! 處理結果
! #OOResult=X,1,O
! #OOResultX=X,10,O
! ! 業績日期
! #OOPerfDate=D,7,O
! ! 業績年月 YYYY,mm
! #OOPerfYM=X,7,O
! ! 申請單位代號 固定[10H000]
! #OODepCode=X,6,O
! ! 申請批號 固定[0000000001]
! #OOSeriesNum=X,10,O
! ! 身份證字號
! #OOCustId=X,10,O
! ! 薪碼 固定[Q2]
! #OOSalaryCode=X,2,O
! ! 薪碼說明 固定[ 放款介紹獎金       ]
! #OOSalaryCodeX=X,20,O
! ! 金額 PfReward-介紹人介紹獎金
! #OOIntroducerBonus=X,10,O
! ! 業績(FYC) 固定[0000000000]
! #OOFyc=A,10,O
! ! 業績(FYP) 固定[0000000000]
! #OOFyp=A,10,O
! ! 轉發明細
! #OODetail=X,1,O
! ! 轉發明細A 固定[ 介紹獎金                               ]
! #OODetailA=X,40,O
! ! 計算基礎 固定[0000000000]
! #OOCountFoundation=X,10,O
! ! FP跨售換算率 固定[00000.00]
! #OOFpRate=X,8,O
! ! FC跨售換算率 固定[00000.00]
! #OOFcRate=X,8,O
! ! 跨售類別 固定[0]
! #OOSellType=X,1,O
!------ 上行電文 TEXT ------

! #FuncType
<sub type="TIM">
#DrawdownDateFm
#DrawdownDateTo
#IntroducerBonusDate
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
TXFORM=L5513
#TxtSnoL5513
^
</sub>

<sub type="PART" name="L5513" layout="cols=1;screen.width=[130,870];printer.width=[15,30,15,30];order=1">
[
["[L5513]                                 產生介紹獎金發放媒體                                                                          "],
]
</sub>

! <sub type="PART" name="L5513A" layout="cols=1;screen.width=[130,870];printer.width=[15,30,15,30];order=1">
! [
! ["[L5512]                                 產生介紹人加碼獎金發放媒體                                                            "],
! ]

! </sub>

! #OOResult
! #OOPerfDate
! #OOPerfYM
! #OODepCode
! #OOSeriesNum
! #OOCustId
! #OOSalaryCode
! #OOSalaryCodeX
! #OOIntroducerBonus
! #OOFyc
! #OOFyp
! #OODetail
! #OODetailA
! #OOCountFoundation
! #OOFpRate
! #OOFcRate
! #OOSellType
!---------- 單據輸出組合 ----------
! #PdfPrtL5513=1,PDF,,,,,,,,,,,,,PdfSnoF;3,介紹人加碼獎金發放媒體

! #RPTFG=1,QUERY.GRID,L5513A
! #any={detail:true, header:'L5513A.part', caption:'', width:1020, rowNum:20, rowList:[20,40,60]}
! #OOResultX=處理結果
! {width:95,hidden:true}
! #OOPerfDate=業績日期
! {width:95}
! #OOPerfYM=業績年月
! {width:95}
! #OODepCode=申請單位代號
! {width:95}
! #OOSeriesNum=申請批號
! {width:95}
! #OOCustId=身份證字號
! {width:95}
! #OOSalaryCode=薪碼
! {width:95}
! #OOSalaryCodeX=薪碼說明
! {width:95}
! #OOIntroducerBonus=金額
! {width:95}
! #OOFyc=業績(FYC)
! {width:95}
! #OOFyp=業績(FYP)
! {width:95}
! #OODetail=轉發明細
! {width:95,hidden:true}
! #OODetailA=轉發明細A
! {width:95}
! #OOCountFoundation=計算基礎
! {width:95}
! #OOFpRate=FP跨售換算率
! {width:95}
! #OOFcRate=FC跨售換算率
! {width:95}
! #OOSellType=跨售類別
! {width:95}
! ^

<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
^
#PdfPrtL5513=1,PDF,,,,,,,,,,,,,PdfSnoF;3,介紹、協辦獎金發放媒體
^
#PdfPrtL5513Detail=1,PDF,,,,,,,,,,,,,PdfSnoF1;3,車馬費明細檔
^
</sub>

! <include src="PRT.icf::INQ04.sel" map="i=L5513;cpi=15"/>
! #DrawdownDateFm
! #DrawdownDateTo
! #IntroducerBonusDate
! %
! #OOResult
! #OOPerfDate
! #OOPerfYM
! #OODepCode
! #OOSeriesNum
! #OOCustId
! #OOSalaryCode
! #OOSalaryCodeX
! #OOIntroducerBonus
! #OOFyc
! #OOFyp
! #OODetail
! #OODetailA
! #OOCountFoundation
! #OOFpRate
! #OOFcRate
! #OOSellType
! ^
! </sub>