!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L5104)
</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)

#button=x,1,S
K(MODIFYBUTTON,製表)

</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L5104" layout="cols=1;screen.width=[130,870];printer.width=[20,80];order=1">
[
["[L5104]                                 檔案借閱報表作業(列印)"],
[#<->#,"#FdStartDate+借閱日期",#StartDate,"~",#EndDate],
[#<->#,"#FdReportFlag+報表種類",#ReportFlag,#ReportFlagX],
]
!---------- AP TEXT AREA Variables ----------


#FdStartDate=X,2,L
#FdReportFlag=X,2,L

!報表種類
#ReportHelp=X,100,S
T(3,1:未歸還月報表;2:法拍件月報表;3:件數統計表;4:全部)

#CHAIN=A,1,S
T(4,CHAIN$) 

#NTXBUF=X,13,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@StartDate,#NTXBUF,1,7)
INVOKEJS(SHOW,p1,02,02,1)

#TODAY=A,7,S
T(1,#SYSCDATE,2,7)

#PREVALUE=A,1,S
E(0,@StartDate,#TODAY)
E(0,@EndDate,#TODAY)

! 開始日期
#StartDate=D,7,I
C(3,#CHAIN,0,$,s)

! 終止日期
#EndDate=D,7,I

! 報表種類
#ReportFlag=A,1,I
E(0,4)
HELP(#ReportHelp)
@V(H,#ReportHelp)
     
#ReportFlagX=X,12,L
T(3, )
T(H,#ReportFlag,#ReportHelp)

#Report=X,1,S
SWITCH(#ReportFlag,
1,T(2,@ReportA,Y)T(2,@ReportB,)T(2,@ReportC,),
2,T(2,@ReportA,)T(2,@ReportB,Y)T(2,@ReportC,),
3,T(2,@ReportA,)T(2,@ReportB,)T(2,@ReportC,Y),
4,T(2,@ReportA,Y)T(2,@ReportB,Y)T(2,@ReportC,Y))
#ReportA=X,1,S
#ReportB=X,1,S
#ReportC=X,1,S



!  4.印表機代號: XXXXXXXXXX
!  5.報表分數  : 1~255
</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
![顯示註記]
#L514APRT=A,1,S
C(3,#ReportFlag,4,E(0,1),C(4,#ReportA,E(0,0),E(0,1)))
C(5,#TXFORM,L514A,E(0,1),E(0,0))
![資料表頭(HEADER)長度]
#L514AHD=n,3,S
C(3,#L514APRT,0,S,$)E(0,6)ASGN(INQHD$)
![每筆明細(OCCURS)長度]
#L514ALN=n,3,S
C(3,#L514APRT,0,S,$)E(0,71)ASGN(INQLEN$)
![每張印錄單列印的筆數]
#L514AQPRT=n,2,S
C(3,#L514APRT,0,S,$)E(0,50)ASGN(INQPRT$)
![畫面顯示的明細間的高度]
#L514ALOOP=n,3,S
C(3,#L514APRT,0,S,$)E(0,1)ASGN(LOOPHEIGHT$)

![顯示註記]
#L514BPRT=A,1,S
C(3,#ReportFlag,4,E(0,1),C(4,#ReportB,E(0,1),E(0,1)))
![資料表頭(HEADER)長度]
#L514BHD=n,3,S
C(4,#ReportB,S,$)E(0,6)ASGN(INQHD$)
![每筆明細(OCCURS)長度]
#L514BLN=n,3,S
C(4,#ReportB,S,$)E(0,92)ASGN(INQLEN$)
![每張印錄單列印的筆數]
#L514BQPRT=n,2,S
C(4,#ReportB,S,$)E(0,50)ASGN(INQPRT$)
![畫面顯示的明細間的高度]
#L514BLOOP=n,3,S
C(4,#ReportB,S,$)E(0,1)ASGN(LOOPHEIGHT$)

#L514CPRT=A,1,S
C(3,#ReportFlag,4,E(0,1),C(4,#ReportC,E(0,0),E(0,1)))
![資料表頭(HEADER)長度]
#L514CHD=n,3,S
C(4,#ReportC,S,$)E(0,6)ASGN(INQHD$)
![每筆明細(OCCURS)長度]
#L514CLN=n,3,S
C(4,#ReportC,S,$)E(0,8)ASGN(INQLEN$)
![每張印錄單列印的筆數]
#L514CQPRT=n,2,S
C(4,#ReportC,S,$)E(0,30)ASGN(INQPRT$)
![畫面顯示的明細間的高度]
#L514CLOOP=n,3,S
C(4,#ReportC,S,$)E(0,1)ASGN(LOOPHEIGHT$)

</sub>

!------------ TXFORM = L5104 -----------
<sub type="FORM" name="L514A" tota-mode="1">
#BackACnt=m,6,O
C(3,#ReportFlag,4,s,$)
C(3,#BackACnt,0,E(0,@L514APRT,0),E(0,@L514APRT,1))

#L514A_LOOP=X,1,S
E(0,1)ASGN(LOOP$)
#ReportACustNo=A,7,O
#ReportACustNoX=X,7,O
C(3,#ReportACustNo,0,T(2,),T(2,#ReportACustNo))
#ReportAFacmNo=A,3,O
#ReportAFacmNoX=X,3,O
C(3,#ReportAFacmNo,0,T(2,),T(2,#ReportAFacmNo))
#ACustNo=X,11,O
C(4,#ReportACustNoX,T(2,),T(2,#ReportACustNoX+-+#ReportAFacmNoX))

#ReportACustName=X,20,O
#ReportAUsageCode=A,2,O
#ReportAUsageCodeX=x,4,O
T(A,#ReportAUsageCode,L5DEF,UsageCodeDef,UsageCode,UsageCodeX)
#UsageCodeAfter=A,2,O
C(3,#UsageCodeAfter,0,E(0,#ReportAUsageCode),s)

#ReportAMark=X,90,O
C(3,#ReportAUsageCode,#UsageCodeAfter,T(2,),T(2,------------------------------------------------------------------------------------------))
C(3,#ReportAUsageCode,#UsageCodeAfter,s,E(0,@UsageCodeAfter,#ReportAUsageCode))

#ReportAApplEmpNo=X,6,O
#ReportAApplName=X,10,O	
#ReportAKeeperEmpNo=X,6,O
#ReportAKeeperName=X,10,O
#ReportAApplDate=D,7,O
#ApplAYear=X,3,S
T(1,#ReportAApplDate,1,3)
#ApplAMon=X,2,S
T(1,#ReportAApplDate,4,2)
#ApplADay=X,2,S
T(1,#ReportAApplDate,6,2)
#ApplADateTurn=X,9,O
T(2,#ApplAYear+/+#ApplAMon+/+#ApplADay)
#ReportAApplDateX=X,9,O
C(3,#ReportAApplDate,0,T(2,),T(2,#ApplADateTurn))
![防止二次單據]
E(0,@L514BPRT,0)
E(0,@L514CPRT,0)
</sub>

<sub type="FORM" name="L514B" tota-mode="1">
#BackBCnt=m,6,O
C(3,#ReportFlag,4,s,$)
C(3,#BackBCnt,0,E(0,@L514BPRT,0),E(0,@L514BPRT,1))

#L514B_LOOP=X,1,S
E(0,1)ASGN(LOOP$)
#ReportBCustNo=A,7,O
#ReportBCustNoX=X,7,O
C(3,#ReportBCustNo,0,T(2,),T(2,#ReportBCustNo))
#ReportBFacmNo=A,3,O
#ReportBFacmNoX=X,3,O
C(3,#ReportBFacmNo,0,T(2,),T(2,#ReportBFacmNo))
#BCustNo=X,11,O
C(4,#ReportBCustNoX,T(2,),T(2,#ReportBCustNoX+-+#ReportBFacmNoX))

#ReportBCustName=X,20,O
#ReportBApplEmpNo=X,6,O
#ReportBApplName=X,10,O
#ReportBKeeperEmpNo=X,6,O
#ReportBKeeperName=X,10,O

#ReportBReturnEmpNo=X,6,O
#ReportBReturnName=X,10,O
!借閱日期
#ReportBApplDate=D,7,O
#ApplBYear=X,3,S
T(1,#ReportBApplDate,1,3)
#ApplBMon=X,2,S
T(1,#ReportBApplDate,4,2)
#ApplBDay=X,2,S
T(1,#ReportBApplDate,6,2)
#ApplBDateTurn=X,9,O
T(2,#ApplBYear+/+#ApplBMon+/+#ApplBDay)
#ReportBApplDateX=X,9,O
C(3,#ReportBApplDate,0,T(2,),T(2,#ApplBDateTurn))

!歸還日期
#ReportBReturnDate=D,7,O
#TurnYear=X,3,S
T(1,#ReportBReturnDate,1,3)
#TurnMon=X,2,S
T(1,#ReportBReturnDate,4,2)
#TurnDay=X,2,S
T(1,#ReportBReturnDate,6,2)
#ReturnDateTurn=X,9,O
T(2,#TurnYear+/+#TurnMon+/+#TurnDay)
#ReportBReturnDateX=X,9,O
C(3,#ReportBReturnDate,0,T(2,),T(2,#ReturnDateTurn))

![防止二次單據]
E(0,@L514APRT,0)
E(0,@L514CPRT,0)
</sub>

<sub type="FORM" name="L514C" tota-mode="1">
#BackCCnt=m,6,O
C(3,#ReportFlag,4,s,$)
C(3,#BackCCnt,0,E(0,@L514CPRT,0),E(0,@L514CPRT,1))

#L514C_LOOP=X,1,S
E(0,1)ASGN(LOOP$)
#ReportCUsageCode=A,2,O
#ReportCUsageCodeX=x,4,O
T(A,#ReportCUsageCode,L5DEF,UsageCodeDef,UsageCode,UsageCodeX)

#ReportCUsageCnt=m,6,O
![防止二次單據]
E(0,@L514APRT,0)
E(0,@L514BPRT,0)
</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#StartDate#EndDate#ReportFlag
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
TXFORM=L514A
#BackACnt
#ReportACustNo
#ReportAFacmNo
#ReportACustName
#ReportAUsageCode
#ReportAApplEmpNo
#ReportAApplName
#ReportAKeeperEmpNo
#ReportAApplDate
#ReportAKeeperName
^
TXFORM=L514B
#BackBCnt
#ReportBCustNo
#ReportBFacmNo
#ReportBCustName
#ReportBApplEmpNo
#ReportBApplName
#ReportBKeeperEmpNo
#ReportBKeeperName
#ReportBReturnEmpNo
#ReportBReturnName
#ReportBApplDate
#ReportBReturnDate
^
TXFORM=L514C
#BackCCnt
#ReportCUsageCode
#ReportCUsageCnt
^
</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
#L514APRT=1,L514A,NA,,D,15
#StartDate
#EndDate
%
#ReportAMark
#ACustNo
#ReportACustName
#ReportAUsageCodeX
#ReportAApplEmpNo
#ReportAApplName
#ReportAKeeperEmpNo
#ReportAKeeperName
#ReportAApplDateX
@
#BackACnt
^

#L514BPRT=1,L514B,NA,,D,15
#StartDate
#EndDate
%
#BCustNo
#ReportBCustName
#ReportBApplEmpNo
#ReportBApplName
#ReportBKeeperEmpNo
#ReportBKeeperName
#ReportBApplDateX
@
#BackBCnt
^

#L514CPRT=1,L514C,NA,,D,15
#StartDate
#EndDate
%
#ReportCUsageCodeX
#ReportCUsageCnt
@
#BackCCnt
^
</sub>
