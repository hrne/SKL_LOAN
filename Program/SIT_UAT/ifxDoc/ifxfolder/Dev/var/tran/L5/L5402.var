!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L5402)
</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L5402" layout="cols=1;screen.width=[130,870];printer.width=[20,80];order=1">
[
["[L5402]                                 年度業績目標更新"],
[#<->#,"#FdBUTTON_FLD+選擇檔案","#BUTTON_FLD"],
[#<->#,"#FdUploadYear+上傳年度",#UploadYear],
[#<->#,"#FdFileCheck+格式檢查",#FileCheck],
! [#<->#,"#FdUploadFg+上傳模式",#UploadFg,#UploadFgX],
]

#FdBUTTON_FLD=X,2,L
#FdUploadYear=X,2,L
T(3,*)
#FdFileCheck=X,2,L
! #FdUploadFg=X,2,L


! 上傳檔案連動
#LC014Mrkey=x,100,S
T(2,L5402)

#LC014Note=x,100,S
T(2,檔名：房貸專員年度業績目標更新母版)

#BufLC014=X,200,S
T(2,L54020000000000000+#LC014Mrkey+#LC014Note)

#BufLC104=X,200,S
T(2,L54020000000000000+#LC014Mrkey+#LC014Note)

#Button=x,100,S
T(2,{cmd=CHAIN; ntxcd=LC014; ntxbuf=#BufLC014})ASGN(BTN_NEW1$)
K(MODIFYBUTTON,1,已上傳母版查詢)

#Button1=x,100,S
T(2,{cmd=CHAIN; ntxcd=LC104; ntxbuf=#BufLC104})ASGN(BTN_NEW2$)
K(MODIFYBUTTON,2,上傳母版)


!---------- AP TEXT AREA Variables ----------
!建議寫在第一個輸入欄位前

! 宣告按鈕物件
! multiple:true : 可上傳多個檔案 (綠底)
! fieldName : 設定上傳欄名返回傳接收變數 (黃底)
! width : 上傳檔名顯示框的寛度 (藍底)
#BUTTON_FLD=X,1,O,ui:button;value:瀏覽;enable:1;tabbable:1;file:true;multiple:false;fieldName:#FILENA;width:600

! 宣告按鈕事件
#BIND_ABA=X,1,S
BIND(#BUTTON_FLD,click)

! 上傳欄名返回傳接收變數 (請定為小x)
#FILENA=x,1000,S


#CHAIN=A,1,S
T(4,CHAIN$) 

#NTXBUF=X,13,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@UploadYear,#NTXBUF,1,3)

#PREVALUE=A,1,S
T(1,@UploadYear,#SYSDATE,2,3)



<include src="ROM.icf::L5R34.dec"/>
#RimFileName=x,1000,S
#RimL5R34=X,1,S
! 上傳年度
#UploadYear=A,3,I
@
V(2,0)
T(2,@RimFileName,#FILENA)
RESET_RIM(#RimL5R34,L5R34)
S(L5R34,1,#RimFileName)
R(1,L5R34)
T(2,@ReturnMessage,#L5R34Message)
E(0,@SuccessFlag,#L5R34SuccessFlag)

! 檔名檢核回復
#ReturnMessage=x,1000,S

#SuccessFlag=A,1,S

#FileCheck=X,10,L
SWITCH(#SuccessFlag,
       1,T(3,成功),
       0,T(3,失敗),)
@C(3,#SuccessFlag,0,V(P,#ReturnMessage),ALERT(#ReturnMessage))

! 選項下拉選單
<include src="HELPRIM.icf::HELPRIM.rtn"/>
#UploadFgRimName=x,20,S
T(3,CdCode.UploadFg)
#UploadFgHelpRim=X,1,S
RESET_RIM(#UploadFgHelpRim,XXR99)
S(XXR99,01,#UploadFgRimName)
R(1,XXR99)
CALL(#HelpProc)
T(2,@UploadFgHelp,#HelpDesc1)
#UploadFgHelp=x,1024,S

#UploadFg=A,1,S
E(0,1)
! HELP(#UploadFgHelp)
! @V(H,#UploadFgHelp)
! #UploadFgX=X,10,L
! T(H,#UploadFg,#UploadFgHelp)
</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L5402 -----------
<sub type="FORM" name="L5402">

#OSuccessFlag=A,1,O
C(3,#OSuccessFlag,1,ALERT(檔案上傳成功),s)

</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#FILENA
#UploadYear
#UploadFg
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="HELPRIM.icf::HELPRIM.tom"/>
TXFORM=L5402
#OSuccessFlag
^

<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L5R34.tom"/>
</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
</sub>
