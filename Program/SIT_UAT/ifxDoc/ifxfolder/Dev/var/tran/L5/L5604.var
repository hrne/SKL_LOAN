!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L5604)
</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L5604" layout="cols=3;screen.width=[150,400,150,400];printer.width=[20,80];order=1">
[
["[L5604]                                 法務進度登錄"],
[#<->#,"#FdFunctionCd+功能",#FunctionCdX],
[#<->#,"#FdCaseCode+案件種類",#CaseCode,#CaseCodeX],
[#<->#,"#FdCustNo+戶號",#CustNo,"@",#CustName],
[#<->#,"#FdFacmNo+額度編號",#FacmNo],
["#FdAccCollPsn+催收人員",#AccCollPsn,#AccCollPsnX],["#FdLegalPsn+法務人員",#LegalPsn,#LegalPsnX],
["#FdPrevIntDate+繳息迄日",#PrevIntDate],["#FdLoanBal+放款餘額",#LoanBal],
["#FdNextIntDate+下次應繳日",#NextIntDate],
[#<->#,"@",#BTNA,#BTNB,#BTNC,#BTND,#BTNE,#BTNN],
[#<->#,"@",#BTNX,#BTNG],
[#<->#,"#FdClCode+擔保品編號",#ClCode1,"-",#ClCode2,"-",#ClNo,#ClX],
[#<->#,"#FdRecordDate+記錄日期",#RecordDate],
[#<->#,"#FdLegalProg+法務進度",#LegalProg,#LegalProgX],
[#<->#,"#FdAmount+金額",#Amount],
[#<->#,"#FdRemark+其他記錄",#Remark,#RemarkX],
[#<->#,"#FdMemo",#Memo],
["#FdEditDate+維護日期",#EditDate],["#FdEditTime+維護時間",#EditTime],
[#<->#,"#FdEditEmpNo+維護人員",#EditEmpNo,#EditEmpNoX],
]
!---------- AP TEXT AREA Variables ----------
#BTNA=X,1,I,ui:button;value:電催查詢;enable:1;tabbable:0
#BTNB=X,1,I,ui:button;value:面催查詢;enable:1;tabbable:0
#BTNC=X,1,I,ui:button;value:函催查詢;enable:1;tabbable:0
#BTND=X,1,I,ui:button;value:法務查詢;enable:1;tabbable:0
#BTNE=X,1,I,ui:button;value:提醒查詢;enable:1;tabbable:0
#BTNN=X,1,I,ui:button;value:提醒登錄;enable:1;tabbable:0
#BTNX=X,1,I,ui:button;value:擔保品不動產資料查詢;enable:1;tabbable:0
#BTNG=X,1,I,ui:button;value:擔保品全部資料查詢;enable:1;tabbable:0
#CHAIN=A,1,S
T(4,CHAIN$) 
IF(#CHAIN!=1,V(P,此為連動交易，請從L5060進入),$)

!做完交易自動更新原畫面
#AutoReFresh=A,1,S
C(3,#CHAIN,1,$,S)
E(0,1)
ASGN(CAUTO$)

<include src="HELPRIM.icf::HELPRIM.rtn"/>
! 功能下拉選單1
#FunctionCdRimName=x,20,S
T(3,CdCode.FunctionCd)
#FunctionCdHelp=x,1024,S

! 案件種類下拉選單2
#CaseCodeRimName=x,20,S
T(3,CdCode.CaseCode)
#CaseCodeHelp=x,1024,S

! 法務進度下拉選單3
#LegalProgRimName=x,20,S
T(3,CdCode.LegalProg)
#LegalProgHelp=x,3000,S

! 紀錄下拉選單4
#LawRemarkRimName=x,20,S
T(3,CdCode.LawRemark)
#LawRemarkHelp=x,1024,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#FunctionCdRimName,#CaseCodeRimName,#LegalProgRimName,#LawRemarkRimName)
R(1,XXR99)
CALL(#HelpProc)
T(2,@FunctionCdHelp,#HelpDesc1)
T(2,@CaseCodeHelp,#HelpDesc2)
T(2,@LegalProgHelp,#HelpDesc3)
T(2,@LawRemarkHelp,#HelpDesc4)


#NTXBUF=X,33,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@FunctionCd,#NTXBUF,1,1)
T(1,@CaseCode,#NTXBUF,2,1)
T(1,@CustNo,#NTXBUF,3,7)
T(1,@FacmNo,#NTXBUF,10,3)
T(1,@TitaTlrNo,#NTXBUF,13,6)
T(1,@TitaTxtNo,#NTXBUF,19,8)
T(1,@TitaAcDate,#NTXBUF,27,7)
INVOKEJS(SHOW,p1,02,02,1)

<include src="ROM.icf::L5R15.dec"/>
#RimCustNo=X,7,S
#RimFacmNo=X,3,S
#RimL5R15=X,1,S
T(2,@RimCustNo,#CustNo)
T(2,@RimFacmNo,#FacmNo)
RESET_RIM(#RimL5R15,L5R15)
S(L5R15,1,#RimCustNo,#RimFacmNo)
R(1,L5R15)
T(2,@CustName,#L5R15CustName)
T(2,@AccCollPsn,#L5R15AccCollPsn)
T(2,@LegalPsn,#L5R15LegalPsn)
T(2,@AccCollPsnX,#L5R15AccCollPsnX)
T(2,@LegalPsnX,#L5R15LegalPsnX)
T(2,@PrevIntDate,#L5R15PrevIntDate)
T(2,@LoanBal,#L5R15LoanBal)
T(2,@NextIntDate,#L5R15NextIntDate)

#Space=X,1,S
<include src="ROM.icf::L5R21.dec"/>
#RimCaseCode=X,1,S
#RimAcDate=X,7,S
#RimTitaTlrNo=X,6,S
#RimTitaTxtNo=X,8,S
#RimL5R21=X,1,S
T(2,@RimCaseCode,#CaseCode)
T(2,@RimAcDate,#TitaAcDate)
T(2,@RimTitaTlrNo,#TitaTlrNo)
T(2,@RimTitaTxtNo,#TitaTxtNo)
C(3,#FunctionCd,1,S,$)
RESET_RIM(#RimL5R21,L5R21)
S(L5R21,1,#RimCaseCode,#RimCustNo,#RimFacmNo,#RimAcDate,#RimTitaTlrNo,#RimTitaTxtNo)
R(1,L5R21)
T(2,@RecordDate,#L5R21RecordDate)
T(2,@LegalProg,#L5R21LegalProg)
T(2,@Amount,#L5R21Amount)
T(2,@Memo,#L5R21Memo)
T(2,@Remark,#L5R21ReMark)
E(0,@ClCode1,#L5R21ClCode1)
E(0,@ClCode2,#L5R21ClCode2)
E(0,@ClNo,#L5R21ClNo)
T(2,@EditEmpNo,#L5R21EditEmpNo)
T(2,@EditDate,#L5R21EditDate)
T(2,@EditTime,#L5R21EditTime)
T(2,@ClX,#L5R21Other)

! 調Rim完成預先帶入
T(H,@LegalProgX,#LegalProg,#LegalProgHelp)
T(H,@RemarkX,#Remark,#LawRemarkHelp)

#Space2=X,1,S
!C(2,#FunctionCd,s,$,$,$,s,s)
!T(4,@EditEmpNo,TLRNO$)
<include src="ROM.icf::L5R28.dec"/>
#RimEmployeeNo=X,6,S
#RimL5R28=X,1,S
T(2,@RimEmployeeNo,#EditEmpNo)
RESET_RIM(#RimL5R28,L5R28)
S(L5R28,1,#RimEmployeeNo)
R(1,L5R28)
T(2,@EditEmpNoX,#L5r28FullName)

! 登放序號
#ActSeq=X,20,S

!必輸欄位
#FdFunctionCd=X,1,L
#FdCaseCode=X,1,L
#FdCustNo=X,1,L
#FdAccCollPsn=X,1,L
#FdLegalPsn=X,1,L
#FdPrevIntDate=X,1,L
#FdLoanBal=X,1,L
#FdNextIntDate=X,1,L
#FdTelPhone=X,1,L
#FdCallDate=X,1,L
#FdMemo=X,1,L
#FdEditEmpNo=X,1,L
#FdFacmNo=X,1,L
#FdClCode=X,1,L
#FdRecordDate=X,1,L
#FdLegalProg=X,1,L
#FdAmount=X,1,L
#FdRemark=X,1,L
#FdEditDate=X,1,L
#FdEditTime=X,1,L

#Default=X,1,S
SWITCH(#FunctionCd,
    1,K(MODIFYBUTTON,新增)T(2,@FdClCode,*)T(2,@FdRecordDate,*)T(2,@FdLegalProg,*)T(2,@FdRemark,*),
    2,K(MODIFYBUTTON,修改)INVOKEJS(SHOW,L5604,9,9,0)T(2,@FdRecordDate,*)T(2,@FdLegalProg,*)T(2,@FdRemark,*)T(F,@ClCode1,0)T(F,@ClCode2,0)T(F,@ClNo,0),
    3,K(MODIFYBUTTON,新增)T(2,@FdClCode,*)T(2,@FdRecordDate,*)T(2,@FdLegalProg,*)T(2,@FdRemark,*),
    4,K(MODIFYBUTTON,刪除)INVOKEJS(SHOW,L5604,8,9,0)T(F,@ClCode1,0)T(F,@ClCode2,0)T(F,@ClNo,0)T(F,@RecordDate,0)T(F,@LegalProg,0)T(F,@Amount,0)T(F,@Remark,0)T(F,@Memo,0),
    5,K(NOBUTTON,CLOSEY)INVOKEJS(SHOW,L5604,8,9,0)T(F,@ClCode1,0)T(F,@ClCode2,0)T(F,@ClNo,0)T(F,@RecordDate,0)T(F,@LegalProg,0)T(F,@Amount,0)T(F,@Remark,0)T(F,@Memo,0)
)

! 功能
#FunctionCd=A,1,S
C(3,#FunctionCd,3,E(0,1),s)
C(3,#CHAIN,0,$,s)
C(2,#FunctionCd,S,$,$,s,s,s)
HELP(#FunctionCdHelp)
@V(H,#FunctionCdHelp)
E(0,@FUNCIND,#FunctionCd)

#FunctionCdX=X,4,L
T(H,#FunctionCd,#FunctionCdHelp)
E(0,@FUNCIND,#FunctionCd)
!刪除隱藏重新交易按鈕
#AGAIN=X,1,S
C(2,#FunctionCd,$,$,E(0,1),$,E(0,1))
ASGN(AGAIN$)
! 案件種類
#CaseCode=A,1,L
C(3,#CHAIN,0,$,s)
C(2,#FunctionCd,S,$,$,s,s,s)
HELP(#CaseCode)
@V(H,#CaseCode)
#CaseCodeX=X,4,L
T(H,#CaseCode,#CaseCodeHelp)

!<電催查詢>
#BUFA=X,11,S
T(2,#CaseCode+#CustNo+#FacmNo)
#BINDA=X,1,S
BIND(#BTNA,click, {cmd=CHAIN; ntxcd=L5961; ntxbuf=#BUFA})
!<面催查詢>
#BUFB=X,11,S
T(2,#CaseCode+#CustNo+#FacmNo)
#BINDB=X,1,S
BIND(#BTNB,click, {cmd=CHAIN; ntxcd=L5962; ntxbuf=#BUFB})
!<函催查詢>
#BUFC=X,11,S
T(2,#CaseCode+#CustNo+#FacmNo)
#BINDC=X,1,S
BIND(#BTNC,click, {cmd=CHAIN; ntxcd=L5963; ntxbuf=#BUFC})
!<法務查詢>
#BUFD=X,11,S
T(2,#CaseCode+#CustNo+#FacmNo)
#BINDD=X,1,S
BIND(#BTND,click, {cmd=CHAIN; ntxcd=L5964; ntxbuf=#BUFD})
!<提醒查詢>
#BUFE=X,12,S
T(2,#CaseCode+#CustNo+#FacmNo+1)
#BINDE=X,1,S
BIND(#BTNE,click, {cmd=CHAIN; ntxcd=L5965; ntxbuf=#BUFE})
! <提醒登錄>
#BUFN=X,12,S
T(2,1+#CaseCode+#CustNo+#FacmNo+1)
#BINDN=X,1,S
BIND(#BTNN,click, {cmd=CHAIN; ntxcd=L5605; ntxbuf=#BUFN})
! <擔保品明細資料查詢>
#BUFX=X,38,S
T(2,1 000000000+#FacmNo+0000000+          +#CustNo)
#BUFG=X,38,S
T(2,  000000000+#FacmNo+0000000+          +#CustNo)
! 戶號
#CustNo=A,7,L
C(3,#CHAIN,0,$,s)
C(2,#FunctionCd,S,$,$,s,s,s)

! 戶名----調RIM
#CustName=X,20,L

! 額度編號
#FacmNo=A,3,L
C(3,#CHAIN,0,$,s)
C(2,#FunctionCd,S,$,$,s,s,s)

! ---------調RIM
! 催收人員
#AccCollPsn=X,8,L
#AccCollPsnX=X,40,L
! 法務人員
#LegalPsn=X,8,L
#LegalPsnX=X,40,L
! 繳息迄日
#PrevIntDate=D,7,L
! 放款餘額
#LoanBal=M,14,L
! 下次繳息日
#NextIntDate=D,7,L
! ---------調RIM
! 擔保品編號1
#BINDG=X,1,S
BIND(#BTNG,click, {cmd=CHAIN; ntxcd=L2038; ntxbuf=#BUFG;ntxbuf5=type<-1:ClCode1<-OOClCode1:ClCode2<-OOClCode2:ClNo<-OOClNo:ClX<-})
#BINDX=X,1,S
BIND(#BTNX,click, {cmd=CHAIN; ntxcd=L2038; ntxbuf=#BUFX;ntxbuf5=type<-1:ClCode1<-OOClCode1:ClCode2<-OOClCode2:ClNo<-OOClNo:ClX<-OOOther})
#ClCode1=A,1,I
C(2,#FunctionCd,S,$,s,$,s,s)
@V(2,0)
! 擔保品編號2
#ClCode2=A,2,I
C(2,#FunctionCd,S,$,s,$,s,s)
@V(2,0)
! 擔保品號碼
#ClNo=A,7,I
C(2,#FunctionCd,S,$,s,$,s,s)
@V(2,0)

! 門牌號碼
#ClX=x,100,L

! 記錄日期
#RecordDateX=X,8,S
T(4,#SYSCDATE)

#RecordDate=D,7,I
C(2,#FunctionCd,S,$,$,$,s,s)
C(2,#FunctionCd,S,T(1,#RecordDateX,2,7),$,T(1,#RecordDateX,2,7),s,s)
D(8)
@V(7)A(DATE,0,#RecordDate)

! 法務進度
#LegalProg=A,3,I
C(2,#FunctionCd,S,$,$,$,s,s)
HELP(#LegalProgHelp,cols:5)
@V(H,#LegalProgHelp)
#LegalProgX=X,30,L
T(H,#LegalProg,#LegalProgHelp)
! 金額
#Amount=M,14,I
C(2,#FunctionCd,S,$,$,$,s,s)


! 其他記錄
#Remark=A,1,I
C(2,#FunctionCd,S,$,$,$,s,s)
HELP(#LawRemarkHelp)
@V(H,#LawRemarkHelp)

#RemarkX=X,20,L
! C(3,#Remark,0,S,$)
T(H,#Remark,#LawRemarkHelp)
! 其他記錄
#Memo=x,10.50,I
C(2,#FunctionCd,S,$,$,$,s,s)
! 維護人員
#EditEmpNo=X,6,L
C(2,#FunctionCd,S,$,$,$,s,s)
T(4,@EditEmpNo,TLRNO$)
T(2,@RimEmployeeNo,#EditEmpNo)
RESET_RIM(#RimL5R28,L5R28)
S(L5R28,1,#RimEmployeeNo)
R(1,L5R28)
T(2,@EditEmpNoX,#L5r28FullName)

#EditEmpNoX=X,50,L
! 經辦
#TitaTlrNo=X,6,L
! 交易序號
#TitaTxtNo=X,8,L
! 系統日期
#TitaAcDate=D,7,L

#CDate=D,7,S
T(1,#SYSCDATE,2,7)
! 維護日期
#EditDate=D,7,L
C(2,#FunctionCd,S,T(2,#CDate),T(2,#CDate),T(2,#CDate),s,s)

! 維護時間
#EditTimeX=X,6,S
T(4,TIME$)
#EditTime=X,4,L
C(2,#FunctionCd,S,$,$,$,s,s)
T(1,#EditTimeX,1,4)
@V(7)

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L5604 -----------
<sub type="FORM" name="L5604">
</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#FunctionCd
#CaseCode
#CustNo
#FacmNo
#AccCollPsn
#LegalPsn
#PrevIntDate
#LoanBal
#ClCode1
#ClCode2
#ClNo
#RecordDate
#LegalProg
#Amount
#Remark
#Memo
#TitaTlrNo
#TitaTxtNo
#TitaAcDate
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L5R15.tom"/>
<include src="ROM.icf::L5R21.tom"/>
<include src="ROM.icf::L5R28.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
TXFORM=L5604

^
</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
</sub>
