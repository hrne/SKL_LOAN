!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L5101)
</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L5101" layout="cols=1;screen.width=[130,870];printer.width=[20,80];order=1">
[
["[L5101]                                 資金運用概況維護"],
[#<->#,"#FdFunctionCodeX+功能",#FunctionCodeX],
[#<->#,"#FdAcDate+日期",#AcDate],
[#<->#,"#FdResrvStndrd+責任準備金",#ResrvStndrd],
[#<->#,"#FdPosbleBorPsn+可放款比率+%",#PosbleBorPsn],
[#<->#,"#FdPosbleBorAmt+可放款金額",#PosbleBorAmt],
[#<->#,"#FdAlrdyBorAmt+已放款金額",#AlrdyBorAmt],
[#<->#,"#FdStockHoldersEqt+股東權益",#StockHoldersEqt],
]

#FdFunctionCodeX=X,2,L
#FdAcDate=X,2,L
T(3,*)
#FdResrvStndrd=X,2,L
T(3,*)
#FdPosbleBorPsn=X,2,L
T(3,*)
#FdPosbleBorAmt=X,2,L
#FdAlrdyBorAmt=X,2,L
#FdStockHoldersEqt=X,2,L
T(3,*)


!---------- AP TEXT AREA Variables ----------

!功能
#FuncHelp=X,50,S
T(3,1:新增;2:修改;4:刪除;5:查詢)

#FuncHelp1=X,50,S
T(3,2:修改;4:刪除;5:查詢)

#CHAIN=A,1,S
T(4,CHAIN$) 
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:[L5901 資金運用概況查詢]進入),$)
C(3,#CHAIN,1,E(0,@FunctionCode,1),s)


#NTXBUF=X,100,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@FunctionCode,#NTXBUF,1,1)
T(1,@AcDate,#NTXBUF,2,7)
T(1,@ResrvStndrd,#NTXBUF,9,14)
T(1,@PRE_PosbleBorPsn,#NTXBUF,23,7)
T(1,@PosbleBorAmt,#NTXBUF,30,14)
T(1,@AlrdyBorAmt,#NTXBUF,44,14)
T(1,@StockHoldersEqt,#NTXBUF,58,14)
INVOKEJS(SHOW,p1,02,02,1)

#PRE_EVUL=A,1,S
! E(3,@ResrvStndrd,#PRE_ResrvStndrd/100)
E(3,@PosbleBorPsn,#PRE_PosbleBorPsn/100)
! E(3,@PosbleBorAmt,#PRE_PosbleBorAmt/100)
! E(3,@AlrdyBorAmt,#PRE_AlrdyBorAmt/100)

! 功能
#FunctionCode=A,1,S
C(3,#CHAIN,0,E(0,@FunctionCode,1),HELP(#FuncHelp1))
C(3,#CHAIN,0,s,$)
C(3,#FunctionCode,2,$,s)
@C(3,#CHAIN,0,V(1,1),V(H,#FuncHelp))
E(0,@FUNCIND,#FunctionCode)


#FunctionCodeX=X,4,L
T(H,#FunctionCode,#FuncHelp)
C(2,#FunctionCode,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),$,K(MODIFYBUTTON,刪除),K(MODIFYBUTTON,查詢))
C(3,#FunctionCode,5,K(NOBUTTON,CLOSEY),$)

!刪除隱藏重新交易按鈕
#AGAIN=X,1,S
C(3,#FunctionCode,1,S,$)
E(0,1)ASGN(AGAIN$)

#ShowFd=X,1,S
C(2,#FunctionCode,T(3, ),T(3,*),T(3,*),T(3,*),T(3, ),T(3, ))
T(2,@FdAcDate,#ShowFd)     
T(2,@FdResrvStndrd,#ShowFd)
T(2,@FdPosbleBorPsn,#ShowFd)
T(2,@FdStockHoldersEqt,#ShowFd)

!顯示框線
#WKTF=X,1,S
SWITCH(#FunctionCode,
1,
T(F,@AcDate,1)
T(F,@ResrvStndrd,1)
T(F,@PosbleBorPsn,1)
T(F,@PosbleBorAmt,1)
T(F,@AlrdyBorAmt,1)
T(F,@StockHoldersEqt,1),
2,
T(F,@AcDate,0)
T(F,@ResrvStndrd,1)
T(F,@PosbleBorPsn,1)
T(F,@PosbleBorAmt,1)
T(F,@AlrdyBorAmt,1)
T(F,@StockHoldersEqt,1),
4,
T(F,@AcDate,0)
T(F,@ResrvStndrd,0)
T(F,@PosbleBorPsn,0)
T(F,@PosbleBorAmt,0)
T(F,@AlrdyBorAmt,0)
T(F,@StockHoldersEqt,0))

#RimFuncCode=A,1,S
#RimAcDate=D,7,S

#RimL5r32A=X,1,S
C(3,#FunctionCode,1,$,s)
RESET_RIM(#RimL5r32,L5R32)
E(0,@RimFuncCode,1)
S(L5R32,1,#RimFuncCode,#RimAcDate)
R(1,L5R32)
E(0,@AcDate,#L5r32LastMonthEndDay)

! 日期
#AcDate=D,7,I
! C(3,#FunctionCode,2,$,C(3,#FunctionCode,1,$,s))
C(3,#FunctionCode,1,$,s)
@V(7)
A(DATE,0,#AcDate)

! !<回收試算>
! #BUFA=X,74,S
! T(1,#AcDate,1,3)
! #BINDA=X,1,S
! BIND(#BTNA,click, {cmd=CHAIN; ntxcd=L5901; ntxbuf=#BUFA})

#RimL5r32B=X,1,S
C(3,#FunctionCode,1,$,s)
RESET_RIM(#RimL5r32,L5R32)
E(0,@RimFuncCode,2)
E(0,@RimAcDate,#AcDate)
S(L5R32,1,#RimFuncCode,#RimAcDate)
R(1,L5R32)
E(0,@AlrdyBorAmt,#L5r32AldyLoanBal)

! 責任準備金
#ResrvStndrd=m,14,I
C(3,#FunctionCode,2,$,C(3,#FunctionCode,1,$,s))
@V(2,0)

! 可放款比率%
#PRE_PosbleBorPsn=m,10,S
#PosbleBorPsn=m,3.2,I
C(3,#FunctionCode,2,$,C(3,#FunctionCode,1,$,s))
@V(2,0)

! 最高可放款金額
#MaxPosbleBorAmt=m,14,S
E(0,#ResrvStndrd*#PosbleBorPsn/100)

! 可放款金額
#PosbleBorAmt=m,14,I
C(3,#FunctionCode,2,$,C(3,#FunctionCode,1,$,s))
IF(#FunctionCode==1 || #FunctionCode==2 ,E(0,#MaxPosbleBorAmt),$)
@IF(#PosbleBorAmt>#MaxPosbleBorAmt,V(P,放款金額輸入過大),s)

<include src="ROM.icf::L5R32.dec"/>

! 已放款金額
#AlrdyBorAmt=m,14,L
C(3,#FunctionCode,2,$,C(3,#FunctionCode,1,$,s))

! 股東權益
#StockHoldersEqt=m,14,I
C(3,#FunctionCode,2,$,C(3,#FunctionCode,1,$,s))
@V(2,0)

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L5101 -----------
<sub type="FORM" name="L5101">
</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#FunctionCode
#AcDate
#ResrvStndrd
#PosbleBorPsn
#PosbleBorAmt
#AlrdyBorAmt
#StockHoldersEqt
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L5R32.tom"/>
TXFORM=L5101
^
</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
</sub>
