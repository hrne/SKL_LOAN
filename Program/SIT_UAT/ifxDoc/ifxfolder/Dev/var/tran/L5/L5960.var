!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L5960)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,0)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,40)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,40)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
!不自動送出更新記號
#AutoReFresh=A,1,S
E(0,2)
ASGN(CAUTO$)

</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L5960" layout="cols=3;screen.width=[100,400,100,400];printer.width=[20,80];order=1">
[
["[L5960]                                 案件資料查詢"],
[#<->#,"@案件種類",#CaseCode,#CaseCodeX],
[#<->#,"@借戶戶號",#CustNo,#CustName],
[#<->#,"@額度編號",#FacmNo],
["@催收人員",#AccCollPsn,#AccCollPsnX],["@法務人員",#LegalPsn,#LegalPsnX],
["@繳息迄日",#PrevIntDate],["@放款餘額",#LoanBal],
["@下次應繳日",#NextIntDate],
[#<->#,"@案件登錄",#BTNPHET,#BTNFCET,#BTNMLET,#BTNLGET,#BTNALET],
[#<->#,"@案件查詢",#BTNPHSR,#BTNFCSR,#BTNMLSR,#BTNLGSR,#BTNALSR],
[#<->#,"@資料查詢",#BTNB,#BTNC,#BTND,#BTNH,#BTNI],
[#<->#,"@其他查詢",#BTNE,#BTNF,#BTNG,#BTNJ,#BTNK],
]
!---------- AP TEXT AREA Variables ----------
#BTNPHET=X,1,I,ui:button;value:電催登錄;enable:1;tabbable:0
#BTNFCET=X,1,I,ui:button;value:面催登錄;enable:1;tabbable:0
#BTNMLET=X,1,I,ui:button;value:函催登錄;enable:1;tabbable:0
#BTNLGET=X,1,I,ui:button;value:法催登錄;enable:1;tabbable:0
#BTNALET=X,1,I,ui:button;value:提醒登錄;enable:1;tabbable:0

#BTNPHSR=X,1,I,ui:button;value:電催查詢;enable:1;tabbable:0
#BTNFCSR=X,1,I,ui:button;value:面催查詢;enable:1;tabbable:0
#BTNMLSR=X,1,I,ui:button;value:函催查詢;enable:1;tabbable:0
#BTNLGSR=X,1,I,ui:button;value:法催查詢;enable:1;tabbable:0
#BTNALSR=X,1,I,ui:button;value:提醒查詢;enable:1;tabbable:0

#BTNB=X,1,I,ui:button;value:顧客基本資料;enable:1;tabbable:0
#BTNC=X,1,I,ui:button;value:顧客聯絡電話;enable:1;tabbable:0
#BTND=X,1,I,ui:button;value:額度資料;enable:1;tabbable:0
#BTNE=X,1,I,ui:button;value:回收試算;enable:1;tabbable:0
#BTNF=X,1,I,ui:button;value:繳息情形查詢;enable:1;tabbable:0
#BTNG=X,1,I,ui:button;value:法拍費用資料;enable:1;tabbable:0
#BTNH=X,1,I,ui:button;value:保證人資料;enable:1;tabbable:0
#BTNI=X,1,I,ui:button;value:擔保品(含火險)資料;enable:1;tabbable:0
#BTNJ=X,1,I,ui:button;value:火險查詢;enable:1;tabbable:0
#BTNK=X,1,I,ui:button;value:火險;enable:1;tabbable:0

#CHAIN=A,1,S
T(4,CHAIN$) 
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:[L5060案件處理清單]進入),$)

#NTXBUF=X,26,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@CustNo,#NTXBUF,1,7)
T(1,@FacmNo,#NTXBUF,8,3)
T(1,@CaseCode,#NTXBUF,11,1)

<include src="ROM.icf::L5R15.dec"/>
#RimCustNo=X,7,S
#RimFacmNo=X,3,S
#RimL5R15=X,1,S
T(2,@RimCustNo,#CustNo)
T(2,@RimFacmNo,#FacmNo)
RESET_RIM(#RimL5R15,L5R15)
S(L5R15,1,#RimCustNo,#RimFacmNo)
R(1,L5R15)
T(2,@CustName,#L5R15CustName)
T(2,@AccCollPsn,#L5R15AccCollPsn)
T(2,@LegalPsn,#L5R15LegalPsn)
T(2,@AccCollPsnX,#L5R15AccCollPsnX)
T(2,@LegalPsnX,#L5R15LegalPsnX)
T(2,@PrevIntDate,#L5R15PrevIntDate)
T(2,@LoanBal,#L5R15LoanBal)
T(2,@NextIntDate,#L5R15NextIntDate)

INVOKEJS(SHOW,p1,02,02,1)

<include src="HELPRIM.icf::HELPRIM.rtn"/>
! 案件種類下拉選單1
#CaseCodeRimName=x,20,S
T(3,CdCode.CaseCode)
#CaseCodeHelp=x,1024,S

! 作業細項下拉選單2
#TxCodeRimName=x,20,S
T(3,CdCode.TxCode)
#TxCodeHelp=x,1024,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CaseCodeRimName,#TxCodeRimName)
R(1,XXR99)
CALL(#HelpProc)
T(2,@CaseCodeHelp,#HelpDesc1)
T(2,@TxCodeHelp,#HelpDesc2)

#BTNCD=A,1,S
K(NOBUTTON,CLOSE)

! 案件種類
#CaseCode=A,1,L
HELP(#CaseCodeHelp)
@T(3,@CaseCodeX,)
V(H,#CaseCodeHelp)

#CaseCodeX=X,4,L
T(H,#CaseCode,#CaseCodeHelp)
! 借戶戶號
#CustNo=A,7,L
C(3,#CHAIN,0,$,s)

! 借款人戶名---調RIM
#CustName=X,100,L

! 額度編號
#FacmNo=A,3,L
C(3,#CHAIN,0,$,s)

#MRKEY=_,_,S
C(3,#CustNo,0,S,$)
C(3,#FacmNo,0,T(2,#CustNo),T(2,#CustNo+-+#FacmNo)) 

! 催收人員
#AccCollPsn=X,6,L
! 催收員姓名
#AccCollPsnX=X,40,L
! 法務人員
#LegalPsn=X,6,L
! 法務人員姓名
#LegalPsnX=X,40,L
! 繳息迄日
#PrevIntDate=D,7,L
! 放款餘額
#LoanBal=M,14,L
! 下次繳息日
#NextIntDate=D,7,L

!<電催登錄>
#BUFPHET=X,12,S
T(2,1+#CaseCode+#CustNo+#FacmNo)
#BINDPHET=X,1,S
BIND(#BTNPHET,click, {cmd=CHAIN; ntxcd=L5601; ntxbuf=#BUFPHET})

!<面催登錄>
#BUFFCET=X,12,S
T(2,1+#CaseCode+#CustNo+#FacmNo)
#BINDFCET=X,1,S
BIND(#BTNFCET,click, {cmd=CHAIN; ntxcd=L5602; ntxbuf=#BUFFCET})

!<函催登錄>
#BUFMLET=X,12,S
T(2,1+#CaseCode+#CustNo+#FacmNo)
#BINDMLET=X,1,S
BIND(#BTNMLET,click, {cmd=CHAIN; ntxcd=L5603; ntxbuf=#BUFMLET})

!<法催登錄>
#BUFLGET=X,12,S
T(2,1+#CaseCode+#CustNo+#FacmNo)
#BINDLGET=X,1,S
BIND(#BTNLGET,click, {cmd=CHAIN; ntxcd=L5604; ntxbuf=#BUFLGET})

!<提醒登錄>
#BUFALET=X,13,S
T(2,1+#CaseCode+#CustNo+#FacmNo)
#BINDALET=X,1,S
BIND(#BTNALET,click, {cmd=CHAIN; ntxcd=L5605; ntxbuf=#BUFALET})


! --------------------查詢--------------------
!<電催查詢>
! #BUFPHSR=X,11,S
! T(2,#CustNo+#FacmNo+#CaseCode)
#BUFPHSR=X,11,S
T(2,#CaseCode+#CustNo+#FacmNo)
#BINDPHSR=X,1,S
BIND(#BTNPHSR,click, {cmd=CHAIN; ntxcd=L5961; ntxbuf=#BUFPHSR})

!<面催查詢>
#BUFFCSR=X,11,S
T(2,#CaseCode+#CustNo+#FacmNo)
#BINDFCSR=X,1,S
BIND(#BTNFCSR,click, {cmd=CHAIN; ntxcd=L5962; ntxbuf=#BUFFCSR})

!<函催查詢>
#BUFMLSR=X,11,S
T(2,#CaseCode+#CustNo+#FacmNo)
#BINDMLSR=X,1,S
BIND(#BTNMLSR,click, {cmd=CHAIN; ntxcd=L5963; ntxbuf=#BUFMLSR})

!<法催查詢>
#BUFLGSR=X,11,S
T(2,#CaseCode+#CustNo+#FacmNo)
#BINDLGSR=X,1,S
BIND(#BTNLGSR,click, {cmd=CHAIN; ntxcd=L5964; ntxbuf=#BUFLGSR})

!<提醒查詢>
#BUFALSR=X,12,S
T(2,#CaseCode+#CustNo+#FacmNo+1)
#BINDALSR=X,1,S
BIND(#BTNALSR,click, {cmd=CHAIN; ntxcd=L5965; ntxbuf=#BUFALSR})


!<顧客基本資料>
#BUFB=X,7,S
T(2,#CustNo)
#BINDB=X,1,S
BIND(#BTNB,click, {cmd=CHAIN; ntxcd=L1001; ntxbuf=#BUFB})

!<顧客聯絡電話>
#CSPACE=X,10,S
#BUFC=X,18,S
T(2,1+#CSPACE+#CustNo)
#BINDC=X,1,S
BIND(#BTNC,click, {cmd=CHAIN; ntxcd=L1905; ntxbuf=#BUFC})

!<額度資料>
#BUFD=X,11,S
T(2,5+#CustNo+#FacmNo)
#BINDD=X,1,S
BIND(#BTND,click, {cmd=CHAIN; ntxcd=L2154; ntxbuf=#BUFD})

!<回收試算>
#SPACEE=X,5,S
#BUFE=X,45,S
T(2,L5960+#CustNo+#FacmNo+000+                  +#SYSDATE)
#BINDE=X,1,S
BIND(#BTNE,click, {cmd=CHAIN; ntxcd=L3921; ntxbuf=#BUFE})

!<繳息情形查詢>
#BUFF=X,15,S
T(2,L5960+#CustNo+#FacmNo)
#BINDF=X,1,S
BIND(#BTNF,click, {cmd=CHAIN; ntxcd=L3911; ntxbuf=#BUFF})

!<法拍費用資料>
#BUFG=X,7,S
T(2,#CustNo)
#BINDG=X,1,S
BIND(#BTNG,click, {cmd=CHAIN; ntxcd=L2941; ntxbuf=#BUFG})

!<保證人資料>
#HSPACE=A,7,S
#BUFH=X,14,S
T(2,#HSPACE+#CustNo)
#BINDH=X,1,S
BIND(#BTNH,click, {cmd=CHAIN; ntxcd=L2020; ntxbuf=#BUFH})

!<擔保品(含火險)資料>
! #BUFIS=A,10,S
#BUFI=X,11,S
T(2,1+#CustNo+#FacmNo)
#BINDI=X,1,S
BIND(#BTNI,click, {cmd=CHAIN; ntxcd=L4060; ntxbuf=#BUFI})

!<擔保品(含火險)資料>
#BUFJS=A,10,S
#BUFJ=X,21,S
T(2,2+#CustNo+#FacmNo)
#BINDJ=X,1,S
BIND(#BTNJ,click, {cmd=CHAIN; ntxcd=L4965; ntxbuf=#BUFJ})

!火險
#BUFKS=A,10,S
#BUFK=X,21,S
T(2,#CustNo+#FacmNo+00000000000)
#BINDK=X,1,S
BIND(#BTNK,click, {cmd=CHAIN; ntxcd=L2017; ntxbuf=#BUFK})

#RPTFG=A,1,S

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L5960 -----------
<sub type="FORM" name="L5960">

#SCRTIL=_,_,S
T(3,[L5960] 案件資料)

#LOOP=X,1,S
E(0,1)ASGN(LOOP$)

! 作業日期
#OOTXDATE=D,7,O
! 作業項目
#OOPROCSUBJ=X,1,O
#OOPROCSUBJX=X,12,O
C(1,#OOTxCode,S,S,$)
T(H,#OOPROCSUBJ,#TxCodeHelp)

! 戶號
#OOCustNo=A,7,O
! 額度
#OOFacmNo=A,3,O
! 繳息迄日
#OOPrevIntDate=D,7,O
! 逾期數
#OOOVERDUETERM=m,3,O
! 幣別
#OOCURRIND=X,3,O
! 本金餘額
#OOPRNPLBAL=M,14,O
! 催收員
#OOAccCollPsn=X,8,O
! 催收員姓名
#OOAccCollPsnX=X,40,O
! 法務人員
#OOLegalPsn=X,8,O
! 法務人員姓名
#OOLegalPsnX=X,40,O
! 同擔保品戶號
#OOClCustNo=A,7,O
! 同擔保品額度
#OOClFacmNo=A,10,O

! 1+13+20+16+6=55
#OOBUF_PHONE=X,11,S
T(2,#OOCustNo+#OOFacmNo+#CaseCode)
#OOBUF_FACE=X,11,S
T(2,#OOCustNo+#OOFacmNo+#CaseCode)
#OOBUF_MAIL=X,11,S
T(2,#OOCustNo+#OOFacmNo+#CaseCode)
#OOBUF_LEGAL=X,11,S
T(2,#OOCustNo+#OOFacmNo+#CaseCode)
#OOBUF_ALERT=X,12,S
T(2,#OOCustNo+#OOFacmNo+#CaseCode+0)

#OOBTN_PHONE=A,2,O
BIND(grid,{ cmd=CHAIN; ntxcd=L5961; ntxbuf=#OOBUF_PHONE})
#OOBTN_FACE=A,2,O
BIND(grid,{ cmd=CHAIN; ntxcd=L5962; ntxbuf=#OOBUF_FACE})
#OOBTN_MAIL=A,2,O
BIND(grid,{ cmd=CHAIN; ntxcd=L5963; ntxbuf=#OOBUF_MAIL})
#OOBTN_LEGAL=A,2,O
BIND(grid,{ cmd=CHAIN; ntxcd=L5964; ntxbuf=#OOBUF_LEGAL})
#OOBTN_ALERT=A,2,O
BIND(grid,{ cmd=CHAIN; ntxcd=L5965; ntxbuf=#OOBUF_ALERT})

</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#CustNo#FacmNo#CaseCode
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L5R15.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
TXFORM=L5960
#OOTXDATE
#OOPROCSUBJ
#OOCustNo
#OOFacmNo
#OOPrevIntDate
#OOOVERDUETERM
#OOCURRIND
#OOPRNPLBAL
#OOAccCollPsn
#OOLegalPsn
^
</sub>


!---------- 單據輸出組合 ----------
<sub type="PART" prompt='{{#SCRTIL}} world' name="L5960" layout="cols=1;screen.width=[130,870];order=1;">
[
["[L5960]                                 案件資料查詢"],
! [#<->#,"@借戶戶號",#CustNo,#CustName],
! [#<->#,"@額度編號",#FacmNo],
! [#<->#,"@案件種類",#CaseCode,#CaseCodeX],
]
</sub>

<sub type="SELECT">

#RPTFG=0,QUERY.GRID,L5960
#any={detail:true, header:'L5960.part', caption:'', width:1020, rowNum:20, rowList:[20,40,60]}

#OOBTN_PHONE=
{search:false,formatter:'cust:bind-button:電',align:'center',canExport:false,width:20}
#OOBTN_FACE=
{search:false,formatter:'cust:bind-button:面',align:'center',canExport:false,width:20}
#OOBTN_MAIL=
{search:false,formatter:'cust:bind-button:函',align:'center',canExport:false,width:20}
#OOBTN_LEGAL=
{search:false,formatter:'cust:bind-button:法',align:'center',canExport:false,width:20}
#OOTXDATE=作業日期
{width:65}
#OOPROCSUBJX=作業項目
{width:95}
#OOBTN_ALERT=
{search:false,formatter:'cust:bind-button:提醒',align:'center',canExport:false,width:35}
#OOCustNo=戶號
{width:45}
#OOFacmNo=額度
{width:40,align:'center'}
#OOPrevIntDate=繳息迄日
{width:65}
#OOOVERDUETERM=逾期數
{width:50}
#OOCURRIND=幣別
{width:35}
#OOPRNPLBAL=本金餘額
{width:95}
#OOAccCollPsn=催收員
{width:65}
#OOLegalPsn=法務人員
{width:65}

^
<include src="PRT.icf::INQ04.sel" map="i=L5960;cpi=15"/>
#CustNo#FacmNo#CaseCode
%
#OOTXDATE
#OOPROCSUBJ
#OOCustNo
#OOFacmNo
#OOPrevIntDate
#OOOVERDUETERM
#OOCURRIND
#OOPRNPLBAL
#OOAccCollPsn
#OOLegalPsn
@^
</sub>
