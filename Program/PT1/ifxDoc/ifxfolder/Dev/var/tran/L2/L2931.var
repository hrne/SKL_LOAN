----- BASIC LABEL Variables ----------
<sub type="SYS">
#Submit=A,1,S
K(MODIFYBUTTON,查詢)
</sub>

<sub type="SYS" name="label">

!#TXCD
!T(3,L2931)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,0)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,136)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,20)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)

</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=1;screen.width=[200,800];printer.width=[20,20];">
[
["[L2931]                                 清償違約明細"],
["#FdCustNo+借戶戶號",#CustNo,#BTN1,#CustName],
["#FdFacmNo+額度編號",#FacmNo],
["#FdBormNo+撥款序號",#BormNo],
["#FdInqKind+查詢方式",#InqKind,#InqKindX],
["#FdEntryDate+入帳日期",#EntryDate],
["#FdExtraRepay+部分償還本金",#TwExtraRepay,#UsExtraRepay],
["#FdIncludeIntFlag+是否內含利息",#IncludeIntFlag,#IncludeIntFlagX],
]
!---------- AP Button AREA ----------
![Buttom資料查詢]
#BTN1=X,15,I,ui:button;value:顧客資料查詢;enable:1;tabbable:0
#BUF1=X,42,S

#FdCustNo=X,2,L
T(3,*)
#FdFacmNo=X,2,L
#FdBormNo=X,2,L
#FdInqKind=X,2,L
T(3,*)

!---------- AP TEXT AREA Variables ----------
! Help
<include src="HELPRIM.icf::HELPRIM.rtn"/>


![幣別小數位]
#CDDEF01=x,26,S
T(3,CdCode.CurrPrecision)

#CurrPrecisionHelp=x,1024,S 

![幣別名稱]
#CDDEF02=x,30,S
T(3,CdCode.Currency)

#CurrencyCodeHelp=x,1024,S


!BreachGetCode
#CDDEF03=x,30,S
T(3,CdCode.BreachGetCode)

#BreachGetCodeHelp=x,1024,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDDEF01,#CDDEF02,#CDDEF03)
R(1,XXR99)
CALL(#HelpProc)  
T(2,@CurrPrecisionHelp,#HelpDesc1)
T(2,@CurrencyCodeHelp,#HelpDesc2)
T(2,@BreachGetCodeHelp,#HelpDesc3)

#InqKindHelp=x,1024,S
T(3,0:清償違約明細;1:清償違約明細+部分償還試算;2:清償違約明細+結案試算)

! 是否help
#YNHelp=x,50,S
T(3,Y:是;N:否)

#CHAIN=A,1,S
T(4,CHAIN$)
T(2,@RimTxCode,#TXCD)
INVOKEJS(SHOW,p1,5,7,0)
HIDE(#UsExtraRepay)

#NTXBUF=X,100,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@CustNo,#NTXBUF,1,7)
T(1,@FacmNo,#NTXBUF,8,3)
T(1,@BormNo,#NTXBUF,11,3)
T(1,@InqKind,#NTXBUF,14,1)
C(2,#InqKind,S,$,$,S,S,S)
T(1,@EntryDate,#NTXBUF,15,7)
C(2,#InqKind,S,$,S,S,S,S)
T(1,@TimExtraRepay,#NTXBUF,22,14.2)
T(1,@IncludeIntFlag,#NTXBUF,38,1)

#BIND1=X,1,S
BIND(#BTN1,click, {cmd=CHAIN; ntxcd=L1001; ntxbuf=#BUF1;ntxbuf5=type<-1:CustNo<-OOCustNo})

!借戶戶號
#CustNo=A,7,I
C(3,#CHAIN,1,s,$)
@V(2,0)
T(3,#CustName,)

#TimCustNo=A,7,S
E(0,0)
C(3,#CustNo,0,$,E(0,#CustNo))
T(2,@RmkCustNo,#TimCustNo)
<include src="COM.icf::CustRmk.rtn"/>

#SendL2r07A=X,1,S
C(3,#CustNo,0,S,$)
T(3,@RimCustId, )
E(0,@RimCustNo,#CustNo)
RESET_RIM(#SendL2r07A,L2R07)
S(L2R07,1,#RimTxCode,#RimCustId,#RimCustNo)
R(1,L2R07)

#CustName=X,100,L
C(3,#CustNo,0,S,T(2,#L2r07CustName))

#FacmNo=A,3,I
C(3,#CHAIN,1,s,$)

#BormNo=A,3,I
C(3,#CHAIN,1,s,$)


![幣別]
#FdCurrencyCode=X,2,L

#CurrencyCode=X,3,L
T(3,TWD)

#CurrencyCodeX=X,10,S
T(3,)T(H,#CurrencyCode,#CurrencyCodeHelp)

#Precision=N,1,S
E(0,0)T(H,#CurrencyCode,#CurrPrecisionHelp)
C(3,#Precision,0,SHOW(#TwExtraRepay)HIDE(#UsExtraRepay)
                ,SHOW(#UsExtraRepay)HIDE(#TwExtraRepay))



#InqKind=X,1,I
C(3,#CHAIN,1,s,$)
HELP(#InqKindHelp)
T(2,@FdEntryDate,)
T(2,@FdExtraRepay,)
T(2,@FdIncludeIntFlag,)
@
V(H,#InqKindHelp)

#InqKindX=X,30,L
T(H,#InqKind,#InqKindHelp)
C(3,#InqKind,1,T(2,@FdEntryDate,*)T(2,@FdExtraRepay,*)T(2,@FdIncludeIntFlag,*),$)
C(3,#InqKind,2,T(2,@FdEntryDate,*),$)
C(3,#InqKind,0,INVOKEJS(SHOW,p1,5,7,0),$)
C(3,#InqKind,1,INVOKEJS(SHOW,p1,5,7,1),$)
C(3,#InqKind,2,INVOKEJS(SHOW,p1,5,5,1)INVOKEJS(SHOW,p1,6,7,0),$)

!入帳日期
#FdEntryDate=X,2,L

#EntryDate=D,7,I
C(3,#CHAIN,1,s,$)
C(2,#InqKind,S,$,$,S,S)
@
V(7)
A(DATE,0,#EntryDate)

!部分償還本金
#FdExtraRepay=X,2,L

#TwExtraRepay=m,14,I
C(2,#InqKind,S,$,S,S,S)
C(3,#Precision,0,$,S)
E(0,#TimExtraRepay)
C(3,#CHAIN,1,s,$)
@V(2,0)

#UsExtraRepay=m,14.2,I
C(2,#InqKind,S,$,S,S,S)
C(3,#Precision,0,S,$)
E(0,#TimExtraRepay)
C(3,#CHAIN,1,s,$)
@V(2,0)

#TimExtraRepay=m,14.2,S
C(2,#InqKind,S,$,S,S,S)
C(3,#Precision,0,E(0,#TwExtraRepay),E(0,#UsExtraRepay))

!是否內含利息
#FdIncludeIntFlag=X,2,L

#IncludeIntFlag=X,1,I
C(3,#CHAIN,1,s,$)
C(2,#InqKind,S,$,S,S,S)
HELP(#YNHelp)
@V(H,#YNHelp)

#IncludeIntFlagX=X,10,L
C(2,#InqKind,S,$,S,S,S)
T(H,#IncludeIntFlag,#YNHelp)


#RPTFG=A,1,S
C(3,#CHAIN,0,$,E(0,@CHAIN,0)XMT())

#MRKEY=_,_,S
C(3,#FacmNo,0,T(2,#CustNo),T(2,#CustNo+-+#FacmNo))
C(3,#BormNo,0,$,T(2,#CustNo+-+#FacmNo+-+#BormNo))

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>


!---------- TXFORM = L2931 ----------
<sub type="FORM" name="L2931">

!#SCRPRT=_,_,S
!C(5,#TXFORM,L2931,$,S)

#SCRTIL=_,_,S
T(3,[L2931] 清償違約明細)

#OCUSTNO=A,7,L
T(2,#CustNo)

#OCUSTNO1=A,3,L
T(2,#FacmNo)

#OCUSTNO2=A,3,L
T(2,#BormNo)


#OCurrencyCode=X,3,L
T(3,TWD)

#PRECISION=N,1,S
E(0,0)T(H,#OCurrencyCode,#CurrPrecisionHelp)

!------ TOM(HEAD)   Variables (FOR OUTPUT SCREEN) ------
!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------
#LOOP=X,1,S
T(3,1)ASGN(LOOP$)
!額度
#OOFacmNo=A,3,L
!撥款
#OOBormNo=A,3,L
!會計日期
#OOAcDate=D,7,L
!交易序號
#OOTitaTxtNo=X,15,L
!交易摘要
#OOTitaTxCd=X,5,L
!入帳日期
#OOEntryDate=D,7,L
!提前還款金額
#OOExtraRepay=m,14.2,L
#OOExtraRepayX=X,22,L
CALL2(#ADJUSTDOT,#PRECISION,#OOExtraRepay,#OOExtraRepayX)
P(R,#OOExtraRepayX)
!清償違約金
#OOCloseBreachAmt=m,14.2,L
#OOCloseBreachAmtX=X,22,L
CALL2(#ADJUSTDOT,#PRECISION,#OOCloseBreachAmt,#OOCloseBreachAmtX)
P(R,#OOCloseBreachAmtX)


!提前還款金額累計
#OOExtraRepayAcc=m,14.2,L
#OOExtraRepayAccX=X,22,L
CALL2(#ADJUSTDOT,#PRECISION,#OOExtraRepayAcc,#OOExtraRepayAccX)
P(R,#OOExtraRepayAccX)

!違約起算金額
#OOBreachStartAmt=m,14.2,L
#OOBreachStartAmtX=X,22,L
CALL2(#ADJUSTDOT,#PRECISION,#OOBreachStartAmt,#OOBreachStartAmtX)
P(R,#OOBreachStartAmtX)

!計算金額
#OOAmount=m,14.2,L
#OOAmountX=X,22,L
CALL2(#ADJUSTDOT,#PRECISION,#OOAmount,#OOAmountX)
P(R,#OOAmountX)

!首撥日期
#OOStartDate=D,7,O

!遞減段數
#OOMonIdx=A,3,O

!計算百分比
#OOBreachRate=n,3.2,O

!違約金收取方式
#OOBreachGetCode=X,1,O
#OOBreachGetCodeX=X,20,L
T(H,#OOBreachGetCode,#BreachGetCodeHelp)



<include src="ROM.icf::L2R07.dec"/>
<include src="ROM.icf::L0Rim.dec"/>
<include src="ROM.icf::L2Rim.dec"/>
!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------

</sub>


!------ 上行電文 ------
<sub type="TIM">
#CustNo
#FacmNo
#BormNo
#InqKind
#EntryDate
#TimExtraRepay
#IncludeIntFlag
#END
</sub>


!------ 下行電文TOM ------
<sub type="TOM">
TXFORM=L2931
#OOFacmNo
#OOBormNo
#OOAcDate
#OOTitaTxtNo
#OOTitaTxCd
#OOEntryDate
#OOExtraRepay
#OOCloseBreachAmt
#OOExtraRepayAcc
#OOBreachStartAmt
#OOAmount
#OOStartDate
#OOMonIdx
#OOBreachRate
#OOBreachGetCode
^
<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L2R07.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>

<sub type="PART" name="L2931" layout="cols=1;screen.width=[130,870];printer.width=[15,30];order=1">
[
["[L2931]                                 清償違約明細"],
[""],
! ["@借戶戶號",#CustNo,"-",#FacmNo,"-",#BormNo,#CustName],
]
</sub>
!---------- 單據輸出組合 ----------
<sub type="SELECT">

#RPTFG=0,QUERY.GRID,L2931
#any={detail:true, header:'L2931.part', caption:'', width:1000, rowNum:20, rowList:[20,40,60]}


#OOFacmNo=額度
{width:80,align:'center'}

#OOBormNo=撥款
{width:80,align:'center'}

#OOAcDate=會計日期
{width:80,align:'center'}

#OOTitaTxtNo=交易序號
{width:80,align:'center'}

#OOTitaTxCd=交易摘要
{width:80,align:'center'}

#OOEntryDate=入帳日期
{width:80,align:'center'}


#OOCloseBreachAmtX=清償違約金
{width:180,align:'center'}


#OOExtraRepayX=提前還款金額
{width:180,align:'center'}


#OOExtraRepayAccX=提前還款金額累計
{width:180,align:'center'}


#OOBreachStartAmtX=違約起算金額
{width:180,align:'center'}


#OOAmountX=計算金額
{width:180,align:'center'}


#OOStartDate=首撥日期
{width:80,align:'center'}


#OOMonIdx=遞減段數
{width:80,align:'center'}


#OOBreachRate=計算百分比
{width:80,align:'center'}

#OOBreachGetCodeX=收取方式
{width:150,align:'center'}

^

<include src="PRT.icf::INQ01.sel" map="i=L2931;cpi=15"/>

<include src="PRT.icf::INQ01.sel"/>
</sub>
