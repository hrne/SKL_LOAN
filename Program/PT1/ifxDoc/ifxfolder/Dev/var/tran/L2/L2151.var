!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

!#TXCD
!T(3,XW111)

![一段式/二段式/三段式]
!#RELCD=_,_,S
!E(0,1)

!#ACTFG=_,_,S
!E(0,1)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!=====================================================================
!#FKEY>0時，重新執行
!=====================================================================
<sub type="PREDC" name="PreDC">
#PDC=X,1,S
C(3,#FKEY,1,K(LIGHT,#ProcessCodeX,TXTRED,0,1),$)

<include src="COM.icf::TITLE-RUN.pre"/>
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=3;screen.width=[150,350,150,350];printer.width=[15,30,15,30];order=1">
[
["[L2151]                                 額度登錄准駁查詢"],
[#<->#,"#FdFuncCode+功能",#FuncCodeX],
[#<->#,"#FdApplNo+申請號碼",#ApplNo,#BTN1],
[#<->#,"#FdCustId+統一編號",#CustId,#CustIdX],
[#<->#,"#FdApplDate+申請日期",#ApplDate],
[#<->#,"#FdProdNo+申請商品代碼",#ProdNo,#ProdName], 
![#<->#,"#FdAcctCode+申請科目",#AcctCodeX],
["#FdCurrencyCode+申請幣別",#CurrencyCode],
["#FdApplAmt+申請金額",#ApplAmtX],
["#FdEstimate+估價人員",#Estimate,#EstimateX],          
["#FdPieceCode+計件代碼",#PieceCode,#PieceCodeX],
["#FdCreditOfficer+授信人員",#CreditOfficer,#CreditOfficerX],
["#FdLoanOfficer+放款專員",#LoanOfficer,#LoanOfficerX],
["#FdIntroducer+介紹人",#Introducer,#IntroducerX],
["#FdDistrict+區部",#District,#DistrictX],
["#FdSupervisor+核決主管",#Supervisor,#SupervisorX],          
[#<->#,"#FdGroupId+團體戶統編",#GroupId,#GroupIdX],
[#<->#,"#FdProcessCode+處理情形",#ProcessCodeX],
[#<->#,"#FdApproveDate+准駁日期",#ApproveDate,#ApproveDateX],
]
!---------- AP Button AREA ----------
![Buttom資料查詢]
#BTN1=X,15,I,ui:button;value:申請案件查詢;enable:1;tabbable:0;title:L2010 申請案件明細資料查詢
!---------- AP TEXT AREA Variables ----------
! Help
<include src="HELPRIM.icf::HELPRIM.rtn"/>
!FuncCode
#CDDEF01=x,30,S
T(3,CdCode.FacmAcctCode)

#FacmAcctCodeHelp=x,1024,S

!PieceCode
#CDDEF02=x,25,S
T(3,CdCode.PieceCode)

#PieceCodeHelp=x,1024,S

!ProcessCode
#CDDEF03=x,25,S
T(3,CdCode.ApplProcessCode)

#ProcessCodeHelp=x,1024,S

#CDDEF04=x,26,S
T(3,CdCode.CurrPrecision)

#CurrPrecisionHelp=x,1024,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDDEF01,#CDDEF02,#CDDEF03,#CDDEF04)
R(1,XXR99)
CALL(#HelpProc)
T(2,@FacmAcctCodeHelp,#HelpDesc1)
T(2,@PieceCodeHelp,#HelpDesc2) 
T(2,@ProcessCodeHelp,#HelpDesc3)
T(2,@CurrPrecisionHelp,#HelpDesc4)

#FuncHeplp=X,20,S
T(3,5:查詢;7:駁回)

#CHAIN=A,1,S
T(4,CHAIN$) 
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:[L2010申請案件明細資料查詢]進入),$)
C(3,#CHAIN,1,HIDE(#BTN1,#FuncCode)T(F,#ApplNo,0),SHOW(#BTN1)T(F,#ApplNo,1))
T(2,@RimTxCode,#TXCD)
E(0,@RimFKey,#FKEY)

#NTXBUF=X,18,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)

![功能]
!已作過准駁處理之案件不可刪除
#FdFuncCode=X,2,L
T(3,*)

#FuncCode=X,1,S
SHOW(#ApproveDate)
HIDE(#ApproveDateX)
C(3,#CHAIN,1,T(1,#NTXBUF,1,1),$)
C(3,#CHAIN,1,s,$)
HELP(#FuncHeplp)
@V(H,#FuncHeplp)

#FuncCodeX=X,4,L
T(H,#FuncCode,#FuncHeplp)
E(0,@FUNCIND,#FuncCode)
C(3,#FuncCode,5,T(F,@ApproveDate,0)K(NOBUTTON,CLOSEY),T(F,@ApproveDate,1))
C(2,#FuncCode,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),K(MODIFYBUTTON,新增),K(MODIFYBUTTON,刪除),K(MODIFYBUTTON,查詢),K(MODIFYBUTTON,核准),K(MODIFYBUTTON,駁回))

#ShowFd=X,1,S
C(2,#FuncCode,T(3, ),T(3,*),T(3,*),T(3,*),T(3, ),T(3, ),T(3, ),T(3, ))
T(2,@FdFuncCode,#ShowFd)     
T(2,@FdApplNo,#ShowFd)
T(2,@FdApproveDate,#ShowFd)

#ShowFd1=X,1,S
C(2,#FuncCode,T(3, ),T(3,*),T(3,*),T(3,*),T(3, ),T(3, ),T(3, ),T(3,*))
T(2,@FdApproveDate,#ShowFd1)

#WkStatus=A,1,S
C(3,#FuncCode,7,E(0,0),E(0,9))

#WkCustId=X,10,S
T(3, )

#WkApplNo=A,7,S
C(3,#ApplNo,0,E(0,1),E(0,#ApplNo))

#BUF1=X,18,S
T(2,#WkApplNo+#WkCustId+#WkStatus)

#BIND1=X,1,S
BIND(#BTN1,click, {cmd=CHAIN; ntxcd=L2010; ntxbuf=#BUF1;ntxbuf5=type<-1:ApplNo<-OOApplNo})

![申請號碼]
#FdApplNo=X,2,L


#ApplNo=A,7,I
C(3,#CHAIN,1,T(1,#NTXBUF,2,7),$)
C(3,#CHAIN,1,s,$)
@V(2,0)


#BUF2=X,18,S
T(2,#ApplNo+#WkCustId+#WkStatus)

#BIND2=X,1,S
BIND(#BTN1,click, {cmd=CHAIN; ntxcd=L2010; ntxbuf=#BUF2;ntxbuf5=type<-1:ApplNo<-OOApplNo})

#SendL2r02=X,1,S
C(3,#FuncCode,1,S,$)
E(0,@RimFuncCode,#FuncCode)
E(0,@RimApplNo,#ApplNo)
T(2,@RimCustId,#CustId)
RESET_RIM(#SendL2r02,L2R02)
S(L2R02,1,#RimFuncCode,#RimTxCode,#RimFKey,#RimApplNo,#RimCustId)
R(1,L2R02)

#RcvL2r02=X,1,S
T(2,@CustId,#L2r02CustId)
E(0,@ApplDate,#L2r02ApplDate)
T(2,@ProdNo,#L2r02ProdNo)
!E(0,@AcctCode,#L2r02AcctCode)
!T(H,@AcctCodeX,#AcctCode,#FacmAcctCodeHelp)
T(2,@CurrencyCode,#L2r02CurrencyCode)
E(0,@TwApplAmt,#L2r02ApplAmt)
E(0,@UsApplAmt,#L2r02ApplAmt)
T(2,@Estimate,#L2r02Estimate)
T(2,@PieceCode,#L2r02PieceCode)
T(2,@CreditOfficer,#L2r02CreditOfficer)
T(2,@LoanOfficer,#L2r02LoanOfficer)
T(2,@Introducer,#L2r02Introducer)
T(2,@Supervisor,#L2r02Supervisor)
T(2,@ProcessCode,#L2r02ProcessCode)
T(H,@ProcessCodeX,#ProcessCode,#ProcessCodeHelp)
E(0,@ApproveDate,#L2r02ApproveDate)
T(2,@GroupId,#L2r02GroupId)

![統一編號]
#FdCustId=X,2,L

#CustId=X,10,L
@C(4,#CustId,S,$)
A(ID_UNINO,1,#CustId)


#SendL2r07A=X,1,S
T(2,@RimCustId,#CustId)
E(0,@RimCustNo,0)
RESET_RIM(#SendL2r07A,L2R07)
S(L2R07,1,#RimTxCode,#RimCustId,#RimCustNo)
R(1,L2R07)

#CustIdX=X,100,L
T(2,#L2r07CustName)


#TimCustNo=A,7,S
C(4,#CustId,$,E(0,#L2r07CustNo))
T(2,@RmkCustNo,#TimCustNo)
<include src="COM.icf::CustRmk.rtn"/>


![申請日期]
#FdApplDate=X,2,L

#ApplDate=D,7,L

![申請商品代碼]
#FdProdNo=X,2,L

#ProdNo=X,5,L

#SendL2r01=X,1,S
E(0,@RimFuncCode,5)
T(2,@RimProdNo,#ProdNo)
RESET_RIM(#SendL2r01,L2R01)
S(L2R01,1,#RimFuncCode,#RimTxCode,#RimProdNo)
R(1,L2R01)

#ProdName=X,60,L
T(2,#L2r01ProdName)

![申請科目]
!#FdAcctCode=X,2,L

!#AcctCode=A,3,S

!#AcctCodeX=X,20,L
!T(H,#AcctCode,#FacmAcctCodeHelp)

![申請幣別]
#FdCurrencyCode=X,2,L

#CurrencyCode=X,3,L

!#CurrencyCodeX=X,10,L
!T(A,#CurrencyCode,CURR,CURDEF,ENAME,CNAME)

#Precision=N,1,S
T(H,#CurrencyCode,#CurrPrecisionHelp)

![申請金額]
#FdApplAmt=X,2,L

#TwApplAmt=m,14,S

#UsApplAmt=m,14.2,S

#timApplAmt=m,14.2,S
C(3,#Precision,0,E(0,#TwApplAmt),E(0,#UsApplAmt))

#ApplAmtX=X,22,L
CALL2(#ADJUSTDOT,#Precision,#timApplAmt,#ApplAmtX)
P(R,#ApplAmtX)

! C(3,#Precision,0,X(#TwApplAmt),X(#UsApplAmt))
! P(L,#ApplAmtX)

![估價]
#FdEstimate=X,2,L

#Estimate=X,6,L

#SendL2r08A=X,1,S
C(4,#Estimate,S,$)
T(2,@RimEmployeeNo,#Estimate)
C(3,#FuncCode,5,T(3,@RimErrorSkip,Y),T(3,@RimErrorSkip,N))
RESET_RIM(#SendL2r08A,L2R08)
S(L2R08,1,#RimTxCode,#RimEmployeeNo,#RimErrorSkip)
R(1,L2R08)

#EstimateX=X,20,L
C(4,#Estimate,S,$)
T(2,#L2r08FullName)

![計件代碼]
#FdPieceCode=X,2,L

#PieceCode=X,1,L

#PieceCodeX=X,20,L
T(H,#PieceCode,#PieceCodeHelp)

![授信]
#FdCreditOfficer=X,2,L

#CreditOfficer=X,6,L

#SendL2r08B=X,1,S
C(4,#CreditOfficer,S,$)
T(2,@RimEmployeeNo,#CreditOfficer)
C(3,#FuncCode,5,T(3,@RimErrorSkip,Y),T(3,@RimErrorSkip,N))
RESET_RIM(#SendL2r08B,L2R08)
S(L2R08,1,#RimTxCode,#RimEmployeeNo,#RimErrorSkip)
R(1,L2R08)

#CreditOfficerX=X,20,L
C(4,#CreditOfficer,S,$)
T(2,#L2r08FullName)

![放款專員]
#FdLoanOfficer=X,2,L

#LoanOfficer=X,6,L

#SendL2r08C=X,1,S
C(4,#LoanOfficer,S,$)
T(2,@RimEmployeeNo,#LoanOfficer)
C(3,#FuncCode,5,T(3,@RimErrorSkip,Y),T(3,@RimErrorSkip,N))
RESET_RIM(#SendL2r08C,L2R08)
S(L2R08,1,#RimTxCode,#RimEmployeeNo,#RimErrorSkip)
R(1,L2R08)

#LoanOfficerX=X,20,L
C(4,#LoanOfficer,S,$)
T(2,#L2r08FullName)

![介紹人]
#FdIntroducer=X,2,L

#Introducer=X,6,L

#SendL2r08D=X,1,S
C(4,#Introducer,S,$)
T(2,@RimEmployeeNo,#Introducer)
C(3,#FuncCode,5,T(3,@RimErrorSkip,Y),T(3,@RimErrorSkip,N))
RESET_RIM(#SendL2r08D,L2R08)
S(L2R08,1,#RimTxCode,#RimEmployeeNo,#RimErrorSkip)
R(1,L2R08)

#IntroducerX=X,20,L
C(4,#Introducer,S,$)
T(2,#L2r08FullName)

![區部]
#FdDistrict=X,2,L

#District=X,6,L
C(4,#Introducer,S,$)
T(2,#L2r08CenterCode2)

#DistrictX=X,20,L
C(4,#Introducer,S,$)
T(2,#L2r08CenterCode2Name)

![核決主管]
#FdSupervisor=X,2,L

#Supervisor=X,6,L

#SendL2r08E=X,1,S
C(4,#Supervisor,S,$)
T(2,@RimEmployeeNo,#Supervisor)
C(3,#FuncCode,5,T(3,@RimErrorSkip,Y),T(3,@RimErrorSkip,N))
RESET_RIM(#SendL2r08E,L2R08)
S(L2R08,1,#RimTxCode,#RimEmployeeNo,#RimErrorSkip)

R(1,L2R08)

#SupervisorX=X,20,L
C(4,#Supervisor,S,$)
T(2,#L2r08FullName)

![團體戶]
#FdGroupId=X,2,L

#GroupId=X,10,L

#SendL2r07B=X,1,S
C(4,#GroupId,S,$)
T(2,@RimCustId,#GroupId)
E(0,@RimCustNo,0)
RESET_RIM(#SendL2r07B,L2R07)
S(L2R07,1,#RimTxCode,#RimCustId,#RimCustNo)
R(1,L2R07)

#GroupIdX=X,100,L
C(4,#GroupId,S,$)
T(2,#L2r07CustName)

![處理情形]
#FdProcessCode=X,2,L

#ProcessCode=A,1,S

#ProcessCodeX=X,10,L
T(H,#ProcessCode,#ProcessCodeHelp)

![准駁日期]
#FdApproveDate=X,2,L


#ApproveDate=D,7,I
C(3,#FuncCode,7,$,s)
E(0,#SYSCDATE)
@V(7)A(DATE,0,#ApproveDate)

#ApproveDateX=X,3,L
C(3,#FuncCode,5,$,S)
C(3,#ApproveDate,0,T(3,無)HIDE(#ApproveDate)SHOW(#ApproveDateX)
                  ,T(3, ))

!0011 駁回額度登錄需主管核可
!#RQSP=X,4,S
!C(3,#FuncCode,7,T(3,0011),T(3, ))
!ASGN(RQSP$)

<include src="ROM.icf::L0Rim.dec"/>
<include src="ROM.icf::L2Rim.dec"/>
<include src="ROM.icf::L2R01.dec"/>
<include src="ROM.icf::L2R02.dec"/>
<include src="ROM.icf::L2R07.dec"/>
<include src="ROM.icf::L2R08.dec"/>

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>


!---------- TXFORM = L2151 ----------
<sub type="FORM" name="L2151">

#SCRPRT=_,_,S
C(5,#TXFORM,L2151,$,S)

#SCRTIL=_,_,S
T(3,[L2151] 商品參數維護)

#OProcessCode=A,1,S

#OProcessCodeX=X,10,S
T(H,#OProcessCode,#ProcessCodeHelp)
T(2,@ProcessCodeX,#OProcessCodeX)
K(LIGHT,#ProcessCodeX,TXTRED,0,1)
</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">

#FuncCode#ApplNo#ApproveDate
#ProcessCodeX
</sub>


!------ 下行電文TOM ------
<sub type="TOM">
TXFORM=L2151
#OProcessCode
^

<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L2R01.tom"/>
<include src="ROM.icf::L2R02.tom"/>
<include src="ROM.icf::L2R07.tom"/>
<include src="ROM.icf::L2R08.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>


!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
<include src="PRT.icf::UPDH01.sel"/>
</sub>
