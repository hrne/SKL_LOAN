!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

!#TXCD
!T(3,L3240)

![一段式/二段式/三段式]
!#RELCD=_,_,S
!E(0,1)

!#ACTFG=_,_,S
!E(0,1)

![借貸別 (1:借 2:貸)]
#CRDB=_,_,S
E(0,1)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
K(MODIFYBUTTON,登錄)
</sub>
<sub type="DC" name="BFRP">
<include src="RPDTL.icf::BFRP.dec"/>
</sub>
!=====================================================================
!#FKEY>0時，重新執行
!=====================================================================
<sub type="PREDC" name="PreDC">
!#PDC=X,1,S
!C(3,#FKEY,0,NOP,T(R,#MRKEY,#REFNO))
!C(3,#FKEY,3,NO_RUN(#CIFKEY,#PREFG,#KINDCD,#REFNO),$)
!C(3,#FKEY,7,NO_RUN(#CIFKEY,#PREFG,#KINDCD,#REFNO),s)

<include src="COM.icf::TITLE-RUN.pre"/>
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=3;screen.width=[150,500,150,500];printer.width=[20,40,20,40];order=1">
[
["[L3240]                                 回收冲正（轉換前資料）"],
[#<->#,"#FdCustNo+借戶戶號",#CustNo,"@@@",#CustNoX],
[#<->#,"#FdEntryDate+入帳日期",#EntryDate],
["#FdIntStartDate+計息起日",#IntStartDate],["#FdIntEndDate+計息迄日",#IntEndDate],
[#<->#,"#FdPrincipal+本金",#Principal],
[#<->#,"#FdInterest+利息",#Interest],
[#<->#,"#FdDelayInt+延遲息",#DelayInt],
[#<->#,"#FdBreachAmt+違約金",#BreachAmt],
[#<->#,"#FdExtraCloseBreachAmt+清償違約金",#ExtraCloseBreachAmt],
["#FdShortfall+累短收",#Shortfall],["#FdExcessive+累溢收",#Excessive],
[#<->#,"#FdOverShort+溢短收",#OverShort],
[#<->#,"#FdAcDate+會計日期",#AcDate],
[#<->#,"#FdTellerNo+經辦",#TellerNo],
[#<->#,"#FdTxtNo+交易序號",#TxtNo],
]
!---------- AP Button AREA ----------
![Buttom資料查詢]

!---------- AP TEXT AREA Variables ----------
#FdCustNo=X,2,L
#FdEntryDate=X,2,L
#FdIntStartDate=X,2,L
#FdIntEndDate=X,2,L
#FdFacmNo=X,2,L
#FdBormNo=X,2,L
#FdPrincipal=X,2,L
#FdInterest=X,2,L
#FdShortfall=X,2,L
#FdExcessive=X,2,L
#FdDelayInt=X,2,L
#FdBreachAmt=X,2,L
#FdExtraCloseBreachAmt=X,2,L
#FdAcDate=X,2,L
#FdTellerNo=X,2,L
#FdTxtNo=X,2,L


#CHAIN=A,1,S
T(4,CHAIN$)
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:[L3005交易明細資料查詢]進入),$)
T(2,@RimTxCode,#TXCD)
E(0,@RimFKey,#FKEY)

#NTXBUF=X,50,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@ChainCustNo,#NTXBUF,1,7)
T(1,@FacmNo,#NTXBUF,8,3)
T(1,@BormNo,#NTXBUF,11,3)
T(1,@AcDate,#NTXBUF,14,7)
T(1,@TellerNo,#NTXBUF,21,6)
T(1,@TxtNo,#NTXBUF,27,8)

#ChainCustNo=A,7,S



![借戶戶號]
!借戶戶號, 統一編號或核准編號擇一輸入

#CustNo=X,7,I
C(3,#CHAIN,1,C(3,#ChainCustNo,0,$,E(0,#ChainCustNo)),$)
C(3,#CHAIN,1,s,$)
@C(4,#CustNo,S,$)
V(9)

#TmpCustNo=A,7,S
C(4,#CustNo,S,$)
E(0,@TmpCustNo,#CustNo)
T(2,@CustNo,#TmpCustNo)


#SendL2r07A=X,1,S
C(3,#CustNo,0,S,$)
T(3,@RimCustId, )
E(0,@RimCustNo,#CustNo)
RESET_RIM(#SendL2r07A,L2R07)
S(L2R07,1,#RimTxCode,#RimCustId,#RimCustNo)
R(1,L2R07)
T(2,@CustNoX,#L2r07CustName)

#CustNoX=x,100,L
C(3,#CustNo,0,S,$)


#TimCustNo=A,7,S
E(0,0)
C(3,#CustNo,0,$,E(0,#CustNo))
T(2,@LockCustNo,#TimCustNo)
T(2,@RmkCustNo,#TimCustNo)
<include src="COM.icf::CustRmk.rtn"/>

<include src="COM.icf::LockControl.rtn"/>

!額度編號
#FacmNo=A,3,S

#BormNo=A,3,S

#Principal=m,14,L

#Interest=m,14,L

#DelayInt=m,14,L

#BreachAmt=m,14,L

!入帳日期
#EntryDate=D,7,L

!計息起日
#IntStartDate=D,7,L

!計息迄日
#IntEndDate=D,7,L

#ExtraCloseBreachAmt=m,14,L

!會計日期
#AcDate=D,7,L

#TellerNo=X,6,L

!交易序號
#TxtNo=X,8,L
T(2,@ORGKIN,0000)
T(2,@ORGTLR,#TellerNo)
T(2,@ORGTNO,#TxtNo)
E(0,@OrgEntdy,#AcDate)

#MRKEY=_,_,S
T(2,#TimCustNo)

#RimAcDate=D,7,S
#RimTellerNo=X,6,S
#RimTxtNo=X,8,S

#SendL3r18S=X,1,S
E(0,@RimCustNo,#TimCustNo)
E(0,@RimAcDate,#AcDate)
T(2,@RimTellerNo,#TellerNo)
T(2,@RimTxtNo,#TxtNo)
RESET_RIM(#SendL3r18S,L3R18)
S(L3R18,01,#RimCustNo,#RimAcDate,#RimTellerNo,#RimTxtNo)
R(1,L3R18)
E(0,@IntStartDate,#L3r18IntStartDate)
E(0,@IntEndDate,#L3r18IntEndDate)
E(0,@EntryDate,#L3r18EntryDate)
E(0,@Principal,#L3r18Principal)
E(0,@Interest,#L3r18Interest)
E(0,@DelayInt,#L3r18DelayInt)
E(0,@BreachAmt,#L3r18BreachAmt)
E(0,@ExtraCloseBreachAmt,#L3r18ExtraCloseBreachAmt)
E(0,@Shortfall,#L3r18Shortfall)
E(0,@Excessive,#L3r18Excessive)
E(0,@OverShort,#L3r18OverShort)
##loop{times:20,l:0,n:1,m:2}
IF({n}==1,C(3,#L3r18FacmNo{n},0,INVOKEJS(SHOW,p2,0),INVOKEJS(SHOW,p2,1)),$)
C(3,#L3r18FacmNo{n},0,INVOKEJS(SHOW,grd1_{n},0),INVOKEJS(SHOW,grd1_{n},1))
T(2,@FacmBormNo{n},#L3r18FacmNo{n}+-+#L3r18BormNo{n})
T(2,@IntStartDate{n},#L3r18IntStartDate{n})
T(2,@IntEndDate{n},#L3r18IntEndDate{n})
T(2,@IntSEDate{n},#IntStartDate{n}+-+#IntEndDate{n})
E(0,@Principal{n},#L3r18Principal{n})
E(0,@Interest{n},#L3r18Interest{n})
E(0,@DelayInt{n},#L3r18DelayInt{n})
E(0,@BreachAmt{n},#L3r18BreachAmt{n})
E(0,@Total{n},#L3r18Total{n})
E(0,@CloseBreachAmt{n},#L3r18CloseBreachAmt{n})
##end

#Shortfall=m,14,L



!累溢收

#Excessive=m,14,L
!溢短收
#FdOverShort=X,2,L
#OverShort=+m,14,L

!----------------本息計算表----------------

##loop{times:20,l:0,n:1,m:2}
#FacmBormNo{n}=X,7,L
#IntStartDate{n}=D,7,L
#IntEndDate{n}=D,7,L
#IntSEDate{n}=X,20,L
#Principal{n}=+m,14,L
#Interest{n}=+m,14,L
#DelayInt{n}=+m,14,L
#BreachAmt{n}=+m,14,L
#Total{n}=+m,14,L
#CloseBreachAmt{n}=+m,14,L
##end
!---------------------------------------------


![業務別] 01:撥款匯款(含暫收退還且非退票) 02:支票繳款  09:放款
#SECNO=_,_,S
T(3,09)



<include src="HELPRIM.icf::HELPRIM.rtn"/>
<include src="RPDTL.icf::RPCOL.dec"/>
<include src="ROM.icf::L0Rim.dec"/>
<include src="ROM.icf::L2Rim.dec"/>
<include src="ROM.icf::L2R05.dec"/>
<include src="ROM.icf::L2R07.dec"/>
<include src="ROM.icf::L3R18.dec"/>
<include src="ROM.icf::L3Rim.dec"/>
</sub>

<sub type="DC" name="p2" layout="cols=2;screen.width=[10,1200];printer.width=[15,30];order=1;">
[
["<font color=red>@本息計算表"],
["#grid#,{id:1,expand:true,loop:20,row_height:1,s_cols:[70,70,120,120,120,120,120,], p_cols:[5,15,15,15,15,15,15]}","","",
["額度撥款","計息起訖日","本金","利息","延遲息","違約金","小計"],
[[#FacmBormNo1],[#IntSEDate1],[#Principal1],[#Interest1],[#DelayInt1],[#BreachAmt1],[#Total1]],
],
]


</sub>
!--------- 收付欄 -----------------------
<sub type="DC" name="RPDTL" layout="cols=1;screen.width=[1000];printer.width=[20,80];">
[
<include src="RPDTL.icf::RPDTL.scr"/>
]
</sub>
!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
<include src="PRT.icf::FM101.rtn"/>
</sub>


!---------- TXFORM = L3240 ----------
<sub type="FORM" name="L3240">

#SCRPRT=_,_,S
C(5,#TXFORM,L3240,$,S)

#SCRTIL=_,_,S
T(3,[L3240] 回收冲正)



</sub>
!---------- TXFORM = FM101 交易分錄----------
<sub type="FORM" name="FM101">
<include src="PRT.icf::FM101.form"/>
</sub>
!------ 上行電文 TEXT ------
<sub type="TIM">
#TimCustNo#FacmNo
#EntryDate
#IntStartDate
#IntEndDate
#AcDate#TellerNo#TxtNo
#END
#CustNo
<include src="RPDTL.icf::RPDTL.tim"/>
</sub>


!------ 下行電文TOM ------
<sub type="TOM">
TXFORM=L3240
^
<include src="COM.icf::TRCTL.tom"/>
<include src="COM.icf::LockControl.tom"/>
<include src="ROM.icf::L3R18.tom"/>
<include src="ROM.icf::L2R05.tom"/>
<include src="ROM.icf::L2R07.tom"/>
<include src="RPDTL.icf::RPDTL.tom"/>
<include src="PRT.icf::FM101.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>


!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
<include src="PRT.icf::UPDH01.sel"/>
<include src="PRT.icf::FM01.sel"/>
<include src="PRT.icf::FMR01.sel"/>
<include src="PRT.icf::FMH01.sel"/>
<include src="PRT.icf::FMHR01.sel"/>
<include src="PRT.icf::FM101.sel" map="landscape=1;size=830:1170" />
^
</sub>
