----- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

!#TXCD
!T(3,L1108)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,27)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,75)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,20)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)

</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=1;screen.width=[400,800];printer.width=[20,20];">
[
["[L1108]                                 申請不列印書面通知書維護"],
["#FdFunCdX+功能",#FunCdX],
["#FdCustNo2+戶號-額度（複製來源）",#CustNo2,"-",#FacmNo2],
["#FdCustNo+戶號-額度",#CustNo,"-",#FacmNo,#BTN1,#CustName],
["#FdApplyDt+申請日期",#ApplyDt],
["#grid#,{id:1,expand:true,loop:40,row_height:1}","","","","",
[[#Paper0,"不寄送書面"],[#Msg0,"不發送簡訊"],[#EMail0,"不發送EMail"],"通知書名稱"],
[[#Paper1],[#Msg1],[#EMail1],[#NoticeX1]],
],
]

#Init1=X,1,S
INVOKEJS(SHOW,p1,2,2,0)

#FdFunCdX=X,2,L
#FdCustNo=X,2,L
T(2,*)
#FdCustNo2=X,2,L
#FdApplyDt=X,2,L
T(2,*)
!---------- AP Button AREA ----------
![Buttom資料查詢]
#BTN1=X,15,I,ui:button;value:顧客資料查詢;enable:1;tabbable:0
!---------- AP TEXT AREA Variables ----------
#CHAIN=X,1,S
T(4,CHAIN$)
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:[L1908 申請不列印書面通知書查詢]進入),$)

#init=X,1,S

#NTXBUF=X,20,S
C(3,#CHAIN,1,T(4,NTXBUF$))

#CHAIN_FunCd=A,1,S
T(1,@FunCd,#NTXBUF,1,1)
C(3,#FunCd,1,S,$)
T(1,@CustNo,#NTXBUF,2,7)
T(1,@FacmNo,#NTXBUF,9,3)
T(1,@ApplyDt,#NTXBUF,12,8)


#Init2=X,1,S
C(3,#FunCd,3,$,S)
INVOKEJS(SHOW,p1,2,2,1)

<include src="HELPRIM.icf::HELPRIM.rtn"/>
#CDDEF0001=x,40,S
T(3,CdCode.FunctionCd)
#FunCdHelp=x,1024,S

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDDEF0001)
R(1,XXR99)
CALL(#HelpProc)
T(2,@FunCdHelp,#HelpDesc1)

! 第一行做成全選按鈕
#Paper0=X,1,I,ui:button;value:全選;enable:1;tabbable:0
#Msg0=X,1,I,ui:button;value:全選;enable:1;tabbable:0
#EMail0=X,1,I,ui:button;value:全選;enable:1;tabbable:0

##loop{times:40,i:1}
#tmpFormNo{i}=X,10,S
#tmpPaper{i}=X,1,S
#tmpMsg{i}=X,1,S
#tmpEMail{i}=X,1,S
##end

!功能 下拉式選單 1: 新增 2:修改 4:刪除;5:查詢
#FunCd=A,1,S

#FunCdX=X,4,L
C(3,#FunCd,3,T(3,複製),T(H,#FunCd,#FunCdHelp))

C(2,#FunCd,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),K(MODIFYBUTTON,複製),K(MODIFYBUTTON,刪除),K(MODIFYBUTTON,查詢))
#BUF1=X,1,S
#BIND1=X,1,S
BIND(#BTN1,click, {cmd=CHAIN; ntxcd=L1001; ntxbuf=#BUF1;ntxbuf5=type<-1:CustNo<-OOCustNo})

#checkfuncd1=X,1,S
C(3,#FunCd,1,E(0,@CHAIN,0),E(0,@CHAIN,1))

!刪除隱藏重新交易按鈕
#AGAIN=X,1,S
C(2,#FunCd,$,$,E(0,1),$,E(0,1))
ASGN(AGAIN$)

#Space=X,1,S
C(3,#FunCd,1,T(2,@FdCustNo,*)T(F,#CustNo,1)T(F,#FacmNo,1),$)
C(3,#FunCd,2,T(2,@FdCustNo, )T(F,#CustNo,0)T(F,#FacmNo,0)HIDE(#BTN1),$)
C(3,#FunCd,3,T(2,@FdCustNo,*)T(F,#CustNo,1)T(F,#FacmNo,1),$)


!複製來源
#CustNo2=A,7,L
E(0,#CustNo)

#FacmNo2=A,3,L
E(0,#FacmNo)

!戶號
#CustNo=A,7,I
C(2,#FunCd,s,$,s,$)
@V(2,0)

#FacmNo=A,3,I
C(2,#FunCd,s,$,s,$)
@
V(2,0)

#C1=X,1,S
IF(#FunCd==3 && #CustNo==#CustNo2 && #FacmNo==#FacmNo2,V(P,請輸入不同戶號額度),$)

!戶名
#CustName=X,100,L

!調RIM參數
#RimFunCd=A,1,S
E(0,#FunCd)
<include src="ROM.icf::L1R11.dec"/>

! 修改複製預先調RIM
<include src="ROM.icf::L1R04.dec"/>
#RimCustNo=A,7,S
#RimFacmNo=A,3,S
#RimL1r04=X,1,S
C(3,#FunCd,3,E(0,@RimCustNo,#CustNo2),E(0,@RimCustNo,#CustNo))
C(3,#FunCd,3,E(0,@RimFacmNo,#FacmNo2),E(0,@RimFacmNo,#FacmNo))
RESET_RIM(#RimL1r04,L1R04)
S(L1R04,1,#RimCustNo,#RimFacmNo)
R(1,L1R04)
##loop{times:40,i:1}
T(2,@FormNo{i},#L1r04FormNo{i})
T(2,@Notice{i},#L1r04FormName{i})
T(2,@NoticeX{i},#L1r04FormNo{i}+#L1r04FormName{i})
T(2,@SendCode{i},#L1r04SendCode{i})
T(2,@Paper{i},#L1r04Paper{i})
T(2,@Msg{i},#L1r04Msg{i})
T(2,@EMail{i},#L1r04EMail{i})
T(2,@PaperFg{i},#L1r04PaperFg{i})
T(2,@MsgFg{i},#L1r04MsgFg{i})
T(2,@EMailFg{i},#L1r04EMailFg{i})
C(5,#PaperFg{i},N,HIDE(#Paper{i}),SHOW(#Paper{i}))
C(5,#MsgFg{i},N,HIDE(#Msg{i}),SHOW(#Msg{i}))
C(5,#EMailFg{i},N,HIDE(#EMail{i}),SHOW(#EMail{i}))
E(0,@ChkA{i},0)
C(5,#PaperFg{i},N,$,E(0,@ChkA{i},#ChkA{i}+1))
C(5,#MsgFg{i},N,$,E(0,@ChkA{i},#ChkA{i}+1))
C(5,#EMailFg{i},N,$,E(0,@ChkA{i},#ChkA{i}+1))
##end
##loop{times:40,i:1,j:3}
#Default{i}=X,10,S
C(4,#Notice{i},INVOKEJS(SHOW,grd1,{j},{j},0),INVOKEJS(SHOW,grd1,{j},{j},1))
##end

#CanMsg=X,1,S
#CanEmail=X,1,S
!RIM參數使用

#RimFunc=A,1,S
E(0,#FunCd)
<include src="ROM.icf::L1R13.dec"/>
#RimL1r13=X,1,S
E(0,@RimCustNo,#CustNo)
E(0,@RimFacmNo,#FacmNo)
RESET_RIM(#RimL1r13,L1R13)
S(L1R13,1,#RimFunc,#RimCustNo,#RimFacmNo)
R(1,L1R13)
T(2,@CustName,#L1R13CustName)
T(2,@CanMsg,#L1R13MsgFg)
T(2,@CanEmail,#L1R13EmailFg)

##loop{times:40,i:1,j:3}

#PaperFg{i}=X,1,S
#MsgFg{i}=X,1,S
#EMailFg{i}=X,1,S
#ChkA{i}=A,3,S
#ChkB{i}=A,3,S

#FormNo{i}=X,10,S
#Notice{i}=X,100,L
C(4,#Notice{i},INVOKEJS(SHOW,grd1,{j},{j},0),INVOKEJS(SHOW,grd1,{j},{j},1))
#NoticeX{i}=X,110,L
#SendCode{i}=X,1,S
##end


! 若需要修改無簡訊電話或email時，會自動把不發送設為Y的功能請修改此處
! 這個參數也控制選擇發送時，是否檢查有沒有對應的資料（如發送簡訊時，檢查客戶有無簡訊電話資料等等）
! 0:關閉 1:開啟
#IsCheck=A,1,S
E(0,0)

!  申請日期
#DATE=D,8,S
T(4,#SYSCDATE)

#ApplyDt=D,7,I
C(3,#ApplyDt,0,T(1,#DATE,2,7),$)
@
V(5,0010101,#SYSCDATE)
A(DATE,0,#ApplyDt)

! 按下全選按鈕後,呼叫相對應的處理
#BIND_Paper0=X,1,S
BIND(#Paper0,click, {cmd=CALLSEND;DOCODE=SELECT_Paper_ALL})
#BIND_Msg0=X,1,S
BIND(#Msg0,click, {cmd=CALLSEND;DOCODE=SELECT_Msg_ALL})
#BIND_EMail1=X,1,S
BIND(#EMail0,click, {cmd=CALLSEND;DOCODE=SELECT_EMail_ALL})

! 全選記號
#Paper_ALL_FG=A,1,S
E(0,0)
#Msg_ALL_FG=A,1,S
E(0,0)
#EMail_ALL_FG=A,1,S
E(0,0)

#MRKEY=_,_,S
C(3,#FacmNo,0,T(2,#CustNo),T(2,#CustNo+-+#FacmNo))


! 三顆全選按鈕的實際對應處理:1.變更"全選記號" -> 2.將各選項打勾
#SELECT_Paper_ALL=@,1,S
IF(#Paper_ALL_FG==0,E(0,@Paper_ALL_FG,1),E(0,@Paper_ALL_FG,0))
##loop{times:40,i:1}
IF(#Paper_ALL_FG==0,T(3,@Paper{i},),T(3,@Paper{i},Y))
##end

#SELECT_Msg_ALL=@,1,S
IF(#Msg_ALL_FG==0,E(0,@Msg_ALL_FG,1),E(0,@Msg_ALL_FG,0))
##loop{times:40,i:1}
IF(#Msg_ALL_FG==0,T(3,@Msg{i},),T(3,@Msg{i},Y))
##end

#SELECT_EMail_ALL=@,1,S
IF(#EMail_ALL_FG==0,E(0,@EMail_ALL_FG,1),E(0,@EMail_ALL_FG,0))
##loop{times:40,i:1}
IF(#EMail_ALL_FG==0,T(3,@EMail{i},),T(3,@EMail{i},Y))
##end


#CheckY=X,1,S
T(2,Y)
! SendCode==1不可申請全部不寄送;2可以申請全部不寄送
##loop{times:40,i:1}

! 不寄送記號-書面
#Paper{i}=X,1,I
C(4,#FormNo{i},s,$)
C(5,#PaperFg{i},N,s,$)
HELP(Y:不寄送; :寄送)
@
C(4,#Paper{i},$,IF(#Paper{i} == #CheckY,$,V(P,限輸入Y或空白)))

! 不發送記號-簡訊
#Msg{i}=X,1,I
C(4,#FormNo{i},s,$)
C(5,#MsgFg{i},N,s,$)
C(3,#IsCheck,0,$,C(5,#CanMsg,0,T(3,Y),$))
HELP(Y:不發送; :發送)
@
C(3,#IsCheck,0,$,C(5,#CanMsg,0,C(4,#Msg{i},V(P,此客戶尚未設定簡訊電話，故不可設定為發送),$),$))
C(4,#Msg{i},$,IF(#Msg{i} == #CheckY,$,V(P,限輸入Y或空白)))

#Err{i}=x,200,S
T(B,#NoticeX{i}+，不可申請全部不寄送)

! 不發送記號-EMail
#EMail{i}=X,1,I
C(4,#FormNo{i},s,$)
C(5,#EMailFg{i},N,s,$)
C(3,#IsCheck,0,$,C(5,#CanEmail,0,T(3,Y),$))
HELP(Y:不發送; :發送)
@
C(3,#IsCheck,0,$,C(5,#CanEmail,0,C(4,#EMail{i},V(P,此客戶尚未設定信箱，故不可設定為發送),$),$))
C(4,#EMail{i},$,IF(#EMail{i} == #CheckY,$,V(P,限輸入Y或空白)))
C(5,#SendCode{i},1,$,s)
E(0,@ChkB{i},0)
C(5,#Paper{i},Y,E(0,@ChkB{i},#ChkB{i}+1),$)
C(5,#Msg{i},Y,E(0,@ChkB{i},#ChkB{i}+1),$)
C(5,#EMail{i},Y,E(0,@ChkB{i},#ChkB{i}+1),$)
C(3,#ChkA{i},#ChkB{i},V(P,#Err{i}),$)

##end


</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>


!---------- TXFORM = L1108 ----------
<sub type="FORM" name="L1108">

!#SCRPRT=_,_,S
!C(5,#TXFORM,L1108,$,S)

#SCRTIL=_,_,S
T(3,[L1108] 申請不列印書面通知書維護)

!------ TOM(HEAD)   Variables (FOR OUTPUT SCREEN) ------
!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------


!------ TOM(OCCURS) Variables (FOR OUTPUT SCREEN) ------
#LOOP=X,1,S
T(3,1)ASGN(LOOP$)



</sub>


!------ 上行電文 ------
<sub type="TIM">
#FunCd
#CustNo
#FacmNo
#ApplyDt
##loop{times:40,i:1}
#FormNo{i}
#Paper{i}
#Msg{i}
#EMail{i}
##end
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
TXFORM=L1108^
<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L1R04.tom"/>
<include src="ROM.icf::L1R11.tom"/>
<include src="ROM.icf::L1R13.tom"/>
<include src="ROM.icf::L1R01.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
</sub>
