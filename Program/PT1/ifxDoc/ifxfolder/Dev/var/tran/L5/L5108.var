!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

!!#FKEY 0:登錄,1:更正,2:放行,3:審核/在途登錄,5:更正重登,6:在途設定,7修改,9檢視journal
!![一段式/二段式/三段式]
!#RELCD=_,_,S
!C(2,#FKEY,$,s,s,s,$,$,s,s,$,$)
!E(0,4)

!#ACTFG=_,_,S
!C(2,#FKEY,$,s,s,s,$,$,s,s,$,$)
!E(0,1)


#TXCD
T(3,L5108)
</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)


</sub>

!=====================================================================
!#FKEY>0時，重新執行
!=====================================================================
<sub type="PREDC" name="PreDC">


!#ActFgHelp=x,20,S
!T(3,1:登錄;2:放行;3:審核)
!C(3,#FKEY,2,T(H,@ACTFGX,#ACTFG,#ActFgHelp),$)

!#Hiddent=X,1,S
!C(3,#ACTFG,2,$,s)
!HIDE(#BTND)

!<include src="COM.icf::TITLE-RUN.pre"/>
</sub> 
!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L5108" layout="cols=3;screen.width=[130,370,130,370];printer.width=[20,80];order=1">
[
["[L5108]                                 檔案借閱內容維護"],
["#FdFunctionCodeX+功能",#FunctionCodeX],["#FdApplCodeX+申請或歸還",#ApplCodeX],
[#<->#,"#FdCustNo+借款人戶號",#CustNo,"-",#FacmNo,#CustName],
[#<->#,"#FdFacmNoMemo+同押品額度",#FacmNoMemo],
["#FdApplSeq+申請序號",#ApplSeq],["#FdApplEmpNo+借閱人",#ApplEmpNo,#ApplEmpNoX],
["#FdUsageCode+用途",#UsageCode,#UsageCodeX],["#FdCopyCode+正本+/+影本",#CopyCode,#CopyCodeX],
["#FdApplDate+借閱日期",#ApplDate],["#FdKeeperEmpNo+管理人",#KeeperEmpNo,#KeeperEmpNoX],
["#FdReturnDate+歸還日期",#ReturnDate],["#FdReturnEmpNo+歸還人",#ReturnEmpNo,#ReturnEmpNoX],
[#<->#,"#FdRemark+備註",#Remark],
[#<->#,"#FdApplObj+借閱項目",#ApplObj,#ApplObjX],
![#<->#,#LABLEA,#BTN_GRDA,#BTN_GRDB,#BTN_GRDC],
["#grid#,{id:1,expand:true,loop:25,row_height:1,s_cols:[], p_cols:[]}","@申請資料","",
["內容資料名稱","數量"],
[[#OPTA1,#FILENMA1],[#AMTA1," 份 "]]],
["#grid#,{id:2,expand:true,loop:25,row_height:1,s_cols:[], p_cols:[]}","@設定資料","",
["內容資料名稱","數量"],
[[#OPTB1,#FILENMB1],[#AMTB1," 份"]]],
["#grid#,{id:3,expand:true,loop:25,row_height:1,s_cols:[], p_cols:[]}","@對保資料","",
["內容資料名稱","數量"],
[[#OPTC1,#FILENMC1],[#AMTC1," 份"]]],

]

#FdFunctionCodeX=X,2,L
#FdCustNo=X,2,L
#FdApplSeq=X,2,L
#FdUsageCode=X,2,L
#FdApplDate=X,2,L
#FdReturnDate=X,2,L
#FdRemark=X,2,L
#FdApplObj=X,2,L
#FdApplCodeX=X,2,L
#FdApplEmpNo=X,2,L
#FdCopyCode=X,2,L
#FdKeeperEmpNo=X,2,L
T(3,*)
#FdReturnEmpNo=X,2,L

!---------- AP TEXT AREA Variables ----------

!#BTND=X,4,I,ui:button;value:顧客資料查詢;enable:1;tabbable:0

<include src="HELPRIM.icf::HELPRIM.rtn"/>
<include src="ROM.icf::L2R08.dec"/>


!1申請或歸還
#ApplCodeRimName=x,20,S
T(3,CdCode.ApplCode)
#ApplCodeHelp=x,1024,S

!3借閱項目
#ApplObjRimName=x,20,S
T(3,CdCode.ApplObj)
#ApplObjHelp=x,1024,S

!4用途
#UsageCodeXRimName=x,20,S
T(3,CdCode.UsageCodeX)
#UsageCodeXHelp=x,1024,S

!5正本/影本
#CopyCodeRimName=x,20,S
T(3,CdCode.CopyCode)
#CopyCodeHelp=x,1024,S

!6申請資料
#ApplicationRimName=x,30,S
T(3,CdCode.ApplicationCode)
#ApplicationCodeHelp=x,1024,S

!7設定資料
#SettingRimName=x,30,S
T(3,CdCode.SettingCode)
#SettingCodeHelp=x,1024,S

!8對保資料
#GuaranteedRimName=x,30,S
T(3,CdCode.GuaranteedCode)
#GuaranteedCodeHelp=x,1024,S

!9檔案借閱管理人
#InnDocKeeperRimName=x,20,S
T(3,CdCode.InnDocKeeper)
#InnDocKeeperHelp=x,1024,S

!10功能代碼
#FunctionCodeCode=x,20,S
T(3,CdCode.FunctionCode)
#FunctionCodeHelp=x,1024,S


#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#ApplCodeRimName,#ApplObjRimName,#UsageCodeXRimName,#CopyCodeRimName,#ApplicationRimName,#SettingRimName,#GuaranteedRimName,#InnDocKeeperRimName,#FunctionCodeCode)
R(1,XXR99)
CALL(#HelpProc)
T(2,@ApplCodeHelp,#HelpDesc1) 
T(2,@ApplObjHelp,#HelpDesc2)
T(2,@UsageCodeXHelp,#HelpDesc3)
T(2,@CopyCodeHelp,#HelpDesc4)
T(2,@ApplicationCodeHelp,#HelpDesc5)
T(2,@SettingCodeHelp,#HelpDesc6)
T(2,@GuaranteedCodeHelp,#HelpDesc7)
T(2,@InnDocKeeperHelp,#HelpDesc8)
T(2,@FunctionCodeHelp,#HelpDesc9)

#CHAIN=A,1,S
T(4,CHAIN$) 
IF(#CHAIN==1,$,V(P,此為連動交易，請從交易:[L5903 檔案借閱查詢]進入))

!做完交易自動更新原畫面
#AutoReFresh=A,1,S
C(3,#CHAIN,1,$,S)
E(0,1)
ASGN(CAUTO$)

#InitApplCode=A,1,S
!IF(#FKEY == 3 ,E(0,1),S)
!HIDE(#BTND)


! 新增按鈕會帶入1 ??? 防呆
#NTXBUF=X,300,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@ApplCode,#NTXBUF,248,1)
C(3,#ApplCode,0,s,$)
T(1,@CustNo,#NTXBUF,1,7)
T(1,@FacmNo,#NTXBUF,8,3)
T(1,@ApplSeq,#NTXBUF,11,3)
T(1,@CustName,#NTXBUF,14,100)
T(1,@KeeperEmpNo,#NTXBUF,114,6)
T(1,@ApplEmpNo,#NTXBUF,120,6)
T(1,@ApplDate,#NTXBUF,126,7)
T(1,@ReturnDate,#NTXBUF,133,7)
T(1,@ReturnEmpNo,#NTXBUF,140,6)
T(1,@UsageCode,#NTXBUF,146,2)
T(1,@Remark,#NTXBUF,148,100)
T(1,@CopyCode,#NTXBUF,249,1)
T(1,@ApplObj,#NTXBUF,250,1)
T(1,@FacmNoMemo,#NTXBUF,251,20)
T(1,@ApplEmpNoX,#NTXBUF,271,20)
INVOKEJS(SHOW,p1,02,02,1)


<include src="ROM.icf::L5R48.dec"/> 

#Rim5R48CustNo=A,7,S
E(0,#CustNo)
#Rim5R48FacmNo=A,3,S
E(0,#FacmNo)
#Rim5R48ApplSeq=X,3,S
T(2,#ApplSeq)

#RimL5R48=X,1,S
!IF(#ApplObj==4&&#ApplCode==2,$,s)
IF(#ApplObj==4,$,s)
RESET_RIM(#RimL5R48,L5R48)
S(L5R48,01,#Rim5R48CustNo,#Rim5R48FacmNo,#Rim5R48ApplSeq)
R(1,L5R48)
##loop {times:25,i:1}
E(0,@OPTA{i},#L5r48OPTA{i})
E(0,@AMTA{i},#L5r48AMTA{i})
E(0,@OPTB{i},#L5r48OPTB{i})
E(0,@AMTB{i},#L5r48AMTB{i})
E(0,@OPTC{i},#L5r48OPTC{i})
E(0,@AMTC{i},#L5r48AMTC{i})
##end

#Trol=X,1,S
!IF(#ApplObj==4&&#ApplCode==2,$,s)
IF(#ApplObj==4,$,s)
INVOKEJS(SHOW,L5108,10,12,1)
##loop {times:25,i:1}
C(3,#OPTA{i},0,$,T(H,@FILENMA{i},#OPTA{i},#ApplicationCodeHelp))
C(3,#OPTB{i},0,$,T(H,@FILENMB{i},#OPTB{i},#SettingCodeHelp))
C(3,#OPTC{i},0,$,T(H,@FILENMC{i},#OPTC{i},#GuaranteedCodeHelp))
C(3,#OPTA{i},0,INVOKEJS(SHOW,grd1_{i},0),INVOKEJS(SHOW,grd1_{i},1))
C(3,#OPTB{i},0,INVOKEJS(SHOW,grd2_{i},0),INVOKEJS(SHOW,grd2_{i},1))
C(3,#OPTC{i},0,INVOKEJS(SHOW,grd3_{i},0),INVOKEJS(SHOW,grd3_{i},1))
##end
C(3,#OPTA1,0,INVOKEJS(SHOW,L5108_10,0),$)
C(3,#OPTB1,0,INVOKEJS(SHOW,L5108_11,0),$)
C(3,#OPTC1,0,INVOKEJS(SHOW,L5108_12,0),$)

! 藏欄位
! ApplCode 若=0預設1
#PRE_GRDDIS=A,1,S
!IF(#ApplObj==4&&#ApplCode==2 ||#ACTFG==3,$,INVOKEJS(SHOW,L5108,10,14,0))
IF(#ApplObj==4,$,INVOKEJS(SHOW,L5108,10,14,0))
C(3,#ApplCode,0,E(0,@ApplCode,1),$)
! 登放記號
!#ACTFGX=X,8,L
!T(H,#ACTFG,#ActFgHelp)
!C(2,#ACTFG,$,K(MODIFYBUTTON,登錄),K(MODIFYBUTTON,放行),K(MODIFYBUTTON,審核))


! 功能代碼
#FunctionCode=X,2,S
T(2,02)

#FunctionCodeX=X,24,L
T(H,#FunctionCode,#FunctionCodeHelp)
!C(2,#FunctionCode,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),$,K(MODIFYBUTTON,刪除),K(MODIFYBUTTON,查詢))
K(MODIFYBUTTON,#FunctionCodeX)
C(3,#FunctionCode,5,K(NOBUTTON,CLOSEY),$)

#FUNCIND=_,_,S
E(0,#FunctionCode)


!刪除隱藏重新交易按鈕
#AGAIN=X,1,S
C(3,#FunctionCode,2,$,S)
E(0,1)ASGN(AGAIN$)             


#TODAY=A,7,S
E(0,#SYSCDATE)

! 申請或歸還
#ApplCode=A,1,S
C(3,#ApplCode,1,$,s)
HELP(#ApplCodeHelp)
@V(H,#ApplCodeHelp)
T(2,@L5108ConfirmBrNo,)
T(2,@L5108ConfirmGroupNo,)

#ApplCodeX=X,4,L
SWITCH(#ApplCode
,1,
T(F,@KeeperEmpNo,1)
T(F,@Remark,1)
T(F,@FacmNoMemo,1)
INVOKEJS(SHOW,L5108_6,1)
INVOKEJS(SHOW,L5108_7,0)
SHOW(#UsageCode,#CopyCode,#ApplObj)
,2,
T(F,@KeeperEmpNo,1)
T(F,@Remark,1)
T(F,@FacmNoMemo,1)
INVOKEJS(SHOW,L5108_6,1)
INVOKEJS(SHOW,L5108_7,1)
##loop {times:25,i:1}
T(F,@OPTA{i},0)
T(F,@AMTA{i},0)
T(F,@OPTB{i},0)
T(F,@AMTB{i},0)
T(F,@OPTC{i},0)
T(F,@AMTC{i},0)
##end
HIDE(#UsageCode,#CopyCode,#ApplObj)
!HIDE(#BTND)
,$)
T(H,#ApplCode,#ApplCodeHelp)
IF(#InitApplCode == 1,
##loop {times:25,i:1}
T(F,@OPTA{i},0)
T(F,@AMTA{i},0)
T(F,@OPTB{i},0)
T(F,@AMTB{i},0)
T(F,@OPTC{i},0)
T(F,@AMTC{i},0)
##end
,$)


! 借款人戶號
#CustNo=A,7,L

! 借款人戶名rim
<include src="ROM.icf::L5R33.dec"/>     
#RimL5R33=X,1,S
#RimCustNo=A,7,S
E(0,#CustNo)
RESET_RIM(#RimL5R33,L5R33)
S(L5R33,1,#RimCustNo)
R(1,L5R33)


! 額度編號
#FacmNo=A,3,L

! 借款人戶名---調RIM
#CustName=X,100,L

!調RIM預設值
#UsageCodeX1=X,16,L
T(H,#UsageCode,#UsageCodeXHelp)
T(2,@UsageCodeX,#UsageCodeX1)
#CopyCodeX1=X,6,L
T(H,#CopyCode,#CopyCodeHelp)
T(2,@CopyCodeX,#CopyCodeX1)
#ApplObjX1=X,16,L
T(H,#ApplObj,#ApplObjHelp)
T(2,@ApplObjX,#ApplObjX1)


!額度若輸入0則必須輸入同押品額度不可空白,額度>0則不檢查
#FdFacmNoMemo=X,2,L
IF(#FacmNo == 0,T(3,*),T(3,))


#FacmNoMemo=X,20,I
@C(3,#FacmNo,0,$,s)
V(7)


! 申請序號
#ApplSeq=A,3,L


! 借閱人
#ApplEmpNo=X,6,L

#RimEmployeeNo=X,6,S
#RimTxCode=X,6,S
T(2,L5108)
#RimErrorSkip=X,1,S
T(2,Y)

#SendL2r08A=X,1,S
C(4,#ApplEmpNo,S,$)
T(2,@RimEmployeeNo,#ApplEmpNo)
RESET_RIM(#SendL2r08A,L2R08)
S(L2R08,1,#RimTxCode,#RimEmployeeNo,#RimErrorSkip)
R(1,L2R08)
T(2,@ApplEmpNoX,#L2r08FullName)


! 員工姓名---調RIM
#ApplEmpNoX=X,8,L
C(3,#ApplCode,1,$,s)


! 用途
#UsageCode=x,2,L

#UsageCodeX=X,16,L


! 正本/影本
#CopyCode=X,1,L
#CopyCodeX=X,6,L


#PreApplObjX=X,16,L
C(3,#ApplCode,2,$,s)
T(H,#ApplObj,#ApplObjHelp)
T(2,@ApplObjX,#PreApplObjX)


! 借閱日期
#ApplDate=D,7,L


! 管理人
#KeeperEmpNo=X,6,I
HELP(#InnDocKeeperHelp)
@T(3,@KeeperEmpNoX,)
V(H,#InnDocKeeperHelp)

! 員工姓名---調RIM
#KeeperEmpNoX=X,8,L
T(H,#KeeperEmpNo,#InnDocKeeperHelp)

#SendL2r08C=X,1,S
C(4,#KeeperEmpNo,S,$)
T(2,@RimEmployeeNo,#KeeperEmpNo)
RESET_RIM(#SendL2r08C,L2R08)
S(L2R08,1,#RimTxCode,#RimEmployeeNo,#RimErrorSkip)
R(1,L2R08)
C(4,#KeeperEmpNo,s,$)
T(2,@L5108ConfirmGroupNo,#L2r08GroupNo)
T(2,@L5108ConfirmBrNo,#L2r08Brno)
IF(#KeeperEmpNoX == "",T(2,@KeeperEmpNoX,#L2r08FullName),$)



! 歸還日期
#ReturnDate=D,7,L


! 歸還人
#ReturnEmpNo=X,6,L

#SendL2r08B=X,1,S
C(4,#ReturnEmpNo,S,$)
T(2,@RimEmployeeNo,#ReturnEmpNo)
RESET_RIM(#SendL2r08B,L2R08)
S(L2R08,1,#RimTxCode,#RimEmployeeNo,#RimErrorSkip)
R(1,L2R08)
T(2,@ReturnEmpNoX,#L2r08FullName)
C(4,#ReturnEmpNo,s,$)
T(2,@L5108ConfirmGroupNo,#L2r08GroupNo)
T(2,@L5108ConfirmBrNo,#L2r08Brno)

#ReturnEmpNoX=X,8,L

! 備註
#Remark=X,100,I


! 借閱項目
#ApplObj=A,1,L

#ApplObjX=X,16,L

#L5108ConfirmBrNo=x,5,S
#L5108ConfirmGroupNo=x,5,S


#PAGE_FG=A,1,S
E(0,0)

! 內容明細



! *-*-*-*-*-*-*-*-*-*-*-*-Loop*Start-*-*-*-*-*-*-*-*-*-*-*-*-
! ---------申請資料---------
##loop{times:25,i:1,j:0,k:2}

#OPTA{i}=A,2,L

#FILENMA{i}=X,20,L


#AMTA{i}=A,2,L

#COPTA{i}=X,1,S
##end



! ---------設定資料---------
##loop{times:25,i:1,j:0,k:2}
#OPTB{i}=A,2,L


#FILENMB{i}=X,20,L

#AMTB{i}=A,2,L

#COPTB{i}=X,1,S

##end



! ---------對保資料---------
##loop{times:25,i:1,j:0,k:2}
#OPTC{i}=A,2,L

#FILENMC{i}=X,20,L

#AMTC{i}=A,2,L

#COPTC{i}=X,1,S

##end


!參考編號
#MRKEY=_,_,S
T(2,#CustNo+-+#FacmNo+-+#ApplSeq)

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L5108 -----------
<sub type="FORM" name="L5108">
</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#FunctionCode
#CustNo
#FacmNo
#ApplCode
#ApplSeq
#ApplEmpNo
#KeeperEmpNo
#UsageCode
#CopyCode
#ApplDate
#ReturnDate
#ReturnEmpNo
#Remark
#ApplObj
#FacmNoMemo
#L5108ConfirmBrNo
#L5108ConfirmGroupNo
##loop {times:25,i:1}
#OPTA{i}
#FILENMA{i}
#AMTA{i}
##end
##loop {times:25,i:1}
#OPTB{i}
#FILENMB{i}
#AMTB{i}
##end
##loop {times:25,i:1}
#OPTC{i}
#FILENMC{i}
#AMTC{i}
##end

#FunctionCodeX
#ApplCodeX
#CustName
#ApplEmpNoX
#UsageCodeX
#CopyCodeX
#KeeperEmpNoX
#ReturnEmpNoX
#ApplObjX

#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
<include src="ROM.icf::L5R33.tom"/>
<include src="ROM.icf::L5R48.tom"/>
<include src="ROM.icf::L2R08.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
TXFORM=L5108

^

</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
</sub>
