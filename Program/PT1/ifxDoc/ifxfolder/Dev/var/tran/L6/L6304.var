----- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">

!#TXCD
!T(3,L6304)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD2.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)


</sub>


!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="p1" layout="cols=1;screen.width=[150,850];printer.width=[20,20];">
[
["[L6304]                                 專案放款維護"],
["#FdYear+民國年月",#sYear,"年",#sMonth,"月",],

]
!---------- AP Button AREA ----------



#FdYear=X,2,L

#CHAIN=A,1,S
T(4,CHAIN$)
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:[L6034 專案放款查詢]進入),$)


![連動交易]
#NTXBUF=X,138,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)

#CHAIN_FuncCode=X,1,S
T(1,#NTXBUF,1,1)

#CHAIN_YearMonth=X,5,S
T(1,#NTXBUF,2,5)

#uYear=X,3,S
T(1,#CHAIN_YearMonth,1,3)

#uMonth=X,2,S
T(1,#CHAIN_YearMonth,4,2)



INVOKEJS(SHOW,p2,0)

!---------- AP TEXT AREA Variables ----------


#DATE=D,8,S
T(4,DATE$)

#Year=A,3,S
T(1,#DATE,2,3)

#Month=A,2,S
T(1,#DATE,5,2)

! 年月起
#sYear=A,3,I
C(3,#CHAIN_FuncCode,1,E(0,#Year),E(0,#uYear))
C(3,#CHAIN_FuncCode,1,I,O)
@V(2,0)

#sMonth=A,2,I
C(3,#CHAIN_FuncCode,1,E(0,#Month),E(0,#uMonth))
C(3,#CHAIN_FuncCode,1,I,O)
@V(5,1,12)


#YearMonth=A,5,S
T(2,#sYear+#sMonth)

#RimEffectDate=D,7,S
T(2,#YearMonth+01)

#TranKey_Tmp=X,1,S
T(2,#CHAIN_FuncCode)


S(L6R51,0,#RimEffectDate,#TranKey_Tmp)
R(1,L6R51)

!新增顯示
IF(#CHAIN_FuncCode == 1 ,INVOKEJS(SHOW,p2,1),INVOKEJS(SHOW,p2,0))
IF(#CHAIN_FuncCode == 2 ,INVOKEJS(SHOW,p2,1),$)
IF(#CHAIN_FuncCode == 4 ,INVOKEJS(SHOW,p2,0),$)
IF(#CHAIN_FuncCode == 4 ,K(MODIFYBUTTON,刪除),$)

##loop {times:12,i:1}

T(2,@ProdName{i},#L6r51ProdName{i})
E(0,@LoanBal{i},#L6r51LoanBal{i})
T(2,@ColName{i},#L6r51ColName{i})

##end

##loop {times:12,i:1}

#L6r51ProdName{i}=X,50,L
#L6r51LoanBal{i}=X,30,L
#L6r51ColName{i}=x,15,S

#ProdName{i}=X,50,L
#LoanBal{i}=M,30,I
#ColName{i}=x,15,S

##end


</sub>

<sub type="DC" name="p2" layout="cols=2;screen.width=[200,1000];printer.width=[45,70];order=1;">
[
["專案放款維護"],
["#grid#,{id:1,expand:false,loop:12,row_height:0,s_cols:[60,60], p_cols:[90,50]}","","",
["中文項目名稱","放款金額"],
[#ProdName1,#LoanBal1],
],
]
</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!---------- TXFORM = L6304 ----------
<sub type="FORM" name="L6304">

!#SCRPRT=_,_,S
!C(5,#TXFORM,L6304,$,S)

!#SCRTIL=_,_,S
!T(3,[L6304] 專案放款維護)

!#LOOP=X,1,S
!T(3,1)ASGN(LOOP$)

</sub>


!------ 上行電文 ------
<sub type="TIM">
#RimEffectDate
#TranKey_Tmp
##loop{times:12,i:1}
#ProdName{i}
#LoanBal{i}
#ColName{i}
##end

#END
</sub>


!------ 下行電文TOM ------
<sub type="TOM">
TXFORM=L6304
^
TXFORM=L6R51
##loop{times:12,i:1}
#L6r51ProdName{i}
#L6r51LoanBal{i}
#L6r51ColName{i}
##end
^
<include src="COM.icf::TRCTL.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>

</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>
</sub>



