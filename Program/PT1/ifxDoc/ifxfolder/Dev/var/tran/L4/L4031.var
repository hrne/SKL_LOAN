!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L4031)

![資料表頭(HEADER)長度]
#INQHD=n,3,S
E(0,0)ASGN(INQHD$)

![每筆資料明細(OCCURS)長度]
#INQLEN=n,3,S
E(0,12)ASGN(INQLEN$)

![多筆查詢之一個畫面有N筆資料]
#INQREC=n,2,S
E(0,40)ASGN(INQREC$)

![畫面顯示的明細間的高度]
#LOOPH=n,3,S
E(0,1)ASGN(LOOPHEIGHT$)

![每張印錄單列印的筆數]
#INQPRT=n,2,S
E(0,40)ASGN(INQPRT$)

</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)
</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L4031" layout="cols=1;screen.width=[130,870];printer.width=[20,80];order=1">
[
["[L4031]@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@利率調整清單"],
[#<->#,"#FdRateChangeDate+調整日期",#RateChangeDate],
[#<->#,"#FdCustType+個金/企金",#CustType,#CustTypeX]
]

#FdRateChangeDate=X,2,L
T(3,*)
#FdCustType=X,2,L
T(3,*)

! Help
<include src="HELPRIM.icf::HELPRIM.rtn"/>

![戶別]
#CDDEF01=x,26,S
T(3,CdCode.EntCode2)

#EntCodeHelp=x,1024,S 

![作業項目]
#CDDEF02=x,26,S
T(3,CdCode.TxKind)

#LableAHelp=x,1024,S 

#HelpRim=X,1,S
RESET_RIM(#HelpRim,XXR99)
S(XXR99,01,#CDDEF01,#CDDEF02)
R(1,XXR99)
CALL(#HelpProc) 
T(2,@EntCodeHelp,#HelpDesc1)
T(2,@LableAHelp,#HelpDesc2)  

!註記
#LableBHelp=x,100,S
T(3,1:批次自動調整;2:按地區別調整;3:人工調整（未調整）;4:人工調整（待輸入）;5:人工調整（已調整）;9:檢核有誤)

! #CHAIN=A,1,S
! T(4,CHAIN$) 

! #NTXBUF=X,1,S
! C(3,#CHAIN,1,T(4,NTXBUF$),S)


! 調整日期
#RateChangeDate=D,7,I
E(0,@RateChangeDate,#SYSDATE)
@A(DATE,0,#RateChangeDate)
IF(#RateChangeDate==0,V(P,調整日期不可為0),$)

! #AdjMonth=A,5,I
! T(1,#RateChangeDate,1,5)

! 戶別
#CustType=A,1,I
E(0,1)
HELP(#EntCodeHelp)
@V(H,#EntCodeHelp)

#CustTypeX=X,30,L
T(3,)T(H,#CustType,#EntCodeHelp)
!SWITCH(#CustType,1,T(3,個金),2,T(3,企金（含企金自然人）),T(3,))

! 個金無須個別輸入利率(0)
#RPTFG=A,1,S
! C(3,#CustType,1,E(0,0),E(0,1))

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L4031 -----------
<sub type="FORM" name="L4031">
#SCRTIL=_,_,S
T(3,[L4031] 利率調整清單)

#LOOP=X,1,S
E(0,1)ASGN(LOOP$) 

#OORank=m,1,S

! 作業項目
#OOLableA=m,1,O
#OOLableAX=X,20,O
C(3,#OORank,1,$,S)
T(3,)T(H,#OOLableA,#LableAHelp)

! 註記
#OOLableB=X,2,O
T(1,@OOLableB_AdjCode,#OOLableB,1,1)
T(1,@OOLableB_KeyinCode,#OOLableB,2,1)
!1.批次自動調整 2.按地區別調整 3.人工調整
#OOLableB_AdjCode=X,1,S
!0.未調整 1.已調整 2.待輸入
#OOLableB_KeyinCode=X,1,S

#OOLableBX=X,30,O

! 方式細項 0:未輸入 1:已輸入 2:有誤
#OOLableC=X,1,O


! 總數   
#OOSumCnt=m,4,O
#OOSumCntX=X,5,O
C(3,#OOSumCnt,0,T(2, ),X(#OOSumCnt))

#OOTotCnt=m,4,O
#OOTotCntX=X,5,O
C(3,#OOTotCnt,0,T(2, ),X(#OOTotCnt))

! 待處理
#OOIgnCnt=m,4,O
#OOIgnCntX=X,5,O
C(3,#OOIgnCnt,0,T(2, ),X(#OOIgnCnt))

! 已總數確認
#OOCheckFlag=A,1,O

! 總數 
#OOBUF_TOTAL=X,50,S
SWITCH(#OORank,
1,T(2,#CustType+#OOLableA+A +#OOLableBX+A+#RateChangeDate+#OORptFg),
2,T(2,#CustType+#OOLableA+#OOLableB+#OOLableBX+A+#RateChangeDate+#OORptFg))

! 有處理 
#OOBUF_SUM=X,50,S
SWITCH(#OORank,
1,T(2,#CustType+#OOLableA+A +#OOLableBX+0+#RateChangeDate+#OORptFg),
2,T(2,#CustType+#OOLableA+#OOLableB+#OOLableBX+0+#RateChangeDate+#OORptFg))

! 待處理 
#OOBUF_ERROR=X,50,S
SWITCH(#OORank,
1,T(2,#CustType+#OOLableA+A +#OOLableBX+9+#RateChangeDate+#OORptFg),
2,T(2,#CustType+#OOLableA+#OOLableB+#OOLableBX+9+#RateChangeDate+#OORptFg))

! 總筆數
#OOBTN_TOTAL1=A,1,O
IF(#OOTotCnt>0,BIND(grid,{ cmd=CHAIN;ntxcd=L4931; text=#OOTotCntX; ntxbuf=#OOBUF_TOTAL}),BIND(grid,cancel))
! 需處理
#OOBTN_TOTAL2=A,1,O
IF(#OOSumCnt>0,BIND(grid,{ cmd=CHAIN;ntxcd=L4931; text=#OOSumCntX; ntxbuf=#OOBUF_SUM}),BIND(grid,cancel))
! 不處理
#OOBTN_TOTAL3=A,1,O
IF(#OOIgnCnt>0,BIND(grid,{ cmd=CHAIN;ntxcd=L4931; text=#OOIgnCntX; ntxbuf=#OOBUF_ERROR}),BIND(grid,cancel))

#OOText_Exec=X,10,O
IF(#OOCheckFlag==1,T(2,已確認報表),IF(#OOCheckFlag==0,T(2,確認),IF(#OOCheckFlag==2,T(2,輸入利率),T(2,)))))

#OOBuff_L4321=X,42,O
T(2,#RateChangeDate+#OOLableA+#CustType+#OOLableB_AdjCode+#OOLableB_KeyinCode+#OOLableBX)
#OOBuff_LC009=X,15,O
T(2,#TLRNO+L4321)

#OOBuff_L4325=X,10,O
T(2,#RateChangeDate+#OOLableA+#CustType)

#OOBTN_Exec=A,1,O
SWITCH(#OOCheckFlag,1,BIND(grid,{ cmd=CHAIN;ntxcd=LC009; text=#OOText_Exec; ntxbuf=#OOBuff_LC009}),
			  0,BIND(grid,{ cmd=CHAIN;ntxcd=L4321; text=#OOText_Exec; ntxbuf=#OOBuff_L4321}),
                    2,BIND(grid,{ cmd=CHAIN;ntxcd=L4325; text=#OOText_Exec; ntxbuf=#OOBuff_L4325}),BIND(grid,cancel))
! IF(#OOCheckFlag==2,BIND(grid,{ cmd=CHAIN;ntxcd=L4325; text=#OOText_Exec; ntxbuf=#OOBuff_L4325}),BIND(grid,cancel))

#OOStatus=A,1,O

#OOStatusX=x,10,O
T(2,)
C(2,#OOStatus,T(2,未確認),T(2,確認未放行),T(2,已確認放行))

#OORptFg=X,1,O

#OONeedConCnt=m,4,S
#OONeedConCntX=X,5,O
C(3,#OONeedConCnt,0,T(2, ),X(#OONeedConCnt))

</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#RateChangeDate
#CustType
#END
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
TXFORM=L4031
#OORank
#OOLableA
#OOLableB
#OOLableBX
#OOTotCnt
#OOSumCnt
#OOIgnCnt
#OOCheckFlag
#OOStatus
#OORptFg
#OONeedConCnt
^
<include src="HELPRIM.icf::HELPRIM.tom"/>
</sub>

<sub type="PART" prompt='{{#SCRTIL}} world' name="L4031" layout="cols=1;screen.width=[130,870];order=1;">
[
["[L4031]                                 利率調整清單"],
[""],
]
</sub>
<sub type="SELECT">

#RPTFG=0,QUERY.GRID
#any={detail:true, header:'L4031.part',width:1000, caption:'', rowNum:60, rowList:[20,40,60]}

#OOLableAX=作業項目
{width:200,align:'center'}
#OOLableBX=註記
{width:320,align:'center'}
#OOBTN_TOTAL2=要處理
{search:false,formatter:'cust:bind-button:#OOSumCntX',align:'right',canExport:false,width:90}
#OOBTN_Exec=
{search:false,formatter:'cust:bind-button:#OOText_Exec',align:'center',canExport:false,width:90}
#OOBTN_TOTAL3=待處理
{search:false,formatter:'cust:bind-button:#OOSumCntX',align:'right',canExport:false,width:90}
#OOBTN_TOTAL1=總筆數
{search:false,formatter:'cust:bind-button:#OOSumCntX',align:'right',canExport:false,width:90}
#OOStatusX=作業狀態
{width:200,align:'center'}
^

<include src="PRT.icf::INQ04.sel" map="i=L4031;cpi=15"/>
#RateChangeDate
#CustType
%
#OORank
#OOLableA
#OOLableB
#OORglCnt
#OOExpCnt
#OONonExpCnt
@^
</sub>
