!---------- BASIC LABEL Variables ----------
<sub type="SYS">
</sub>

<sub type="SYS" name="label">
!#TXCD
!T(3,L4512)
</sub>

<sub type="DC" name="BFHEAD">
<include src="COM.icf::BFHEAD.dec"/>
!起始交易記號  0:起始交易,1:非起始交易
#ORGFG=_,_,S
E(0,0)

</sub>

!---------- 交易畫面及個別交易變數宣告 ----------
<sub type="DC" name="L4512" layout="cols=3;screen.width=[150,350,150,350];printer.width=[20,80];order=1">
[
["[L4512]@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@員工扣薪明細檔維護"],
[#<->#,"#FdFunctionCodeX+功能",#FunctionCodeX],
["#FdEntryDate+入帳日期",#EntryDate],["#FdPerfMonth+業績年月",#PerfMonth],
["#FdProcCode+流程別",#ProcCode],["#FdAcctCode+科目",#AcctCode,#AcctCodeX],
["#FdRepayCode+扣款代碼",#RepayCode,#RepayCodeX],["#FdAchRepayCode+入帳扣款別",#AchRepayCode,#AchRepayCodeX],
[#<->#,"#FdCustNo+戶號",#CustNo,"-",#FacmNo,"-","#BormNo"],
["#FdEmpNo+員工編號",#EmpNo],["#FdEmpName+員工姓名",#EmpName],
[#<->#,"#FdCustId+統一編號",#CustId],
["#FdTxAmt+交易金額",#TxAmt],["#FdDeptCode+部室代號",#DeptCode],
["#FdRepayAmt+應扣金額",#RepayAmt],["#FdUnitCode+單位代號",#UnitCode],
["#FdPrincipal+本金",#Principal],["#FdResignCode+離職代碼",#ResignCode],
["#FdInterest+利息",#Interest],["#FdPositCode+職務代號",#PositCode],
[#<->#,"#FdSumOvpayAmt+累溢短收",#SumOvpayAmt],
["#FdIntStartDate+計息起日",#IntStartDate],["#FdBatchNo+批次號碼",#BatchNo],
["#FdIntEndDate+計息迄日",#IntEndDate],["#FdErrMsg+失敗原因",#ErrMsg],
["#FdAcdate+會計日期",#Acdate],["#FdTitaTxtNo+交易序號",#TitaTxtNo],
]

#FdFunctionCodeX=X,2,L
#FdEntryDate=X,2,L
#FdPerfMonth=X,2,L
#FdProcCode=X,2,L
#FdAcctCode=X,2,L
#FdRepayCode=X,2,L
#FdAchRepayCode=X,2,L
#FdCustNo=X,2,L
#FdEmpNo=X,2,L
#FdEmpName=X,2,L
#FdCustId=X,2,L
#FdTxAmt=X,2,L
#FdDeptCode=X,2,L
#FdRepayAmt=X,2,L
#FdUnitCode=X,2,L
#FdPrincipal=X,2,L
#FdResignCode=X,2,L
#FdInterest=X,2,L
#FdPositCode=X,2,L
#FdSumOvpayAmt=X,2,L
#FdIntStartDate=X,2,L
#FdBatchNo=X,2,L
#FdIntEndDate=X,2,L
#FdErrMsg=X,2,L
#FdAcdate=X,2,L
#FdTitaTxtNo=X,2,L


#CHAIN=A,1,S
T(4,CHAIN$) 
IF(#CHAIN!=1,V(P,此為連動交易，請從交易:L4951進入),$)

<include src="HELPRIM.icf::HELPRIM.rtn"/>
! 功能下拉選單
#CDDEF01=x,20,S
T(3,CdCode.FuncCode)
#FunctionCdHelp=x,1024,S

! 入帳扣款別
#CDDEF02=x,20,S
T(3,CdCode.RepayCodeX)
#RepayCodeXHelp=x,1024,S

! 扣款代碼
#CDDEF03=x,20,S
T(3,CdCode.PerfRepayCode)
#PerfRepayCodeHelp=x,1024,S

! 業務科目
#CDDEF04=x,20,S
T(3,CdCode.AcctCode)
#AcctCodeHelp=x,1024,S

#FunctionCdHelpRim=X,1,S
RESET_RIM(#FunctionCdHelpRim,XXR99)
S(XXR99,01,#CDDEF01,#CDDEF02,#CDDEF03,#CDDEF04)
R(1,XXR99)
CALL(#HelpProc)
T(2,@FunctionCdHelp,#HelpDesc1)
T(2,@RepayCodeXHelp,#HelpDesc2)
T(2,@PerfRepayCodeHelp,#HelpDesc3)
T(2,@AcctCodeHelp,#HelpDesc4)

#NTXBUF=X,500,S
C(3,#CHAIN,1,T(4,NTXBUF$),S)
T(1,@FunctionCode,#NTXBUF,1,1)
T(1,@EntryDate,#NTXBUF,2,7)
T(1,@PerfMonth,#NTXBUF,9,5)
T(1,@ProcCode,#NTXBUF,14,1)
T(1,@AcctCode,#NTXBUF,15,3)
T(1,@RepayCode,#NTXBUF,18,1)
T(1,@AchRepayCode,#NTXBUF,19,2)
T(1,@CustNo,#NTXBUF,21,7)
T(1,@FacmNo,#NTXBUF,28,3)
T(1,@BormNo,#NTXBUF,31,3)
T(1,@MediaDate,#NTXBUF,34,7)
T(1,@MediaKind,#NTXBUF,41,1)
T(1,@MediaSeq,#NTXBUF,42,6)

#MediaDate=D,7,S
#MediaKind=X,1,S
#MediaSeq=A,6,S
#RimMediaDate=D,7,S
#RimMediaKind=X,1,S
#RimMediaSeq=A,6,S
! 預先塞中文內容
!T(H,@RepayCodeX,#RepayCode,#RepayCodeXHelp)
!T(H,@PerfRepayCodeX,#PerfRepayCode,#PerfRepayCodeHelp)

! #Pre_RepayAmt=m,16,S
! E(2,@RepayAmt,#Pre_RepayAmt/100)

! 功能
#FunctionCode=A,1,S
C(3,#CHAIN,0,E(0,#FunctionCode,5),s)
E(0,@FUNCIND,#FunctionCode)

#FunctionCodeX=X,4,L
T(H,#FunctionCode,#FunctionCdHelp)
C(2,#FunctionCode,$,K(MODIFYBUTTON,新增),K(MODIFYBUTTON,修改),$,K(MODIFYBUTTON,刪除),K(MODIFYBUTTON,查詢))
C(3,#FunctionCode,5,K(NOBUTTON,CLOSEY),$)

!刪除隱藏重新交易按鈕
#AGAIN=X,1,S
C(3,#FunctionCode,1,S,$)
E(0,1)ASGN(AGAIN$)

#ShowFd=X,1,S
C(2,#FunctionCode,T(3, ),T(3,*),T(3,),T(3,*),T(3, ),T(3, ))
T(2,@FdEntryDate,#ShowFd)     
T(2,@FdPerfMonth,#ShowFd) 
T(2,@FdProcCode,#ShowFd)
T(2,@FdAcctCode,#ShowFd)
T(2,@FdRepayCode,#ShowFd)
T(2,@FdAchRepayCode,#ShowFd)
T(2,@FdCustNo,#ShowFd)

!修改時關閉框線
#WKTF=X,1,S
IF(#FunctionCode==2,
T(F,@EntryDate,0)
T(F,@PerfMonth,0)
T(F,@ProcCode,0)
T(F,@AcctCode,0)
T(F,@RepayCode,0)
T(F,@AchRepayCode,0)
T(F,@CustNo,0)
T(F,@FacmNo,0)
T(F,@BormNo,0)
,$)

!刪除時關閉框線
#WKTF1=X,1,S
IF(#FunctionCode==4||#FunctionCode==5,
T(F,@EntryDate,0)
T(F,@PerfMonth,0)
T(F,@ProcCode,0)
T(F,@AcctCode,0)
T(F,@RepayCode,0)
T(F,@AchRepayCode,0)
T(F,@CustNo,0)
T(F,@FacmNo,0)
T(F,@BormNo,0)
T(F,@RepayAmt,0)
T(F,@Principal,0)
T(F,@Interest,0)
T(F,@SumOvpayAmt,0)
,$)

![入帳日期]
#EntryDate=D,7,I
C(3,#FunctionCode,1,$,s)
@V(7)A(DATE,0,#EntryDate)

#SetValue=A,1,S
C(3,#FunctionCode,1,$,s)
T(1,@PerfMonth,#SYSDATE,2,5)

![業績年月]
#PerfMonth=A,5,I
C(3,#FunctionCode,1,$,s)
@A(YM13,1,#PerfMonth)

![流程別]
#ProcCode=A,1,I
C(3,#FunctionCode,1,$,s)
@V(1,1,2,3,4,5,6,7,8,9)

![科目]
#AcctCode=X,3,I
C(3,#FunctionCode,1,$,s)
HELP(#AcctCodeHelp)
@V(7)V(H,#AcctCode,#AcctCodeHelp)

#AcctCodeX=X,20,L
T(H,#AcctCode,#AcctCodeHelp)

![扣款代碼]
#RepayCode=A,1,I
C(3,#FunctionCode,1,$,s)
HELP(#PerfRepayCodeHelp)
@V(H,#PerfRepayCodeHelp)

#RepayCodeX=X,10,L
T(H,#RepayCode,#PerfRepayCodeHelp)

![入帳扣款別]
#AchRepayCode=A,2,I
C(3,#FunctionCode,1,$,s)
HELP(#RepayCodeXHelp)
@V(H,#RepayCodeXHelp)

#AchRepayCodeX=X,10,L
T(H,#AchRepayCode,#RepayCodeXHelp)

![戶號]
#CustNo=A,7,I
C(3,#FunctionCode,1,$,s)
@V(2,0)

#RimFindCode=A,1,S
#RimCustNo=A,7,S
#RimFacmNo=A,3,S
#RimAcctNo=x,14,S
#RimBankNo=A,3,S

<include src="ROM.icf::L4R21.dec"/>
<include src="ROM.icf::L4R03.dec"/>
<include src="ROM.icf::L4R29.dec"/>

! 4R21
#SendL4R21A=X,1,S
E(0,@RimFindCode,1)
E(0,@RimCustNo,#CustNo)
RESET_RIM(#SendL4R21A,L4R21)
S(L4R21,1,#RimFindCode,#RimCustNo)
R(1,L4R21)

#CustCheck=A,1,S
IF(#L4r21CheckCode==1,$,V(P,該戶號不存在於客戶檔))

![額度]
#FacmNo=A,3,I
C(3,#FunctionCode,1,$,s)
@V(2,0)

![序號]
#BormNo=A,3,I
C(3,#FunctionCode,1,$,s)
@V(2,0)

#RimType=A,1,S

! 4R03
#SendL4R03A=X,1,S
E(0,@RimCustNo,#CustNo)
!RimType=1找尋客戶主檔，=2找郵局授權主檔
E(0,@RimType,1)
RESET_RIM(#RimL4r03,L4R03)
S(L4R03,1,#RimType,#RimCustNo)
R(1,L4R03)
T(2,@EmpNo,#L4r03EmpNo)
T(2,@EmpName,#L4r03CustName)
T(2,@CustId,#L4r03CustId)

#RimEntryDate=D,7,S
#RimPerfMonth=A,5,S
#RimProcCode=A,1,S
#RimAcctCode=X,3,S
#RimRepayCode=A,1,S
#RimAchRepayCode=A,2,S
#RimBormNo=A,3,S

!4r29
#SendL4R29=X,1,S
C(3,#FunctionCode,1,s,$)
E(0,@RimEntryDate,#EntryDate)
E(0,@RimPerfMonth,#PerfMonth)
T(2,@RimProcCode,#ProcCode)
T(2,@RimAcctCode,#AcctCode)
T(2,@RimRepayCode,#RepayCode)
E(0,@RimAchRepayCode,#AchRepayCode)
E(0,@RimCustNo,#CustNo)
E(0,@RimFacmNo,#FacmNo)
E(0,@RimBormNo,#BormNo)
E(0,@RimMediaDate,#MediaDate)
T(2,@RimMediaKind,#MediaKind)
E(0,@RimMediaSeq,#MediaSeq)
RESET_RIM(#RimL4r29,L4R29)
S(L4R29,1,#RimEntryDate,#RimPerfMonth,#RimProcCode,#RimAcctCode,#RimRepayCode,#RimAchRepayCode,#RimCustNo,#RimFacmNo,#RimBormNo,#RimMediaDate,#RimMediaKind,#RimMediaSeq)
R(1,L4R29)
E(0,@TxAmt,#L4R29TxAmt)
T(2,@DeptCode,#L4R29DeptCode)
E(0,@RepayAmt,#L4R29RepayAmt)
T(2,@UnitCode,#L4R29UnitCode)
E(0,@Principal,#L4R29Principal)
T(2,@ResignCode,#L4R29ResignCode)
E(0,@Interest,#L4R29Interest)
T(2,@PositCode,#L4R29PositCode)
E(0,@SumOvpayAmt,#L4R29SumOvpayAmt)
T(2,@IntStartDate,#L4R29IntStartDate)
T(2,@BatchNo,#L4R29BatchNo)
T(2,@IntEndDate,#L4R29IntEndDate)
T(2,@ErrMsg,#L4R29ErrMsg+-+#L4R29ErrMsgX)
T(2,@Acdate,#L4R29Acdate)
T(2,@TitaTxtNo,#L4R29TitaTxtNo)

![員工編號]
#EmpNo=X,6,L

![員工姓名]
#EmpName=X,10,L

![統一編號]
#CustId=X,10,L

![交易金額]
#TxAmt=m,14,L

![部室代號]
#DeptCode=X,6,L

![應扣金額]
#RepayAmt=m,14,I
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)

![單位代號]
#UnitCode=X,6,L

![本金]
#Principal=m,14,I
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)

![離職代碼]
#ResignCode=X,6,L

![利息]
#Interest=m,14,I
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)

![職務代號]
#PositCode=X,6,L

![累溢短收]
#SumOvpayAmt=+m,14,I
C(3,#FunctionCode,4,s,$)
C(3,#FunctionCode,5,s,$)

![計息起日]
#IntStartDate=D,7,L

![批次號碼]
#BatchNo=X,6,L

![計息迄日]
#IntEndDate=D,7,L

![失敗原因]
#ErrMsg=X,80,L

![會計日期]
#Acdate=D,7,L

![交易序號]
#TitaTxtNo=A,8,L

</sub>

!---------- 輸出共用變數宣告區 ----------
<sub type="RTN" name="AFXMT">
<include src="PRT.icf::PRTHEAD.rtn"/>
</sub>

!------------ TXFORM = L4512 -----------
<sub type="FORM" name="L4512">
</sub>

!------ 上行電文 TEXT ------
<sub type="TIM">
#FunctionCode
#EntryDate
#PerfMonth
#ProcCode
#AcctCode
#RepayCode
#AchRepayCode
#CustNo
#FacmNo
#BormNo
#RepayAmt
#Principal
#Interest
#SumOvpayAmt
</sub>

!------ 下行電文TOM ------
<sub type="TOM">
<include src="COM.icf::TRCTL.tom"/>
<include src="HELPRIM.icf::HELPRIM.tom"/>
<include src="ROM.icf::L4R21.tom"/>
<include src="ROM.icf::L4R03.tom"/>
<include src="ROM.icf::L4R29.tom"/>
TXFORM=L4512

^
</sub>

!---------- 單據輸出組合 ----------
<sub type="SELECT">
<include src="PRT.icf::UPD01.sel"/>

</sub>
